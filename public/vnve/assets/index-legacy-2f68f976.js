System.register(["./vendor-legacy-ca608f0c.js"],function(e,t){"use strict";var a,s,n,i,r,o,l,c,d,h,m,u,p,x,f,g,v,b,w,y,j,k,N,S,C,Z,G,V,W,T,X,R,L,I,z,K,F,Y,H,M,B,D,U,E,J,P,O,A,Q,_,$,q,ee,te,ae,se,ne,ie,re,oe,le,ce,de,he,me,ue,pe,xe,fe,ge,ve,be,we,ye,je,ke,Ne,Se,Ce,Ze,Ge,Ve,We,Te,Xe,Re,Le,Ie,ze,Ke,Fe,Ye,He,Me,Be,De,Ue,Ee,Je,Pe,Oe,Ae,Qe,_e,$e,qe,et,tt,at,st,nt,it,rt,ot,lt,ct,dt,ht,mt,ut,pt,xt,ft,gt,vt,bt,wt,yt,jt,kt,Nt,St,Ct,Zt,Gt,Vt,Wt,Tt,Xt,Rt,Lt,It,zt,Kt,Ft,Yt,Ht,Mt,Bt,Dt,Ut,Et,Jt,Pt,Ot,At,Qt,_t,$t,qt,ea,ta,aa,sa,na,ia,ra,oa,la,ca,da,ha,ma,ua,pa,xa,fa,ga,va,ba,wa,ya,ja,ka,Na,Sa,Ca,Za,Ga,Va,Wa,Ta,Xa,Ra,La,Ia,za,Ka,Fa,Ya,Ha,Ma,Ba,Da,Ua,Ea,Ja,Pa,Oa,Aa,Qa,_a,$a,qa,es,ts,as,ss,ns,is,rs,os,ls,cs,ds,hs,ms,us,ps,xs,fs,gs,vs,bs,ws,ys,js,ks,Ns,Ss,Cs,Zs,Gs,Vs,Ws,Ts,Xs,Rs,Ls,Is,zs,Ks,Fs,Ys,Hs,Ms,Bs,Ds,Us,Es,Js,Ps,Os,As,Qs,_s,$s,qs,en,tn,an,sn,nn,rn,on,ln,cn,dn,hn,mn,un,pn,xn,fn,gn,vn,bn,wn,yn,jn,kn,Nn,Sn,Cn,Zn,Gn,Vn,Wn,Tn,Xn,Rn,Ln,In;return{setters:[e=>{a=e.t,s=e.c,n=e.r,i=e.j,r=e.n,o=e.l,l=e.C,c=e.B,d=e.N,h=e.a,m=e.T,u=e.G,p=e.b,x=e.R,f=e.F,g=e.L,v=e.d,b=e.E,w=e.e,y=e.f,j=e.g,k=e.S,N=e.A,S=e.h,C=e.p,Z=e.i,G=e.k,V=e.U,W=e.M,T=e.m,X=e.o,R=e.q,L=e.s,I=e.u,z=e.P,K=e.v,F=e.w,Y=e.x,H=e.y,M=e.z,B=e.D,D=e.H,U=e.V,E=e.I,J=e.J,P=e.K,O=e.O,A=e.Q,Q=e.W,_=e.X,$=e.Y,q=e.Z,ee=e._,te=e.$,ae=e.a0,se=e.a1,ne=e.a2,ie=e.a3,re=e.a4,oe=e.a5,le=e.a6,ce=e.a7,de=e.a8,he=e.a9,me=e.aa,ue=e.ab,pe=e.ac,xe=e.ad,fe=e.ae,ge=e.af,ve=e.ag,be=e.ah,we=e.ai,ye=e.aj,je=e.ak,ke=e.al,Ne=e.am,Se=e.an,Ce=e.ao,Ze=e.ap,Ge=e.aq,Ve=e.ar,We=e.as,Te=e.at,Xe=e.au,Re=e.av,Le=e.aw,Ie=e.ax,ze=e.ay,Ke=e.az,Fe=e.aA,Ye=e.aB,He=e.aC,Me=e.aD,Be=e.aE,De=e.aF,Ue=e.aG,Ee=e.aH,Je=e.aI,Pe=e.aJ,Oe=e.aK,Ae=e.aL,Qe=e.aM,_e=e.aN,$e=e.aO,qe=e.aP,et=e.aQ,tt=e.aR,at=e.aS,st=e.aT,nt=e.aU,it=e.aV,rt=e.aW,ot=e.aX,lt=e.aY,ct=e.aZ,dt=e.a_,ht=e.a$,mt=e.b0,ut=e.b1,pt=e.b2,xt=e.b3,ft=e.b4,gt=e.b5,vt=e.b6,bt=e.b7,wt=e.b8,yt=e.b9,jt=e.ba,kt=e.bb,Nt=e.bc,St=e.bd,Ct=e.be,Zt=e.bf,Gt=e.bg,Vt=e.bh,Wt=e.bi,Tt=e.bj,Xt=e.bk,Rt=e.bl,Lt=e.bm,It=e.bn,zt=e.bo,Kt=e.bp,Ft=e.bq,Yt=e.br,Ht=e.bs,Mt=e.bt,Bt=e.bu,Dt=e.bv,Ut=e.bw,Et=e.bx,Jt=e.by,Pt=e.bz,Ot=e.bA,At=e.bB,Qt=e.bC,_t=e.bD,$t=e.bE,qt=e.bF,ea=e.bG,ta=e.bH,aa=e.bI,sa=e.bJ,na=e.bK,ia=e.bL,ra=e.bM,oa=e.bN,la=e.bO,ca=e.bP,da=e.bQ,ha=e.bR,ma=e.bS,ua=e.bT,pa=e.bU,xa=e.bV,fa=e.bW,ga=e.bX,va=e.bY,ba=e.bZ,wa=e.b_,ya=e.b$,ja=e.c0,ka=e.c1,Na=e.c2,Sa=e.c3,Ca=e.c4,Za=e.c5,Ga=e.c6,Va=e.c7,Wa=e.c8,Ta=e.c9,Xa=e.ca,Ra=e.cb,La=e.cc,Ia=e.cd,za=e.ce,Ka=e.cf,Fa=e.cg,Ya=e.ch,Ha=e.ci,Ma=e.cj,Ba=e.ck,Da=e.cl,Ua=e.cm,Ea=e.cn,Ja=e.co,Pa=e.cp,Oa=e.cq,Aa=e.cr,Qa=e.cs,_a=e.ct,$a=e.cu,qa=e.cv,es=e.cw,ts=e.cx,as=e.cy,ss=e.cz,ns=e.cA,is=e.cB,rs=e.cC,os=e.cD,ls=e.cE,cs=e.cF,ds=e.cG,hs=e.cH,ms=e.cI,us=e.cJ,ps=e.cK,xs=e.cL,fs=e.cM,gs=e.cN,vs=e.cO,bs=e.cP,ws=e.cQ,ys=e.cR,js=e.cS,ks=e.cT,Ns=e.cU,Ss=e.cV,Cs=e.cW,Zs=e.cX,Gs=e.cY,Vs=e.cZ,Ws=e.c_,Ts=e.c$,Xs=e.d0,Rs=e.d1,Ls=e.d2,Is=e.d3,zs=e.d4,Ks=e.d5,Fs=e.d6,Ys=e.d7,Hs=e.d8,Ms=e.d9,Bs=e.da,Ds=e.db,Us=e.dc,Es=e.dd,Js=e.de,Ps=e.df,Os=e.dg,As=e.dh,Qs=e.di,_s=e.dj,$s=e.dk,qs=e.dl,en=e.dm,tn=e.dn,an=e.dp,sn=e.dq,nn=e.dr,rn=e.ds,on=e.dt,ln=e.du,cn=e.dv,dn=e.dw,hn=e.dx,mn=e.dy,un=e.dz,pn=e.dA,xn=e.dB,fn=e.dC,gn=e.dD,vn=e.dE,bn=e.dF,wn=e.dG,yn=e.dH,jn=e.dI,kn=e.dJ,Nn=e.dK,Sn=e.dL,Cn=e.dM,Zn=e.dN,Gn=e.dO,Vn=e.dP,Wn=e.dQ,Tn=e.dR,Xn=e.dS,Rn=e.dT,Ln=e.dU,In=e.dV}],execute:function(){var e=document.createElement("style");e.textContent='*,:before,:after{--tw-border-spacing-x: 0;--tw-border-spacing-y: 0;--tw-translate-x: 0;--tw-translate-y: 0;--tw-rotate: 0;--tw-skew-x: 0;--tw-skew-y: 0;--tw-scale-x: 1;--tw-scale-y: 1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness: proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width: 0px;--tw-ring-offset-color: #fff;--tw-ring-color: rgb(59 130 246 / .5);--tw-ring-offset-shadow: 0 0 #0000;--tw-ring-shadow: 0 0 #0000;--tw-shadow: 0 0 #0000;--tw-shadow-colored: 0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }::backdrop{--tw-border-spacing-x: 0;--tw-border-spacing-y: 0;--tw-translate-x: 0;--tw-translate-y: 0;--tw-rotate: 0;--tw-skew-x: 0;--tw-skew-y: 0;--tw-scale-x: 1;--tw-scale-y: 1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness: proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width: 0px;--tw-ring-offset-color: #fff;--tw-ring-color: rgb(59 130 246 / .5);--tw-ring-offset-shadow: 0 0 #0000;--tw-ring-shadow: 0 0 #0000;--tw-shadow: 0 0 #0000;--tw-shadow-colored: 0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }*,:before,:after{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}:before,:after{--tw-content: ""}html,:host{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;-o-tab-size:4;tab-size:4;font-family:ui-sans-serif,system-ui,sans-serif,"Apple Color Emoji","Segoe UI Emoji",Segoe UI Symbol,"Noto Color Emoji";font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,samp,pre{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;font-feature-settings:normal;font-variation-settings:normal;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button,input,optgroup,select,textarea{font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;letter-spacing:inherit;color:inherit;margin:0;padding:0}button,select{text-transform:none}button,input:where([type=button]),input:where([type=reset]),input:where([type=submit]){-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dl,dd,h1,h2,h3,h4,h5,h6,hr,figure,p,pre{margin:0}fieldset{margin:0;padding:0}legend{padding:0}ol,ul,menu{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::-moz-placeholder,textarea::-moz-placeholder{opacity:1;color:#9ca3af}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}button,[role=button]{cursor:pointer}:disabled{cursor:default}img,svg,video,canvas,audio,iframe,embed,object{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}[hidden]:where(:not([hidden=until-found])){display:none}:root{--background: 0 0% 100%;--foreground: 222.2 84% 4.9%;--card: 0 0% 100%;--card-foreground: 222.2 84% 4.9%;--popover: 0 0% 100%;--popover-foreground: 222.2 84% 4.9%;--primary: 222.2 47.4% 11.2%;--primary-foreground: 210 40% 98%;--secondary: 210 40% 96.1%;--secondary-foreground: 222.2 47.4% 11.2%;--muted: 210 40% 96.1%;--muted-foreground: 215.4 16.3% 46.9%;--accent: 210 40% 96.1%;--accent-foreground: 222.2 47.4% 11.2%;--destructive: 0 84.2% 60.2%;--destructive-foreground: 210 40% 98%;--border: 214.3 31.8% 91.4%;--input: 214.3 31.8% 91.4%;--ring: 222.2 84% 4.9%;--radius: .5rem;--chart-1: 12 76% 61%;--chart-2: 173 58% 39%;--chart-3: 197 37% 24%;--chart-4: 43 74% 66%;--chart-5: 27 87% 67%}.dark{--background: 0 0% 0%;--foreground: 0 0% 88%;--card: 0 0% 0%;--card-foreground: 0 0% 88%;--popover: 0 0% 0%;--popover-foreground: 0 0% 88%;--primary: 0 0% 100%;--primary-foreground: 0 0% 0%;--secondary: 0 0% 10%;--secondary-foreground: 0 0% 88%;--muted: 0 0% 10%;--muted-foreground: 0 0% 60%;--accent: 0 0% 15%;--accent-foreground: 0 0% 100%;--destructive: 0 62.8% 30.6%;--destructive-foreground: 210 40% 98%;--border: 0 0% 20%;--input: 0 0% 20%;--ring: 0 0% 80%;--chart-1: 220 70% 50%;--chart-2: 160 60% 45%;--chart-3: 30 80% 55%;--chart-4: 280 65% 60%;--chart-5: 340 75% 55%}*{border-color:hsl(var(--border))}body{background-color:hsl(var(--background));color:hsl(var(--foreground));font-family:Share Tech Mono,"Fusion Pixel 12px Monospaced",Courier New,Courier,PingFang SC,monospace}.container{width:100%;margin-right:auto;margin-left:auto;padding-right:2rem;padding-left:2rem}@media (min-width: 1400px){.container{max-width:1400px}}.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border-width:0}.pointer-events-none{pointer-events:none}.pointer-events-auto{pointer-events:auto}.\\!visible{visibility:visible!important}.visible{visibility:visible}.invisible{visibility:hidden}.fixed{position:fixed}.absolute{position:absolute}.relative{position:relative}.sticky{position:sticky}.inset-0{top:0;right:0;bottom:0;left:0}.inset-x-0{left:0;right:0}.inset-y-0{top:0;bottom:0}.-bottom-px{bottom:-1px}.-right-1{right:-.25rem}.-top-1{top:-.25rem}.-top-px{top:-1px}.bottom-0{bottom:0}.left-0{left:0}.left-2{left:.5rem}.left-\\[50\\%\\]{left:50%}.right-0{right:0}.right-1{right:.25rem}.right-2{right:.5rem}.right-4{right:1rem}.top-0{top:0}.top-1{top:.25rem}.top-4{top:1rem}.top-\\[50\\%\\]{top:50%}.z-10{z-index:10}.z-20{z-index:20}.z-40{z-index:40}.z-50{z-index:50}.z-\\[100\\]{z-index:100}.z-\\[500\\]{z-index:500}.m-0{margin:0}.m-1{margin:.25rem}.-mx-1{margin-left:-.25rem;margin-right:-.25rem}.mx-0\\.5{margin-left:.125rem;margin-right:.125rem}.mx-1{margin-left:.25rem;margin-right:.25rem}.mx-auto{margin-left:auto;margin-right:auto}.my-1{margin-top:.25rem;margin-bottom:.25rem}.my-1\\.5{margin-top:.375rem;margin-bottom:.375rem}.\\!mb-4{margin-bottom:1rem!important}.\\!mt-auto{margin-top:auto!important}.-ml-1{margin-left:-.25rem}.-mr-3{margin-right:-.75rem}.mb-1{margin-bottom:.25rem}.mb-2{margin-bottom:.5rem}.mb-4{margin-bottom:1rem}.ml-0\\.5{margin-left:.125rem}.ml-1{margin-left:.25rem}.ml-2{margin-left:.5rem}.ml-auto{margin-left:auto}.mr-0{margin-right:0}.mr-0\\.5{margin-right:.125rem}.mr-1{margin-right:.25rem}.mr-2{margin-right:.5rem}.mr-3{margin-right:.75rem}.mr-auto{margin-right:auto}.mt-1{margin-top:.25rem}.mt-2{margin-top:.5rem}.mt-24{margin-top:6rem}.mt-4{margin-top:1rem}.mt-auto{margin-top:auto}.box-content{box-sizing:content-box}.block{display:block}.inline-block{display:inline-block}.inline{display:inline}.flex{display:flex}.inline-flex{display:inline-flex}.table{display:table}.grid{display:grid}.hidden{display:none}.aspect-\\[1\\/1\\]{aspect-ratio:1/1}.aspect-\\[16\\/3\\]{aspect-ratio:16/3}.aspect-\\[16\\/9\\]{aspect-ratio:16/9}.aspect-\\[9\\/16\\]{aspect-ratio:9/16}.\\!size-4{width:1rem!important;height:1rem!important}.size-10{width:2.5rem;height:2.5rem}.size-3\\.5{width:.875rem;height:.875rem}.size-4{width:1rem;height:1rem}.size-5{width:1.25rem;height:1.25rem}.size-6{width:1.5rem;height:1.5rem}.size-9{width:2.25rem;height:2.25rem}.size-full{width:100%;height:100%}.h-0\\.5{height:.125rem}.h-1\\.5{height:.375rem}.h-10{height:2.5rem}.h-11{height:2.75rem}.h-12{height:3rem}.h-2{height:.5rem}.h-2\\.5{height:.625rem}.h-3{height:.75rem}.h-3\\.5{height:.875rem}.h-4{height:1rem}.h-5{height:1.25rem}.h-6{height:1.5rem}.h-8{height:2rem}.h-9{height:2.25rem}.h-\\[1\\.3em\\]{height:1.3em}.h-\\[1\\.5em\\]{height:1.5em}.h-\\[120px\\]{height:120px}.h-\\[32px\\]{height:32px}.h-\\[400px\\]{height:400px}.h-\\[50vh\\]{height:50vh}.h-\\[53px\\]{height:53px}.h-\\[90vh\\]{height:90vh}.h-\\[calc\\(100\\%-2\\.5rem\\)\\]{height:calc(100% - 2.5rem)}.h-\\[calc\\(100vh-53px-1rem\\)\\]{height:calc(100vh - 53px - 1rem)}.h-\\[var\\(--radix-select-trigger-height\\)\\]{height:var(--radix-select-trigger-height)}.h-auto{height:auto}.h-full{height:100%}.h-px{height:1px}.h-screen{height:100vh}.max-h-96{max-height:24rem}.max-h-\\[288px\\]{max-height:288px}.max-h-\\[50\\%\\]{max-height:50%}.max-h-\\[500px\\]{max-height:500px}.max-h-\\[80vh\\]{max-height:80vh}.max-h-screen{max-height:100vh}.min-h-\\[1lh\\]{min-height:1lh}.min-h-\\[400px\\]{min-height:400px}.min-h-\\[60px\\]{min-height:60px}.min-h-\\[80px\\]{min-height:80px}.w-12{width:3rem}.w-2\\.5{width:.625rem}.w-3{width:.75rem}.w-3\\.5{width:.875rem}.w-3\\/4{width:75%}.w-4{width:1rem}.w-5{width:1.25rem}.w-6{width:1.5rem}.w-72{width:18rem}.w-8{width:2rem}.w-9{width:2.25rem}.w-\\[100px\\]{width:100px}.w-\\[120px\\]{width:120px}.w-\\[200px\\]{width:200px}.w-\\[260px\\]{width:260px}.w-\\[300px\\]{width:300px}.w-\\[330px\\]{width:330px}.w-\\[3rem\\]{width:3rem}.w-\\[4rem\\]{width:4rem}.w-\\[80px\\]{width:80px}.w-\\[8rem\\]{width:8rem}.w-auto{width:auto}.w-full{width:100%}.w-px{width:1px}.min-w-0{min-width:0px}.min-w-32{min-width:8rem}.min-w-\\[12rem\\]{min-width:12rem}.min-w-\\[150px\\]{min-width:150px}.min-w-\\[180px\\]{min-width:180px}.min-w-\\[35px\\]{min-width:35px}.min-w-\\[36px\\]{min-width:36px}.min-w-\\[400px\\]{min-width:400px}.min-w-\\[70vw\\]{min-width:70vw}.min-w-\\[80vw\\]{min-width:80vw}.min-w-\\[8rem\\]{min-width:8rem}.min-w-\\[90vw\\]{min-width:90vw}.min-w-\\[auto\\]{min-width:auto}.min-w-\\[var\\(--radix-select-trigger-width\\)\\]{min-width:var(--radix-select-trigger-width)}.max-w-\\[100px\\]{max-width:100px}.max-w-\\[150px\\]{max-width:150px}.max-w-lg{max-width:32rem}.flex-1{flex:1 1 0%}.flex-shrink-0,.shrink-0{flex-shrink:0}.flex-grow,.grow{flex-grow:1}.caption-bottom{caption-side:bottom}.-translate-x-full{--tw-translate-x: -100%;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.translate-x-\\[-50\\%\\]{--tw-translate-x: -50%;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.translate-y-\\[-50\\%\\]{--tw-translate-y: -50%;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.transform{transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}@keyframes spin{to{transform:rotate(360deg)}}.animate-spin{animation:spin 1s linear infinite}.cursor-default{cursor:default}.cursor-not-allowed{cursor:not-allowed}.cursor-pointer{cursor:pointer}.cursor-text{cursor:text}.touch-none{touch-action:none}.select-none{-webkit-user-select:none;-moz-user-select:none;user-select:none}.resize{resize:both}.grid-cols-1{grid-template-columns:repeat(1,minmax(0,1fr))}.grid-cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}.flex-row{flex-direction:row}.flex-col{flex-direction:column}.flex-col-reverse{flex-direction:column-reverse}.flex-wrap{flex-wrap:wrap}.items-start{align-items:flex-start}.items-center{align-items:center}.justify-start{justify-content:flex-start}.justify-end{justify-content:flex-end}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.justify-around{justify-content:space-around}.gap-0\\.5{gap:.125rem}.gap-1{gap:.25rem}.gap-1\\.5{gap:.375rem}.gap-2{gap:.5rem}.gap-3{gap:.75rem}.gap-4{gap:1rem}.space-x-1>:not([hidden])~:not([hidden]){--tw-space-x-reverse: 0;margin-right:calc(.25rem * var(--tw-space-x-reverse));margin-left:calc(.25rem * calc(1 - var(--tw-space-x-reverse)))}.space-x-2>:not([hidden])~:not([hidden]){--tw-space-x-reverse: 0;margin-right:calc(.5rem * var(--tw-space-x-reverse));margin-left:calc(.5rem * calc(1 - var(--tw-space-x-reverse)))}.space-x-4>:not([hidden])~:not([hidden]){--tw-space-x-reverse: 0;margin-right:calc(1rem * var(--tw-space-x-reverse));margin-left:calc(1rem * calc(1 - var(--tw-space-x-reverse)))}.space-x-6>:not([hidden])~:not([hidden]){--tw-space-x-reverse: 0;margin-right:calc(1.5rem * var(--tw-space-x-reverse));margin-left:calc(1.5rem * calc(1 - var(--tw-space-x-reverse)))}.space-y-0>:not([hidden])~:not([hidden]){--tw-space-y-reverse: 0;margin-top:calc(0px * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(0px * var(--tw-space-y-reverse))}.space-y-1>:not([hidden])~:not([hidden]){--tw-space-y-reverse: 0;margin-top:calc(.25rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(.25rem * var(--tw-space-y-reverse))}.space-y-1\\.5>:not([hidden])~:not([hidden]){--tw-space-y-reverse: 0;margin-top:calc(.375rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(.375rem * var(--tw-space-y-reverse))}.space-y-2>:not([hidden])~:not([hidden]){--tw-space-y-reverse: 0;margin-top:calc(.5rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(.5rem * var(--tw-space-y-reverse))}.space-y-4>:not([hidden])~:not([hidden]){--tw-space-y-reverse: 0;margin-top:calc(1rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(1rem * var(--tw-space-y-reverse))}.space-y-8>:not([hidden])~:not([hidden]){--tw-space-y-reverse: 0;margin-top:calc(2rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(2rem * var(--tw-space-y-reverse))}.self-center{align-self:center}.overflow-auto{overflow:auto}.overflow-hidden{overflow:hidden}.overflow-x-auto{overflow-x:auto}.overflow-y-auto{overflow-y:auto}.text-ellipsis{text-overflow:ellipsis}.whitespace-nowrap{white-space:nowrap}.whitespace-pre-wrap{white-space:pre-wrap}.text-nowrap{text-wrap:nowrap}.break-words{overflow-wrap:break-word}.break-all{word-break:break-all}.rounded{border-radius:.25rem}.rounded-\\[inherit\\]{border-radius:inherit}.rounded-full{border-radius:9999px}.rounded-lg{border-radius:var(--radius)}.rounded-md{border-radius:calc(var(--radius) - 2px)}.rounded-sm{border-radius:calc(var(--radius) - 4px)}.rounded-xl{border-radius:.75rem}.rounded-b-none{border-bottom-right-radius:0;border-bottom-left-radius:0}.rounded-t-\\[10px\\]{border-top-left-radius:10px;border-top-right-radius:10px}.rounded-t-lg{border-top-left-radius:var(--radius);border-top-right-radius:var(--radius)}.rounded-t-none{border-top-left-radius:0;border-top-right-radius:0}.border{border-width:1px}.border-0{border-width:0px}.border-2{border-width:2px}.border-b{border-bottom-width:1px}.border-l{border-left-width:1px}.border-l-2{border-left-width:2px}.border-r{border-right-width:1px}.border-t{border-top-width:1px}.border-t-0{border-top-width:0px}.border-none{border-style:none}.border-border{border-color:hsl(var(--border))}.border-destructive{border-color:hsl(var(--destructive))}.border-destructive\\/50{border-color:hsl(var(--destructive) / .5)}.border-input{border-color:hsl(var(--input))}.border-primary\\/50{border-color:hsl(var(--primary) / .5)}.border-transparent{border-color:transparent}.border-white\\/50{border-color:rgba(255,255,255,.5)}.border-b-border{border-bottom-color:hsl(var(--border))}.border-l-transparent{border-left-color:transparent}.border-l-yellow-500{--tw-border-opacity: 1;border-left-color:rgb(234 179 8 / var(--tw-border-opacity, 1))}.border-t-border{border-top-color:hsl(var(--border))}.border-t-transparent{border-top-color:transparent}.border-t-yellow-500\\/50{border-top-color:rgba(234,179,8,.5)}.bg-background{background-color:hsl(var(--background))}.bg-background\\/95{background-color:hsl(var(--background) / .95)}.bg-black\\/80{background-color:rgba(0,0,0,.8)}.bg-border{background-color:hsl(var(--border))}.bg-card{background-color:hsl(var(--card))}.bg-destructive{background-color:hsl(var(--destructive))}.bg-muted{background-color:hsl(var(--muted))}.bg-muted\\/50{background-color:hsl(var(--muted) / .5)}.bg-muted\\/80{background-color:hsl(var(--muted) / .8)}.bg-popover{background-color:hsl(var(--popover))}.bg-primary{background-color:hsl(var(--primary))}.bg-primary\\/20{background-color:hsl(var(--primary) / .2)}.bg-ring{background-color:hsl(var(--ring))}.bg-secondary{background-color:hsl(var(--secondary))}.bg-transparent{background-color:transparent}.bg-white{--tw-bg-opacity: 1;background-color:rgb(255 255 255 / var(--tw-bg-opacity, 1))}.bg-yellow-500\\/20{background-color:rgba(234,179,8,.2)}.fill-current{fill:currentColor}.object-contain{-o-object-fit:contain;object-fit:contain}.p-0{padding:0}.p-1{padding:.25rem}.p-2{padding:.5rem}.p-4{padding:1rem}.p-6{padding:1.5rem}.p-\\[1px\\]{padding:1px}.px-0{padding-left:0;padding-right:0}.px-1{padding-left:.25rem;padding-right:.25rem}.px-1\\.5{padding-left:.375rem;padding-right:.375rem}.px-2{padding-left:.5rem;padding-right:.5rem}.px-3{padding-left:.75rem;padding-right:.75rem}.px-4{padding-left:1rem;padding-right:1rem}.px-5{padding-left:1.25rem;padding-right:1.25rem}.px-8{padding-left:2rem;padding-right:2rem}.py-0\\.5{padding-top:.125rem;padding-bottom:.125rem}.py-1{padding-top:.25rem;padding-bottom:.25rem}.py-1\\.5{padding-top:.375rem;padding-bottom:.375rem}.py-2{padding-top:.5rem;padding-bottom:.5rem}.py-3{padding-top:.75rem;padding-bottom:.75rem}.pb-0{padding-bottom:0}.pb-1{padding-bottom:.25rem}.pb-4{padding-bottom:1rem}.pl-2{padding-left:.5rem}.pl-3{padding-left:.75rem}.pl-8{padding-left:2rem}.pr-1{padding-right:.25rem}.pr-2{padding-right:.5rem}.pr-6{padding-right:1.5rem}.pr-8{padding-right:2rem}.pt-0{padding-top:0}.pt-1{padding-top:.25rem}.pt-2{padding-top:.5rem}.pt-\\[2px\\]{padding-top:2px}.pt-\\[3px\\]{padding-top:3px}.text-left{text-align:left}.text-center{text-align:center}.text-right{text-align:right}.align-baseline{vertical-align:baseline}.align-middle{vertical-align:middle}.text-2xl{font-size:1.5rem;line-height:2rem}.text-\\[0\\.8rem\\]{font-size:.8rem}.text-\\[1\\.1em\\]{font-size:1.1em}.text-\\[1\\.25em\\]{font-size:1.25em}.text-\\[1\\.5em\\]{font-size:1.5em}.text-\\[1\\.875em\\]{font-size:1.875em}.text-base{font-size:1rem;line-height:1.5rem}.text-lg{font-size:1.125rem;line-height:1.75rem}.text-sm{font-size:.875rem;line-height:1.25rem}.text-xl{font-size:1.25rem;line-height:1.75rem}.text-xs{font-size:.75rem;line-height:1rem}.font-bold{font-weight:700}.font-medium{font-weight:500}.font-normal{font-weight:400}.font-semibold{font-weight:600}.italic{font-style:italic}.leading-6{line-height:1.5rem}.leading-none{line-height:1}.tracking-tight{letter-spacing:-.025em}.tracking-widest{letter-spacing:.1em}.text-card-foreground{color:hsl(var(--card-foreground))}.text-destructive{color:hsl(var(--destructive))}.text-destructive-foreground{color:hsl(var(--destructive-foreground))}.text-foreground{color:hsl(var(--foreground))}.text-foreground\\/50{color:hsl(var(--foreground) / .5)}.text-gray-600{--tw-text-opacity: 1;color:rgb(75 85 99 / var(--tw-text-opacity, 1))}.text-muted-foreground{color:hsl(var(--muted-foreground))}.text-muted-foreground\\/30{color:hsl(var(--muted-foreground) / .3)}.text-muted-foreground\\/50{color:hsl(var(--muted-foreground) / .5)}.text-neutral-600{--tw-text-opacity: 1;color:rgb(82 82 82 / var(--tw-text-opacity, 1))}.text-popover-foreground{color:hsl(var(--popover-foreground))}.text-primary{color:hsl(var(--primary))}.text-primary-foreground{color:hsl(var(--primary-foreground))}.text-primary\\/60{color:hsl(var(--primary) / .6)}.text-secondary-foreground{color:hsl(var(--secondary-foreground))}.underline{text-decoration-line:underline}.decoration-primary{text-decoration-color:hsl(var(--primary))}.underline-offset-4{text-underline-offset:4px}.opacity-0{opacity:0}.opacity-100{opacity:1}.opacity-50{opacity:.5}.opacity-60{opacity:.6}.opacity-70{opacity:.7}.opacity-90{opacity:.9}.shadow{--tw-shadow: 0 1px 3px 0 rgb(0 0 0 / .1), 0 1px 2px -1px rgb(0 0 0 / .1);--tw-shadow-colored: 0 1px 3px 0 var(--tw-shadow-color), 0 1px 2px -1px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.shadow-lg{--tw-shadow: 0 10px 15px -3px rgb(0 0 0 / .1), 0 4px 6px -4px rgb(0 0 0 / .1);--tw-shadow-colored: 0 10px 15px -3px var(--tw-shadow-color), 0 4px 6px -4px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.shadow-md{--tw-shadow: 0 4px 6px -1px rgb(0 0 0 / .1), 0 2px 4px -2px rgb(0 0 0 / .1);--tw-shadow-colored: 0 4px 6px -1px var(--tw-shadow-color), 0 2px 4px -2px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.shadow-none{--tw-shadow: 0 0 #0000;--tw-shadow-colored: 0 0 #0000;box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.shadow-sm{--tw-shadow: 0 1px 2px 0 rgb(0 0 0 / .05);--tw-shadow-colored: 0 1px 2px 0 var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.outline-none{outline:2px solid transparent;outline-offset:2px}.outline{outline-style:solid}.ring-0{--tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(0px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow, 0 0 #0000)}.ring-1{--tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(1px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow, 0 0 #0000)}.ring-2{--tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow, 0 0 #0000)}.ring-ring{--tw-ring-color: hsl(var(--ring))}.ring-offset-background{--tw-ring-offset-color: hsl(var(--background))}.\\!filter{filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)!important}.filter{filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.backdrop-blur{--tw-backdrop-blur: blur(8px);backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia)}.transition{transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.transition-all{transition-property:all;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.transition-colors{transition-property:color,background-color,border-color,text-decoration-color,fill,stroke;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.transition-opacity{transition-property:opacity;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.transition-transform{transition-property:transform;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.duration-200{transition-duration:.2s}.ease-in-out{transition-timing-function:cubic-bezier(.4,0,.2,1)}@keyframes enter{0%{opacity:var(--tw-enter-opacity, 1);transform:translate3d(var(--tw-enter-translate-x, 0),var(--tw-enter-translate-y, 0),0) scale3d(var(--tw-enter-scale, 1),var(--tw-enter-scale, 1),var(--tw-enter-scale, 1)) rotate(var(--tw-enter-rotate, 0))}}@keyframes exit{to{opacity:var(--tw-exit-opacity, 1);transform:translate3d(var(--tw-exit-translate-x, 0),var(--tw-exit-translate-y, 0),0) scale3d(var(--tw-exit-scale, 1),var(--tw-exit-scale, 1),var(--tw-exit-scale, 1)) rotate(var(--tw-exit-rotate, 0))}}.animate-in{animation-name:enter;animation-duration:.15s;--tw-enter-opacity: initial;--tw-enter-scale: initial;--tw-enter-rotate: initial;--tw-enter-translate-x: initial;--tw-enter-translate-y: initial}.fade-in-0{--tw-enter-opacity: 0}.zoom-in-95{--tw-enter-scale: .95}.duration-200{animation-duration:.2s}.ease-in-out{animation-timing-function:cubic-bezier(.4,0,.2,1)}.file\\:border-0::file-selector-button{border-width:0px}.file\\:bg-background::file-selector-button{background-color:hsl(var(--background))}.file\\:bg-transparent::file-selector-button{background-color:transparent}.file\\:text-sm::file-selector-button{font-size:.875rem;line-height:1.25rem}.file\\:font-medium::file-selector-button{font-weight:500}.file\\:text-foreground::file-selector-button{color:hsl(var(--foreground))}.placeholder\\:text-muted-foreground::-moz-placeholder{color:hsl(var(--muted-foreground))}.placeholder\\:text-muted-foreground::placeholder{color:hsl(var(--muted-foreground))}.before\\:absolute:before{content:var(--tw-content);position:absolute}.before\\:cursor-text:before{content:var(--tw-content);cursor:text}.before\\:opacity-30:before{content:var(--tw-content);opacity:.3}.before\\:content-\\[attr\\(placeholder\\)\\]:before{--tw-content: attr(placeholder);content:var(--tw-content)}.focus-within\\:ring-2:focus-within{--tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow, 0 0 #0000)}.hover\\:scale-110:hover{--tw-scale-x: 1.1;--tw-scale-y: 1.1;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.hover\\:bg-accent:hover{background-color:hsl(var(--accent))}.hover\\:bg-destructive:hover{background-color:hsl(var(--destructive))}.hover\\:bg-destructive\\/90:hover{background-color:hsl(var(--destructive) / .9)}.hover\\:bg-muted:hover{background-color:hsl(var(--muted))}.hover\\:bg-muted\\/50:hover{background-color:hsl(var(--muted) / .5)}.hover\\:bg-primary:hover{background-color:hsl(var(--primary))}.hover\\:bg-primary\\/90:hover{background-color:hsl(var(--primary) / .9)}.hover\\:bg-secondary:hover{background-color:hsl(var(--secondary))}.hover\\:bg-secondary\\/80:hover{background-color:hsl(var(--secondary) / .8)}.hover\\:bg-slate-100:hover{--tw-bg-opacity: 1;background-color:rgb(241 245 249 / var(--tw-bg-opacity, 1))}.hover\\:text-accent-foreground:hover{color:hsl(var(--accent-foreground))}.hover\\:text-destructive:hover{color:hsl(var(--destructive))}.hover\\:text-destructive-foreground:hover{color:hsl(var(--destructive-foreground))}.hover\\:text-foreground:hover{color:hsl(var(--foreground))}.hover\\:text-muted-foreground:hover{color:hsl(var(--muted-foreground))}.hover\\:text-primary-foreground:hover{color:hsl(var(--primary-foreground))}.hover\\:underline:hover{text-decoration-line:underline}.hover\\:opacity-100:hover{opacity:1}.focus\\:bg-accent:focus{background-color:hsl(var(--accent))}.focus\\:text-accent-foreground:focus{color:hsl(var(--accent-foreground))}.focus\\:opacity-100:focus{opacity:1}.focus\\:outline-none:focus{outline:2px solid transparent;outline-offset:2px}.focus\\:ring-1:focus{--tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(1px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow, 0 0 #0000)}.focus\\:ring-2:focus{--tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow, 0 0 #0000)}.focus\\:ring-ring:focus{--tw-ring-color: hsl(var(--ring))}.focus\\:ring-offset-2:focus{--tw-ring-offset-width: 2px}.focus-visible\\:outline-none:focus-visible{outline:2px solid transparent;outline-offset:2px}.focus-visible\\:ring-1:focus-visible{--tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(1px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow, 0 0 #0000)}.focus-visible\\:ring-2:focus-visible{--tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow, 0 0 #0000)}.focus-visible\\:ring-ring:focus-visible{--tw-ring-color: hsl(var(--ring))}.focus-visible\\:ring-transparent:focus-visible{--tw-ring-color: transparent}.focus-visible\\:ring-offset-2:focus-visible{--tw-ring-offset-width: 2px}.focus-visible\\:ring-offset-background:focus-visible{--tw-ring-offset-color: hsl(var(--background))}.disabled\\:pointer-events-none:disabled{pointer-events:none}.disabled\\:cursor-not-allowed:disabled{cursor:not-allowed}.disabled\\:opacity-50:disabled{opacity:.5}.group:hover .group-hover\\:visible{visibility:visible}.group:hover .group-hover\\:opacity-100{opacity:1}.group.destructive .group-\\[\\.destructive\\]\\:border-muted\\/40{border-color:hsl(var(--muted) / .4)}.group.destructive .group-\\[\\.destructive\\]\\:text-red-300{--tw-text-opacity: 1;color:rgb(252 165 165 / var(--tw-text-opacity, 1))}.group.destructive .group-\\[\\.destructive\\]\\:hover\\:border-destructive\\/30:hover{border-color:hsl(var(--destructive) / .3)}.group.destructive .group-\\[\\.destructive\\]\\:hover\\:bg-destructive:hover{background-color:hsl(var(--destructive))}.group.destructive .group-\\[\\.destructive\\]\\:hover\\:text-destructive-foreground:hover{color:hsl(var(--destructive-foreground))}.group.destructive .group-\\[\\.destructive\\]\\:hover\\:text-red-50:hover{--tw-text-opacity: 1;color:rgb(254 242 242 / var(--tw-text-opacity, 1))}.group.destructive .group-\\[\\.destructive\\]\\:focus\\:ring-destructive:focus{--tw-ring-color: hsl(var(--destructive))}.group.destructive .group-\\[\\.destructive\\]\\:focus\\:ring-red-400:focus{--tw-ring-opacity: 1;--tw-ring-color: rgb(248 113 113 / var(--tw-ring-opacity, 1))}.group.destructive .group-\\[\\.destructive\\]\\:focus\\:ring-offset-red-600:focus{--tw-ring-offset-color: #dc2626}.peer:disabled~.peer-disabled\\:cursor-not-allowed{cursor:not-allowed}.peer:disabled~.peer-disabled\\:opacity-70{opacity:.7}.aria-checked\\:bg-accent[aria-checked=true]{background-color:hsl(var(--accent))}.aria-checked\\:text-accent-foreground[aria-checked=true]{color:hsl(var(--accent-foreground))}.data-\\[disabled\\]\\:pointer-events-none[data-disabled]{pointer-events:none}.data-\\[side\\=bottom\\]\\:translate-y-1[data-side=bottom]{--tw-translate-y: .25rem;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.data-\\[side\\=left\\]\\:-translate-x-1[data-side=left]{--tw-translate-x: -.25rem;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.data-\\[side\\=right\\]\\:translate-x-1[data-side=right]{--tw-translate-x: .25rem;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.data-\\[side\\=top\\]\\:-translate-y-1[data-side=top]{--tw-translate-y: -.25rem;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.data-\\[state\\=checked\\]\\:translate-x-4[data-state=checked]{--tw-translate-x: 1rem;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.data-\\[state\\=unchecked\\]\\:translate-x-0[data-state=unchecked],.data-\\[swipe\\=cancel\\]\\:translate-x-0[data-swipe=cancel]{--tw-translate-x: 0px;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.data-\\[swipe\\=end\\]\\:translate-x-\\[var\\(--radix-toast-swipe-end-x\\)\\][data-swipe=end]{--tw-translate-x: var(--radix-toast-swipe-end-x);transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.data-\\[swipe\\=move\\]\\:translate-x-\\[var\\(--radix-toast-swipe-move-x\\)\\][data-swipe=move]{--tw-translate-x: var(--radix-toast-swipe-move-x);transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.data-\\[active-item\\=true\\]\\:bg-accent[data-active-item=true]{background-color:hsl(var(--accent))}.data-\\[state\\=active\\]\\:bg-background[data-state=active]{background-color:hsl(var(--background))}.data-\\[state\\=checked\\]\\:bg-accent[data-state=checked]{background-color:hsl(var(--accent))}.data-\\[state\\=checked\\]\\:bg-primary[data-state=checked]{background-color:hsl(var(--primary))}.data-\\[state\\=on\\]\\:bg-accent[data-state=on],.data-\\[state\\=open\\]\\:bg-accent[data-state=open]{background-color:hsl(var(--accent))}.data-\\[state\\=open\\]\\:bg-secondary[data-state=open]{background-color:hsl(var(--secondary))}.data-\\[state\\=selected\\]\\:bg-muted[data-state=selected]{background-color:hsl(var(--muted))}.data-\\[state\\=unchecked\\]\\:bg-input[data-state=unchecked]{background-color:hsl(var(--input))}.data-\\[active-item\\=true\\]\\:text-accent-foreground[data-active-item=true]{color:hsl(var(--accent-foreground))}.data-\\[disabled\\]\\:text-gray-400[data-disabled]{--tw-text-opacity: 1;color:rgb(156 163 175 / var(--tw-text-opacity, 1))}.data-\\[state\\=active\\]\\:text-foreground[data-state=active]{color:hsl(var(--foreground))}.data-\\[state\\=checked\\]\\:text-accent-foreground[data-state=checked],.data-\\[state\\=on\\]\\:text-accent-foreground[data-state=on],.data-\\[state\\=open\\]\\:text-accent-foreground[data-state=open]{color:hsl(var(--accent-foreground))}.data-\\[state\\=open\\]\\:text-muted-foreground[data-state=open]{color:hsl(var(--muted-foreground))}.data-\\[disabled\\]\\:opacity-50[data-disabled]{opacity:.5}.data-\\[state\\=active\\]\\:shadow[data-state=active]{--tw-shadow: 0 1px 3px 0 rgb(0 0 0 / .1), 0 1px 2px -1px rgb(0 0 0 / .1);--tw-shadow-colored: 0 1px 3px 0 var(--tw-shadow-color), 0 1px 2px -1px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.data-\\[swipe\\=move\\]\\:transition-none[data-swipe=move]{transition-property:none}.data-\\[state\\=closed\\]\\:duration-300[data-state=closed]{transition-duration:.3s}.data-\\[state\\=open\\]\\:duration-500[data-state=open]{transition-duration:.5s}.data-\\[state\\=open\\]\\:animate-in[data-state=open]{animation-name:enter;animation-duration:.15s;--tw-enter-opacity: initial;--tw-enter-scale: initial;--tw-enter-rotate: initial;--tw-enter-translate-x: initial;--tw-enter-translate-y: initial}.data-\\[state\\=closed\\]\\:animate-out[data-state=closed],.data-\\[swipe\\=end\\]\\:animate-out[data-swipe=end]{animation-name:exit;animation-duration:.15s;--tw-exit-opacity: initial;--tw-exit-scale: initial;--tw-exit-rotate: initial;--tw-exit-translate-x: initial;--tw-exit-translate-y: initial}.data-\\[state\\=closed\\]\\:fade-out-0[data-state=closed]{--tw-exit-opacity: 0}.data-\\[state\\=closed\\]\\:fade-out-80[data-state=closed]{--tw-exit-opacity: .8}.data-\\[state\\=open\\]\\:fade-in-0[data-state=open]{--tw-enter-opacity: 0}.data-\\[state\\=closed\\]\\:zoom-out-95[data-state=closed]{--tw-exit-scale: .95}.data-\\[state\\=open\\]\\:zoom-in-95[data-state=open]{--tw-enter-scale: .95}.data-\\[side\\=bottom\\]\\:slide-in-from-top-2[data-side=bottom]{--tw-enter-translate-y: -.5rem}.data-\\[side\\=left\\]\\:slide-in-from-right-2[data-side=left]{--tw-enter-translate-x: .5rem}.data-\\[side\\=right\\]\\:slide-in-from-left-2[data-side=right]{--tw-enter-translate-x: -.5rem}.data-\\[side\\=top\\]\\:slide-in-from-bottom-2[data-side=top]{--tw-enter-translate-y: .5rem}.data-\\[state\\=closed\\]\\:slide-out-to-bottom[data-state=closed]{--tw-exit-translate-y: 100%}.data-\\[state\\=closed\\]\\:slide-out-to-left[data-state=closed]{--tw-exit-translate-x: -100%}.data-\\[state\\=closed\\]\\:slide-out-to-left-1\\/2[data-state=closed]{--tw-exit-translate-x: -50%}.data-\\[state\\=closed\\]\\:slide-out-to-right[data-state=closed],.data-\\[state\\=closed\\]\\:slide-out-to-right-full[data-state=closed]{--tw-exit-translate-x: 100%}.data-\\[state\\=closed\\]\\:slide-out-to-top[data-state=closed]{--tw-exit-translate-y: -100%}.data-\\[state\\=closed\\]\\:slide-out-to-top-\\[48\\%\\][data-state=closed]{--tw-exit-translate-y: -48%}.data-\\[state\\=open\\]\\:slide-in-from-bottom[data-state=open]{--tw-enter-translate-y: 100%}.data-\\[state\\=open\\]\\:slide-in-from-left[data-state=open]{--tw-enter-translate-x: -100%}.data-\\[state\\=open\\]\\:slide-in-from-left-1\\/2[data-state=open]{--tw-enter-translate-x: -50%}.data-\\[state\\=open\\]\\:slide-in-from-right[data-state=open]{--tw-enter-translate-x: 100%}.data-\\[state\\=open\\]\\:slide-in-from-top[data-state=open]{--tw-enter-translate-y: -100%}.data-\\[state\\=open\\]\\:slide-in-from-top-\\[48\\%\\][data-state=open]{--tw-enter-translate-y: -48%}.data-\\[state\\=open\\]\\:slide-in-from-top-full[data-state=open]{--tw-enter-translate-y: -100%}.data-\\[state\\=closed\\]\\:duration-300[data-state=closed]{animation-duration:.3s}.data-\\[state\\=open\\]\\:duration-500[data-state=open]{animation-duration:.5s}.dark\\:border-destructive:is(.dark *){border-color:hsl(var(--destructive))}@media (min-width: 640px){.sm\\:bottom-0{bottom:0}.sm\\:right-0{right:0}.sm\\:top-auto{top:auto}.sm\\:mt-0{margin-top:0}.sm\\:max-h-full{max-height:100%}.sm\\:max-w-\\[600px\\]{max-width:600px}.sm\\:max-w-sm{max-width:24rem}.sm\\:flex-row{flex-direction:row}.sm\\:flex-col{flex-direction:column}.sm\\:justify-end{justify-content:flex-end}.sm\\:justify-center{justify-content:center}.sm\\:space-x-2>:not([hidden])~:not([hidden]){--tw-space-x-reverse: 0;margin-right:calc(.5rem * var(--tw-space-x-reverse));margin-left:calc(.5rem * calc(1 - var(--tw-space-x-reverse)))}.sm\\:rounded-lg{border-radius:var(--radius)}.sm\\:px-3{padding-left:.75rem;padding-right:.75rem}.sm\\:text-left{text-align:left}.data-\\[state\\=open\\]\\:sm\\:slide-in-from-bottom-full[data-state=open]{--tw-enter-translate-y: 100%}}@media (min-width: 768px){.md\\:mr-0\\.5{margin-right:.125rem}.md\\:flex{display:flex}.md\\:hidden{display:none}.md\\:h-\\[30vh\\]{height:30vh}.md\\:w-\\[130px\\]{width:130px}.md\\:max-w-\\[420px\\]{max-width:420px}.md\\:grid-cols-\\[minmax\\(450px\\,1fr\\)_2fr\\]{grid-template-columns:minmax(450px,1fr) 2fr}.md\\:border{border-width:1px}.md\\:p-2{padding:.5rem}.md\\:shadow{--tw-shadow: 0 1px 3px 0 rgb(0 0 0 / .1), 0 1px 2px -1px rgb(0 0 0 / .1);--tw-shadow-colored: 0 1px 3px 0 var(--tw-shadow-color), 0 1px 2px -1px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}}@media (min-width: 1024px){.lg\\:inline{display:inline}.lg\\:min-w-\\[130px\\]{min-width:130px}}@media print{.print\\:hidden{display:none}}.\\[\\&\\+div\\]\\:text-xs+div{font-size:.75rem;line-height:1rem}.\\[\\&\\:has\\(\\[role\\=checkbox\\]\\)\\]\\:pr-0:has([role=checkbox]){padding-right:0}.\\[\\&\\>\\[role\\=checkbox\\]\\]\\:translate-y-\\[2px\\]>[role=checkbox]{--tw-translate-y: 2px;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.\\[\\&\\>span\\]\\:line-clamp-1>span{overflow:hidden;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:1}.\\[\\&\\>svg\\+div\\]\\:translate-y-\\[-3px\\]>svg+div{--tw-translate-y: -3px;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.\\[\\&\\>svg\\]\\:absolute>svg{position:absolute}.\\[\\&\\>svg\\]\\:left-4>svg{left:1rem}.\\[\\&\\>svg\\]\\:top-4>svg{top:1rem}.\\[\\&\\>svg\\]\\:text-destructive>svg{color:hsl(var(--destructive))}.\\[\\&\\>svg\\]\\:text-foreground>svg{color:hsl(var(--foreground))}.\\[\\&\\>svg\\~\\*\\]\\:pl-7>svg~*{padding-left:1.75rem}.\\[\\&\\>tr\\]\\:last\\:border-b-0:last-child>tr{border-bottom-width:0px}.\\[\\&_\\[data-slate-placeholder\\]\\]\\:top-\\[auto_\\!important\\] [data-slate-placeholder]{top:auto!important}.\\[\\&_\\[data-slate-placeholder\\]\\]\\:text-muted-foreground [data-slate-placeholder]{color:hsl(var(--muted-foreground))}.\\[\\&_\\[data-slate-placeholder\\]\\]\\:\\!opacity-100 [data-slate-placeholder]{opacity:1!important}.\\[\\&_p\\]\\:leading-relaxed p{line-height:1.625}.\\[\\&_strong\\]\\:font-bold strong{font-weight:700}.\\[\\&_svg\\:not\\(\\[data-icon\\]\\)\\]\\:size-5 svg:not([data-icon]){width:1.25rem;height:1.25rem}.\\[\\&_svg\\]\\:pointer-events-none svg{pointer-events:none}.\\[\\&_svg\\]\\:size-4 svg{width:1rem;height:1rem}.\\[\\&_svg\\]\\:shrink-0 svg{flex-shrink:0}.\\[\\&_tr\\:last-child\\]\\:border-0 tr:last-child{border-width:0px}.\\[\\&_tr\\]\\:border-b tr{border-bottom-width:1px}\n',document.head.appendChild(e);const t=Object.freeze(Object.defineProperty({__proto__:null,get AddFilter(){return pr},get AnimationDirective(){return Li},get ChangeSource(){return sr},get Directive(){return Ri},get EnterFromLeft(){return lr},get EnterFromRight(){return dr},get FadeIn(){return Yi},get FadeInTransition(){return ur},get FadeOut(){return ar},get FilterDirective(){return Ki},get Hide(){return tr},get LeaveFromLeft(){return cr},get LeaveFromRight(){return hr},get Pause(){return Ei},get Play(){return Ui},get RemoveFilter(){return xr},get ShakeX(){return nr},get ShakeY(){return ir},get Show(){return Fi},get SoundDirective(){return Ii},get Speak(){return er},get Speaker(){return Bi},get Stop(){return Ji},get TransitionDirective(){return zi},get Voice(){return Pi},get Wait(){return mr},get ZoomIn(){return rr},get ZoomOut(){return or}},Symbol.toStringTag,{value:"Module"}));function zn(...e){return a(s(e))}function Kn(e,t,a="mp4"){const s=document.createElement("a");s.setAttribute("download",`${e}.${a}`),s.setAttribute("href",t),document.body.appendChild(s),s.click(),document.body.removeChild(s)}function Fn(e){const t=e.name.split(".").pop()||"";return{name:e.name.substring(0,e.name.lastIndexOf(".")),ext:t}}function Yn(e){const t=e.match(/\{[\s\S]*\}/);try{const e=t[0];return JSON.parse(e)}catch{return null}}function Hn(e,t=!1){let a="";return e.forEach(e=>{if("p"===e.type)for(let t=0;t<e.children.length;t++){const s=e.children[t];if(!s.type){let n=s.text;t===e.children.length-1&&(n+="\n"),a+=n}}}),t&&(a=a.replace(/\n/g,"")),a}const Mn=n.forwardRef(({className:e,...t},a)=>i.jsx("div",{className:"relative w-full overflow-auto",children:i.jsx("table",{ref:a,className:zn("w-full caption-bottom text-sm",e),...t})}));Mn.displayName="Table";const Bn=n.forwardRef(({className:e,...t},a)=>i.jsx("thead",{ref:a,className:zn("[&_tr]:border-b",e),...t}));Bn.displayName="TableHeader";const Dn=n.forwardRef(({className:e,...t},a)=>i.jsx("tbody",{ref:a,className:zn("[&_tr:last-child]:border-0",e),...t}));Dn.displayName="TableBody",n.forwardRef(({className:e,...t},a)=>i.jsx("tfoot",{ref:a,className:zn("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...t})).displayName="TableFooter";const Un=n.forwardRef(({className:e,...t},a)=>i.jsx("tr",{ref:a,className:zn("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",e),...t}));Un.displayName="TableRow";const En=n.forwardRef(({className:e,...t},a)=>i.jsx("th",{ref:a,className:zn("h-8 px-2 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...t}));En.displayName="TableHead";const Jn=n.forwardRef(({className:e,...t},a)=>i.jsx("td",{ref:a,className:zn("p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...t}));async function Pn(e,t,a,s){const n=e.sampleRate,i=e.numberOfChannels,r=Math.floor(t*n),o=n*a,l=new OfflineAudioContext(i,o,n);let c=l.createBuffer(i,o,n);const d=new Float32Array(o);for(let h=0;h<e.numberOfChannels;h++)e.copyFromChannel(d,h,r),c.copyToChannel(d,h);if(void 0!==s){const e=l.createBufferSource();e.buffer=c;const t=l.createGain();t.gain.value=s,e.connect(t),t.connect(l.destination),e.start(),c=await l.startRendering()}return c}async function On(e){try{const t=await(await fetch(e)).arrayBuffer(),a=await async function(e,t=44100){return new Promise((a,s)=>{const n=new AudioContext({sampleRate:t});n.decodeAudioData(e,a,s).finally(()=>{n.close()})})}(t);return a}catch(t){return void console.error("fetchAudioBuffer error:",t)}}Jn.displayName="TableCell",n.forwardRef(({className:e,...t},a)=>i.jsx("caption",{ref:a,className:zn("mt-4 text-sm text-muted-foreground",e),...t})).displayName="TableCaption";const An={codec:"avc1.42002A",width:1920,height:1080,bitrate:12e6},Qn={codec:"mp4a.40.2",numberOfChannels:2,sampleRate:44100,bitrate:128e3};function _n(){return r(8)}async function $n(e,t){if(!t)return[];const a=[];for(const s of t){const t=await qn(e,s);a.push(t)}return a}async function qn(e,t){const a=e[t.__type];return await a.fromJSON(t)}function ei(e,t,a=!1){a&&(t.name=e.name),t.label=e.label}function ti(e){return{__type:e.type,label:e.label,name:e.name}}function ai(e,t){t.label=e.label,t.name=e.name}o.setLevel("ERROR");class si extends l{label="";name=_n();type="BlackMaskFilter";constructor(){super(),this.blackAndWhite(!0),this.brightness(0,!0)}clone(e=!1){const t=new si;return ei(this,t,e),t}toJSON(){return ti(this)}static fromJSON(e){const t=new si;return ai(e,t),t}}class ni extends c{label="";name=_n();type="BlurFilter";clone(e=!1){const t=new ni;return ei(this,t,e),t}toJSON(){return ti(this)}static fromJSON(e){const t=new ni;return ai(e,t),t}}class ii extends d{label="";name=_n();type="NoiseFilter";clone(e=!1){const t=new ii;return ei(this,t,e),t}toJSON(){return ti(this)}static fromJSON(e){const t=new ii;return ai(e,t),t}}class ri extends h{label="";name=_n();type="OldFilmFilter";clone(e=!1){const t=new ri;return ei(this,t,e),t}toJSON(){return ti(this)}static fromJSON(e){const t=new ri;return ai(e,t),t}}class oi extends h{label="";name=_n();type="VignetteFilter";constructor(){super(),this.sepia=0,this.noise=0,this.vignetting=.5}clone(e=!1){const t=new oi;return ei(this,t,e),t}toJSON(){return ti(this)}static fromJSON(e){const t=new oi;return ai(e,t),t}}const li={BlackMaskFilter:si,BlurFilter:ni,NoiseFilter:ii,OldFilmFilter:ri,VignetteFilter:oi};function ci(e){return $n(li,e)}function di(e,t,a=!1,s=!1){a&&(t.name=e.name),t.label=e.label,t.type=e.type,t.visible=e.visible,t.alpha=e.alpha,t.zIndex=e.zIndex,t.setTransform(...pi(e)),s||(t.width=e.width,t.height=e.height),t.filters=e.filters?.map(e=>e.clone(a))||null}function hi(e,t=!1){let a={__type:e.type,name:e.name,label:e.label,type:e.type,visible:e.visible,alpha:e.alpha,zIndex:e.zIndex,transform:pi(e),filters:e.filters?.map(e=>e.toJSON())||null};return t||(a={...a,width:e.width,height:e.height}),a}async function mi(e,t,a=!1){t.name=e.name,t.label=e.label,t.type=e.type,t.visible=e.visible,t.alpha=e.alpha,t.zIndex=e.zIndex,t.setTransform(...e.transform),a||("number"==typeof e.width&&(t.width=e.width),"number"==typeof e.height&&(t.height=e.height)),t.filters=await ci(e.filters)}function ui(e){return e.width===e.texture.width&&e.height===e.texture.height&&1===e.width&&1===e.height}function pi(e){return[e.x,e.y,e.scale.x,e.scale.y,e.rotation,e.skew.x,e.skew.y,e.pivot.x,e.pivot.y]}class xi extends m{name=_n();label="";type="Text";disableTextEdit=!1;async load(){}clone(e=!1){const t=new xi(this.text,this.style.clone());return di(this,t,e,!0),t.disableTextEdit=this.disableTextEdit,t}toJSON(){return{...hi(this,!0),text:this.text,disableTextEdit:this.disableTextEdit,style:{fontSize:this.style.fontSize,fontWeight:this.style.fontWeight,fontStyle:this.style.fontStyle,fontFamily:this.style.fontFamily,fill:this.style.fill,wordWrap:this.style.wordWrap,breakWords:this.style.breakWords,wordWrapWidth:this.style.wordWrapWidth,leading:this.style.leading}}}static async fromJSON(e){const t=new xi(e.text,e.style);return await mi(e,t,!0),t.disableTextEdit=e.disableTextEdit,t}}class fi extends u{name=_n();label="";type="Graphics";fillColor="";async load(){}clone(e=!1){const t=new fi(super.clone().geometry);return di(this,t,e),t.fillColor=this.fillColor,t}toJSON(){return{...hi(this),fillColor:this.fillColor,graphicsData:this.geometry.graphicsData.map(e=>[e.shape,{...e.fillStyle,texture:void 0},{...e.lineStyle,texture:void 0}])}}static async fromJSON(e){const t=new p;t.graphicsData=e.graphicsData.map(e=>{const t=new x;t.x=e[0].x,t.y=e[0].y,t.width=e[0].width,t.height=e[0].height;const a=new f;a.alpha=e[1].alpha,a.color=e[1].color,a.visible=e[1].visible;const s=new g;return s.color=e[2].color,s.alpha=e[2].alpha,s.visible=e[2].visible,s.width=e[2].width,s.alignment=e[2].alignment,s.native=e[2].native,s.cap=e[2].cap,s.join=e[2].join,s.miterLimit=e[2].miterLimit,new v(t,a,s)});const a=new fi(t);return await mi(e,a),a.fillColor=e.fillColor,a}}const gi={extension:b.Asset,detection:{test:async()=>!0,add:async e=>[...e],remove:async e=>e.filter(t=>e.includes(t))},loader:{extension:{type:[b.LoadParser],priority:w.High},test:e=>e.startsWith("blob:"),load:async e=>y.from(e)}};j.add(gi);class vi extends k{name;label;type;source;assetID;assetType;constructor(e){super(),this.name=_n(),this.label="",this.type="Sprite",this.source=e.source,this.assetID=0,this.assetType=""}changeSource(e){this.source=e}async load(){this.source&&(this.texture=await N.load(this.source))}clone(e=!1){const t=new vi({source:this.source});return t.assetID=this.assetID,t.assetType=this.assetType,di(this,t,e,ui(this)),t}toJSON(){return{...hi(this,ui(this)),source:this.source,assetID:this.assetID,assetType:this.assetType}}static async fromJSON(e){const t=new vi({source:e.source});return t.assetID=e.assetID,t.assetType=e.assetType,await mi(e,t),t}}class bi extends k{name;label;type;source;assetID;assetType;static defaultOptions={source:"",scaleMode:S.LINEAR,fps:30,loop:!0,animationSpeed:1,autoPlay:!0,autoUpdate:!0,onComplete:null,onFrameChange:null,onLoop:null};animationSpeed=1;loop=!0;onComplete;onFrameChange;onLoop;duration=0;autoPlay=!0;_frames;_context;dirty=!1;_currentFrame=0;_autoUpdate=!1;_isConnectedToTicker=!1;_playing=!1;_currentTime=0;static fromBuffer(e,t){if(!e||0===e.byteLength)throw new Error("Invalid buffer");const a=C(e);(e=>{let t=null;for(const a of e.frames)t=a.gce??t,"image"in a&&!("gce"in a)&&(a.gce=t)})(a);const s=Z(a,!0),n=[],i=document.createElement("canvas"),r=i.getContext("2d",{willReadFrequently:!0}),o=document.createElement("canvas"),l=o.getContext("2d");i.width=a.lsd.width,i.height=a.lsd.height;let c=0,d=null;const{fps:h}=Object.assign({},bi.defaultOptions,t),m=1e3/h;for(let x=0;x<s.length;x++){const{disposalType:e=2,delay:t=m,patch:a,dims:{width:h,height:u,left:p,top:f}}=s[x];o.width=h,o.height=u,l.clearRect(0,0,h,u);const g=l.createImageData(h,u);g.data.set(a),l.putImageData(g,0,0),3===e&&(d=r.getImageData(0,0,i.width,i.height)),r.drawImage(o,p,f);const v=r.getImageData(0,0,i.width,i.height);2===e?r.clearRect(0,0,i.width,i.height):3===e&&r.putImageData(d,0,0),n.push({start:c,end:c+t,imageData:v}),c+=t}i.width=i.height=0,o.width=o.height=0;const{width:u,height:p}=a.lsd;return{frames:n,width:u,height:p}}constructor(e){super(y.EMPTY),this.name=_n(),this.label="",this.type="AnimatedGIF",this.source=e.source,this.assetID=0,this.assetType="",this._frames=[],this._context=null}async load(){const e=await fetch(this.source).then(e=>e.arrayBuffer()),{frames:t,width:a,height:s}=bi.fromBuffer(e),n=document.createElement("canvas"),i=n.getContext("2d");n.width=a,n.height=s;const{source:r,scaleMode:o,...l}=bi.defaultOptions;this.texture=y.from(n,{scaleMode:o}),this.duration=t[t.length-1].end,this._frames=t,this._context=i,this._playing=!1,this._currentTime=0,this._isConnectedToTicker=!1,Object.assign(this,l),this.dirty=!0,this.currentFrame=0}stop(){this._playing&&(this._playing=!1,this._autoUpdate&&this._isConnectedToTicker&&(G.shared.remove(this.update,this),this._isConnectedToTicker=!1))}play(){this._playing||(this._playing=!0,this._autoUpdate&&!this._isConnectedToTicker&&(G.shared.add(this.update,this,V.HIGH),this._isConnectedToTicker=!0),this.loop||this.currentFrame!==this._frames.length-1||(this._currentTime=0))}get progress(){return this._currentTime/this.duration}get playing(){return this._playing}update(e){if(!this._playing)return;const t=1e3*G.shared.time,a=t%this.duration,s=this._frames.findIndex(e=>e.start<=a&&e.end>a);t>=this.duration?this.loop?(this._currentTime=a,this.updateFrameIndex(s),this.onLoop?.()):(this._currentTime=this.duration,this.updateFrameIndex(this._frames.length-1),this.onComplete?.(),this.stop()):(this._currentTime=a,this.updateFrameIndex(s))}updateFrame(){if(!this.dirty)return;const{imageData:e}=this._frames[this._currentFrame];this._context.putImageData(e,0,0),this._context.fillStyle="transparent",this._context.fillRect(0,0,0,1),this.texture.update(),this.dirty=!1}_render(e){this.updateFrame(),super._render(e)}_renderCanvas(e){this.updateFrame(),super._renderCanvas(e)}get autoUpdate(){return this._autoUpdate}set autoUpdate(e){e!==this._autoUpdate&&(this._autoUpdate=e,!this._autoUpdate&&this._isConnectedToTicker?(G.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._playing&&(G.shared.add(this.update,this),this._isConnectedToTicker=!0))}get currentFrame(){return this._currentFrame}set currentFrame(e){this.updateFrameIndex(e),this._currentTime=this._frames[e].start}updateFrameIndex(e){if(e<0||e>=this._frames.length)throw new Error(`Frame index out of range, expecting 0 to ${this.totalFrames}, got ${e}`);this._currentFrame!==e&&(this._currentFrame=e,this.dirty=!0,this.onFrameChange?.(e))}get totalFrames(){return this._frames.length}destroy(){this.stop(),super.destroy(!0);const e=null;this._context=e,this._frames=e,this.onComplete=e,this.onFrameChange=e,this.onLoop=e}clone(e=!1){const t=new bi({source:this.source});return t.assetID=this.assetID,t.assetType=this.assetType,di(this,t,e,ui(this)),t}toJSON(){return{...hi(this,ui(this)),source:this.source,assetID:this.assetID,assetType:this.assetType}}static async fromJSON(e){const t=new bi({source:e.source});return t.assetID=e.assetID,t.assetType=e.assetType,await mi(e,t),t}}var wi=(e=>(e[e.AUDIO_STREAM_TYPE=0]="AUDIO_STREAM_TYPE",e[e.VIDEO_STREAM_TYPE=1]="VIDEO_STREAM_TYPE",e))(wi||{});const{DataStream:yi}=W;function ji(...e){o.debug(...e)}class ki{fileUri;streamType;source;readySamples;_pending_read_resolver;audioTrack;videoTrack;constructor(e){this.fileUri=e}async initialize(e){this.source=new Ni(this.fileUri),this.readySamples=[],this._pending_read_resolver=void 0,this.streamType=e;const t=await this._tracksReady();return 0==this.streamType?this._selectTrack(this.audioTrack):this._selectTrack(this.videoTrack),t}getDecoderConfig(){return 0==this.streamType?{codec:this.audioTrack.codec,sampleRate:this.audioTrack.audio.sample_rate,numberOfChannels:this.audioTrack.audio.channel_count,description:this.source.getAudioSpecificConfig()}:{codec:this.videoTrack.codec.startsWith("vp08")?"vp8":this.videoTrack.codec,displayWidth:this.videoTrack.track_width,displayHeight:this.videoTrack.track_height,description:this._getDescription(this.source.getDescriptionBox())}}async getNextChunk(){let e=await this._readSample();const t=e.is_sync?"key":"delta",a=1e6*e.cts/e.timescale,s=1e6*e.duration/e.timescale;return new(0==this.streamType?EncodedAudioChunk:EncodedVideoChunk)({type:t,timestamp:a,duration:s,data:e.data})}_getDescription(e){const t=new yi(void 0,0,yi.BIG_ENDIAN);return e.write(t),new Uint8Array(t.buffer,8)}async _tracksReady(){let e=await this.source.getInfo();return this.videoTrack=e.videoTracks[0],this.audioTrack=e.audioTracks[0],{video:this.videoTrack,audio:this.audioTrack}}_selectTrack(e){this.source.selectTrack(e)}async _readSample(){if(this.readySamples.length)return Promise.resolve(this.readySamples.shift());let e=new Promise(e=>{this._pending_read_resolver=e});return this.source.start(this._onSamples.bind(this)),e}_onSamples(e){this.readySamples.push(...e),this.readySamples.length>=50&&this.source.stop();let t=1e6*e[0].cts/e[0].timescale;ji(`adding new ${e.length} samples (first = ${t}). total = ${this.readySamples.length}`),this._pending_read_resolver&&(this._pending_read_resolver(this.readySamples.shift()),this._pending_read_resolver=void 0)}destroy(){this.readySamples=[],this.source.close()}}class Ni{file;_onSamples;info;_info_resolver;constructor(e){this.file=W.createFile(),this.file.onError=console.error.bind(console),this.file.onReady=this.onReady.bind(this),this.file.onSamples=this.onSamples.bind(this),ji("fetching file"),fetch(e).then(e=>{ji("fetch responded");const t=e.body.getReader();let a=0,s=this.file;return t.read().then(function e({done:n,value:i}){if(n)return void s.flush();let r=i.buffer;return r.fileStart=a,a+=r.byteLength,s.appendBuffer(r),t.read().then(e)})}),this.info=void 0,this._info_resolver=void 0}onReady(e){this.info=e,this._info_resolver&&(this._info_resolver(e),this._info_resolver=void 0)}getInfo(){return this.info?Promise.resolve(this.info):new Promise(e=>{this._info_resolver=e})}getDescriptionBox(){const e=this.file.moov.traks[0].mdia.minf.stbl.stsd.entries[0],t=e.avcC||e.hvcC||e.vpcC||e.av1C;if(!t)throw new Error("avcC, hvcC, vpcC, or av1C box not found!");return t}getAudioSpecificConfig(){try{return this.file.moov.traks[0].mdia.minf.stbl.stsd.entries[0].esds.esd.descs[0].descs[0].data}catch(e){return}}selectTrack(e){this.file.setExtractionOptions(e.id)}start(e){this._onSamples=e,this.file.start()}stop(){this.file.stop()}close(){this.file.flush()}onSamples(e,t,a){this._onSamples(a)}}function Si(...e){o.debug(...e)}class Ci{width;height;duration;demuxer;frameBuffer;fillInProgress;canvasCtx;decoder;init_resolver;async initialize(e,t,{width:a,height:s}){this.frameBuffer=[],this.fillInProgress=!1,this.demuxer=new ki(e);const{video:n}=await this.demuxer.initialize(wi.VIDEO_STREAM_TYPE),i=this.demuxer.getDecoderConfig();this.width=a>0?a:i.displayWidth,this.height=s>0?s:i.displayHeight,this.duration=n.duration/n.timescale,this.canvasCtx=t,this.canvasCtx.canvas.width=this.width,this.canvasCtx.canvas.height=this.height,this.decoder=new VideoDecoder({output:this.bufferFrame.bind(this),error:e=>console.error(e)});let r=await VideoDecoder.isConfigSupported(i);console.assert(r.supported),this.decoder.configure(i),this.init_resolver=void 0;let o=new Promise(e=>this.init_resolver=e);return this.fillFrameBuffer(),o}render(e){Si("render(%d)",e);let t=this.chooseFrame(e);if(this.fillFrameBuffer(),null!=t)return this.paint(t),t;console.warn("VideoRenderer.render(): no frame ")}chooseFrame(e){if(0==this.frameBuffer.length)return null;let t=Number.MAX_VALUE,a=-1;for(let n=0;n<this.frameBuffer.length;n++){let s=Math.abs(e-this.frameBuffer[n].timestamp);if(!(s<t))break;t=s,a=n}console.assert(-1!=a),a>0&&Si("dropping %d stale frames",a);for(let n=0;n<a;n++){let e=this.frameBuffer.shift();e&&e.close()}let s=this.frameBuffer[0];return Si("frame time delta = %dms (%d vs %d)",t/1e3,e,s.timestamp),s}async fillFrameBuffer(){if(this.frameBufferFull())return Si("frame buffer full"),void(this.init_resolver&&(this.init_resolver(!0),this.init_resolver=void 0));if(this.fillInProgress)return!1;for(this.fillInProgress=!0;this.frameBuffer.length<3&&this.decoder.decodeQueueSize<3;){let e=await this.demuxer.getNextChunk();this.decoder.decode(e)}this.fillInProgress=!1,setTimeout(this.fillFrameBuffer.bind(this),0)}frameBufferFull(){return this.frameBuffer.length>=3}bufferFrame(e){Si(`bufferFrame(${e.timestamp})`),this.frameBuffer.push(e)}paint(e){Si("paint(%d)",e.timestamp),this.canvasCtx.drawImage(e,0,0,this.width,this.height)}async destroy(){"closed"!=this.decoder.state&&(this.frameBuffer.forEach(e=>e.close()),await this.decoder.flush(),this.decoder.close()),this.demuxer.destroy()}}class Zi extends k{name;label;type;source;assetID;assetType;start;duration;offset;loop;volume;bufferDuration=0;options;videoRenderer;_isConnectedToTicker=!1;constructor(e){super(),this.options=e,this.name=_n(),this.label="",this.type="Video",this.source=e.source,this.assetID=0,this.assetType="",this.width=this.options.width??0,this.height=this.options.height??0,this.start=e.start??0,this.duration=e.duration??0,this.offset=e.offset??0,this.loop=e.loop??!1,this.volume=e.volume??1}async load(){if(this.source){const e=this.source,t=document.createElement("canvas"),a=t.getContext("2d"),s=new Ci;await s.initialize(e,a,{width:this.width,height:this.height}),this.width=s.width,this.height=s.height;const n=1e3*s.duration;this.duration=this.duration||n,this.bufferDuration=n,this.videoRenderer=s,this.texture=y.from(t),this.videoRenderer.render(0),this.texture.update()}}play(){this._isConnectedToTicker||(G.shared.add(this.update,this,V.HIGH),this._isConnectedToTicker=!0)}stop(){this._isConnectedToTicker&&(G.shared.remove(this.update,this),this._isConnectedToTicker=!1)}destroy(){this.stop(),super.destroy(!0),this.videoRenderer=void 0}async update(){const e=1e3*G.shared.time;this.videoRenderer?.render(1e3*e),this.texture.update()}clone(e=!1){const t=new Zi({source:this.source});return t.assetID=this.assetID,t.assetType=this.assetType,di(this,t,e,ui(this)),t}toJSON(){return{...hi(this,ui(this)),source:this.source,assetID:this.assetID,assetType:this.assetType}}static async fromJSON(e){const t=new Zi({source:e.source});return t.assetID=e.assetID,t.assetType=e.assetType,await mi(e,t),t}}const Gi={Text:xi,Graphics:fi,Sprite:vi,AnimatedGIF:bi,Video:Zi};class Vi{name;label;type;source;assetID;assetType;buffer;constructor(e){this.name=_n(),this.label="",this.type="Sound",this.source=e.source,this.assetID=0,this.assetType=""}changeSource(e){this.source=e}async load(){this.buffer=await On(this.source)}clone(e=!1){const t=new Vi({source:this.source});return Wi(this,t,e),t}toJSON(){const e={};return Wi(this,e,!0),{__type:this.type,...e,source:this.source,assetID:this.assetID,assetType:this.assetType}}static async fromJSON(e){const t=new Vi({source:e.source});return Wi(e,t,!0),t}destroy(){this.buffer=void 0}}function Wi(e,t,a=!1){a&&(t.name=e.name),t.label=e.label,t.assetID=e.assetID,t.assetType=e.assetType}class Ti extends T{name;label;config;dialogues;sounds;constructor(e){super(),this.name=_n(),this.label=e?.label||"",this.config={speak:{targetName:"",wordsPerMin:500,interval:.2,effect:"typewriter",speaker:{targetName:"",name:"",autoShowSpeaker:{inEffect:"Show"},autoMaskOtherSpeakers:{alpha:.5}}},autoShowBackground:!0},this.dialogues=[],this.sounds=[],this.sortableChildren=!0}getSoundByName(e){return this.sounds.find(t=>t.name===e)}addSound(e){this.sounds.push(e)}removeSound(e){this.sounds=this.sounds.filter(t=>t.name!==e.name||(e.destroy(),!1))}addFilter(e){this.filters?this.filters.push(e):this.filters=[e]}removeFilter(e){this.filters&&(this.filters=this.filters.filter(t=>t!==e))}addDialogue(e,t){void 0!==t?this.dialogues.splice(t,0,e):this.dialogues.push(e)}updateDialogue(e,t){this.dialogues[e]=t}removeDialogue(e){this.dialogues=this.dialogues.filter(t=>t!==e)}swapDialogue(e,t){[this.dialogues[e],this.dialogues[t]]=[this.dialogues[t],this.dialogues[e]]}getChildByLabel(e){return this.children.find(t=>t.label===e)}getChildrenByAssetType(e){return this.children.filter(t=>t.assetType===e)}clone(){const e=new Ti;e.label=this.label,e.config=X(this.config),e.dialogues=X(this.dialogues);const t=this.children.map(e=>e.clone(!0));return t.length>0&&e.addChild(...t),e.sounds=this.sounds.map(e=>e.clone(!0)),e.filters=this.filters?.map(e=>e.clone(!0))||null,e}toJSON(){return{__type:"Scene",name:this.name,label:this.label,config:this.config,dialogues:this.dialogues,children:this.children,sounds:this.sounds,filters:this.filters}}static async fromJSON(e,t=!0){const a=new Ti;t&&(a.name=e.name),a.label=e.label,a.config=e.config,a.dialogues=e.dialogues;const s=await function(e){return $n(Gi,e)}(e.children);var n;return s.length>0&&a.addChild(...s),a.sounds=await(n=e.sounds,$n({Sound:Vi},n)),a.filters=await ci(e.filters),a}async load({skipSoundLoading:e=!1}={}){const t=async e=>{if("function"==typeof e.load&&await e.load(),e.children&&e.children.length>0)for(const a of e.children)await t(a)};for(const a of this.children)await t(a);if(!e)for(const a of this.sounds)await a.load()}}const Xi={version:"3.12.2",name:"text",init(e,t,a){"object"!=typeof t&&(t={value:t});let s=t.value;this.startText=a.vars?.startAt?.text?.value||"",this.target=e,this.startText&&(s=s.replace(this.startText,"")),s=s.split(""),this.from=a._from,this.text=s,this._props.push("text")},render(e,t){e>1?e=1:e<0&&(e=0),t.from&&(e=1-e);const{text:a,target:s,startText:n}=t,i=e*a.length+.5|0;s.text=n+a.slice(0,i).join("")}};class Ri{options;stage;executeTime;currentTime;constructor(e,t){this.options=e,this.stage=t,this.executeTime=e.executeTime??0,this.currentTime=0}load(){}check(){return!0}}class Li extends Ri{target;constructor(e,t){super(e,t),this.options=e,this.target=this.stage.getChildByName(e.targetName,!0)}check(){return!!this.target}execute(){if(!this.target)return;const{fromVars:e,toVars:t}=this.options;this.target.visible=!0,"function"==typeof this.target.play&&this.target.play(),e&&t?R.fromTo(this.target,e,t):t&&R.to(this.target,t)}getDuration(){return this.options.sequential?this.options.toVars?.duration??0:0}}class Ii extends Ri{target;constructor(e,t){super(e,t),this.stage=t,this.target=this.stage.getSoundByName(e.targetName)}check(){return!!this.target}getDuration(){return 0}}class zi extends Ri{constructor(e,t){super(e,t),this.options=e}execute(){const{fromVars:e,toVars:t}=this.options;e&&t?R.fromTo(this.stage,e,t):t&&R.to(this.stage,t)}getDuration(){return this.options.sequential?this.options.toVars?.duration??0:0}}class Ki extends Ri{target;constructor(e,t){super(e,t),this.options=e,this.stage=t,e.targetName&&(this.target=this.stage.getChildByName(e.targetName))}getDuration(){return 0}}class Fi extends Li{constructor(e,t){super(e,t),this.options=L({toVars:{pixi:{visible:!0},ease:"none",duration:0}},e)}}class Yi extends Li{constructor(e,t){super(e,t),this.target&&(this.options=L({fromVars:{pixi:{alpha:0}},toVars:{pixi:{alpha:this.target.alpha??1},ease:"power1.in",duration:.5}},e))}}const Hi="AutoMaskFilter",Mi={Show:Fi,FadeIn:Yi};class Bi extends Li{speakerTarget;constructor(e,t){super(e,t),this.options=L({autoShowSpeaker:{inEffect:"Show"},autoMaskOtherSpeakers:{alpha:.5}},e);const{speakerTargetName:a}=this.options;a&&(this.speakerTarget=this.stage.getChildByName(a))}execute(){const{name:e,autoShowSpeaker:t,autoMaskOtherSpeakers:a,executeTime:s}=this.options;if(this.target&&(this.target.visible=!0,this.target.text=e),t&&this.speakerTarget&&!this.speakerTarget.visible){const{inEffect:e="Show"}=t;new(0,Mi[e])({...t,executeTime:s,targetName:this.speakerTarget.name},this.stage).execute()}if(a){const{alpha:e=.5}=a;this.speakerTarget&&this.checkMaskFilter(this.speakerTarget)&&this.removeMaskFilter(this.speakerTarget),this.stage.children.forEach(t=>{t!==this.speakerTarget&&"Character"===t.assetType&&(this.checkMaskFilter(t)||this.addMaskFilter(t,e))})}}checkMaskFilter(e){return e.filters?.some(e=>e.name===Hi)}removeMaskFilter(e){e.filters=e.filters?.filter(e=>e.name!==Hi)||[]}addMaskFilter(e,t){const a=new si;a.name=Hi,a.alpha=t,e.filters?e.filters.push(a):e.filters=[a]}}const Di=new class{sliceTaskList=[];soundRecordMap=new Map;get(e){return this.soundRecordMap.get(e)}play(e,t){const a=this.soundRecordMap.get(e.name);if(a)L(a,{...t,paused:!1});else{const{start:a,volume:s,loop:n,untilEnd:i}=t;this.soundRecordMap.set(e.name,{sound:e,paused:!1,elapsedTime:0,start:a??0,volume:s??1,loop:n??!1,untilEnd:i??!1})}}pause(e){const t=this.soundRecordMap.get(e.name);t&&(t.paused=!0)}stop(e){this.soundRecordMap.delete(e.name)}update(e,t){for(const a of this.soundRecordMap.values()){const{sound:e,paused:s,elapsedTime:n,start:i,loop:r,volume:o}=a;if(!s&&e.buffer){let s=n;const l=e.buffer.duration;if(s>l-i){if(!r)continue;s%=l-i}const c=1/t,d=Pn(e.buffer,s+i,c,o);a.elapsedTime=n+c,this.sliceTaskList.push(d)}}}async getAudioBuffers(){const e=await Promise.all(this.sliceTaskList);return this.sliceTaskList=[],e}resetExceptUtilEnd(){for(const[e,t]of this.soundRecordMap)t.untilEnd||this.soundRecordMap.delete(e)}reset(){this.sliceTaskList=[],this.soundRecordMap.clear()}};class Ui extends Ii{constructor(e,t){super(e,t),this.options=e}async load(){this.target.buffer||await this.target.load()}execute(){Di.play(this.target,this.options)}getDuration(){return this.options.sequential?this.target.buffer?.duration??0:0}}class Ei extends Ii{execute(){Di.pause(this.target)}}class Ji extends Ii{execute(){Di.stop(this.target)}}class Pi extends Ii{constructor(e,t){super(e,t),this.options=e}async load(){this.target.buffer||await this.target.load()}execute(){Di.play(this.target,this.options)}getDuration(){return this.options.sequential?this.target.buffer?.duration??0:0}}function Oi(e,t){return t.some(([t,a])=>t<=e&&e<=a)}function Ai(e){return Oi(e.charCodeAt(0),[[12352,12447],[19968,40959],[44032,55203],[131072,191456]])}function Qi(e){return" \n\r\t".includes(e)}function _i(e){return Oi(e.charCodeAt(0),[[33,47],[58,64],[91,96],[123,126],[12288,12351],[65280,65519]])}function $i(e,t={}){const{wordsPerMin:a=500}=t,s=e.total/a;return{seconds:parseFloat((60*s).toFixed(1))}}function qi(e,t={}){const a=function(e,t){let a=0,s=0,n=e.length-1;const{wordBound:i=Qi}=t;for(;i(e[s]);)s++;for(;i(e[n]);)n--;const r=`${e}\n`;for(let o=s;o<=n;o++)if((Ai(r[o])||!i(r[o])&&(i(r[o+1])||Ai(r[o+1])))&&a++,Ai(r[o]))for(;o<=n&&(_i(r[o+1])||i(r[o+1]));)o++;return{total:a}}(e,t);return{...$i(a,t),words:a}}class er extends Li{speakerDirective;voiceDirective;inlineList;duration;text;tl;constructor(e,a){super(e,a),this.options=L({interval:.2,sequential:!0,effect:"typewriter",effectDuration:.5,alignWithVoice:!0},e),this.duration=0,this.text="";const{speaker:s,voice:n,lines:i,executeTime:r}=this.options;s?.targetName&&(this.speakerDirective=new Bi({...s,executeTime:r},a)),n?.targetName&&(this.voiceDirective=new Pi({...n,executeTime:r,sequential:!0},this.stage)),this.tl=R.timeline({paused:!0}),this.inlineList=[],i.forEach(e=>{if("p"===e.type)for(let s=0;s<e.children.length;s++){const n=e.children[s];if("directive"===n.type){const{directive:e,params:s}=n.value,i=t[e];if(i){const t=new i(s,a);this.inlineList.push({type:"directive",value:t,name:e})}}else if(n.text){let t=n.text;s===e.children.length-1&&(t+="\n"),this.inlineList.push({type:"text",value:t})}}})}check(){let e=!0;for(const t of this.inlineList)if("directive"===t.type&&!t.value.check())throw e=!1,{type:"custom",message:"speak inline directive check failed",errorSceneName:this.stage.label,errorDirectiveName:t.name,errorLines:this.inlineList.filter(e=>"text"===e.type).map(e=>e.value).join("").slice(0,10)};return e}async load(){this.voiceDirective&&await this.voiceDirective.load(),this.target&&(this.target.text="");for(const e of this.inlineList)if("directive"===e.type){const t=e.value;await t.load(),this.tl.add(()=>{t.execute()},this.duration),this.duration+=t.getDuration()}else{const t=e.value,a=this.readingTime(t,this.options.wordsPerMin);this.textAnimate(t,a),this.duration+=a}}execute(){this.target&&(this.target.visible=!0),this.tl.play(),this.speakerDirective?.execute(),this.voiceDirective?.execute()}textAnimate(e,t){const{effect:a}=this.options;switch(a){case"typewriter":this.typewriter(e,t);break;case"typewriteFadeIn":this.typewriteFadeIn(e,t);break;case"fadeIn":this.fadeIn(e,t);break;case"none":this.none(e)}}typewriter(e,t){const a=this.text,s=a+e;this.tl.fromTo(this.target,{text:{value:a}},{text:{value:s},duration:t,ease:"none"},this.duration),this.text=s}typewriteFadeIn(e,t){const a=this.text,s=a+e,n=t/e.length;this.target.alpha=0;const i=[],r=this.target.style,o=I.measureText(s,r),l=o.lines;let c=this.target.y;l.forEach(e=>{let t=this.target.x;for(let s=0;s<e.length;s++){const n=e[s],o=new m(n,r),l=I.measureText(n,r);o.x=t,o.y=c,o.alpha=i.length<a.length?1:0,o.zIndex=this.target.zIndex,t+=l.width,this.stage.addChild(o),i.push(o)}c+=o.lineHeight}),i.forEach((e,t)=>{t<a.length||this.tl.to(e,{alpha:1,duration:.3,onComplete:()=>{t===i.length-1&&i.forEach(e=>{this.stage.removeChild(e),this.target.text=s,this.target.alpha=1})}},this.duration+t*n)}),this.text=s}fadeIn(e,t){const{effectDuration:a}=this.options,s=this.text,n=s+e;this.tl.fromTo(this.target,{pixi:{alpha:0},text:{value:s}},{pixi:{alpha:1},text:{value:n},duration:Math.min(a??.5,t),ease:"none"},this.duration),this.text=n}none(e){const t=this.text+e;this.tl.to(this.target,{pixi:{alpha:1},text:{value:t},duration:0,ease:"none"},this.duration),this.text=t}getDuration(){const{sequential:e,interval:t}=this.options;let a=this.duration;if(this.voiceDirective){const e=this.voiceDirective.getDuration();a=Math.max(a,e)}return a+=t??0,e?a:0}readingTime(e,t=500){return e?qi(e,{wordsPerMin:t}).seconds:0}}class tr extends Li{constructor(e,t){super(e,t),this.options=L({toVars:{pixi:{visible:!1},ease:"none",duration:0}},e)}}class ar extends Li{constructor(e,t){super(e,t),this.options=L({toVars:{pixi:{alpha:0},ease:"power1.in",duration:.5}},e)}}class sr extends Li{constructor(e,t){super(e,t),this.options={...e,immediate:!0}}async execute(){const{source:e,immediate:t}=this.options;this.target.changeSource(e),t?await this.target.load():R.to(this.target,{pixi:{alpha:0},duration:.3,onComplete:()=>{this.target.load().then(()=>{R.to(this.target,{pixi:{alpha:1},duration:.3})})}})}}class nr extends Li{constructor(e,t){super(e,t);const a=this.target;if(!a)return;const s=a.width?.05*a.width:0,n=a.x,i=n-s,r=n+s;this.options=L({toVars:{keyframes:{"0%":{x:n},"15%":{x:i},"30%":{x:r},"45%":{x:i},"60%":{x:r},"75%":{x:i},"90%":{x:r},"100%":{x:n}},duration:.5,ease:"none"}},e)}}class ir extends Li{constructor(e,t){super(e,t);const a=this.target;if(!a)return;const s=a.height?.05*a.height:0,n=a.y,i=n-s,r=n+s;this.options=L({toVars:{keyframes:{"0%":{y:n},"15%":{y:i},"30%":{y:r},"45%":{y:i},"60%":{y:r},"75%":{y:i},"90%":{y:r},"100%":{y:n}},duration:.5,ease:"none"}},e)}}class rr extends Li{constructor(e,t){super(e,t);const a=this.target;if(!a)return;const s=a.x,n=a.y;a.anchor.set(.5),a.x=s+a.width*a.anchor.x,a.y=n+a.height*a.anchor.y,this.options=L({toVars:{pixi:{scale:1.1},ease:"power1.in",duration:.5}},e)}}class or extends Li{constructor(e,t){super(e,t);const a=this.target;if(!a)return;const s=a.x,n=a.y;a.anchor.set(.5),a.x=s+a.width*a.anchor.x,a.y=n+a.height*a.anchor.y,this.options=L({toVars:{pixi:{scale:.9},ease:"power1.out",duration:.5}},e)}}class lr extends Li{constructor(e,t){super(e,t);const a=this.target;a&&(this.options=L({fromVars:{pixi:{x:a.x-a.width,alpha:0}},toVars:{pixi:{x:a.x??0,alpha:a.alpha??1},ease:"power1.in",duration:.5}},e))}}class cr extends Li{constructor(e,t){super(e,t);const a=this.target;a&&(this.options=L({toVars:{pixi:{x:a.x-a.width,alpha:0},ease:"power1.in",duration:.5}},e))}}class dr extends Li{constructor(e,t){super(e,t);const a=this.target;a&&(this.options=L({fromVars:{pixi:{x:a.x+a.width,alpha:0}},toVars:{pixi:{x:a.x??0,alpha:a.alpha??1},ease:"power1.in",duration:.5}},e))}}class hr extends Li{constructor(e,t){super(e,t);const a=this.target;a&&(this.options=L({toVars:{pixi:{x:a.x+a.width,alpha:0},ease:"power1.in",duration:.5}},e))}}class mr extends Ri{constructor(e,t){super(e,t),this.options=L({sequential:!0},e)}execute(){}getDuration(){return this.options.duration}}class ur extends zi{constructor(e,t){super(e,t),this.options=L({fromVars:{pixi:{alpha:0}},toVars:{pixi:{alpha:1},ease:"power1.in",duration:.3}},e)}}class pr extends Ki{constructor(e,t){super(e,t),this.options=e}execute(){const{targetName:e,filterName:t}=this.options;e?this.target&&this.addFilter(this.target,t):this.addFilter(this.stage,t)}addFilter(e,t){const a=new li[t];e.filters?e.filters.push(a):e.filters=[a]}}class xr extends Ki{execute(){const{targetName:e}=this.options;e?this.target&&(this.target.filters=[]):this.stage.filters=[]}}R.registerPlugin(z),R.registerPlugin(Xi),z.registerPIXI(K),R.ticker.remove(R.updateRoot);var fr=(e=>(e.ChangeSource="ChangeSource",e.Speak="Speak",e.Speaker="Speaker",e.Show="Show",e.Hide="Hide",e.FadeIn="FadeIn",e.FadeOut="FadeOut",e.ShakeX="ShakeX",e.ShakeY="ShakeY",e.ZoomIn="ZoomIn",e.ZoomOut="ZoomOut",e.EnterFromLeft="EnterFromLeft",e.LeaveFromLeft="LeaveFromLeft",e.EnterFromRight="EnterFromRight",e.LeaveFromRight="LeaveFromRight",e.Wait="Wait",e.Play="Play",e.Pause="Pause",e.Stop="Stop",e.FadeInTransition="FadeInTransition",e.AddFilter="AddFilter",e.RemoveFilter="RemoveFilter",e))(fr||{});class gr{static defaultRendererOptions={fps:30,width:1920,height:1080,background:0};ticker;renderer;rendererOptions;started;subtitles;connecter;cutResolver;constructor(e){this.ticker=G.shared,this.ticker.ctx={},this.ticker.globalTime=0,this.ticker.asyncHandlers=[],this.ticker.autoStart=!1,this.ticker.stop(),this.rendererOptions=Object.assign({},gr.defaultRendererOptions,e),this.started=!1,this.subtitles=[];const{width:t,height:a,background:s}=this.rendererOptions;this.renderer=this.rendererOptions.renderer??F({view:new OffscreenCanvas(t,a),width:t,height:a,background:s})}connect(e){this.connecter=e,this.connecter.connect()}disconnect(){this.connecter?.disconnect(),this.connecter=void 0}hasStarted(){return this.started}async action(e){if(this.started)return;const t=performance.now();try{return await this.run(e)}catch(a){throw o.error("Error running screenplay:",a),a}finally{this.reset(),o.info("action cost:",performance.now()-t),this.cutResolver&&(this.cutResolver(!0),this.cutResolver=void 0)}}cut(){return new Promise(e=>{this.started=!1,this.cutResolver=e})}reset(){this.started=!1,this.subtitles=[],Di.reset();let e=this.ticker._head.next;for(;e;)e=e.destroy(!0);this.ticker.time=0,this.ticker.globalTime=0,this.ticker.lastTime=-1,this.ticker.ctx={},this.ticker.asyncHandlers=[]}async parseSceneScript(e){const{scene:a}=e,{directives:s}=e;let n=0;const i=[];e.preload?await e.preload:await a.load(),a.children.forEach(e=>{e.visible=!1});for(const c of s){const{directive:e,params:s}=c,r=t[e];if(!r){o.error(`Directive ${e} not found`);continue}const l=new r({...s,executeTime:n},a);if(!l.check())throw{type:"custom",message:"directive check failed",errorSceneName:a.label,errorDirectiveName:e};l.load&&await l.load();const d=()=>{const{time:t,globalTime:a}=this.ticker;var s,n,i;l.currentTime=t,s=t,n=l.executeTime,i=1/this.rendererOptions.fps,Math.abs(s-n)<i&&(o.debug("execute directive:",l,t-l.executeTime),this.ticker.asyncHandlers.push(l.execute()),this.ticker.remove(d),"Speak"===e&&this.subtitles.push({start:a,end:a+l.getDuration(),text:l.options.text}))};i.push(d),n+=l.getDuration()}const{fps:r}=this.rendererOptions,l=n;return{frameCount:Math.ceil(l*r),install:()=>{o.debug("switch scene exec:",this.ticker.time),R.updateRoot(0),Di.resetExceptUtilEnd(),this.ticker.ctx.scene=a,i.forEach(e=>{this.ticker.add(e)});const e=()=>{const e=this.ticker.time;Di.update(e,this.rendererOptions.fps),this.ticker.asyncHandlers.push((async()=>{this.ticker.ctx.audioBuffers=await Di.getAudioBuffers()})()),R.updateRoot(e),this.ticker.ctx.scene&&(this.renderer.render(this.ticker.ctx.scene),this.ticker.ctx.imageSource=this.renderer.view)};return this.ticker.add(e),()=>{this.ticker.remove(e),this.ticker.time=0,this.ticker.lastTime=-1,this.ticker.ctx={},this.ticker.asyncHandlers=[]}}}}async run(e){const{fps:t}=this.rendererOptions,{scenes:a}=e;let s,n=0;this.started=!0;for(const[i,r]of a.entries()){const e=await this.parseSceneScript(r),s=a[i+1];s&&(s.preload=s.scene.load());const o=e.install(),l=e.frameCount;for(let r=0;r<=l;r++){const e=r/t*1e3,s=n/t*1e3;if(!this.started)break;this.ticker.time=e/1e3,this.ticker.update(e),this.ticker.globalTime=s/1e3,await Promise.all(this.ticker.asyncHandlers),this.connecter?.connection&&await this.connecter.handle({timestamp:s,imageSource:this.ticker.ctx.imageSource,audioBuffers:this.ticker.ctx.audioBuffers}),this.rendererOptions.onProgress&&this.rendererOptions.onProgress(100*(i/a.length+r/l/a.length),s/1e3),n++}o()}return this.started&&this.connecter?.connection&&(s=await this.connecter.finish()),this.started=!1,{result:s,subtitles:this.subtitles}}}class vr{connection;options;constructor(e){this.connection=!1,this.options=e}connect(){this.connection=!0}disconnect(){this.connection=!1}}const br="dmFyIGZpPU9iamVjdC5kZWZpbmVQcm9wZXJ0eTt2YXIgY2k9KFIsRCxOKT0+RCBpbiBSP2ZpKFIsRCx7ZW51bWVyYWJsZTohMCxjb25maWd1cmFibGU6ITAsd3JpdGFibGU6ITAsdmFsdWU6Tn0pOlJbRF09Tjt2YXIgaz0oUixELE4pPT4oY2koUix0eXBlb2YgRCE9InN5bWJvbCI/RCsiIjpELE4pLE4pOyhmdW5jdGlvbigpeyJ1c2Ugc3RyaWN0Ijt2YXIgUj1PYmplY3QuZGVmaW5lUHJvcGVydHksRD1PYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzLE49T2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eSx0dD1PYmplY3QucHJvdG90eXBlLnByb3BlcnR5SXNFbnVtZXJhYmxlLHo9TWF0aC5wb3csemU9KGUsdCxpKT0+dCBpbiBlP1IoZSx0LHtlbnVtZXJhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMCx3cml0YWJsZTohMCx2YWx1ZTppfSk6ZVt0XT1pLGl0PShlLHQpPT57Zm9yKHZhciBpIGluIHR8fCh0PXt9KSlOLmNhbGwodCxpKSYmemUoZSxpLHRbaV0pO2lmKEQpZm9yKHZhciBpIG9mIEQodCkpdHQuY2FsbCh0LGkpJiZ6ZShlLGksdFtpXSk7cmV0dXJuIGV9LHdlPShlLHQsaSk9PntpZighdC5oYXMoZSkpdGhyb3cgVHlwZUVycm9yKCJDYW5ub3QgIitpKX0sbj0oZSx0LGkpPT4od2UoZSx0LCJyZWFkIGZyb20gcHJpdmF0ZSBmaWVsZCIpLGk/aS5jYWxsKGUpOnQuZ2V0KGUpKSxoPShlLHQsaSk9PntpZih0LmhhcyhlKSl0aHJvdyBUeXBlRXJyb3IoIkNhbm5vdCBhZGQgdGhlIHNhbWUgcHJpdmF0ZSBtZW1iZXIgbW9yZSB0aGFuIG9uY2UiKTt0IGluc3RhbmNlb2YgV2Vha1NldD90LmFkZChlKTp0LnNldChlLGkpfSxiPShlLHQsaSxzKT0+KHdlKGUsdCwid3JpdGUgdG8gcHJpdmF0ZSBmaWVsZCIpLHM/cy5jYWxsKGUsaSk6dC5zZXQoZSxpKSxpKSxwPShlLHQsaSk9Pih3ZShlLHQsImFjY2VzcyBwcml2YXRlIG1ldGhvZCIpLGkpLHU9bmV3IFVpbnQ4QXJyYXkoOCksQj1uZXcgRGF0YVZpZXcodS5idWZmZXIpLEw9ZT0+WyhlJTI1NisyNTYpJTI1Nl0sZj1lPT4oQi5zZXRVaW50MTYoMCxlLCExKSxbdVswXSx1WzFdXSksbnQ9ZT0+KEIuc2V0SW50MTYoMCxlLCExKSxbdVswXSx1WzFdXSksQmU9ZT0+KEIuc2V0VWludDMyKDAsZSwhMSksW3VbMV0sdVsyXSx1WzNdXSksYT1lPT4oQi5zZXRVaW50MzIoMCxlLCExKSxbdVswXSx1WzFdLHVbMl0sdVszXV0pLHN0PWU9PihCLnNldFVpbnQzMigwLE1hdGguZmxvb3IoZS96KDIsMzIpKSwhMSksQi5zZXRVaW50MzIoNCxlLCExKSxbdVswXSx1WzFdLHVbMl0sdVszXSx1WzRdLHVbNV0sdVs2XSx1WzddXSksZ2U9ZT0+KEIuc2V0SW50MTYoMCx6KDIsOCkqZSwhMSksW3VbMF0sdVsxXV0pLFA9ZT0+KEIuc2V0SW50MzIoMCx6KDIsMTYpKmUsITEpLFt1WzBdLHVbMV0sdVsyXSx1WzNdXSksbWU9ZT0+KEIuc2V0SW50MzIoMCx6KDIsMzApKmUsITEpLFt1WzBdLHVbMV0sdVsyXSx1WzNdXSksVz0oZSx0PSExKT0+e2xldCBpPUFycmF5KGUubGVuZ3RoKS5maWxsKG51bGwpLm1hcCgocyxyKT0+ZS5jaGFyQ29kZUF0KHIpKTtyZXR1cm4gdCYmaS5wdXNoKDApLGl9LHg9ZT0+ZSYmZVtlLmxlbmd0aC0xXSxZPShlLHQsaT0hMCk9PntsZXQgcz1lKnQ7cmV0dXJuIGk/TWF0aC5yb3VuZChzKTpzfSxrZT1lPT57bGV0IHQ9ZSooTWF0aC5QSS8xODApLGk9TWF0aC5jb3ModCkscz1NYXRoLnNpbih0KTtyZXR1cm5baSxzLDAsLXMsaSwwLDAsMCwxXX0scnQ9a2UoMCksRmU9ZT0+W1AoZVswXSksUChlWzFdKSxtZShlWzJdKSxQKGVbM10pLFAoZVs0XSksbWUoZVs1XSksUChlWzZdKSxQKGVbN10pLG1lKGVbOF0pXSxtPShlLHQsaSk9Pih7dHlwZTplLGNvbnRlbnRzOnQmJm5ldyBVaW50OEFycmF5KHQuZmxhdCgxMCkpLGNoaWxkcmVuOml9KSx5PShlLHQsaSxzLHIpPT5tKGUsW0wodCksQmUoaSkscyE9bnVsbD9zOltdXSxyKSxhdD1lPT5lP20oImZ0eXAiLFtXKCJpc29tIiksYSgwKSxXKCJpc280IiksVygiaHZjMSIpXSk6bSgiZnR5cCIsW1coImlzb20iKSxhKDApLFcoImlzb20iKSxXKCJhdmMxIiksVygibXA0MSIpXSksb3Q9KCk9Pih7dHlwZToibWRhdCIsbGFyZ2VTaXplOiEwfSksbHQ9KGUsdCk9Pm0oIm1vb3YiLG51bGwsW2h0KHQsZSksLi4uZS5tYXAoaT0+dXQoaSx0KSldKSxodD0oZSx0KT0+e2xldCBpPVkoTWF0aC5tYXgoMCwuLi50LmZpbHRlcihyPT5yLnNhbXBsZXMubGVuZ3RoPjApLm1hcChyPT54KHIuc2FtcGxlcykudGltZXN0YW1wK3goci5zYW1wbGVzKS5kdXJhdGlvbikpLEVlKSxzPU1hdGgubWF4KC4uLnQubWFwKHI9PnIuaWQpKSsxO3JldHVybiB5KCJtdmhkIiwwLDAsW2EoZSksYShlKSxhKEVlKSxhKGkpLFAoMSksZ2UoMSksQXJyYXkoMTApLmZpbGwoMCksRmUocnQpLEFycmF5KDI0KS5maWxsKDApLGEocyldKX0sdXQ9KGUsdCk9Pm0oInRyYWsiLG51bGwsW2R0KGUsdCksZnQoZSx0KV0pLGR0PShlLHQpPT57bGV0IGk9eChlLnNhbXBsZXMpLHM9WShpP2kudGltZXN0YW1wK2kuZHVyYXRpb246MCxFZSk7cmV0dXJuIHkoInRraGQiLDAsMyxbYSh0KSxhKHQpLGEoZS5pZCksYSgwKSxhKHMpLEFycmF5KDgpLmZpbGwoMCksZigwKSxmKDApLGdlKGUuaW5mby50eXBlPT09ImF1ZGlvIj8xOjApLGYoMCksRmUoa2UoZS5pbmZvLnR5cGU9PT0idmlkZW8iP2UuaW5mby5yb3RhdGlvbjowKSksUChlLmluZm8udHlwZT09PSJ2aWRlbyI/ZS5pbmZvLndpZHRoOjApLFAoZS5pbmZvLnR5cGU9PT0idmlkZW8iP2UuaW5mby5oZWlnaHQ6MCldKX0sZnQ9KGUsdCk9Pm0oIm1kaWEiLG51bGwsW2N0KGUsdCksdnQoZS5pbmZvLnR5cGU9PT0idmlkZW8iPyJ2aWRlIjoic291biIpLHB0KGUpXSksY3Q9KGUsdCk9PntsZXQgaT14KGUuc2FtcGxlcykscz1ZKGk/aS50aW1lc3RhbXAraS5kdXJhdGlvbjowLGUudGltZXNjYWxlKTtyZXR1cm4geSgibWRoZCIsMCwwLFthKHQpLGEodCksYShlLnRpbWVzY2FsZSksYShzKSxmKDIxOTU2KSxmKDApXSl9LHZ0PWU9PnkoImhkbHIiLDAsMCxbVygibWhsciIpLFcoZSksYSgwKSxhKDApLGEoMCksVygibXA0LW11eGVyLWhkbHIiKV0pLHB0PWU9Pm0oIm1pbmYiLG51bGwsW2UuaW5mby50eXBlPT09InZpZGVvIj93dCgpOmd0KCksbXQoKSxfdChlKV0pLHd0PSgpPT55KCJ2bWhkIiwwLDEsW2YoMCksZigwKSxmKDApLGYoMCldKSxndD0oKT0+eSgic21oZCIsMCwwLFtmKDApLGYoMCldKSxtdD0oKT0+bSgiZGluZiIsbnVsbCxbeXQoKV0pLHl0PSgpPT55KCJkcmVmIiwwLDAsW2EoMSldLFtDdCgpXSksQ3Q9KCk9PnkoInVybCAiLDAsMSksX3Q9ZT0+bSgic3RibCIsbnVsbCxbVHQoZSksVXQoZSksRHQoZSksUHQoZSksV3QoZSksenQoZSldKSxUdD1lPT55KCJzdHNkIiwwLDAsW2EoMSldLFtlLmluZm8udHlwZT09PSJ2aWRlbyI/U3QoQnRbZS5pbmZvLmNvZGVjXSxlKTpMdChGdFtlLmluZm8uY29kZWNdLGUpXSksU3Q9KGUsdCk9Pm0oZSxbQXJyYXkoNikuZmlsbCgwKSxmKDEpLGYoMCksZigwKSxBcnJheSgxMikuZmlsbCgwKSxmKHQuaW5mby53aWR0aCksZih0LmluZm8uaGVpZ2h0KSxhKDQ3MTg1OTIpLGEoNDcxODU5MiksYSgwKSxmKDEpLEFycmF5KDMyKS5maWxsKDApLGYoMjQpLG50KDY1NTM1KV0sW2t0W3QuaW5mby5jb2RlY10odCldKSxFdD1lPT5lLmNvZGVjUHJpdmF0ZSYmbSgiYXZjQyIsWy4uLmUuY29kZWNQcml2YXRlXSksYnQ9ZT0+ZS5jb2RlY1ByaXZhdGUmJm0oImh2Y0MiLFsuLi5lLmNvZGVjUHJpdmF0ZV0pLEl0PWU9PmUuY29kZWNQcml2YXRlJiZtKCJ2cGNDIixbLi4uZS5jb2RlY1ByaXZhdGVdKSxBdD1lPT5lLmNvZGVjUHJpdmF0ZSYmbSgiYXYxQyIsWy4uLmUuY29kZWNQcml2YXRlXSksTHQ9KGUsdCk9Pm0oZSxbQXJyYXkoNikuZmlsbCgwKSxmKDEpLGYoMCksZigwKSxhKDApLGYodC5pbmZvLm51bWJlck9mQ2hhbm5lbHMpLGYoMTYpLGYoMCksZigwKSxQKHQuaW5mby5zYW1wbGVSYXRlKV0sW1J0W3QuaW5mby5jb2RlY10odCldKSxNdD1lPT55KCJlc2RzIiwwLDAsW2EoNTg3NTMxNTIpLEwoMzIrZS5jb2RlY1ByaXZhdGUuYnl0ZUxlbmd0aCksZigxKSxMKDApLGEoNzU1MzAzNjgpLEwoMTgrZS5jb2RlY1ByaXZhdGUuYnl0ZUxlbmd0aCksTCg2NCksTCgyMSksQmUoMCksYSgxMzAwNzEpLGEoMTMwMDcxKSxhKDkyMzA3NTg0KSxMKGUuY29kZWNQcml2YXRlLmJ5dGVMZW5ndGgpLC4uLmUuY29kZWNQcml2YXRlLGEoMTA5MDg0ODAwKSxMKDEpLEwoMildKSxPdD1lPT5tKCJkT3BzIixbTCgwKSxMKGUuaW5mby5udW1iZXJPZkNoYW5uZWxzKSxmKDM4NDApLGEoZS5pbmZvLnNhbXBsZVJhdGUpLGdlKDApLEwoMCldKSxVdD1lPT55KCJzdHRzIiwwLDAsW2EoZS50aW1lVG9TYW1wbGVUYWJsZS5sZW5ndGgpLGUudGltZVRvU2FtcGxlVGFibGUubWFwKHQ9PlthKHQuc2FtcGxlQ291bnQpLGEodC5zYW1wbGVEZWx0YSldKV0pLER0PWU9PntpZihlLnNhbXBsZXMuZXZlcnkoaT0+aS50eXBlPT09ImtleSIpKXJldHVybiBudWxsO2xldCB0PVsuLi5lLnNhbXBsZXMuZW50cmllcygpXS5maWx0ZXIoKFssaV0pPT5pLnR5cGU9PT0ia2V5Iik7cmV0dXJuIHkoInN0c3MiLDAsMCxbYSh0Lmxlbmd0aCksdC5tYXAoKFtpXSk9PmEoaSsxKSldKX0sUHQ9ZT0+eSgic3RzYyIsMCwwLFthKGUuY29tcGFjdGx5Q29kZWRDaHVua1RhYmxlLmxlbmd0aCksZS5jb21wYWN0bHlDb2RlZENodW5rVGFibGUubWFwKHQ9PlthKHQuZmlyc3RDaHVuayksYSh0LnNhbXBsZXNQZXJDaHVuayksYSgxKV0pXSksV3Q9ZT0+eSgic3RzeiIsMCwwLFthKDApLGEoZS5zYW1wbGVzLmxlbmd0aCksZS5zYW1wbGVzLm1hcCh0PT5hKHQuc2l6ZSkpXSksenQ9ZT0+ZS53cml0dGVuQ2h1bmtzLmxlbmd0aD4wJiZ4KGUud3JpdHRlbkNodW5rcykub2Zmc2V0Pj16KDIsMzIpP3koImNvNjQiLDAsMCxbYShlLndyaXR0ZW5DaHVua3MubGVuZ3RoKSxlLndyaXR0ZW5DaHVua3MubWFwKHQ9PnN0KHQub2Zmc2V0KSldKTp5KCJzdGNvIiwwLDAsW2EoZS53cml0dGVuQ2h1bmtzLmxlbmd0aCksZS53cml0dGVuQ2h1bmtzLm1hcCh0PT5hKHQub2Zmc2V0KSldKSxCdD17YXZjOiJhdmMxIixoZXZjOiJodmMxIix2cDk6InZwMDkiLGF2MToiYXYwMSJ9LGt0PXthdmM6RXQsaGV2YzpidCx2cDk6SXQsYXYxOkF0fSxGdD17YWFjOiJtcDRhIixvcHVzOiJvcHVzIn0sUnQ9e2FhYzpNdCxvcHVzOk90fSxSZT1jbGFzc3tjb25zdHJ1Y3Rvcigpe3RoaXMuYnVmZmVyPW51bGx9fSxOZT1jbGFzc3tjb25zdHJ1Y3RvcihlLHQsaSl7dGhpcy5vbkRhdGE9ZSx0aGlzLm9uRG9uZT10LHRoaXMub3B0aW9ucz1pfX0sTnQ9Y2xhc3N7Y29uc3RydWN0b3IoZSx0KXt0aGlzLnN0cmVhbT1lLHRoaXMub3B0aW9ucz10fX0sSCxLLHllPWNsYXNze2NvbnN0cnVjdG9yKCl7dGhpcy5wb3M9MCxoKHRoaXMsSCxuZXcgVWludDhBcnJheSg4KSksaCh0aGlzLEssbmV3IERhdGFWaWV3KG4odGhpcyxIKS5idWZmZXIpKSx0aGlzLm9mZnNldHM9bmV3IFdlYWtNYXB9c2VlayhlKXt0aGlzLnBvcz1lfXdyaXRlVTMyKGUpe24odGhpcyxLKS5zZXRVaW50MzIoMCxlLCExKSx0aGlzLndyaXRlKG4odGhpcyxIKS5zdWJhcnJheSgwLDQpKX13cml0ZVU2NChlKXtuKHRoaXMsSykuc2V0VWludDMyKDAsTWF0aC5mbG9vcihlL3ooMiwzMikpLCExKSxuKHRoaXMsSykuc2V0VWludDMyKDQsZSwhMSksdGhpcy53cml0ZShuKHRoaXMsSCkuc3ViYXJyYXkoMCw4KSl9d3JpdGVBc2NpaShlKXtmb3IobGV0IHQ9MDt0PGUubGVuZ3RoO3QrKyluKHRoaXMsSykuc2V0VWludDgodCU4LGUuY2hhckNvZGVBdCh0KSksdCU4PT09NyYmdGhpcy53cml0ZShuKHRoaXMsSCkpO2UubGVuZ3RoJTghPT0wJiZ0aGlzLndyaXRlKG4odGhpcyxIKS5zdWJhcnJheSgwLGUubGVuZ3RoJTgpKX13cml0ZUJveChlKXt2YXIgdCxpO2lmKHRoaXMub2Zmc2V0cy5zZXQoZSx0aGlzLnBvcyksZS5jb250ZW50cyYmIWUuY2hpbGRyZW4pdGhpcy53cml0ZUJveEhlYWRlcihlLCh0PWUuc2l6ZSkhPW51bGw/dDplLmNvbnRlbnRzLmJ5dGVMZW5ndGgrOCksdGhpcy53cml0ZShlLmNvbnRlbnRzKTtlbHNle2xldCBzPXRoaXMucG9zO2lmKHRoaXMud3JpdGVCb3hIZWFkZXIoZSwwKSxlLmNvbnRlbnRzJiZ0aGlzLndyaXRlKGUuY29udGVudHMpLGUuY2hpbGRyZW4pZm9yKGxldCBvIG9mIGUuY2hpbGRyZW4pbyYmdGhpcy53cml0ZUJveChvKTtsZXQgcj10aGlzLnBvcyxkPShpPWUuc2l6ZSkhPW51bGw/aTpyLXM7dGhpcy5zZWVrKHMpLHRoaXMud3JpdGVCb3hIZWFkZXIoZSxkKSx0aGlzLnNlZWsocil9fXdyaXRlQm94SGVhZGVyKGUsdCl7dGhpcy53cml0ZVUzMihlLmxhcmdlU2l6ZT8xOnQpLHRoaXMud3JpdGVBc2NpaShlLnR5cGUpLGUubGFyZ2VTaXplJiZ0aGlzLndyaXRlVTY0KHQpfXBhdGNoQm94KGUpe2xldCB0PXRoaXMucG9zO3RoaXMuc2Vlayh0aGlzLm9mZnNldHMuZ2V0KGUpKSx0aGlzLndyaXRlQm94KGUpLHRoaXMuc2Vlayh0KX19O0g9bmV3IFdlYWtNYXAsSz1uZXcgV2Vha01hcDt2YXIgc2UsVixKLHJlLENlLHh0PWNsYXNzIGV4dGVuZHMgeWV7Y29uc3RydWN0b3IoZSl7c3VwZXIoKSxoKHRoaXMscmUpLGgodGhpcyxzZSx2b2lkIDApLGgodGhpcyxWLG5ldyBBcnJheUJ1ZmZlcih6KDIsMTYpKSksaCh0aGlzLEosbmV3IFVpbnQ4QXJyYXkobih0aGlzLFYpKSksYih0aGlzLHNlLGUpfXdyaXRlKGUpe3AodGhpcyxyZSxDZSkuY2FsbCh0aGlzLHRoaXMucG9zK2UuYnl0ZUxlbmd0aCksbih0aGlzLEopLnNldChlLHRoaXMucG9zKSx0aGlzLnBvcys9ZS5ieXRlTGVuZ3RofWZpbmFsaXplKCl7cCh0aGlzLHJlLENlKS5jYWxsKHRoaXMsdGhpcy5wb3MpLG4odGhpcyxzZSkuYnVmZmVyPW4odGhpcyxWKS5zbGljZSgwLHRoaXMucG9zKX19O3NlPW5ldyBXZWFrTWFwLFY9bmV3IFdlYWtNYXAsSj1uZXcgV2Vha01hcCxyZT1uZXcgV2Vha1NldCxDZT1mdW5jdGlvbihlKXtsZXQgdD1uKHRoaXMsVikuYnl0ZUxlbmd0aDtmb3IoO3Q8ZTspdCo9MjtpZih0PT09bih0aGlzLFYpLmJ5dGVMZW5ndGgpcmV0dXJuO2xldCBpPW5ldyBBcnJheUJ1ZmZlcih0KSxzPW5ldyBVaW50OEFycmF5KGkpO3Muc2V0KG4odGhpcyxKKSwwKSxiKHRoaXMsVixpKSxiKHRoaXMsSixzKX07dmFyIFosJCx4ZT1jbGFzcyBleHRlbmRzIHlle2NvbnN0cnVjdG9yKGUpe3N1cGVyKCksaCh0aGlzLFosdm9pZCAwKSxoKHRoaXMsJCxbXSksYih0aGlzLFosZSl9d3JpdGUoZSl7bih0aGlzLCQpLnB1c2goe2RhdGE6ZS5zbGljZSgpLHN0YXJ0OnRoaXMucG9zfSksdGhpcy5wb3MrPWUuYnl0ZUxlbmd0aH1mbHVzaCgpe2lmKG4odGhpcywkKS5sZW5ndGg9PT0wKXJldHVybjtsZXQgZT1bXSx0PVsuLi5uKHRoaXMsJCldLnNvcnQoKGkscyk9Pmkuc3RhcnQtcy5zdGFydCk7ZS5wdXNoKHtzdGFydDp0WzBdLnN0YXJ0LHNpemU6dFswXS5kYXRhLmJ5dGVMZW5ndGh9KTtmb3IobGV0IGk9MTtpPHQubGVuZ3RoO2krKyl7bGV0IHM9ZVtlLmxlbmd0aC0xXSxyPXRbaV07ci5zdGFydDw9cy5zdGFydCtzLnNpemU/cy5zaXplPU1hdGgubWF4KHMuc2l6ZSxyLnN0YXJ0K3IuZGF0YS5ieXRlTGVuZ3RoLXMuc3RhcnQpOmUucHVzaCh7c3RhcnQ6ci5zdGFydCxzaXplOnIuZGF0YS5ieXRlTGVuZ3RofSl9Zm9yKGxldCBpIG9mIGUpe2kuZGF0YT1uZXcgVWludDhBcnJheShpLnNpemUpO2ZvcihsZXQgcyBvZiBuKHRoaXMsJCkpaS5zdGFydDw9cy5zdGFydCYmcy5zdGFydDxpLnN0YXJ0K2kuc2l6ZSYmaS5kYXRhLnNldChzLmRhdGEscy5zdGFydC1pLnN0YXJ0KTtuKHRoaXMsWikub25EYXRhKGkuZGF0YSxpLnN0YXJ0KX1uKHRoaXMsJCkubGVuZ3RoPTB9ZmluYWxpemUoKXt2YXIgZSx0Oyh0PShlPW4odGhpcyxaKSkub25Eb25lKT09bnVsbHx8dC5jYWxsKGUpfX07Wj1uZXcgV2Vha01hcCwkPW5ldyBXZWFrTWFwO3ZhciBIdD16KDIsMjQpLFZ0PTIsaixNLEksYWUsX2UsVGUsSGUsU2UsVmUsZWUsb2UsJGU9Y2xhc3MgZXh0ZW5kcyB5ZXtjb25zdHJ1Y3RvcihlKXt2YXIgdCxpO2lmKHN1cGVyKCksaCh0aGlzLGFlKSxoKHRoaXMsVGUpLGgodGhpcyxTZSksaCh0aGlzLGVlKSxoKHRoaXMsaix2b2lkIDApLGgodGhpcyxNLHZvaWQgMCksaCh0aGlzLEksW10pLGIodGhpcyxqLGUpLGIodGhpcyxNLChpPSh0PWUub3B0aW9ucyk9PW51bGw/dm9pZCAwOnQuY2h1bmtTaXplKSE9bnVsbD9pOkh0KSwhTnVtYmVyLmlzSW50ZWdlcihuKHRoaXMsTSkpfHxuKHRoaXMsTSk8eigyLDEwKSl0aHJvdyBuZXcgRXJyb3IoIkludmFsaWQgU3RyZWFtVGFyZ2V0IG9wdGlvbnM6IGNodW5rU2l6ZSBtdXN0IGJlIGFuIGludGVnZXIgbm90IHNtYWxsZXIgdGhhbiAxMDI0LiIpfXdyaXRlKGUpe3AodGhpcyxhZSxfZSkuY2FsbCh0aGlzLGUsdGhpcy5wb3MpLHAodGhpcyxlZSxvZSkuY2FsbCh0aGlzKSx0aGlzLnBvcys9ZS5ieXRlTGVuZ3RofWZpbmFsaXplKCl7dmFyIGUsdDtwKHRoaXMsZWUsb2UpLmNhbGwodGhpcywhMCksKHQ9KGU9bih0aGlzLGopKS5vbkRvbmUpPT1udWxsfHx0LmNhbGwoZSl9fTtqPW5ldyBXZWFrTWFwLE09bmV3IFdlYWtNYXAsST1uZXcgV2Vha01hcCxhZT1uZXcgV2Vha1NldCxfZT1mdW5jdGlvbihlLHQpe2xldCBpPW4odGhpcyxJKS5maW5kSW5kZXgoYz0+Yy5zdGFydDw9dCYmdDxjLnN0YXJ0K24odGhpcyxNKSk7aT09PS0xJiYoaT1wKHRoaXMsU2UsVmUpLmNhbGwodGhpcyx0KSk7bGV0IHM9bih0aGlzLEkpW2ldLHI9dC1zLnN0YXJ0LGQ9ZS5zdWJhcnJheSgwLE1hdGgubWluKG4odGhpcyxNKS1yLGUuYnl0ZUxlbmd0aCkpO3MuZGF0YS5zZXQoZCxyKTtsZXQgbz17c3RhcnQ6cixlbmQ6citkLmJ5dGVMZW5ndGh9O2lmKHAodGhpcyxUZSxIZSkuY2FsbCh0aGlzLHMsbykscy53cml0dGVuWzBdLnN0YXJ0PT09MCYmcy53cml0dGVuWzBdLmVuZD09PW4odGhpcyxNKSYmKHMuc2hvdWxkRmx1c2g9ITApLG4odGhpcyxJKS5sZW5ndGg+VnQpe2ZvcihsZXQgYz0wO2M8bih0aGlzLEkpLmxlbmd0aC0xO2MrKyluKHRoaXMsSSlbY10uc2hvdWxkRmx1c2g9ITA7cCh0aGlzLGVlLG9lKS5jYWxsKHRoaXMpfWQuYnl0ZUxlbmd0aDxlLmJ5dGVMZW5ndGgmJnAodGhpcyxhZSxfZSkuY2FsbCh0aGlzLGUuc3ViYXJyYXkoZC5ieXRlTGVuZ3RoKSx0K2QuYnl0ZUxlbmd0aCl9LFRlPW5ldyBXZWFrU2V0LEhlPWZ1bmN0aW9uKGUsdCl7bGV0IGk9MCxzPWUud3JpdHRlbi5sZW5ndGgtMSxyPS0xO2Zvcig7aTw9czspe2xldCBkPU1hdGguZmxvb3IoaSsocy1pKzEpLzIpO2Uud3JpdHRlbltkXS5zdGFydDw9dC5zdGFydD8oaT1kKzEscj1kKTpzPWQtMX1mb3IoZS53cml0dGVuLnNwbGljZShyKzEsMCx0KSwocj09PS0xfHxlLndyaXR0ZW5bcl0uZW5kPHQuc3RhcnQpJiZyKys7cjxlLndyaXR0ZW4ubGVuZ3RoLTEmJmUud3JpdHRlbltyXS5lbmQ+PWUud3JpdHRlbltyKzFdLnN0YXJ0OyllLndyaXR0ZW5bcl0uZW5kPU1hdGgubWF4KGUud3JpdHRlbltyXS5lbmQsZS53cml0dGVuW3IrMV0uZW5kKSxlLndyaXR0ZW4uc3BsaWNlKHIrMSwxKX0sU2U9bmV3IFdlYWtTZXQsVmU9ZnVuY3Rpb24oZSl7bGV0IGk9e3N0YXJ0Ok1hdGguZmxvb3IoZS9uKHRoaXMsTSkpKm4odGhpcyxNKSxkYXRhOm5ldyBVaW50OEFycmF5KG4odGhpcyxNKSksd3JpdHRlbjpbXSxzaG91bGRGbHVzaDohMX07cmV0dXJuIG4odGhpcyxJKS5wdXNoKGkpLG4odGhpcyxJKS5zb3J0KChzLHIpPT5zLnN0YXJ0LXIuc3RhcnQpLG4odGhpcyxJKS5pbmRleE9mKGkpfSxlZT1uZXcgV2Vha1NldCxvZT1mdW5jdGlvbihlPSExKXtmb3IobGV0IHQ9MDt0PG4odGhpcyxJKS5sZW5ndGg7dCsrKXtsZXQgaT1uKHRoaXMsSSlbdF07aWYoISghaS5zaG91bGRGbHVzaCYmIWUpKXtmb3IobGV0IHMgb2YgaS53cml0dGVuKW4odGhpcyxqKS5vbkRhdGEoaS5kYXRhLnN1YmFycmF5KHMuc3RhcnQscy5lbmQpLGkuc3RhcnQrcy5zdGFydCk7bih0aGlzLEkpLnNwbGljZSh0LS0sMSl9fX07dmFyICR0PWNsYXNzIGV4dGVuZHMgJGV7Y29uc3RydWN0b3IoZSl7dmFyIHQ7c3VwZXIobmV3IE5lKChpLHMpPT5lLnN0cmVhbS53cml0ZSh7dHlwZToid3JpdGUiLGRhdGE6aSxwb3NpdGlvbjpzfSksdm9pZCAwLHtjaHVua1NpemU6KHQ9ZS5vcHRpb25zKT09bnVsbD92b2lkIDA6dC5jaHVua1NpemV9KSl9fSxFZT0xZTMsR3Q9WyJhdmMiLCJoZXZjIiwidnA5IiwiYXYxIl0sWHQ9WyJhYWMiLCJvcHVzIl0scXQ9MjA4Mjg0NDgwMCxLdD0uNSxRdD1bInN0cmljdCIsIm9mZnNldCJdLGcsQyxHLFgscSxiZSxsZSxJZSxHZSxBZSxYZSxMZSxxZSxNZSxLZSxoZSxPZSxVZSxRZSx0ZSx1ZSxpZSxkZSxmZSxEZSxZdD1jbGFzc3tjb25zdHJ1Y3RvcihlKXtoKHRoaXMsSWUpLGgodGhpcyxBZSksaCh0aGlzLExlKSxoKHRoaXMsTWUpLGgodGhpcyxoZSksaCh0aGlzLFVlKSxoKHRoaXMsdGUpLGgodGhpcyxpZSksaCh0aGlzLGZlKSxoKHRoaXMsZyx2b2lkIDApLGgodGhpcyxDLHZvaWQgMCksaCh0aGlzLEcsdm9pZCAwKSxoKHRoaXMsWCxudWxsKSxoKHRoaXMscSxudWxsKSxoKHRoaXMsYmUsTWF0aC5mbG9vcihEYXRlLm5vdygpLzFlMykrcXQpLGgodGhpcyxsZSwhMSk7dmFyIHQ7aWYocCh0aGlzLEllLEdlKS5jYWxsKHRoaXMsZSksdGhpcy50YXJnZXQ9ZS50YXJnZXQsYih0aGlzLGcsaXQoe2ZpcnN0VGltZXN0YW1wQmVoYXZpb3I6InN0cmljdCJ9LGUpKSxlLnRhcmdldCBpbnN0YW5jZW9mIFJlKWIodGhpcyxDLG5ldyB4dChlLnRhcmdldCkpO2Vsc2UgaWYoZS50YXJnZXQgaW5zdGFuY2VvZiBOZSliKHRoaXMsQywodD1lLnRhcmdldC5vcHRpb25zKSE9bnVsbCYmdC5jaHVua2VkP25ldyAkZShlLnRhcmdldCk6bmV3IHhlKGUudGFyZ2V0KSk7ZWxzZSBpZihlLnRhcmdldCBpbnN0YW5jZW9mIE50KWIodGhpcyxDLG5ldyAkdChlLnRhcmdldCkpO2Vsc2UgdGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIHRhcmdldDogIi5jb25jYXQoZS50YXJnZXQpKTtwKHRoaXMsQWUsWGUpLmNhbGwodGhpcykscCh0aGlzLExlLHFlKS5jYWxsKHRoaXMpfWFkZFZpZGVvQ2h1bmsoZSx0LGkpe2xldCBzPW5ldyBVaW50OEFycmF5KGUuYnl0ZUxlbmd0aCk7ZS5jb3B5VG8ocyksdGhpcy5hZGRWaWRlb0NodW5rUmF3KHMsZS50eXBlLGkhPW51bGw/aTplLnRpbWVzdGFtcCxlLmR1cmF0aW9uLHQpfWFkZFZpZGVvQ2h1bmtSYXcoZSx0LGkscyxyKXtpZihwKHRoaXMsZmUsRGUpLmNhbGwodGhpcyksIW4odGhpcyxnKS52aWRlbyl0aHJvdyBuZXcgRXJyb3IoIk5vIHZpZGVvIHRyYWNrIGRlY2xhcmVkLiIpO3AodGhpcyxoZSxPZSkuY2FsbCh0aGlzLG4odGhpcyxYKSxlLHQsaSxzLHIpfWFkZEF1ZGlvQ2h1bmsoZSx0LGkpe2xldCBzPW5ldyBVaW50OEFycmF5KGUuYnl0ZUxlbmd0aCk7ZS5jb3B5VG8ocyksdGhpcy5hZGRBdWRpb0NodW5rUmF3KHMsZS50eXBlLGkhPW51bGw/aTplLnRpbWVzdGFtcCxlLmR1cmF0aW9uLHQpfWFkZEF1ZGlvQ2h1bmtSYXcoZSx0LGkscyxyKXtpZihwKHRoaXMsZmUsRGUpLmNhbGwodGhpcyksIW4odGhpcyxnKS5hdWRpbyl0aHJvdyBuZXcgRXJyb3IoIk5vIGF1ZGlvIHRyYWNrIGRlY2xhcmVkLiIpO3AodGhpcyxoZSxPZSkuY2FsbCh0aGlzLG4odGhpcyxxKSxlLHQsaSxzLHIpfWZpbmFsaXplKCl7bih0aGlzLFgpJiZwKHRoaXMsdGUsdWUpLmNhbGwodGhpcyxuKHRoaXMsWCkpLG4odGhpcyxxKSYmcCh0aGlzLHRlLHVlKS5jYWxsKHRoaXMsbih0aGlzLHEpKTtsZXQgZT1uKHRoaXMsQykub2Zmc2V0cy5nZXQobih0aGlzLEcpKSx0PW4odGhpcyxDKS5wb3MtZTtuKHRoaXMsRykuc2l6ZT10LG4odGhpcyxDKS5wYXRjaEJveChuKHRoaXMsRykpO2xldCBpPWx0KFtuKHRoaXMsWCksbih0aGlzLHEpXS5maWx0ZXIoQm9vbGVhbiksbih0aGlzLGJlKSk7bih0aGlzLEMpLndyaXRlQm94KGkpLHAodGhpcyxpZSxkZSkuY2FsbCh0aGlzKSxuKHRoaXMsQykuZmluYWxpemUoKSxiKHRoaXMsbGUsITApfX07Zz1uZXcgV2Vha01hcCxDPW5ldyBXZWFrTWFwLEc9bmV3IFdlYWtNYXAsWD1uZXcgV2Vha01hcCxxPW5ldyBXZWFrTWFwLGJlPW5ldyBXZWFrTWFwLGxlPW5ldyBXZWFrTWFwLEllPW5ldyBXZWFrU2V0LEdlPWZ1bmN0aW9uKGUpe2lmKGUudmlkZW8pe2lmKCFHdC5pbmNsdWRlcyhlLnZpZGVvLmNvZGVjKSl0aHJvdyBuZXcgRXJyb3IoIlVuc3VwcG9ydGVkIHZpZGVvIGNvZGVjOiAiLmNvbmNhdChlLnZpZGVvLmNvZGVjKSk7aWYoZS52aWRlby5yb3RhdGlvbiE9PXZvaWQgMCYmIVswLDkwLDE4MCwyNzBdLmluY2x1ZGVzKGUudmlkZW8ucm90YXRpb24pKXRocm93IG5ldyBFcnJvcigiSW52YWxpZCB2aWRlbyByb3RhdGlvbjogIi5jb25jYXQoZS52aWRlby5yb3RhdGlvbiwiLiBIYXMgdG8gYmUgMCwgOTAsIDE4MCBvciAyNzAuIikpfWlmKGUuYXVkaW8mJiFYdC5pbmNsdWRlcyhlLmF1ZGlvLmNvZGVjKSl0aHJvdyBuZXcgRXJyb3IoIlVuc3VwcG9ydGVkIGF1ZGlvIGNvZGVjOiAiLmNvbmNhdChlLmF1ZGlvLmNvZGVjKSk7aWYoZS5maXJzdFRpbWVzdGFtcEJlaGF2aW9yJiYhUXQuaW5jbHVkZXMoZS5maXJzdFRpbWVzdGFtcEJlaGF2aW9yKSl0aHJvdyBuZXcgRXJyb3IoIkludmFsaWQgZmlyc3QgdGltZXN0YW1wIGJlaGF2aW9yOiAiLmNvbmNhdChlLmZpcnN0VGltZXN0YW1wQmVoYXZpb3IpKX0sQWU9bmV3IFdlYWtTZXQsWGU9ZnVuY3Rpb24oKXt2YXIgZTtsZXQgdD0oKGU9bih0aGlzLGcpLnZpZGVvKT09bnVsbD92b2lkIDA6ZS5jb2RlYyk9PT0iaGV2YyI7bih0aGlzLEMpLndyaXRlQm94KGF0KHQpKSxiKHRoaXMsRyxvdCgpKSxuKHRoaXMsQykud3JpdGVCb3gobih0aGlzLEcpKSxwKHRoaXMsaWUsZGUpLmNhbGwodGhpcyl9LExlPW5ldyBXZWFrU2V0LHFlPWZ1bmN0aW9uKCl7dmFyIGU7aWYobih0aGlzLGcpLnZpZGVvJiZiKHRoaXMsWCx7aWQ6MSxpbmZvOnt0eXBlOiJ2aWRlbyIsY29kZWM6bih0aGlzLGcpLnZpZGVvLmNvZGVjLHdpZHRoOm4odGhpcyxnKS52aWRlby53aWR0aCxoZWlnaHQ6bih0aGlzLGcpLnZpZGVvLmhlaWdodCxyb3RhdGlvbjooZT1uKHRoaXMsZykudmlkZW8ucm90YXRpb24pIT1udWxsP2U6MH0sdGltZXNjYWxlOjcyMCxjb2RlY1ByaXZhdGU6bmV3IFVpbnQ4QXJyYXkoMCksc2FtcGxlczpbXSx3cml0dGVuQ2h1bmtzOltdLGN1cnJlbnRDaHVuazpudWxsLGZpcnN0VGltZXN0YW1wOnZvaWQgMCxsYXN0VGltZXN0YW1wOi0xLHRpbWVUb1NhbXBsZVRhYmxlOltdLGxhc3RUaW1lc2NhbGVVbml0czpudWxsLGNvbXBhY3RseUNvZGVkQ2h1bmtUYWJsZTpbXX0pLG4odGhpcyxnKS5hdWRpbyl7bGV0IHQ9cCh0aGlzLE1lLEtlKS5jYWxsKHRoaXMsMixuKHRoaXMsZykuYXVkaW8uc2FtcGxlUmF0ZSxuKHRoaXMsZykuYXVkaW8ubnVtYmVyT2ZDaGFubmVscyk7Yih0aGlzLHEse2lkOm4odGhpcyxnKS52aWRlbz8yOjEsaW5mbzp7dHlwZToiYXVkaW8iLGNvZGVjOm4odGhpcyxnKS5hdWRpby5jb2RlYyxudW1iZXJPZkNoYW5uZWxzOm4odGhpcyxnKS5hdWRpby5udW1iZXJPZkNoYW5uZWxzLHNhbXBsZVJhdGU6bih0aGlzLGcpLmF1ZGlvLnNhbXBsZVJhdGV9LHRpbWVzY2FsZTpuKHRoaXMsZykuYXVkaW8uc2FtcGxlUmF0ZSxjb2RlY1ByaXZhdGU6dCxzYW1wbGVzOltdLHdyaXR0ZW5DaHVua3M6W10sY3VycmVudENodW5rOm51bGwsZmlyc3RUaW1lc3RhbXA6dm9pZCAwLGxhc3RUaW1lc3RhbXA6LTEsdGltZVRvU2FtcGxlVGFibGU6W10sbGFzdFRpbWVzY2FsZVVuaXRzOm51bGwsY29tcGFjdGx5Q29kZWRDaHVua1RhYmxlOltdfSl9fSxNZT1uZXcgV2Vha1NldCxLZT1mdW5jdGlvbihlLHQsaSl7bGV0IHI9Wzk2ZTMsODgyMDAsNjRlMyw0OGUzLDQ0MTAwLDMyZTMsMjRlMywyMjA1MCwxNmUzLDEyZTMsMTEwMjUsOGUzLDczNTBdLmluZGV4T2YodCksZD1pLG89IiI7bys9ZS50b1N0cmluZygyKS5wYWRTdGFydCg1LCIwIiksbys9ci50b1N0cmluZygyKS5wYWRTdGFydCg0LCIwIikscj09PTE1JiYobys9dC50b1N0cmluZygyKS5wYWRTdGFydCgyNCwiMCIpKSxvKz1kLnRvU3RyaW5nKDIpLnBhZFN0YXJ0KDQsIjAiKTtsZXQgYz1NYXRoLmNlaWwoby5sZW5ndGgvOCkqODtvPW8ucGFkRW5kKGMsIjAiKTtsZXQgQT1uZXcgVWludDhBcnJheShvLmxlbmd0aC84KTtmb3IobGV0IEU9MDtFPG8ubGVuZ3RoO0UrPTgpQVtFLzhdPXBhcnNlSW50KG8uc2xpY2UoRSxFKzgpLDIpO3JldHVybiBBfSxoZT1uZXcgV2Vha1NldCxPZT1mdW5jdGlvbihlLHQsaSxzLHIsZCl7dmFyIG87bGV0IGM9cy8xZTYsQT1yLzFlNjtpZihlLmZpcnN0VGltZXN0YW1wPT09dm9pZCAwJiYoZS5maXJzdFRpbWVzdGFtcD1jKSxjPXAodGhpcyxVZSxRZSkuY2FsbCh0aGlzLGMsZSksZS5sYXN0VGltZXN0YW1wPWMsKCFlLmN1cnJlbnRDaHVua3x8Yy1lLmN1cnJlbnRDaHVuay5zdGFydFRpbWVzdGFtcD49S3QpJiYoZS5jdXJyZW50Q2h1bmsmJnAodGhpcyx0ZSx1ZSkuY2FsbCh0aGlzLGUpLGUuY3VycmVudENodW5rPXtzdGFydFRpbWVzdGFtcDpjLHNhbXBsZURhdGE6W10sc2FtcGxlQ291bnQ6MH0pLGUuY3VycmVudENodW5rLnNhbXBsZURhdGEucHVzaCh0KSxlLmN1cnJlbnRDaHVuay5zYW1wbGVDb3VudCsrLChvPWQ9PW51bGw/dm9pZCAwOmQuZGVjb2RlckNvbmZpZykhPW51bGwmJm8uZGVzY3JpcHRpb24mJihlLmNvZGVjUHJpdmF0ZT1uZXcgVWludDhBcnJheShkLmRlY29kZXJDb25maWcuZGVzY3JpcHRpb24pKSxlLnNhbXBsZXMucHVzaCh7dGltZXN0YW1wOmMsZHVyYXRpb246QSxzaXplOnQuYnl0ZUxlbmd0aCx0eXBlOml9KSxlLmxhc3RUaW1lc2NhbGVVbml0cyE9PW51bGwpe2xldCBFPVkoYyxlLnRpbWVzY2FsZSwhMSksXz1NYXRoLnJvdW5kKEUtZS5sYXN0VGltZXNjYWxlVW5pdHMpO2UubGFzdFRpbWVzY2FsZVVuaXRzKz1fO2xldCBPPXgoZS50aW1lVG9TYW1wbGVUYWJsZSk7Ty5zYW1wbGVDb3VudD09PTE/KE8uc2FtcGxlRGVsdGE9XyxPLnNhbXBsZUNvdW50KyspOk8uc2FtcGxlRGVsdGE9PT1fP08uc2FtcGxlQ291bnQrKzooTy5zYW1wbGVDb3VudC0tLGUudGltZVRvU2FtcGxlVGFibGUucHVzaCh7c2FtcGxlQ291bnQ6MixzYW1wbGVEZWx0YTpffSkpfWVsc2UgZS5sYXN0VGltZXNjYWxlVW5pdHM9MCxlLnRpbWVUb1NhbXBsZVRhYmxlLnB1c2goe3NhbXBsZUNvdW50OjEsc2FtcGxlRGVsdGE6WShBLGUudGltZXNjYWxlKX0pfSxVZT1uZXcgV2Vha1NldCxRZT1mdW5jdGlvbihlLHQpe2lmKG4odGhpcyxnKS5maXJzdFRpbWVzdGFtcEJlaGF2aW9yPT09InN0cmljdCImJnQubGFzdFRpbWVzdGFtcD09PS0xJiZlIT09MCl0aHJvdyBuZXcgRXJyb3IoIlRoZSBmaXJzdCBjaHVuayBmb3IgeW91ciBtZWRpYSB0cmFjayBtdXN0IGhhdmUgYSB0aW1lc3RhbXAgb2YgMCAocmVjZWl2ZWQgIi5jb25jYXQoZSwiKS4gTm9uLXplcm8gZmlyc3QgdGltZXN0YW1wcyBhcmUgb2Z0ZW4gY2F1c2VkIGJ5IGRpcmVjdGx5IHBpcGluZyBmcmFtZXMgb3IgYXVkaW8gZGF0YSBmcm9tIGEgTWVkaWFTdHJlYW1UcmFjayBpbnRvIHRoZSBlbmNvZGVyLiBUaGVpciB0aW1lc3RhbXBzIGFyZSB0eXBpY2FsbHkgcmVsYXRpdmUgdG8gdGhlIGFnZSBvZiB0aGUgZG9jdW1lbnQsIHdoaWNoIGlzIHByb2JhYmx5IHdoYXQgeW91IHdhbnQuXG5cbklmIHlvdSB3YW50IHRvIG9mZnNldCBhbGwgdGltZXN0YW1wcyBvZiBhIHRyYWNrIHN1Y2ggdGhhdCB0aGUgZmlyc3Qgb25lIGlzIHplcm8sIHNldCBmaXJzdFRpbWVzdGFtcEJlaGF2aW9yOiAnb2Zmc2V0JyBpbiB0aGUgb3B0aW9ucy5cbiIpKTtpZihuKHRoaXMsZykuZmlyc3RUaW1lc3RhbXBCZWhhdmlvcj09PSJvZmZzZXQiJiYoZS09dC5maXJzdFRpbWVzdGFtcCksZTx0Lmxhc3RUaW1lc3RhbXApdGhyb3cgbmV3IEVycm9yKCJUaW1lc3RhbXBzIG11c3QgYmUgbW9ub3RvbmljYWxseSBpbmNyZWFzaW5nICh3ZW50IGZyb20gIi5jb25jYXQodC5sYXN0VGltZXN0YW1wKjFlNiwiIHRvICIpLmNvbmNhdChlKjFlNiwiKS4iKSk7cmV0dXJuIGV9LHRlPW5ldyBXZWFrU2V0LHVlPWZ1bmN0aW9uKGUpe2lmKGUuY3VycmVudENodW5rKXtlLmN1cnJlbnRDaHVuay5vZmZzZXQ9bih0aGlzLEMpLnBvcztmb3IobGV0IHQgb2YgZS5jdXJyZW50Q2h1bmsuc2FtcGxlRGF0YSluKHRoaXMsQykud3JpdGUodCk7ZS5jdXJyZW50Q2h1bmsuc2FtcGxlRGF0YT1udWxsLChlLmNvbXBhY3RseUNvZGVkQ2h1bmtUYWJsZS5sZW5ndGg9PT0wfHx4KGUuY29tcGFjdGx5Q29kZWRDaHVua1RhYmxlKS5zYW1wbGVzUGVyQ2h1bmshPT1lLmN1cnJlbnRDaHVuay5zYW1wbGVDb3VudCkmJmUuY29tcGFjdGx5Q29kZWRDaHVua1RhYmxlLnB1c2goe2ZpcnN0Q2h1bms6ZS53cml0dGVuQ2h1bmtzLmxlbmd0aCsxLHNhbXBsZXNQZXJDaHVuazplLmN1cnJlbnRDaHVuay5zYW1wbGVDb3VudH0pLGUud3JpdHRlbkNodW5rcy5wdXNoKGUuY3VycmVudENodW5rKSxwKHRoaXMsaWUsZGUpLmNhbGwodGhpcyl9fSxpZT1uZXcgV2Vha1NldCxkZT1mdW5jdGlvbigpe24odGhpcyxDKWluc3RhbmNlb2YgeGUmJm4odGhpcyxDKS5mbHVzaCgpfSxmZT1uZXcgV2Vha1NldCxEZT1mdW5jdGlvbigpe2lmKG4odGhpcyxsZSkpdGhyb3cgbmV3IEVycm9yKCJDYW5ub3QgYWRkIG5ldyB2aWRlbyBvciBhdWRpbyBjaHVua3MgYWZ0ZXIgdGhlIGZpbGUgaGFzIGJlZW4gZmluYWxpemVkLiIpfTt2YXIgSnQ9dHlwZW9mIGdsb2JhbFRoaXM8InUiP2dsb2JhbFRoaXM6dHlwZW9mIHdpbmRvdzwidSI/d2luZG93OnR5cGVvZiBnbG9iYWw8InUiP2dsb2JhbDp0eXBlb2Ygc2VsZjwidSI/c2VsZjp7fTtmdW5jdGlvbiBadChlKXtyZXR1cm4gZSYmZS5fX2VzTW9kdWxlJiZPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwiZGVmYXVsdCIpP2UuZGVmYXVsdDplfXZhciBZZT17ZXhwb3J0czp7fX07KGZ1bmN0aW9uKGUpeyhmdW5jdGlvbih0LGkpe2UuZXhwb3J0cz9lLmV4cG9ydHM9aSgpOnQubG9nPWkoKX0pKEp0LGZ1bmN0aW9uKCl7dmFyIHQ9ZnVuY3Rpb24oKXt9LGk9InVuZGVmaW5lZCIscz10eXBlb2Ygd2luZG93IT09aSYmdHlwZW9mIHdpbmRvdy5uYXZpZ2F0b3IhPT1pJiYvVHJpZGVudFwvfE1TSUUgLy50ZXN0KHdpbmRvdy5uYXZpZ2F0b3IudXNlckFnZW50KSxyPVsidHJhY2UiLCJkZWJ1ZyIsImluZm8iLCJ3YXJuIiwiZXJyb3IiXSxkPXt9LG89bnVsbDtmdW5jdGlvbiBjKHYsVCl7dmFyIGw9dltUXTtpZih0eXBlb2YgbC5iaW5kPT0iZnVuY3Rpb24iKXJldHVybiBsLmJpbmQodik7dHJ5e3JldHVybiBGdW5jdGlvbi5wcm90b3R5cGUuYmluZC5jYWxsKGwsdil9Y2F0Y2godmUpe3JldHVybiBmdW5jdGlvbigpe3JldHVybiBGdW5jdGlvbi5wcm90b3R5cGUuYXBwbHkuYXBwbHkobCxbdixhcmd1bWVudHNdKX19fWZ1bmN0aW9uIEEoKXtjb25zb2xlLmxvZyYmKGNvbnNvbGUubG9nLmFwcGx5P2NvbnNvbGUubG9nLmFwcGx5KGNvbnNvbGUsYXJndW1lbnRzKTpGdW5jdGlvbi5wcm90b3R5cGUuYXBwbHkuYXBwbHkoY29uc29sZS5sb2csW2NvbnNvbGUsYXJndW1lbnRzXSkpLGNvbnNvbGUudHJhY2UmJmNvbnNvbGUudHJhY2UoKX1mdW5jdGlvbiBFKHYpe3JldHVybiB2PT09ImRlYnVnIiYmKHY9ImxvZyIpLHR5cGVvZiBjb25zb2xlPT09aT8hMTp2PT09InRyYWNlIiYmcz9BOmNvbnNvbGVbdl0hPT12b2lkIDA/Yyhjb25zb2xlLHYpOmNvbnNvbGUubG9nIT09dm9pZCAwP2MoY29uc29sZSwibG9nIik6dH1mdW5jdGlvbiBfKCl7Zm9yKHZhciB2PXRoaXMuZ2V0TGV2ZWwoKSxUPTA7VDxyLmxlbmd0aDtUKyspe3ZhciBsPXJbVF07dGhpc1tsXT1UPHY/dDp0aGlzLm1ldGhvZEZhY3RvcnkobCx2LHRoaXMubmFtZSl9aWYodGhpcy5sb2c9dGhpcy5kZWJ1Zyx0eXBlb2YgY29uc29sZT09PWkmJnY8dGhpcy5sZXZlbHMuU0lMRU5UKXJldHVybiJObyBjb25zb2xlIGF2YWlsYWJsZSBmb3IgbG9nZ2luZyJ9ZnVuY3Rpb24gTyh2KXtyZXR1cm4gZnVuY3Rpb24oKXt0eXBlb2YgY29uc29sZSE9PWkmJihfLmNhbGwodGhpcyksdGhpc1t2XS5hcHBseSh0aGlzLGFyZ3VtZW50cykpfX1mdW5jdGlvbiBvaSh2LFQsbCl7cmV0dXJuIEUodil8fE8uYXBwbHkodGhpcyxhcmd1bWVudHMpfWZ1bmN0aW9uIEplKHYsVCl7dmFyIGw9dGhpcyx2ZSxXZSxRLFU9ImxvZ2xldmVsIjt0eXBlb2Ygdj09InN0cmluZyI/VSs9IjoiK3Y6dHlwZW9mIHY9PSJzeW1ib2wiJiYoVT12b2lkIDApO2Z1bmN0aW9uIGhpKHcpe3ZhciBTPShyW3ddfHwic2lsZW50IikudG9VcHBlckNhc2UoKTtpZighKHR5cGVvZiB3aW5kb3c9PT1pfHwhVSkpe3RyeXt3aW5kb3cubG9jYWxTdG9yYWdlW1VdPVM7cmV0dXJufWNhdGNoKHBlKXt9dHJ5e3dpbmRvdy5kb2N1bWVudC5jb29raWU9ZW5jb2RlVVJJQ29tcG9uZW50KFUpKyI9IitTKyI7In1jYXRjaChwZSl7fX19ZnVuY3Rpb24gWmUoKXt2YXIgdztpZighKHR5cGVvZiB3aW5kb3c9PT1pfHwhVSkpe3RyeXt3PXdpbmRvdy5sb2NhbFN0b3JhZ2VbVV19Y2F0Y2goZGkpe31pZih0eXBlb2Ygdz09PWkpdHJ5e3ZhciBTPXdpbmRvdy5kb2N1bWVudC5jb29raWUscGU9ZW5jb2RlVVJJQ29tcG9uZW50KFUpLGV0PVMuaW5kZXhPZihwZSsiPSIpO2V0IT09LTEmJih3PS9eKFteO10rKS8uZXhlYyhTLnNsaWNlKGV0K3BlLmxlbmd0aCsxKSlbMV0pfWNhdGNoKGRpKXt9cmV0dXJuIGwubGV2ZWxzW3ddPT09dm9pZCAwJiYodz12b2lkIDApLHd9fWZ1bmN0aW9uIHVpKCl7aWYoISh0eXBlb2Ygd2luZG93PT09aXx8IVUpKXt0cnl7d2luZG93LmxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKFUpfWNhdGNoKHcpe310cnl7d2luZG93LmRvY3VtZW50LmNvb2tpZT1lbmNvZGVVUklDb21wb25lbnQoVSkrIj07IGV4cGlyZXM9VGh1LCAwMSBKYW4gMTk3MCAwMDowMDowMCBVVEMifWNhdGNoKHcpe319fWZ1bmN0aW9uIG5lKHcpe3ZhciBTPXc7aWYodHlwZW9mIFM9PSJzdHJpbmciJiZsLmxldmVsc1tTLnRvVXBwZXJDYXNlKCldIT09dm9pZCAwJiYoUz1sLmxldmVsc1tTLnRvVXBwZXJDYXNlKCldKSx0eXBlb2YgUz09Im51bWJlciImJlM+PTAmJlM8PWwubGV2ZWxzLlNJTEVOVClyZXR1cm4gUzt0aHJvdyBuZXcgVHlwZUVycm9yKCJsb2cuc2V0TGV2ZWwoKSBjYWxsZWQgd2l0aCBpbnZhbGlkIGxldmVsOiAiK3cpfWwubmFtZT12LGwubGV2ZWxzPXtUUkFDRTowLERFQlVHOjEsSU5GTzoyLFdBUk46MyxFUlJPUjo0LFNJTEVOVDo1fSxsLm1ldGhvZEZhY3Rvcnk9VHx8b2ksbC5nZXRMZXZlbD1mdW5jdGlvbigpe3JldHVybiBRIT1udWxsP1E6V2UhPW51bGw/V2U6dmV9LGwuc2V0TGV2ZWw9ZnVuY3Rpb24odyxTKXtyZXR1cm4gUT1uZSh3KSxTIT09ITEmJmhpKFEpLF8uY2FsbChsKX0sbC5zZXREZWZhdWx0TGV2ZWw9ZnVuY3Rpb24odyl7V2U9bmUodyksWmUoKXx8bC5zZXRMZXZlbCh3LCExKX0sbC5yZXNldExldmVsPWZ1bmN0aW9uKCl7UT1udWxsLHVpKCksXy5jYWxsKGwpfSxsLmVuYWJsZUFsbD1mdW5jdGlvbih3KXtsLnNldExldmVsKGwubGV2ZWxzLlRSQUNFLHcpfSxsLmRpc2FibGVBbGw9ZnVuY3Rpb24odyl7bC5zZXRMZXZlbChsLmxldmVscy5TSUxFTlQsdyl9LGwucmVidWlsZD1mdW5jdGlvbigpe2lmKG8hPT1sJiYodmU9bmUoby5nZXRMZXZlbCgpKSksXy5jYWxsKGwpLG89PT1sKWZvcih2YXIgdyBpbiBkKWRbd10ucmVidWlsZCgpfSx2ZT1uZShvP28uZ2V0TGV2ZWwoKToiV0FSTiIpO3ZhciBqZT1aZSgpO2plIT1udWxsJiYoUT1uZShqZSkpLF8uY2FsbChsKX1vPW5ldyBKZSxvLmdldExvZ2dlcj1mdW5jdGlvbihUKXtpZih0eXBlb2YgVCE9InN5bWJvbCImJnR5cGVvZiBUIT0ic3RyaW5nInx8VD09PSIiKXRocm93IG5ldyBUeXBlRXJyb3IoIllvdSBtdXN0IHN1cHBseSBhIG5hbWUgd2hlbiBjcmVhdGluZyBhIGxvZ2dlci4iKTt2YXIgbD1kW1RdO3JldHVybiBsfHwobD1kW1RdPW5ldyBKZShULG8ubWV0aG9kRmFjdG9yeSkpLGx9O3ZhciBsaT10eXBlb2Ygd2luZG93IT09aT93aW5kb3cubG9nOnZvaWQgMDtyZXR1cm4gby5ub0NvbmZsaWN0PWZ1bmN0aW9uKCl7cmV0dXJuIHR5cGVvZiB3aW5kb3chPT1pJiZ3aW5kb3cubG9nPT09byYmKHdpbmRvdy5sb2c9bGkpLG99LG8uZ2V0TG9nZ2Vycz1mdW5jdGlvbigpe3JldHVybiBkfSxvLmRlZmF1bHQ9byxvfSl9KShZZSk7dmFyIGp0PVllLmV4cG9ydHMsY2U9WnQoanQpO2NlLnNldExldmVsKCJFUlJPUiIpO2Z1bmN0aW9uIGVpKGUpe3JldHVybiBuZXcgUHJvbWlzZSh0PT57Y29uc3QgaT0oKT0+e2UoKT90KCk6cmVxdWVzdEFuaW1hdGlvbkZyYW1lKGkpfTtpKCl9KX1jbGFzcyB0aXtjb25zdHJ1Y3Rvcih0KXtrKHRoaXMsImNvbm5lY3Rpb24iKTtrKHRoaXMsIm9wdGlvbnMiKTt0aGlzLmNvbm5lY3Rpb249ITEsdGhpcy5vcHRpb25zPXR9Y29ubmVjdCgpe3RoaXMuY29ubmVjdGlvbj0hMH1kaXNjb25uZWN0KCl7dGhpcy5jb25uZWN0aW9uPSExfX12YXIgRj0oZT0+KGUuTE9BREVEPSJsb2FkZWQiLGUuSU5JVD0iaW5pdCIsZS5TRU5EPSJzZW5kIixlLkZJTklTSD0iZmluaXNoIixlKSkoRnx8e30pO2Z1bmN0aW9uIGlpKGUpe2NlLmVycm9yKCJub29wIGVycm9yIixlKX1jbGFzcyBuaSBleHRlbmRzIHRpe2NvbnN0cnVjdG9yKGkpe3N1cGVyKGkpO2sodGhpcywidmlkZW9Db25maWciKTtrKHRoaXMsImF1ZGlvQ29uZmlnIik7ayh0aGlzLCJtdXhlciIpO2sodGhpcywidmlkZW9FbmNvZGVyIik7ayh0aGlzLCJhdWRpb0VuY29kZXIiKTtrKHRoaXMsImVycm9yUmVqZWN0IixpaSk7dGhpcy52aWRlb0NvbmZpZz1pLnZpZGVvQ29uZmlnLHRoaXMuYXVkaW9Db25maWc9aS5hdWRpb0NvbmZpZyx0aGlzLmNyZWF0ZU11eGVyQW5kRW5jb2RlcigpfWFzeW5jIGhhbmRsZShpKXt2YXIgbyxjLEEsRTtjb25zdHt2aWRlb0ZyYW1lOnMsYXVkaW9JbmZvOnIsdGltZXN0YW1wOmR9PWk7aWYocyYmKChvPXRoaXMudmlkZW9FbmNvZGVyKSE9bnVsbCYmby5lbmNvZGVRdWV1ZVNpemUmJigoYz10aGlzLnZpZGVvRW5jb2Rlcik9PW51bGw/dm9pZCAwOmMuZW5jb2RlUXVldWVTaXplKT4yMCYmYXdhaXQgZWkoKCk9Pnt2YXIgXyxPO3JldHVybihfPXRoaXMudmlkZW9FbmNvZGVyKSE9bnVsbCYmXy5lbmNvZGVRdWV1ZVNpemU/KChPPXRoaXMudmlkZW9FbmNvZGVyKT09bnVsbD92b2lkIDA6Ty5lbmNvZGVRdWV1ZVNpemUpPDEwOiEwfSksKEE9dGhpcy52aWRlb0VuY29kZXIpPT1udWxsfHxBLmVuY29kZShzLHtrZXlGcmFtZTpkLygxZTMvdGhpcy5vcHRpb25zLmZwcyklMTUwPT09MH0pLHMuY2xvc2UoKSkscil7Y29uc3QgXz1uZXcgQXVkaW9EYXRhKHsuLi5yfSk7KEU9dGhpcy5hdWRpb0VuY29kZXIpPT1udWxsfHxFLmVuY29kZShfKSxfLmNsb3NlKCl9fWNyZWF0ZU11eGVyQW5kRW5jb2Rlcigpe3RoaXMubXV4ZXI9bmV3IFl0KHt0YXJnZXQ6bmV3IFJlLHZpZGVvOntjb2RlYzoiYXZjIix3aWR0aDp0aGlzLnZpZGVvQ29uZmlnLndpZHRoLGhlaWdodDp0aGlzLnZpZGVvQ29uZmlnLmhlaWdodH0sYXVkaW86e2NvZGVjOiJhYWMiLG51bWJlck9mQ2hhbm5lbHM6dGhpcy5hdWRpb0NvbmZpZy5udW1iZXJPZkNoYW5uZWxzLHNhbXBsZVJhdGU6dGhpcy5hdWRpb0NvbmZpZy5zYW1wbGVSYXRlfX0pLHRoaXMudmlkZW9FbmNvZGVyPW5ldyBWaWRlb0VuY29kZXIoe291dHB1dDooaSxzKT0+e3ZhciByO3JldHVybihyPXRoaXMubXV4ZXIpPT1udWxsP3ZvaWQgMDpyLmFkZFZpZGVvQ2h1bmsoaSxzKX0sZXJyb3I6aT0+e2NlLmVycm9yKCJ2aWRlbyBlbmNvZGVyIGVycm9yIixpKSx0aGlzLmVycm9yUmVqZWN0KGkpfX0pLHRoaXMudmlkZW9FbmNvZGVyLmNvbmZpZ3VyZSh0aGlzLnZpZGVvQ29uZmlnKSx0aGlzLm9wdGlvbnMuZGlzYWJsZUF1ZGlvfHwodGhpcy5hdWRpb0VuY29kZXI9bmV3IEF1ZGlvRW5jb2Rlcih7b3V0cHV0OihpLHMpPT57dmFyIHI7cmV0dXJuKHI9dGhpcy5tdXhlcik9PW51bGw/dm9pZCAwOnIuYWRkQXVkaW9DaHVuayhpLHMpfSxlcnJvcjppPT57Y2UuZXJyb3IoImF1ZGlvIGVuY29kZXIgZXJyb3IiLGkpLHRoaXMuZXJyb3JSZWplY3QoaSl9fSksdGhpcy5hdWRpb0VuY29kZXIuY29uZmlndXJlKHRoaXMuYXVkaW9Db25maWcpKX1hc3luYyBlbmRFbmNvZGluZygpe3ZhciBzLHIsZCxvLGMsQSxFO3JldHVybiBhd2FpdCgocz10aGlzLnZpZGVvRW5jb2Rlcik9PW51bGw/dm9pZCAwOnMuZmx1c2goKSksKHI9dGhpcy52aWRlb0VuY29kZXIpPT1udWxsfHxyLmNsb3NlKCksYXdhaXQoKGQ9dGhpcy5hdWRpb0VuY29kZXIpPT1udWxsP3ZvaWQgMDpkLmZsdXNoKCkpLChvPXRoaXMuYXVkaW9FbmNvZGVyKT09bnVsbHx8by5jbG9zZSgpLChjPXRoaXMubXV4ZXIpPT1udWxsfHxjLmZpbmFsaXplKCksKEU9KEE9dGhpcy5tdXhlcik9PW51bGw/dm9pZCAwOkEudGFyZ2V0KT09bnVsbD92b2lkIDA6RS5idWZmZXJ9YXN5bmMgZmluaXNoKCl7cmV0dXJuIGF3YWl0IHRoaXMuZW5kRW5jb2RpbmcoKX19bGV0IFBlO3NlbGYuYWRkRXZlbnRMaXN0ZW5lcigibWVzc2FnZSIsYXN5bmMgZT0+e2NvbnN0e3R5cGU6dCxkYXRhOml9PWUuZGF0YTt0cnl7c3dpdGNoKHQpe2Nhc2UgRi5JTklUOnJldHVybiBzaShpKTtjYXNlIEYuU0VORDpyZXR1cm4gYXdhaXQgcmkoaSk7Y2FzZSBGLkZJTklTSDpyZXR1cm4gYXdhaXQgYWkoKTtkZWZhdWx0OnJldHVybn19Y2F0Y2gocyl7c2VsZi5wb3N0TWVzc2FnZSh7dHlwZTp0LGVyck1zZzpzIGluc3RhbmNlb2YgRXJyb3I/cy5tZXNzYWdlOiJVbmtub3duIEVycm9yIn0pfX0pLHNlbGYucG9zdE1lc3NhZ2Uoe3R5cGU6Ri5MT0FERUR9KTtmdW5jdGlvbiBzaShlKXtQZT1uZXcgbmkoZSksc2VsZi5wb3N0TWVzc2FnZSh7dHlwZTpGLklOSVR9KX1hc3luYyBmdW5jdGlvbiByaShlKXthd2FpdCBQZS5oYW5kbGUoZSksc2VsZi5wb3N0TWVzc2FnZSh7dHlwZTpGLlNFTkR9KX1hc3luYyBmdW5jdGlvbiBhaSgpe2NvbnN0IGU9YXdhaXQgUGUuZmluaXNoKCk7c2VsZi5wb3N0TWVzc2FnZSh7dHlwZTpGLkZJTklTSCxyZXN1bHQ6ZX0sZT9bZV06W10pfX0pKCk7Cg==",wr="undefined"!=typeof window&&window.Blob&&new Blob([atob(br)],{type:"text/javascript;charset=utf-8"});function yr(){let e;try{if(e=wr&&(window.URL||window.webkitURL).createObjectURL(wr),!e)throw"";return new Worker(e)}catch(t){return new Worker("data:application/javascript;base64,"+br)}finally{e&&(window.URL||window.webkitURL).revokeObjectURL(e)}}var jr=(e=>(e.LOADED="loaded",e.INIT="init",e.SEND="send",e.FINISH="finish",e))(jr||{});class kr extends vr{compositorWorker;initialized;videoConfig;audioConfig;constructor(e){super(e),this.videoConfig=e.videoConfig??An,this.audioConfig=e.audioConfig??Qn,this.compositorWorker=new yr,this.initialized=new Promise((t,a)=>{this.compositorWorker.addEventListener("message",s=>{const{type:n}=s.data;n===jr.LOADED&&this.getFromWorker(jr.INIT,{videoConfig:this.videoConfig,audioConfig:this.audioConfig,...e}).then(()=>{t()}).catch(e=>{a(e)})})})}getFromWorker(e,t,a){return new Promise((s,n)=>{const i=({data:t})=>{t.type===e&&(t.errMsg?n(t.errMsg):s(t.result),this.compositorWorker.removeEventListener("message",i))};this.compositorWorker.addEventListener("message",i),this.compositorWorker.postMessage({type:e,data:t},a||[])})}async genAudioInfo(e,t){const a=this.audioConfig.sampleRate,s=this.audioConfig.numberOfChannels,n=this.audioConfig.sampleRate*(1/this.options.fps),i=new OfflineAudioContext(s,n,a).createBuffer(s,n,a);let r;if(t){t.forEach((e,t)=>{for(let a=0;a<s;a++){const s=a<e.numberOfChannels?e.getChannelData(a):e.getChannelData(0),n=i.getChannelData(a);if(0===t)n.set(s);else for(let e=0;e<n.length;e++)n[e]+=s[e]}}),r=new Float32Array(n*s);for(let e=0;e<i.numberOfChannels;e++)r.set(i.getChannelData(e),e*i.length)}else r=new Float32Array(n*s).fill(0);return{timestamp:e,sampleRate:a,numberOfChannels:s,numberOfFrames:n,data:r,format:"f32-planar"}}async handle(e){await this.initialized;const{timestamp:t,imageSource:a,audioBuffers:s}=e,n=new VideoFrame(a,{timestamp:1e3*t}),i=[n];let r;return this.options.disableAudio||(r=await this.genAudioInfo(t,s),i.push(r.data.buffer)),this.getFromWorker(jr.SEND,{timestamp:t,videoFrame:n,audioInfo:r},i)}async finish(){await this.initialized;const e=await this.getFromWorker(jr.FINISH);if(e)return new Blob([e],{type:"video/mp4"})}}class Nr extends vr{context;audioContext;audioPlayTime;currentTime;frameId;frameWaitPromise;frameWaitResolve;constructor(e){super(e),this.options=e,this.audioPlayTime=0;const{canvas:t,width:a,height:s}=this.options;t.width=a,t.height=s,this.context=t.getContext("2d"),this.currentTime=0,this.frameId=0}async handle(e){const{imageSource:t,audioBuffers:a,timestamp:s}=e;var n;this.currentTime=s/1e3,this.options.disableAudio?(this.context&&t&&this.playVideoFrame(t),await(n=1e3/this.options.fps,new Promise(e=>setTimeout(e,n)))):(this.audioContext||(this.audioContext=new AudioContext),this.frameId||(this.frameWaitPromise=new Promise(e=>{this.frameWaitResolve=e}),this.frameId=requestAnimationFrame(()=>this.frameCallback())),this.playAudioBuffers(a),await this.frameWaitPromise,this.context&&t&&this.playVideoFrame(t))}frameCallback(){this.audioContext&&(this.audioContext.currentTime>=this.currentTime&&(this.frameWaitResolve?.(),this.frameWaitPromise=new Promise(e=>{this.frameWaitResolve=e})),this.frameId=requestAnimationFrame(()=>this.frameCallback()))}playVideoFrame(e){const{width:t,height:a}=this.options;this.context.drawImage(e,0,0,t,a)}playAudioBuffers(e){if(0===e.length)return;if(!this.audioContext)return;let t=0;this.audioContext.currentTime>this.audioPlayTime&&(this.audioPlayTime=this.audioContext.currentTime);for(const a of e){const e=this.audioContext.createBufferSource();e.buffer=a,e.connect(this.audioContext.destination),e.onended=()=>{e.disconnect()},e.start(this.audioPlayTime),t=Math.max(t,a.duration)}this.audioPlayTime+=t}async finish(){this.audioContext?.close(),this.frameId&&cancelAnimationFrame(this.frameId),this.frameWaitPromise=void 0,this.frameWaitResolve=void 0}}var Sr=(e=>(e[e.Background=0]="Background",e[e.Character=10]="Character",e[e.Dialog=20]="Dialog",e[e.Text=30]="Text",e))(Sr||{});let Cr=class e{static defaultEditorOptions={width:1920,height:1080,background:0,onChangeActiveChild:()=>{},onChangeActiveScene:()=>{},onChangeScenes:()=>{}};options;app;scenes;activeScene;activeChild;activeTransformer;constructor(t){this.options=Object.assign({},e.defaultEditorOptions,t);const{view:a,width:s,height:n,background:i}=this.options;this.app=new Y({view:a,width:s,height:n,background:i}),this.scenes=[]}addTransformer(){this.activeTransformer=new H({wireframeStyle:{thickness:4,color:41471}}).on("pointertap",()=>{this.activeTransformer&&(this.activeTransformer.__isTapped?(this.activeChild=void 0,this.activeTransformer.group=[],this.options.onChangeActiveChild(void 0),this.activeTransformer.__doubleTapTimer&&clearTimeout(this.activeTransformer.__doubleTapTimer),this.activeTransformer.__isTapped=!1):(this.activeTransformer.__isTapped=!0,this.activeTransformer.__doubleTapTimer=setTimeout(()=>{this.activeTransformer&&(this.activeTransformer.__isTapped=!1)},600)))}),this.activeScene?.addChild(this.activeTransformer)}removeTransformer(){this.activeTransformer&&(this.activeScene?.removeChild(this.activeTransformer),this.activeTransformer.destroy(),this.activeTransformer=void 0)}addChildTransformListener(e){e.interactive=!0,e.on("pointerdown",()=>{this.setActiveChild(e)})}setActiveChild(e){this.activeChild=e,e&&(this.activeTransformer||this.addTransformer(),this.activeTransformer&&(this.activeTransformer.group=[e],this.moveChildToTop(this.activeTransformer))),this.options.onChangeActiveChild(e)}setActiveChildByName(e){const t=this.activeScene;if(t){const a=t.children.find(t=>t.name===e);a&&this.setActiveChild(a)}}updateActiveChild(e){this.activeChild&&(e(this.activeChild),this.options.onChangeActiveChild(this.activeChild))}removeChildTransformListener(e){e.removeAllListeners("pointerdown")}addScene(e,t){void 0===t?this.scenes.push(e):this.scenes.splice(t,0,e);const a=e=>{if(e.children&&e.children.length>0)for(const t of e.children)a(t);else this.addChildTransformListener(e)};for(const s of e.children)a(s);this.options.onChangeScenes(this.scenes)}loadScenes(e){e.forEach(e=>{this.addScene(e)}),this.options.onChangeScenes(this.scenes)}removeScene(e){this.scenes=this.scenes.filter(t=>t!==e),this.activeScene===e&&(this.stageRemoveChild(this.activeScene),this.activeScene.destroy(),this.activeScene=void 0),this.options.onChangeScenes(this.scenes)}removeSceneByIndex(e){this.removeScene(this.scenes[e])}removeSceneByName(e){const t=this.getSceneByName(e);t&&this.removeScene(t)}getSceneByName(e){return this.scenes.find(t=>t.name===e)}cloneScene(e){this.removeTransformer();const t=e??this.activeScene;if(t)return t.clone()}cloneSceneByIndex(e){return this.cloneScene(this.scenes[e])}cloneSceneByName(e){const t=this.getSceneByName(e);if(t)return this.cloneScene(t)}swapScene(e,t){[this.scenes[e],this.scenes[t]]=[this.scenes[t],this.scenes[e]],this.options.onChangeScenes(this.scenes)}setActiveScene(e){this.activeScene&&(this.stageRemoveChild(this.activeScene),this.removeTransformer()),this.activeScene=e,e&&(this.activeScene.load({skipSoundLoading:!0}),this.addTransformer(),this.stageAddChild(e)),this.options.onChangeActiveScene(e)}setActiveSceneByName(e){const t=this.scenes.find(t=>t.name===e);t&&this.setActiveScene(t)}setActiveSceneByIndex(e){this.setActiveScene(this.scenes[e])}getActiveSceneIndex(){return this.activeScene?this.scenes.indexOf(this.activeScene):-1}updateActiveScene(e){this.activeScene&&(e(this.activeScene),this.options.onChangeActiveScene(this.activeScene))}addChild(e){const t=this.activeScene;t&&(this.addChildTransformListener(e),t.addChild(e),this.options.onChangeActiveScene(t))}removeChild(e){const t=this.activeScene;t&&(this.activeChild?.name===e.name&&(this.setActiveChild(void 0),this.removeTransformer()),this.removeChildTransformListener(e),t.removeChild(e),e.destroy(),this.options.onChangeActiveScene(t))}removeChildByName(e){const t=this.activeScene;if(t){const a=t.children.find(t=>t.name===e);a&&this.removeChild(a)}}toggleChildVisibleByName(e){const t=this.activeScene;if(t){const a=t.children.find(t=>t.name===e);a&&(a.visible=!a.visible),this.options.onChangeActiveScene(t)}}toggleChildInteractiveByName(e){const t=this.activeScene;if(t){const a=t.children.find(t=>t.name===e);a&&(a.interactive=!a.interactive),this.options.onChangeActiveScene(t)}}cloneChild(e){const t=e??this.activeChild;if(t)return t.clone()}addSound(e){const t=this.activeScene;t&&(t.addSound(e),this.options.onChangeActiveScene(t))}removeSound(e){const t=this.activeScene;t&&(t.removeSound(e),this.options.onChangeActiveScene(t))}removeSoundByName(e){const t=this.activeScene;if(t){const a=t.sounds.find(t=>t.name===e);a&&this.removeSound(a)}}cloneDialogue(e){return X(e)}cloneDialogueSpeak(e){return X(e)}addDialogue(e,t){const a=this.activeScene;a&&(a.addDialogue(e,t),this.options.onChangeActiveScene(a))}updateDialogue(e,t){const a=this.activeScene;a&&(a.updateDialogue(e,t),this.options.onChangeActiveScene(a))}removeDialogue(e){const t=this.activeScene;t&&(t.removeDialogue(e),this.options.onChangeActiveScene(t))}swapDialogue(e,t){const a=this.activeScene;a&&(a.swapDialogue(e,t),this.options.onChangeActiveScene(a))}swapChildren(e,t){this.activeScene?.swapChildren(e,t)}moveChildTo(e,t){const a=t??this.activeChild;a&&(a.zIndex=e)}moveChildToTop(e){const t=e??this.activeChild;this.activeScene&&t&&(t.zIndex=Sr.Text,this.activeScene.setChildIndex(t,this.activeScene.children.length-1))}moveChildToBottom(e){const t=e??this.activeChild;this.activeScene&&t&&(t.zIndex=Sr.Background,this.activeScene?.setChildIndex(t,0))}moveUpChild(e){const t=e??this.activeChild;if(this.activeScene&&t){const e=this.activeScene.children.indexOf(t);if(e<this.activeScene.children.length-1){const a=this.activeScene.children[e+1];a.zIndex>t.zIndex&&(t.zIndex=a.zIndex),this.swapChildren(t,a)}}}moveDownChild(e){const t=e??this.activeChild;if(this.activeScene&&t){const e=this.activeScene.children.indexOf(t);if(e>0){const a=this.activeScene.children[e-1];a.zIndex<t.zIndex&&(t.zIndex=a.zIndex),this.swapChildren(t,a)}}}stageAddChild(e){this.app.stage.addChild(e)}stageRemoveChild(e){const t=this.app.stage.children.find(t=>t.name===e.name);t&&this.app.stage.removeChild(t)}setChildPosition(e,t){const a=t??this.activeChild,{width:s,height:n}=this.options;if(a)switch(e){case"top":a.y=0;break;case"middle":a.y=n/2-a.height/2;break;case"bottom":a.y=n-a.height;break;case"left":a.x=0;break;case"near-left":a.x=s/3-a.width/2;break;case"center":a.x=s/2-a.width/2;break;case"near-right":a.x=s/3*2-a.width/2;break;case"right":a.x=s-a.width}}genSceneScript(e){const{dialogues:t,config:a}=e,s=a.speak,n=[],i=e.children.find(e=>"Background"===e.assetType);i&&a.autoShowBackground&&n.push({directive:fr.Show,params:{targetName:i.name}});for(const r of t){const{speak:e,lines:t}=r;s?.dialogTargetName&&n.push({directive:fr.Show,params:{targetName:s.dialogTargetName}}),n.push({directive:fr.Speak,params:{lines:t,targetName:s.targetName,wordsPerMin:e.wordsPerMin,interval:e.interval,effect:e.effect,effectDuration:e.effectDuration,speaker:s.speaker.targetName?{targetName:s.speaker.targetName,name:e.speaker?.name||"",speakerTargetName:e.speaker?.speakerTargetName,autoShowSpeaker:e.speaker?.autoShowSpeaker,autoMaskOtherSpeakers:e.speaker?.autoMaskOtherSpeakers}:void 0,voice:e.voice?.targetName?e.voice:void 0}})}return{scene:e,config:a,directives:n}}async exportScreenplay(e=0,t){return{config:{},scenes:this.exportScenes(e,t).map(this.genSceneScript)}}exportScenes(e=0,t){this.removeTransformer();const a=performance.now(),s=this.scenes.slice(e,t).map(e=>e.clone());return o.info("editor export cost:",performance.now()-a),s}saveAsJSON(){return this.removeTransformer(),JSON.stringify({version:"2.0",config:{},scenes:this.scenes})}async loadFromJSON(e){const t=JSON.parse(e),a=[];for(const s of t.scenes){const e=await Ti.fromJSON(s);a.push(e)}this.loadScenes(a)}clear(){this.scenes.forEach(e=>{this.removeScene(e)}),this.setActiveScene(void 0),this.setActiveChild(void 0),this.removeTransformer()}};function Zr(){const e=new Ti,t=new fi;t.alpha=.7,t.beginFill(0),t.drawRect(0,0,1920,400),t.endFill(),t.x=0,t.y=680,t.zIndex=Sr.Dialog,t.label="",t.fillColor="#000000";const a=new xi("",{fill:16777215,fontSize:44,fontWeight:"bold",leading:15});a.x=160,a.y=700,a.zIndex=Sr.Text,a.label="",a.disableTextEdit=!0;const s=new xi("",{fill:16777215,wordWrap:!0,breakWords:!0,wordWrapWidth:1600,fontSize:38,leading:15});return s.x=160,s.y=770,s.zIndex=Sr.Text,s.label="",s.disableTextEdit=!0,e.addChild(t),e.addChild(a),e.addChild(s),e.config.speak.targetName=s.name,e.config.speak.dialogTargetName=t.name,e.config.speak.speaker.targetName=a.name,e.config.speak.speaker.name=a.text,e}function Gr(){const e=new Ti,t=new fi;t.alpha=.7,t.beginFill(0),t.drawRect(0,0,1920,1080),t.endFill(),t.x=0,t.y=0,t.zIndex=Sr.Dialog,t.label="";const a=new xi("",{fill:16777215,breakWords:!0,wordWrap:!0,wordWrapWidth:1600,fontSize:45,leading:15});return a.x=160,a.y=160,a.zIndex=Sr.Text,a.label="",a.disableTextEdit=!0,e.addChild(t),e.addChild(a),e.config.speak.targetName=a.name,e.config.speak.dialogTargetName=t.name,e}function Vr(){const e=new Ti,t=new xi("",{fill:16777215,breakWords:!0,fontSize:100,fontWeight:"bold"});t.x=960-t.width/2,t.y=340,t.zIndex=Sr.Text,t.label="";const a=new xi("",{fill:16777215,breakWords:!0,fontSize:60});return a.x=960-a.width/2,a.y=500,a.zIndex=Sr.Text,a.label="",e.addChild(t),e.addChild(a),e.dialogues=[{speak:{wordsPerMin:500,interval:.2,effect:"typewriter",speaker:{targetName:"",name:"",autoShowSpeaker:{inEffect:"Show"},autoMaskOtherSpeakers:{alpha:.5},speakerTargetName:"Narrator"}},lines:[{children:[{text:""},{children:[{text:""}],type:"directive",value:{directive:"FadeIn",params:{targetName:t.name},label:":"}},{text:""},{children:[{text:""}],type:"directive",value:{directive:"FadeIn",params:{targetName:a.name},label:":"}},{text:""},{children:[{text:""}],type:"directive",value:{directive:"Wait",params:{duration:3},label:":3"}},{text:""}],type:"p"}]}],e}const Wr=M()(B(e=>{let t;return{project:null,editor:null,activeChild:null,activeScene:null,scenes:[],setProject(t){e(e=>{e.project={id:t.id,name:t.name}})},initEditor(a){t=new Cr({view:a,onChangeActiveChild(t){e(e=>{if(!t)return void(e.activeChild=null);let a={...t,width:t.width,height:t.height,x:t.x,y:t.y};if("Text"===t.type){const e=t;a={...a,text:e.text,style:e.style&&{...e.style,fontFamily:e.style.fontFamily,fontWeight:e.style.fontWeight,fontStyle:e.style.fontStyle,fontSize:e.style.fontSize,fill:e.style.fill}}}e.activeChild=a})},onChangeActiveScene(t){e(e=>{e.activeScene=t?{...t}:null})},onChangeScenes(t){e(e=>{e.scenes=[...t]})}}),e(e=>{e.editor=t})}}})),Tr=M()(B(e=>({isOpen:!1,type:null,disableSelect:!1,confirm:null,cancel:null,setConfirm(t){e(e=>{e.confirm=t})},setCancel(t){e(e=>{e.cancel=t})},setOpen(t){e(e=>{e.isOpen=t})},setType(t){e(e=>{e.type=t})},setDisableSelect(t){e(e=>{e.disableSelect=t})}}))),Xr=M()(B(e=>({isOpen:!1,loadingText:"",setOpen(t){e(e=>{e.isOpen=t})},setLoadingText(t){e(e=>{e.loadingText=t})}}))),Rr=n.forwardRef(({className:e,...t},a)=>i.jsx("div",{ref:a,className:zn("rounded-xl border bg-card text-card-foreground shadow",e),...t}));Rr.displayName="Card",n.forwardRef(({className:e,...t},a)=>i.jsx("div",{ref:a,className:zn("flex flex-col space-y-1.5 p-6",e),...t})).displayName="CardHeader",n.forwardRef(({className:e,...t},a)=>i.jsx("h3",{ref:a,className:zn("font-semibold leading-none tracking-tight",e),...t})).displayName="CardTitle",n.forwardRef(({className:e,...t},a)=>i.jsx("p",{ref:a,className:zn("text-sm text-muted-foreground",e),...t})).displayName="CardDescription";const Lr=n.forwardRef(({className:e,...t},a)=>i.jsx("div",{ref:a,className:zn("p-6 pt-0",e),...t}));Lr.displayName="CardContent";const Ir=n.forwardRef(({className:e,...t},a)=>i.jsx("div",{ref:a,className:zn("flex items-center p-6 pt-0",e),...t}));Ir.displayName="CardFooter";const zr=n.forwardRef(({className:e,children:t,...a},s)=>{const r=n.useRef(null);return n.useImperativeHandle(s,()=>({scrollToBottom:()=>{r.current&&r.current.scrollTo({top:r.current.scrollHeight,behavior:"smooth"})}})),i.jsxs(D,{className:zn("relative overflow-hidden",e),...a,children:[i.jsx(U,{ref:r,className:"h-full w-full rounded-[inherit]",children:t}),i.jsx(Kr,{}),i.jsx(E,{})]})});zr.displayName=D.displayName;const Kr=n.forwardRef(({className:e,orientation:t="vertical",...a},s)=>i.jsx(J,{ref:s,orientation:t,className:zn("flex touch-none select-none transition-colors","vertical"===t&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===t&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",e),...a,children:i.jsx(P,{className:"relative flex-1 rounded-full bg-border"})}));Kr.displayName=J.displayName;const Fr={add:O,alignCenter:A,alignJustify:Q,alignLeft:_,alignRight:$,arrowDown:q,bg:ee,blockquote:te,bold:ae,borderAll:e=>i.jsx("svg",{viewBox:"0 0 24 24",height:"48",width:"48",focusable:"false",role:"img",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...e,children:i.jsx("path",{d:"M3 6a3 3 0 0 1 3-3h12a3 3 0 0 1 3 3v12a3 3 0 0 1-3 3H6a3 3 0 0 1-3-3V6zm10 13h5a1 1 0 0 0 1-1v-5h-6v6zm-2-6H5v5a1 1 0 0 0 1 1h5v-6zm2-2h6V6a1 1 0 0 0-1-1h-5v6zm-2-6H6a1 1 0 0 0-1 1v5h6V5z"})}),borderBottom:e=>i.jsx("svg",{viewBox:"0 0 24 24",height:"48",width:"48",focusable:"false",role:"img",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...e,children:i.jsx("path",{d:"M13 5a1 1 0 1 0 0-2h-2a1 1 0 1 0 0 2h2zm-8 6a1 1 0 1 0-2 0v2a1 1 0 1 0 2 0v-2zm-2 7a1 1 0 1 1 2 0 1 1 0 0 0 1 1h12a1 1 0 0 0 1-1 1 1 0 1 1 2 0 3 3 0 0 1-3 3H6a3 3 0 0 1-3-3zm17-8a1 1 0 0 0-1 1v2a1 1 0 1 0 2 0v-2a1 1 0 0 0-1-1zM7 4a1 1 0 0 0-1-1 3 3 0 0 0-3 3 1 1 0 0 0 2 0 1 1 0 0 1 1-1 1 1 0 0 0 1-1zm11-1a1 1 0 1 0 0 2 1 1 0 0 1 1 1 1 1 0 1 0 2 0 3 3 0 0 0-3-3z"})}),borderLeft:e=>i.jsx("svg",{viewBox:"0 0 24 24",height:"48",width:"48",focusable:"false",role:"img",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...e,children:i.jsx("path",{d:"M6 21a1 1 0 1 0 0-2 1 1 0 0 1-1-1V6a1 1 0 0 1 1-1 1 1 0 0 0 0-2 3 3 0 0 0-3 3v12a3 3 0 0 0 3 3zm7-16a1 1 0 1 0 0-2h-2a1 1 0 1 0 0 2h2zm6 6a1 1 0 1 1 2 0v2a1 1 0 1 1-2 0v-2zm-5 9a1 1 0 0 1-1 1h-2a1 1 0 1 1 0-2h2a1 1 0 0 1 1 1zm4-17a1 1 0 1 0 0 2 1 1 0 0 1 1 1 1 1 0 1 0 2 0 3 3 0 0 0-3-3zm-1 17a1 1 0 0 0 1 1 3 3 0 0 0 3-3 1 1 0 1 0-2 0 1 1 0 0 1-1 1 1 1 0 0 0-1 1z"})}),borderNone:e=>i.jsx("svg",{viewBox:"0 0 24 24",height:"48",width:"48",focusable:"false",role:"img",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...e,children:i.jsx("path",{d:"M14 4a1 1 0 0 1-1 1h-2a1 1 0 1 1 0-2h2a1 1 0 0 1 1 1zm-9 7a1 1 0 1 0-2 0v2a1 1 0 1 0 2 0v-2zm14 0a1 1 0 1 1 2 0v2a1 1 0 1 1-2 0v-2zm-6 10a1 1 0 1 0 0-2h-2a1 1 0 1 0 0 2h2zM7 4a1 1 0 0 0-1-1 3 3 0 0 0-3 3 1 1 0 0 0 2 0 1 1 0 0 1 1-1 1 1 0 0 0 1-1zm11-1a1 1 0 1 0 0 2 1 1 0 0 1 1 1 1 1 0 1 0 2 0 3 3 0 0 0-3-3zM7 20a1 1 0 0 1-1 1 3 3 0 0 1-3-3 1 1 0 1 1 2 0 1 1 0 0 0 1 1 1 1 0 0 1 1 1zm11 1a1 1 0 1 1 0-2 1 1 0 0 0 1-1 1 1 0 1 1 2 0 3 3 0 0 1-3 3z"})}),borderRight:e=>i.jsx("svg",{viewBox:"0 0 24 24",height:"48",width:"48",focusable:"false",role:"img",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...e,children:i.jsx("path",{d:"M13 5a1 1 0 1 0 0-2h-2a1 1 0 1 0 0 2h2zm-8 6a1 1 0 1 0-2 0v2a1 1 0 1 0 2 0v-2zm9 9a1 1 0 0 1-1 1h-2a1 1 0 1 1 0-2h2a1 1 0 0 1 1 1zM6 3a1 1 0 0 1 0 2 1 1 0 0 0-1 1 1 1 0 0 1-2 0 3 3 0 0 1 3-3zm1 17a1 1 0 0 1-1 1 3 3 0 0 1-3-3 1 1 0 1 1 2 0 1 1 0 0 0 1 1 1 1 0 0 1 1 1zm11 1a1 1 0 1 1 0-2 1 1 0 0 0 1-1V6a1 1 0 0 0-1-1 1 1 0 1 1 0-2 3 3 0 0 1 3 3v12a3 3 0 0 1-3 3z"})}),borderTop:e=>i.jsx("svg",{viewBox:"0 0 24 24",height:"48",width:"48",focusable:"false",role:"img",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...e,children:i.jsx("path",{d:"M3 6a1 1 0 0 0 2 0 1 1 0 0 1 1-1h12a1 1 0 0 1 1 1 1 1 0 1 0 2 0 3 3 0 0 0-3-3H6a3 3 0 0 0-3 3zm2 5a1 1 0 1 0-2 0v2a1 1 0 1 0 2 0v-2zm14 0a1 1 0 1 1 2 0v2a1 1 0 1 1-2 0v-2zm-5 9a1 1 0 0 1-1 1h-2a1 1 0 1 1 0-2h2a1 1 0 0 1 1 1zm-8 1a1 1 0 1 0 0-2 1 1 0 0 1-1-1 1 1 0 1 0-2 0 3 3 0 0 0 3 3zm11-1a1 1 0 0 0 1 1 3 3 0 0 0 3-3 1 1 0 1 0-2 0 1 1 0 0 1-1 1 1 1 0 0 0-1 1z"})}),check:se,chevronRight:ne,fileText:ie,chevronsUpDown:re,clear:oe,close:oe,code:le,codeblock:ce,color:de,column:he,combine:me,ungroup:ue,comment:pe,commentAdd:xe,delete:fe,dragHandle:ge,editing:ve,emoji:be,externalLink:we,h1:ye,h2:je,h3:ke,h4:Ne,h5:Se,h6:Ce,image:Ze,indent:Ge,italic:Ve,kbd:We,lineHeight:Te,link:Xe,minus:Re,more:Le,ol:Ie,outdent:ze,paragraph:Ke,refresh:Fe,row:Ye,search:He,settings:Me,strikethrough:Be,subscript:De,superscript:Ue,table:Ee,text:Je,trash:Pe,trash2:fe,ul:Oe,underline:Ae,unlink:Qe,viewing:_e,viewingOff:$e,lock:qe,lockOpen:et,type:tt,fontSize:at,bookOpenText:st,copy:nt,moveUp:it,moveDown:rt,squarePlus:ot,folder:lt,bookmark:ct,mic:dt,download:ht,edit:mt,library:ut,scene:pt,images:xt,preview:ft,tip:gt,wandSparkles:vt,sparkles:bt,flip:wt,gitHub:e=>i.jsx("svg",{viewBox:"0 0 438.549 438.549",...e,children:i.jsx("path",{fill:"currentColor",d:"M409.132 114.573c-19.608-33.596-46.205-60.194-79.798-79.8-33.598-19.607-70.277-29.408-110.063-29.408-39.781 0-76.472 9.804-110.063 29.408-33.596 19.605-60.192 46.204-79.8 79.8C9.803 148.168 0 184.854 0 224.63c0 47.78 13.94 90.745 41.827 128.906 27.884 38.164 63.906 64.572 108.063 79.227 5.14.954 8.945.283 11.419-1.996 2.475-2.282 3.711-5.14 3.711-8.562 0-.571-.049-5.708-.144-15.417a2549.81 2549.81 0 01-.144-25.406l-6.567 1.136c-4.187.767-9.469 1.092-15.846 1-6.374-.089-12.991-.757-19.842-1.999-6.854-1.231-13.229-4.086-19.13-8.559-5.898-4.473-10.085-10.328-12.56-17.556l-2.855-6.57c-1.903-4.374-4.899-9.233-8.992-14.559-4.093-5.331-8.232-8.945-12.419-10.848l-1.999-1.431c-1.332-.951-2.568-2.098-3.711-3.429-1.142-1.331-1.997-2.663-2.568-3.997-.572-1.335-.098-2.43 1.427-3.289 1.525-.859 4.281-1.276 8.28-1.276l5.708.853c3.807.763 8.516 3.042 14.133 6.851 5.614 3.806 10.229 8.754 13.846 14.842 4.38 7.806 9.657 13.754 15.846 17.847 6.184 4.093 12.419 6.136 18.699 6.136 6.28 0 11.704-.476 16.274-1.423 4.565-.952 8.848-2.383 12.847-4.285 1.713-12.758 6.377-22.559 13.988-29.41-10.848-1.14-20.601-2.857-29.264-5.14-8.658-2.286-17.605-5.996-26.835-11.14-9.235-5.137-16.896-11.516-22.985-19.126-6.09-7.614-11.088-17.61-14.987-29.979-3.901-12.374-5.852-26.648-5.852-42.826 0-23.035 7.52-42.637 22.557-58.817-7.044-17.318-6.379-36.732 1.997-58.24 5.52-1.715 13.706-.428 24.554 3.853 10.85 4.283 18.794 7.952 23.84 10.994 5.046 3.041 9.089 5.618 12.135 7.708 17.705-4.947 35.976-7.421 54.818-7.421s37.117 2.474 54.823 7.421l10.849-6.849c7.419-4.57 16.18-8.758 26.262-12.565 10.088-3.805 17.802-4.853 23.134-3.138 8.562 21.509 9.325 40.922 2.279 58.24 15.036 16.18 22.559 35.787 22.559 58.817 0 16.178-1.958 30.497-5.853 42.966-3.9 12.471-8.941 22.457-15.125 29.979-6.191 7.521-13.901 13.85-23.131 18.986-9.232 5.14-18.182 8.85-26.84 11.136-8.662 2.286-18.415 4.004-29.263 5.146 9.894 8.562 14.842 22.077 14.842 40.539v60.237c0 3.422 1.19 6.279 3.572 8.562 2.379 2.279 6.136 2.95 11.276 1.995 44.163-14.653 80.185-41.062 108.068-79.226 27.88-38.161 41.825-81.126 41.825-128.906-.01-39.771-9.818-76.454-29.414-110.049z"})}),logo:e=>i.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",...e,children:i.jsx("path",{fill:"currentColor",d:"M11.572 0c-.176 0-.31.001-.358.007a19.76 19.76 0 0 1-.364.033C7.443.346 4.25 2.185 2.228 5.012a11.875 11.875 0 0 0-2.119 5.243c-.096.659-.108.854-.108 1.747s.012 1.089.108 1.748c.652 4.506 3.86 8.292 8.209 9.695.779.25 1.6.422 2.534.525.363.04 1.935.04 2.299 0 1.611-.178 2.977-.577 4.323-1.264.207-.106.247-.134.219-.158-.02-.013-.9-1.193-1.955-2.62l-1.919-2.592-2.404-3.558a338.739 338.739 0 0 0-2.422-3.556c-.009-.002-.018 1.579-.023 3.51-.007 3.38-.01 3.515-.052 3.595a.426.426 0 0 1-.206.214c-.075.037-.14.044-.495.044H7.81l-.108-.068a.438.438 0 0 1-.157-.171l-.05-.106.006-4.703.007-4.705.072-.092a.645.645 0 0 1 .174-.143c.096-.047.134-.051.54-.051.478 0 .558.018.682.154.035.038 1.337 1.999 2.895 4.361a10760.433 10760.433 0 0 0 4.735 7.17l1.9 2.879.096-.063a12.317 12.317 0 0 0 2.466-2.163 11.944 11.944 0 0 0 2.824-6.134c.096-.66.108-.854.108-1.748 0-.893-.012-1.088-.108-1.747-.652-4.506-3.859-8.292-8.208-9.695a12.597 12.597 0 0 0-2.499-.523A33.119 33.119 0 0 0 11.573 0zm4.069 7.217c.347 0 .408.005.486.047a.473.473 0 0 1 .237.277c.018.06.023 1.365.018 4.304l-.006 4.218-.744-1.14-.746-1.14v-3.066c0-1.982.01-3.097.023-3.15a.478.478 0 0 1 .233-.296c.096-.05.13-.054.5-.054z"})}),moon:yt,sun:jt},Yr=zt,Hr=Kt,Mr=Ct,Br=Ft,Dr=n.forwardRef(({className:e,inset:t,children:a,...s},n)=>i.jsxs(kt,{ref:n,className:zn("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",t&&"pl-8",e),...s,children:[a,i.jsx(Nt,{className:"ml-auto h-4 w-4"})]}));Dr.displayName=kt.displayName;const Ur=n.forwardRef(({className:e,...t},a)=>i.jsx(St,{ref:a,className:zn("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...t}));Ur.displayName=St.displayName;const Er=n.forwardRef(({className:e,sideOffset:t=4,...a},s)=>i.jsx(Ct,{children:i.jsx(Zt,{ref:s,sideOffset:t,className:zn("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...a})}));Er.displayName=Zt.displayName;const Jr=n.forwardRef(({className:e,inset:t,...a},s)=>i.jsx(Gt,{ref:s,className:zn("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",t&&"pl-8",e),...a}));Jr.displayName=Gt.displayName,n.forwardRef(({className:e,children:t,checked:a,...s},n)=>i.jsxs(Vt,{ref:n,className:zn("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),checked:a,...s,children:[i.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:i.jsx(Wt,{children:i.jsx(Tt,{className:"h-4 w-4"})})}),t]})).displayName=Vt.displayName,n.forwardRef(({className:e,children:t,...a},s)=>i.jsxs(Xt,{ref:s,className:zn("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...a,children:[i.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:i.jsx(Wt,{children:i.jsx(Rt,{className:"h-4 w-4 fill-current"})})}),t]})).displayName=Xt.displayName,n.forwardRef(({className:e,inset:t,...a},s)=>i.jsx(Lt,{ref:s,className:zn("px-2 py-1.5 text-sm font-semibold",t&&"pl-8",e),...a})).displayName=Lt.displayName;const Pr=n.forwardRef(({className:e,...t},a)=>i.jsx(It,{ref:a,className:zn("-mx-1 my-1 h-px bg-muted",e),...t}));Pr.displayName=It.displayName;const Or=[{ch:"",en:"SimSun"},{ch:"",en:"SimHei"},{ch:"",en:"Microsoft Yahei"},{ch:"",en:"Microsoft JhengHei"},{ch:"",en:"KaiTi"},{ch:"",en:"NSimSun"},{ch:"",en:"FangSong"}],Ar=[{ch:"",en:"PingFang SC"},{ch:"",en:"Hiragino Sans GB"},{ch:"-",en:"Lantinghei SC"},{ch:"-",en:"Hanzipen SC"},{ch:"-",en:"Hannotate SC"},{ch:"-",en:"Songti SC"},{ch:"-",en:"Wawati SC"},{ch:"-",en:"Weibei SC"},{ch:"-",en:"Xingkai SC"},{ch:"-",en:"Yapi SC"},{ch:"-",en:"Yuanti SC"}],Qr=[{ch:"",en:"YouYuan"},{ch:"",en:"LiSu"},{ch:"",en:"STXihei"},{ch:"",en:"STHeiti"},{ch:"",en:"STKaiti"},{ch:"",en:"STSong"},{ch:"",en:"STFangsong"},{ch:"",en:"STZhongsong"},{ch:"",en:"STCaiyun"},{ch:"",en:"STHupo"},{ch:"",en:"STXinwei"},{ch:"",en:"STLiti"},{ch:"",en:"STXingkai"},{ch:"",en:"FZShuTi"},{ch:"",en:"FZYaoti"}],_r=[{ch:"",en:"Source Han Sans CN"},{ch:"",en:"Source Han Serif SC"},{ch:"",en:"WenQuanYi Micro Hei"},{ch:"",en:"LXGW WenKai"},{ch:"",en:"Ark Pixel 12px Monospaced zh_cn"},{ch:"DW Pica Roman V",en:"DW Pica Roman V"}],$r=new function(){const e=["monospace","sans-serif","serif"],t=document.getElementsByTagName("body")[0],a=document.createElement("span");a.style.fontSize="72px",a.innerHTML="mmmmmmmmmmlli";const s={},n={};for(const i in e)a.style.fontFamily=e[i],t.appendChild(a),s[e[i]]=a.offsetWidth,n[e[i]]=a.offsetHeight,t.removeChild(a);this.detect=function(i){let r=!1;for(const o in e){a.style.fontFamily=i+","+e[o],t.appendChild(a);const l=a.offsetWidth!=s[e[o]]||a.offsetHeight!=n[e[o]];t.removeChild(a),r=r||l}return r}},qr=[{ch:"Arial",en:"Arial"}].concat([...Ar,...Or,..._r,...Qr].filter(e=>$r.detect(e.en)));var eo=(e=>(e.NORMAL="normal",e.BOLD="bold",e))(eo||{}),to=(e=>(e.NORMAL="normal",e.ITALIC="italic",e))(to||{});async function ao(e,t){const a=new FontFace(e,"string"==typeof t?`url(${t})`:t);document.fonts.add(a),await a.load()}const so="__TMP__",no=1e5;var io=(e=>(e.Character="Character",e.Background="Background",e.Thing="Thing",e.Dialog="Dialog",e.Audio="Audio",e.Font="Font",e))(io||{});const ro=[{name:"",value:"Character"},{name:"",value:"Background"},{name:"",value:"Thing"},{name:"",value:"Dialog"},{name:"",value:"Audio"},{name:"",value:"Font"}],oo=ro.reduce((e,{name:t,value:a})=>(e[a]=t,e),{}),lo=new class extends Yt{asset;assetSource;template;project;constructor(){super("vnve2"),this.version(4).stores({asset:"++id, name, type, voice, states, [name+type]",assetSource:"++id, mime, blob, ext",template:"++id, name, type, content",project:"++id, name, time, content"})}},co=lo.asset,ho=lo.assetSource,mo=lo.template,uo=lo.project;function po(e){return e.url||`https://s/${e.id}.${e.ext}`}function xo(e){const t=e.states.find(t=>t.id===e.stateId);return t?po(t):""}function fo(e){switch(e){case"Background":case"Character":case"Thing":case"Dialog":return".webp, .png, .jpg, .jpeg, .gif, .mp4";case"Audio":return".mp3, .wav, .m4a, .aac";case"Font":return".ttf, .woff, .woff2";default:return""}}async function go(e,t){const a=await co.get(e);if(t){const e=a.states.find(e=>e.name===t);return e?{...a,stateId:e.id}:void 0}return a}async function vo(e,t,a){const s={name:e};a&&(s.type=a);const n=await co.where(s).first();if(n&&t){const e=n.states.find(e=>e.name===t);return e?{...n,stateId:e.id}:void 0}return n}async function bo(){const e=(await function({accept:e="*",multiple:t=!1}={}){return new Promise((a,s)=>{let n=document.createElement("input");n.type="file",n.accept=e,n.multiple=t,n.style.display="none",n.addEventListener("change",e=>{const t=Array.from(e.target.files||[]);t.length>0?a(t):s(new Error("No files selected")),document.body.removeChild(n),n=null}),n.addEventListener("error",()=>{s(new Error("Error selecting files")),document.body.removeChild(n)}),n.addEventListener("cancel",()=>{s(new Error("File deselected!")),document.body.removeChild(n)}),document.body.appendChild(n),n.click()})}({accept:".vnve"}))[0];e&&await lo.import(e)}const wo=[{type:io.Background,assets:[{name:"",states:[{name:"",url:"/vnve/assets/day-b6ef6b0c.webp"},{name:"",url:"/vnve/assets/night-da7c9955.webp"}]},{name:"",states:[{name:"",url:"/vnve/assets/day-c525641b.webp"},{name:"",url:"/vnve/assets/night-61088675.webp"}]}]},{type:io.Character,assets:[{name:"",states:[{name:"",url:"/vnve/assets/default-9e36bbf3.webp"},{name:"",url:"/vnve/assets/happy-61fa7adf.webp"}]},{name:"",states:[{name:"",url:"/vnve/assets/default-6a415d65.webp"},{name:"",url:"/vnve/assets/happy-77097254.webp"}]}]},{type:io.Thing,assets:[{name:"",states:[{name:"",url:"/vnve/assets/red-628f973d.webp"}]}]},{type:io.Audio,assets:[{name:"BGM",states:[{name:"bgm1",url:"/vnve/assets/bgm1-865a2e82.mp3"},{name:"bgm2",url:"/vnve/assets/bgm2-9df28d45.mp3"}]},{name:"",states:[{name:"",url:"/vnve/assets/open-door-0aa9286c.mp3"},{name:"",url:"/vnve/assets/knock-door-25770f6b.mp3"},{name:"",url:"/vnve/assets/rain-2ed4ca49.mp3"},{name:"",url:"/vnve/assets/thunder-fcdc6cdf.mp3"}]}]},{type:io.Font,assets:[{name:"",states:[{name:"",url:"/vnve/assets/zh-hans-17f9a740.woff2"},{name:"",url:"/vnve/assets/zh-hant-df9154bf.woff2"}]}]}],yo="IS_PRESET_IMPORTED",jo=[{name:"",content:Zr},{name:"",content:Gr},{name:"",content:Vr},{name:"",content:()=>new Ti}];function ko(){const e=Wr(e=>e.editor),t=Ht(()=>mo.reverse().toArray());return{defaultTemplates:jo,customTemplates:t||[],handleAddDefaultTemplate:(t,a)=>()=>{const s=t();e.addScene(s,a),e.setActiveSceneByName(s.name)},handleAddCustomTemplate:async(t,a)=>{const s=await Ti.fromJSON(JSON.parse(t),!1);e.addScene(s,a),e.setActiveSceneByName(s.name)}}}function No({onOpenSceneDetailDialog:e}){const t=Wr(e=>e.editor),a=Wr(e=>e.activeScene),s=Wr(e=>e.scenes),{defaultTemplates:r,customTemplates:o,handleAddDefaultTemplate:l,handleAddCustomTemplate:c}=ko(),d=n.useRef(null);n.useEffect(()=>{d.current&&d.current.scrollIntoView({behavior:"smooth"})},[s.length]);const h=(e,a)=>{t.swapScene(e,a)};return i.jsx(Rr,{className:"flex-1 shrink-0 max-h-[50%] sm:max-h-full rounded-md",children:i.jsx(Lr,{className:"h-full p-1",children:i.jsx(zr,{className:"h-full p-2",children:i.jsxs(Mn,{children:[i.jsx(Bn,{children:i.jsxs(Un,{children:[i.jsx(En,{children:""}),i.jsx(En,{className:"w-[3rem] text-right",children:""})]})}),i.jsx(Dn,{children:s.map((n,m)=>i.jsxs(Un,{ref:a?.name===n.name?d:null,className:(a?.name===n.name?"bg-muted":"")+" cursor-pointer",children:[i.jsxs(Jn,{onClick:()=>{t.setActiveSceneByName(n.name)},children:[i.jsxs("span",{className:"font-medium mr-1",children:[m+1,"."]}),n.label]}),i.jsxs(Jn,{className:"flex gap-1 justify-end",children:[m>0&&i.jsx(Fr.moveUp,{className:"size-4 cursor-pointer",onClick:()=>h(m,m-1)}),m<s.length-1&&i.jsx(Fr.moveDown,{className:"size-4 cursor-pointer",onClick:()=>h(m,m+1),children:""}),i.jsxs(Yr,{modal:!1,children:[i.jsx(Hr,{children:i.jsx(Fr.more,{className:"size-4 cursor-pointer"})}),i.jsxs(Er,{children:[i.jsx(Jr,{className:"flex md:hidden",onClick:e,children:""}),i.jsxs(Br,{children:[i.jsx(Dr,{children:""}),i.jsx(Mr,{children:i.jsxs(Ur,{children:[r.map(e=>i.jsx(Jr,{onClick:l(e.content,m+1),children:e.name},e.name)),o.length>0&&i.jsx(Pr,{}),o.map(e=>i.jsx(Jr,{onClick:()=>c(e.content,m+1),children:e.name},e.id))]})})]}),i.jsx(Jr,{onClick:()=>((e,a)=>{const s=t.cloneSceneByName(e.name);t.addScene(s,a),t.setActiveSceneByName(s.name)})(n,m+1),children:""}),i.jsx(Jr,{className:"text-destructive",onClick:()=>(e=>{e.name===a?.name&&t.setActiveScene(void 0),t.removeSceneByName(e.name)})(n),children:""})]})]})]})]},n.name))})]})})})})}function So(){const e=Tr(e=>e.setConfirm),t=Tr(e=>e.setCancel),a=Tr(e=>e.setOpen),s=Tr(e=>e.setType),n=Tr(e=>e.setDisableSelect);return{selectAsset:(i,r)=>new Promise(o=>{e(e=>{o(e),a(!1)}),t(()=>{o(void 0),a(!1)}),a(!0),s(i),n(r)})}}async function Co(e){const{text:t,voiceType:a,volume:s,speed:n,pitch:i,token:r,appid:o,resourceId:l="volc.tts_async.default"}=e,c=Date.now(),d=await async function(e){const{text:t,voiceType:a,volume:s,speed:n,pitch:i,token:r,appid:o,resourceId:l}=e,c={"volc.tts_async.default":"/api/tts/ark/api/v1/tts_async/submit","volc.tts_async.emotion":"/api/tts/ark/api/v1/tts_async_with_emotion/submit"}[l],d="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}),h={"Content-Type":"application/json","Resource-Id":l,Authorization:`Bearer; ${r}`},m={appid:o,reqid:d,text:t,format:"mp3",voice_type:a,volume:s,speed:n,pitch:i},u=await fetch(c,{method:"POST",headers:h,body:JSON.stringify(m)});return await u.json()}({text:t,voiceType:a,volume:s,speed:n,pitch:i,token:r,appid:o,resourceId:l});if(!d.task_id)throw new Error(`: ${d.message}`);if(2===d.task_status)throw new Error(`: ${JSON.stringify(d)}`);const h=d.task_id;let m;for(;;){if(Date.now()-c>3e5)throw new Error("");const e=await Zo({taskId:h,token:r,appid:o,resourceId:l});if(1===e.task_status){m=e;break}if(2===e.task_status)throw new Error(`: ${JSON.stringify(e)}`);await new Promise(e=>setTimeout(e,1e3))}return m}async function Zo(e){const{taskId:t,token:a,appid:s,resourceId:n}=e,i={"volc.tts_async.default":"/api/tts/ark/api/v1/tts_async/query","volc.tts_async.emotion":"/api/tts/ark/api/v1/tts_async_with_emotion/query"}[n],r=`appid=${s}&task_id=${t}`,o={"Resource-Id":n,Authorization:`Bearer; ${a}`},l=await fetch(`${i}?${r}`,{method:"GET",headers:o});return await l.json()}const Go="NONE_VOICE",Vo=[{name:"",value:Go},{name:" 2.0",value:"BV700_V2_streaming"},{name:"",value:"BV705_streaming"},{name:" 2.0",value:"BV701_V2_streaming"},{name:" 2.0",value:"BV001_V2_streaming"},{name:"",value:"BV700_streaming"},{name:"-2.0",value:"BV406_V2_streaming"},{name:"-",value:"BV406_streaming"},{name:"-2.0",value:"BV407_V2_streaming"},{name:"-",value:"BV407_streaming"},{name:"",value:"BV001_streaming"},{name:"",value:"BV002_streaming"},{name:"",value:"BV701_streaming"},{name:"",value:"BV123_streaming"},{name:"",value:"BV120_streaming"},{name:"",value:"BV119_streaming"},{name:"",value:"BV115_streaming"},{name:"",value:"BV107_streaming"},{name:"",value:"BV100_streaming"},{name:"",value:"BV104_streaming"},{name:"",value:"BV004_streaming"},{name:"",value:"BV113_streaming"},{name:"",value:"BV102_streaming"},{name:"",value:"BV405_streaming"},{name:"",value:"BV007_streaming"},{name:"",value:"BV009_streaming"},{name:"",value:"BV419_streaming"},{name:"",value:"BV415_streaming"},{name:"",value:"BV008_streaming"},{name:"",value:"BV408_streaming"},{name:"",value:"BV426_streaming"},{name:"",value:"BV428_streaming"},{name:"",value:"BV403_streaming"},{name:"",value:"BV158_streaming"},{name:"",value:"BV157_streaming"},{name:"",value:"BR001_streaming"},{name:"",value:"BV410_streaming"},{name:"",value:"BV411_streaming"},{name:"-",value:"BV437_streaming"},{name:"",value:"BV412_streaming"},{name:"",value:"BV159_streaming"},{name:"",value:"BV418_streaming"},{name:"",value:"BV142_streaming"},{name:"",value:"BV143_streaming"},{name:"",value:"BV056_streaming"},{name:"",value:"BV005_streaming"},{name:"",value:"BV064_streaming"},{name:"",value:"BV051_streaming"},{name:"",value:"BV063_streaming"},{name:"",value:"BV417_streaming"},{name:"",value:"BV050_streaming"},{name:"",value:"BV061_streaming"},{name:"",value:"BV401_streaming"},{name:"",value:"BV402_streaming"},{name:"",value:"BV006_streaming"},{name:"",value:"BV011_streaming"},{name:"",value:"BV012_streaming"},{name:"-",value:"BV034_streaming"},{name:"",value:"BV033_streaming"}];async function Wo(e,t){const a=e.states,s=a.find(t=>t.id===e.stateId)??a[0];let n;return n="gif"===s.ext?new bi({source:po(s)}):"mp4"===s.ext?new Zi({source:po(s)}):new vi({source:po(s)}),n.label=e.name,n.assetID=e.id,n.assetType=e.type,await n.load(),e.type===io.Character?(n.zIndex=Sr.Character,n.x=t.options.width/2-n.width/2,n.y=t.options.height-n.height):e.type===io.Background?(n.zIndex=Sr.Background,n.width=t.options.width,n.height=t.options.height):e.type===io.Dialog&&(n.zIndex=Sr.Dialog,n.x=t.options.width/2-n.width/2,n.y=t.options.height-n.height),n}function To(e){const t=e.states,a=t.find(t=>t.id===e.stateId)??t[0],s=new Vi({source:po(a)});return s.label=a.name,s.assetID=e.id,s.assetType=e.type,s}let Xo=!1;function Ro(){return Xo}function Lo(e){let t=e,a="";const s=e.match(/^(.+)\[(.+)\]$/);return s&&(t=s[1],a=s[2]),{name:t,state:a}}function Io(e,t){return e.states.find(e=>e.name===t)||e.states.find(t=>t.id===e.stateId)||e.states[0]}async function zo({lines:e,editor:t,project:a,speak:s,ttsSettings:n}){if(!n||!n.appid||!n.token)throw new Error("");const i=s.speaker.speakerTargetName;let r;r="Narrator"===i?no:t.activeScene.getChildByName(i).assetID;const o=(await go(r)).voice;if(!o)throw new Error(", ");if(o===Go)throw{voice:o,message:" "};s.voice?.targetName&&t.removeSoundByName(s.voice.targetName);const l=Hn(e);try{const e=await Co({token:n.token,appid:n.appid,text:l,voiceType:o}),s=await function(e,t,a="mp3"){return fetch(e).then(e=>e.blob()).then(e=>new File([e],`${t}.${a}`,{type:`audio/${a}`}))}(e.audio_url,l.slice(0,6)),i=await async function(e,t,a){const s=`${so}${e}`;let n=await vo(s,void 0,t);if(!n){const e=await co.add({name:s,type:t,states:[]});n=await go(e)}const{name:i,ext:r}=Fn(a),o=await ho.add({mime:a.type,blob:a,ext:r});return n.stateId=o,n.states.push({id:o,name:`${i}_${Math.random().toString(36).substring(2,8)}`,ext:r}),await co.update(n.id,{states:n.states}),n}(a.id,io.Audio,s),r=To(i);return t.addSound(r),{sound:r,url:xo(i)}}catch(c){throw console.error(c),new Error(`${l.slice(0,6)}... : ${c.message}`)}}const Ko=qt,Fo=n.forwardRef(({className:e,...t},a)=>i.jsx(Mt,{ref:a,className:zn("flex h-9 items-center space-x-1 rounded-md border bg-background p-1 shadow-sm",e),...t}));Fo.displayName=Mt.displayName;const Yo=n.forwardRef(({className:e,...t},a)=>i.jsx(Bt,{ref:a,className:zn("flex cursor-default select-none items-center rounded-sm px-2 sm:px-3 py-1 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground",e),...t}));Yo.displayName=Bt.displayName,n.forwardRef(({className:e,inset:t,children:a,...s},n)=>i.jsxs(Dt,{ref:n,className:zn("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground",t&&"pl-8",e),...s,children:[a,i.jsx(Nt,{className:"ml-auto h-4 w-4"})]})).displayName=Dt.displayName,n.forwardRef(({className:e,...t},a)=>i.jsx(Ut,{ref:a,className:zn("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...t})).displayName=Ut.displayName;const Ho=n.forwardRef(({className:e,align:t="start",alignOffset:a=-4,sideOffset:s=8,...n},r)=>i.jsx(Et,{children:i.jsx(Jt,{ref:r,align:t,alignOffset:a,sideOffset:s,className:zn("z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...n})}));Ho.displayName=Jt.displayName;const Mo=n.forwardRef(({className:e,inset:t,...a},s)=>i.jsx(Pt,{ref:s,className:zn("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t&&"pl-8",e),...a}));Mo.displayName=Pt.displayName,n.forwardRef(({className:e,children:t,checked:a,...s},n)=>i.jsxs(Ot,{ref:n,className:zn("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),checked:a,...s,children:[i.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:i.jsx(At,{children:i.jsx(Tt,{className:"h-4 w-4"})})}),t]})).displayName=Ot.displayName,n.forwardRef(({className:e,children:t,...a},s)=>i.jsxs(Qt,{ref:s,className:zn("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...a,children:[i.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:i.jsx(At,{children:i.jsx(Rt,{className:"h-4 w-4 fill-current"})})}),t]})).displayName=Qt.displayName,n.forwardRef(({className:e,inset:t,...a},s)=>i.jsx(_t,{ref:s,className:zn("px-2 py-1.5 text-sm font-semibold",t&&"pl-8",e),...a})).displayName=_t.displayName;const Bo=n.forwardRef(({className:e,...t},a)=>i.jsx($t,{ref:a,className:zn("-mx-1 my-1 h-px bg-muted",e),...t}));Bo.displayName=$t.displayName;const Do=ra,Uo=oa,Eo=n.forwardRef(({className:e,...t},a)=>i.jsx(ea,{ref:a,className:zn("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t}));Eo.displayName=ea.displayName;const Jo=n.forwardRef(({className:e,children:t,disableClose:a,...s},n)=>i.jsxs(Uo,{children:[i.jsx(Eo,{}),i.jsxs(ta,{ref:n,className:zn("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...s,children:[t,!a&&i.jsxs(aa,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[i.jsx(sa,{className:"h-4 w-4"}),i.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));Jo.displayName=ta.displayName;const Po=({className:e,...t})=>i.jsx("div",{className:zn("flex flex-col space-y-1.5 text-center sm:text-left",e),...t});Po.displayName="DialogHeader";const Oo=({className:e,...t})=>i.jsx("div",{className:zn("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...t});Oo.displayName="DialogFooter";const Ao=n.forwardRef(({className:e,...t},a)=>i.jsx(na,{ref:a,className:zn("text-lg font-semibold leading-none tracking-tight",e),...t}));Ao.displayName=na.displayName;const Qo=n.forwardRef(({className:e,...t},a)=>i.jsx(ia,{ref:a,className:zn("text-sm text-muted-foreground",e),...t}));Qo.displayName=ia.displayName;const _o=ca("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),$o=n.forwardRef(({className:e,...t},a)=>i.jsx(la,{ref:a,className:zn(_o(),e),...t}));$o.displayName=la.displayName;const qo=ua,el=n.createContext({}),tl=({...e})=>i.jsx(el.Provider,{value:{name:e.name},children:i.jsx(ha,{...e})}),al=()=>{const e=n.useContext(el),t=n.useContext(sl),{getFieldState:a,formState:s}=ma(),i=a(e.name,s);if(!e)throw new Error("useFormField should be used within <FormField>");const{id:r}=t;return{id:r,name:e.name,formItemId:`${r}-form-item`,formDescriptionId:`${r}-form-item-description`,formMessageId:`${r}-form-item-message`,...i}},sl=n.createContext({}),nl=n.forwardRef(({className:e,...t},a)=>{const s=n.useId();return i.jsx(sl.Provider,{value:{id:s},children:i.jsx("div",{ref:a,className:zn("space-y-2",e),...t})})});nl.displayName="FormItem";const il=n.forwardRef(({className:e,...t},a)=>{const{error:s,formItemId:n}=al();return i.jsx($o,{ref:a,className:zn(s&&"text-destructive",e),htmlFor:n,...t})});il.displayName="FormLabel";const rl=n.forwardRef(({...e},t)=>{const{error:a,formItemId:s,formDescriptionId:n,formMessageId:r}=al();return i.jsx(da,{ref:t,id:s,"aria-describedby":a?`${n} ${r}`:`${n}`,"aria-invalid":!!a,...e})});rl.displayName="FormControl";const ol=n.forwardRef(({className:e,...t},a)=>{const{formDescriptionId:s}=al();return i.jsx("p",{ref:a,id:s,className:zn("text-[0.8rem] text-muted-foreground",e),...t})});ol.displayName="FormDescription";const ll=n.forwardRef(({className:e,children:t,...a},s)=>{const{error:n,formMessageId:r}=al(),o=n?String(n?.message):t;return o?i.jsx("p",{ref:s,id:r,className:zn("text-[0.8rem] font-medium text-destructive",e),...a,children:o}):null});ll.displayName="FormMessage";const cl=n.forwardRef(({className:e,type:t,...a},s)=>i.jsx("input",{type:t,className:zn("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",e),ref:s,...a}));cl.displayName="Input";const dl=ca("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),hl=n.forwardRef(({className:e,variant:t,size:a,asChild:s=!1,...n},r)=>{const o=s?da:"button";return i.jsx(o,{className:zn(dl({variant:t,size:a,className:e})),ref:r,...n})});hl.displayName="Button";const ml=pa({templateName:xa().min(1,"")});function ul({isOpen:e,sceneName:t,onClose:a}){const s=Wr(e=>e.editor),n=fa({resolver:ga(ml),defaultValues:{templateName:""}});return i.jsx(Do,{open:e,onOpenChange:e=>{e||a()},children:i.jsxs(Jo,{children:[i.jsxs(Po,{children:[i.jsx(Ao,{children:""}),i.jsx(Qo,{})]}),i.jsx(qo,{...n,children:i.jsxs("form",{onSubmit:n.handleSubmit(async e=>{await mo.add({name:e.templateName,type:"",content:JSON.stringify(s.cloneSceneByName(t))}),a(),n.reset()}),className:"space-y-8",children:[i.jsx(tl,{control:n.control,name:"templateName",render:({field:e})=>i.jsxs(nl,{children:[i.jsx(il,{children:""}),i.jsx(rl,{children:i.jsx(cl,{placeholder:"",...e})}),i.jsx(ll,{})]})}),i.jsxs("div",{className:"flex justify-end space-x-4",children:[i.jsx(hl,{type:"button",variant:"outline",onClick:a,children:""}),i.jsx(hl,{type:"submit",children:""})]})]})})]})})}function pl({isOpen:e,onClose:t}){const a=Ht(()=>mo.reverse().toArray());return i.jsx(Do,{open:e,onOpenChange:e=>{e||t()},children:i.jsxs(Jo,{className:"max-h-[80vh] overflow-auto",children:[i.jsxs(Po,{children:[i.jsx(Ao,{children:""}),i.jsx(Qo,{})]}),i.jsxs(Mn,{children:[i.jsx(Bn,{children:i.jsxs(Un,{children:[i.jsx(En,{children:""}),i.jsx(En,{className:"w-[100px]",children:""})]})}),i.jsx(Dn,{children:a?.map(e=>i.jsxs(Un,{children:[i.jsx(Jn,{children:e.name}),i.jsx(Jn,{children:i.jsxs(hl,{variant:"ghost",size:"icon",onClick:()=>(async e=>{await mo.delete(e)})(e.id),children:[i.jsx(Fr.delete,{className:"h-4 w-4"}),i.jsx("span",{className:"sr-only",children:""})]})})]},e.id))})]})]})})}const xl=n.forwardRef(({className:e,value:t,...a},s)=>i.jsx(va,{ref:s,className:zn("relative h-2 w-full overflow-hidden rounded-full bg-primary/20",e),...a,children:i.jsx(ba,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(t||0)}%)`}})}));function fl({progress:e,url:t,subtitles:a,isOpen:s,onClose:n}){const r=Wr(e=>e.project);return i.jsx(Do,{open:s,onOpenChange:e=>{e||n()},children:i.jsxs(Jo,{className:"min-w-[80vw]",onPointerDownOutside:e=>e.preventDefault(),children:[i.jsxs(Po,{children:[i.jsx(Ao,{children:""}),i.jsx(Qo,{})]}),!t&&i.jsx(xl,{value:e.value}),t&&i.jsx("video",{src:t,className:"w-full aspect-[16/9]",controls:!0}),i.jsx(Oo,{children:t&&i.jsxs(hl,{onClick:()=>{Kn(r.name,t)},children:[i.jsx(Fr.download,{className:"size-4 mr-1"}),""]})})]})})}xl.displayName=va.displayName;const gl=n.forwardRef(({progress:e,isOpen:t,onReplay:a,onClose:s,onExport:r},o)=>{const l=n.useRef(null);return n.useImperativeHandle(o,()=>({getPreviewCanvas:()=>l.current})),i.jsx(Do,{open:t,onOpenChange:e=>{e||s()},children:i.jsxs(Jo,{className:"min-w-[80vw]",onPointerDownOutside:e=>e.preventDefault(),children:[i.jsxs(Po,{children:[i.jsx(Ao,{children:""}),i.jsx(Qo,{}),i.jsx("canvas",{ref:l,className:"w-full aspect-[16/9]"}),i.jsx(xl,{value:e.value,className:"mt-2"})]}),i.jsxs(Oo,{children:[i.jsx(hl,{variant:"ghost",onClick:a,children:i.jsx(Fr.refresh,{className:"size-5"})}),i.jsxs(hl,{onClick:r,children:[i.jsx(Fr.download,{className:"size-4 mr-1"}),""]})]})]})})});let vl=0;const bl=new Map,wl=e=>{if(bl.has(e))return;const t=setTimeout(()=>{bl.delete(e),Nl({type:"REMOVE_TOAST",toastId:e})},1e6);bl.set(e,t)},yl=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{const{toastId:a}=t;return a?wl(a):e.toasts.forEach(e=>{wl(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===a||void 0===a?{...e,open:!1}:e)}}case"REMOVE_TOAST":return void 0===t.toastId?{...e,toasts:[]}:{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},jl=[];let kl={toasts:[]};function Nl(e){kl=yl(kl,e),jl.forEach(e=>{e(kl)})}function Sl({...e}){const t=(vl=(vl+1)%Number.MAX_SAFE_INTEGER,vl.toString()),a=()=>Nl({type:"DISMISS_TOAST",toastId:t});return Nl({type:"ADD_TOAST",toast:{...e,id:t,open:!0,onOpenChange:e=>{e||a()}}}),{id:t,dismiss:a,update:e=>Nl({type:"UPDATE_TOAST",toast:{...e,id:t}})}}function Cl(){const[e,t]=n.useState(kl);return n.useEffect(()=>(jl.push(t),()=>{const e=jl.indexOf(t);e>-1&&jl.splice(e,1)}),[e]),{...e,toast:Sl,dismiss:e=>Nl({type:"DISMISS_TOAST",toastId:e})}}const Zl=pa({projectName:xa().min(1,"")});function Gl({isOpen:e,onClose:t}){const a=Wr(e=>e.editor),s=Wr(e=>e.setProject),{toast:n}=Cl(),r=fa({resolver:ga(Zl),defaultValues:{projectName:""}});return i.jsx(Do,{open:e,onOpenChange:e=>{e||t()},children:i.jsxs(Jo,{children:[i.jsxs(Po,{children:[i.jsx(Ao,{children:""}),i.jsx(Qo,{})]}),i.jsx(qo,{...r,children:i.jsxs("form",{onSubmit:r.handleSubmit(async e=>{const i={name:e.projectName,content:"",time:Date.now()},o=await uo.add(i);a.clear(),s({id:o,...i}),t(),r.reset(),n({title:"!",description:"",duration:1e3})}),className:"space-y-8",children:[i.jsx(tl,{control:r.control,name:"projectName",render:({field:e})=>i.jsxs(nl,{children:[i.jsx(il,{children:""}),i.jsx(rl,{children:i.jsx(cl,{placeholder:"",...e})}),i.jsx(ll,{})]})}),i.jsxs("div",{className:"flex justify-end space-x-4",children:[i.jsx(hl,{type:"button",variant:"outline",onClick:t,children:""}),i.jsx(hl,{type:"submit",children:""})]})]})})]})})}function Vl({isOpen:e,onClose:t}){const a=Wr(e=>e.editor),s=Wr(e=>e.setProject),r=Ht(()=>uo.reverse().toArray()),o=n.useRef(!1),l=async e=>{await uo.delete(e),await async function(e){const t=`${so}${e}`,a=await co.where("name").equals(t).toArray();for(const s of a){await co.delete(s.id);for(const e of s.states)await ho.delete(e.id)}}(e)};return i.jsx(Do,{open:e,onOpenChange:e=>{e||t()},children:i.jsxs(Jo,{className:"max-h-[80vh] overflow-auto",children:[i.jsxs(Po,{children:[i.jsx(Ao,{children:""}),i.jsx(Qo,{})]}),i.jsxs(Mn,{children:[i.jsx(Bn,{children:i.jsxs(Un,{children:[i.jsx(En,{children:""}),i.jsx(En,{className:"w-[80px]",children:""})]})}),i.jsx(Dn,{children:r?.map(e=>i.jsxs(Un,{children:[i.jsx(Jn,{onClick:()=>(async e=>{if(o.current)return;o.current=!0;const n=await uo.get(e);a.clear(),n.content&&(await a.loadFromJSON(n.content),a.setActiveSceneByIndex(0)),s(n),t(),setTimeout(()=>{o.current=!1},100)})(e.id),children:i.jsx("span",{className:"cursor-pointer",children:e.name})}),i.jsxs(Jn,{className:"flex gap-2",children:[i.jsx(Fr.copy,{className:"h-4 w-4 cursor-pointer",onClick:()=>(async e=>{const t=await uo.get(e);await uo.add({name:`${t.name} - `,content:t.content,time:Date.now()})})(e.id)}),i.jsx(Fr.delete,{className:"h-4 w-4 cursor-pointer",onClick:()=>l(e.id)})]})]},e.id))})]})]})})}const Wl=Za,Tl=Ca,Xl=n.forwardRef(({className:e,...t},a)=>i.jsx(wa,{className:zn("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t,ref:a}));Xl.displayName=wa.displayName;const Rl=n.forwardRef(({className:e,...t},a)=>i.jsxs(Tl,{children:[i.jsx(Xl,{}),i.jsx(ya,{ref:a,className:zn("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...t})]}));Rl.displayName=ya.displayName;const Ll=({className:e,...t})=>i.jsx("div",{className:zn("flex flex-col space-y-2 text-center sm:text-left",e),...t});Ll.displayName="AlertDialogHeader";const Il=({className:e,...t})=>i.jsx("div",{className:zn("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...t});Il.displayName="AlertDialogFooter";const zl=n.forwardRef(({className:e,...t},a)=>i.jsx(ja,{ref:a,className:zn("text-lg font-semibold",e),...t}));zl.displayName=ja.displayName;const Kl=n.forwardRef(({className:e,...t},a)=>i.jsx(ka,{ref:a,className:zn("text-sm text-muted-foreground",e),...t}));Kl.displayName=ka.displayName;const Fl=n.forwardRef(({className:e,...t},a)=>i.jsx(Na,{ref:a,className:zn(dl(),e),...t}));Fl.displayName=Na.displayName;const Yl=n.forwardRef(({className:e,...t},a)=>i.jsx(Sa,{ref:a,className:zn(dl({variant:"outline"}),"mt-2 sm:mt-0",e),...t}));function Hl({isOpen:e,onConfirm:t,onClose:a}){return i.jsx(Wl,{open:e,onOpenChange:e=>{e||a()},children:i.jsxs(Rl,{children:[i.jsxs(Ll,{children:[i.jsx(zl,{children:""}),i.jsx(Kl,{})]}),i.jsxs(Il,{children:[i.jsx(Yl,{children:""}),i.jsx(Fl,{onClick:()=>{t(),a()},children:""})]})]})})}function Ml(){const e=Xr(e=>e.setOpen),t=Xr(e=>e.setLoadingText);return{showLoading:a=>{e(!0),t(a)},updateLoadingText:e=>{t(e)},hideLoading:()=>{e(!1),t("")}}}Yl.displayName=Sa.displayName;const Bl=Da,Dl=Ua,Ul=Ea,El=n.forwardRef(({className:e,children:t,...a},s)=>i.jsxs(Ga,{ref:s,className:zn("flex h-9 w-full items-center justify-between whitespace-nowrap rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",e),"data-disable-click-outside":!0,...a,children:[t,i.jsx(Va,{asChild:!0,children:i.jsx(Wa,{"data-disable-click-outside":!0,className:"h-4 w-4 opacity-50"})})]}));El.displayName=Ga.displayName;const Jl=n.forwardRef(({className:e,...t},a)=>i.jsx(Ta,{ref:a,className:zn("flex cursor-default items-center justify-center py-1",e),"data-disable-click-outside":!0,...t,children:i.jsx(Xa,{})}));Jl.displayName=Ta.displayName;const Pl=n.forwardRef(({className:e,...t},a)=>i.jsx(Ra,{ref:a,className:zn("flex cursor-default items-center justify-center py-1",e),"data-disable-click-outside":!0,...t,children:i.jsx(La,{})}));Pl.displayName=Ra.displayName;const Ol=n.forwardRef(({className:e,children:t,position:a="popper",...s},n)=>i.jsx(Ia,{children:i.jsxs(za,{ref:n,className:zn("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===a&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:a,"data-disable-click-outside":!0,...s,children:[i.jsx(Jl,{}),i.jsx(Ka,{className:zn("p-1","popper"===a&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),"data-disable-click-outside":!0,children:t}),i.jsx(Pl,{})]})}));Ol.displayName=za.displayName;const Al=n.forwardRef(({className:e,...t},a)=>i.jsx(Fa,{ref:a,className:zn("px-2 py-1.5 text-sm font-semibold",e),...t,"data-disable-click-outside":!0}));Al.displayName=Fa.displayName;const Ql=n.forwardRef(({className:e,children:t,...a},s)=>i.jsxs(Ya,{ref:s,className:zn("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),"data-disable-click-outside":!0,...a,children:[i.jsx("span",{className:"absolute right-2 flex h-3.5 w-3.5 items-center justify-center","data-disable-click-outside":!0,children:i.jsx(Ha,{children:i.jsx(Tt,{className:"h-4 w-4"})})}),i.jsx(Ma,{"data-disable-click-outside":!0,children:t})]}));Ql.displayName=Ya.displayName,n.forwardRef(({className:e,...t},a)=>i.jsx(Ba,{ref:a,className:zn("-mx-1 my-1 h-px bg-muted",e),"data-disable-click-outside":!0,...t})).displayName=Ba.displayName;const _l=Aa,$l=n.forwardRef(({className:e,...t},a)=>i.jsx(Ja,{ref:a,className:zn("inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground",e),...t}));$l.displayName=Ja.displayName;const ql=n.forwardRef(({className:e,...t},a)=>i.jsx(Pa,{ref:a,className:zn("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow",e),...t}));ql.displayName=Pa.displayName;const ec=n.forwardRef(({className:e,...t},a)=>i.jsx(Oa,{ref:a,className:zn("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...t}));ec.displayName=Oa.displayName;const tc=M()(Qa(e=>({ai:null,updateAI:t=>e({ai:t}),tts:null,updateTTS:t=>e({tts:t})}),{name:"settings"})),ac=pa({platform:xa().min(1,""),key:xa().min(1,"API KEY"),model:xa().min(1,"")}),sc=pa({token:xa().min(1,"Token"),appid:xa().min(1,"AppID")});function nc({isOpen:e,onClose:t}){const[a,s]=n.useState("llm"),r=tc(e=>e.ai),o=tc(e=>e.tts),l=tc(e=>e.updateAI),c=tc(e=>e.updateTTS),d=fa({resolver:ga(ac),defaultValues:{platform:"deepseek",key:"",model:"deepseek-chat"}}),h=fa({resolver:ga(sc),defaultValues:{appid:"",token:""}});return n.useEffect(()=>{r&&d.reset(r)},[r,d]),n.useEffect(()=>{o&&h.reset(o)},[o,h]),i.jsx(Do,{open:e,onOpenChange:e=>{e||t()},children:i.jsxs(Jo,{className:"min-w-[400px]",onPointerDownOutside:e=>e.preventDefault(),children:[i.jsxs(Po,{children:[i.jsx(Ao,{children:""}),i.jsx(Qo,{})]}),i.jsxs(_l,{value:a,onValueChange:s,className:"w-full",children:[i.jsxs($l,{className:"grid grid-cols-2 mb-4",children:[i.jsx(ql,{value:"llm",children:""}),i.jsx(ql,{value:"tts",children:""})]}),i.jsx(ec,{value:"llm",children:i.jsx(qo,{...d,children:i.jsxs("form",{onSubmit:d.handleSubmit(function(e){l(e),t()}),className:"space-y-4",children:[i.jsx(tl,{control:d.control,name:"platform",render:({field:e})=>i.jsxs(nl,{children:[i.jsx(il,{children:"AI"}),i.jsx(rl,{children:i.jsxs(Bl,{onValueChange:e.onChange,value:e.value,children:[i.jsx(El,{children:i.jsx(Ul,{placeholder:"AI"})}),i.jsxs(Ol,{children:[i.jsx(Ql,{value:"deepseek",children:"DeepSeek"}),i.jsx(Ql,{value:"ark",children:""}),i.jsx(Ql,{value:"openai",children:"OpenAI"})]})]})}),i.jsx(ll,{})]})}),i.jsx(tl,{control:d.control,name:"key",render:({field:e})=>i.jsxs(nl,{children:[i.jsx(il,{children:"API KEY"}),i.jsx(rl,{children:i.jsx(cl,{type:"password",placeholder:"API KEY",...e})}),i.jsx(ll,{})]})}),i.jsx(tl,{control:d.control,name:"model",render:({field:e})=>i.jsxs(nl,{children:[i.jsx(il,{children:"Model"}),i.jsx(rl,{children:i.jsx(cl,{placeholder:"",...e})}),i.jsx(ll,{})]})}),i.jsxs("div",{className:"flex justify-center gap-2",children:[i.jsx(hl,{type:"submit",children:""}),i.jsx(hl,{variant:"ghost",onClick:t,children:""})]})]})})}),i.jsx(ec,{value:"tts",children:i.jsx(qo,{...h,children:i.jsxs("form",{onSubmit:h.handleSubmit(function(e){c(e),t()}),className:"space-y-4",children:[i.jsx(tl,{control:h.control,name:"appid",render:({field:e})=>i.jsxs(nl,{children:[i.jsx(il,{children:"AppID"}),i.jsx(rl,{children:i.jsx(cl,{placeholder:"AppID",...e})}),i.jsx(ll,{})]})}),i.jsx(tl,{control:h.control,name:"token",render:({field:e})=>i.jsxs(nl,{children:[i.jsx(il,{children:"Token"}),i.jsx(rl,{children:i.jsx(cl,{type:"password",placeholder:"Token",...e})}),i.jsx(ll,{})]})}),i.jsxs("div",{className:"flex justify-center gap-2",children:[i.jsx(hl,{type:"submit",children:""}),i.jsx(hl,{variant:"ghost",onClick:t,children:""})]})]})})})]})]})})}function ic(e){const[t,a]=n.useState(window.matchMedia(e).matches);return n.useEffect(()=>{const s=window.matchMedia(e);s.matches!==t&&a(s.matches);const n=()=>a(s.matches);return s.addEventListener("change",n),()=>s.removeEventListener("change",n)},[t,e]),t}async function rc(e,t){const a=new URLSearchParams(window.location.search),s=tc.getState().ai;let n=a.get("key"),i=a.get("model"),r=a.get("platform")??"deepseek";if(n||(n=s.key,i=s.model,r=s.platform),!n||!i||!r)throw new Error(" AI ");const o=new _a({apiKey:n,baseURL:`${location.origin}/api/llm/${r}`,dangerouslyAllowBrowser:!0}),l=await o.chat.completions.create({messages:[{role:"system",content:e},{role:"user",content:t}],model:i}),c=l.choices[0]?.message?.content;console.log("LLM Response:",c);const d=Yn(c);if(d)return d.scenes;throw new Error(" JSON ")}const oc=n.forwardRef(({className:e,...t},a)=>i.jsx("textarea",{className:zn("flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",e),ref:a,...t}));function lc({accept:e,disabled:t,onFileSelect:a}){const[s,r]=n.useState(null),o=n.useRef(null);return i.jsxs("div",{className:"flex items-center space-x-4",children:[i.jsx(hl,{variant:"outline",size:"icon",onClick:()=>{o.current?.click()},"aria-label":"",disabled:t,children:i.jsx($a,{className:"h-4 w-4"})}),i.jsx("input",{type:"file",ref:o,onChange:e=>{const t=e.target.files?.[0];t&&(r(t.name),a(t))},className:"hidden",accept:e}),s&&i.jsxs("span",{className:"text-sm text-gray-600",children:[": ",s]})]})}function cc({value:e,onChange:t}){const a=e.split("\n");return i.jsxs("div",{className:"flex flex-col gap-2",children:[i.jsxs("div",{className:"text-xs text-muted-foreground bg-muted/50 p-2 rounded",children:[" ",i.jsx(O,{className:"inline w-3 h-3"}),"  ",i.jsx(Re,{className:"inline w-3 h-3"})," "]}),i.jsx(zr,{className:"h-[400px] w-full border rounded-md relative bg-background",children:i.jsx("div",{className:"p-4",children:a.map((e,s)=>{const n=""===e.trim(),r=s>0&&""===a[s-1].trim(),o=n;return i.jsxs("div",{className:zn("group flex items-start py-1 px-2 hover:bg-muted/50 rounded transition-colors border-l-2 border-transparent",(n||r)&&"bg-yellow-500/20 font-bold border-l-yellow-500",o&&"border-t border-t-yellow-500/50 mt-4 pt-2"),children:[i.jsx("div",{className:"w-8 text-xs text-muted-foreground pt-1 select-none text-right mr-3",children:s+1}),i.jsx("div",{className:"relative w-6 h-6 mr-2 flex-shrink-0 flex items-center justify-center",children:n?i.jsx(hl,{size:"icon",variant:"ghost",className:"h-6 w-6 opacity-60 hover:opacity-100 transition-all hover:bg-destructive hover:text-destructive-foreground text-destructive",title:"",onClick:()=>(e=>{const s=[...a];if(""===s[e].trim()){let a=1;e+1<s.length&&s[e+1].trim().startsWith("")&&a++,e>0&&""===s[e-1].trim()&&(s.splice(e-1,1),e--),s.splice(e,a),t(s.join("\n"))}})(s),children:i.jsx(Re,{className:"h-3 w-3"})}):i.jsx(hl,{size:"icon",variant:"ghost",className:"h-6 w-6 opacity-0 group-hover:opacity-100 transition-all hover:bg-primary hover:text-primary-foreground",title:"",onClick:()=>(e=>{const s=[...a];s.splice(e,0,"","",` ${e+1}`,""),t(s.join("\n"))})(s),children:i.jsx(O,{className:"h-3 w-3"})})}),i.jsx("div",{className:"flex-1 whitespace-pre-wrap break-all text-sm leading-6",children:e||i.jsx("span",{className:"text-muted-foreground/30 italic h-6 block"})})]},s)})})})]})}function dc({children:e,value:t,placeholder:a,completeButtonLabel:s,loading:r,onChange:o,onChangeTemplate:l,onComplete:c}){const d=n.useMemo(()=>!!r,[r]),{customTemplates:h}=ko(),[m,u]=n.useState("edit"),p=n.useMemo(()=>[{name:"",value:""},...h.map(e=>({name:e.name,value:e.name}))],[h]);return i.jsxs("div",{className:"space-y-4 w-full",children:[i.jsxs("div",{className:"flex justify-between items-center",children:[i.jsx($o,{children:""}),i.jsxs("div",{className:"flex gap-2",children:[i.jsxs(hl,{variant:"edit"===m?"secondary":"ghost",size:"sm",onClick:()=>u("edit"),children:[i.jsx(ie,{className:"w-4 h-4 mr-1"})," "]}),i.jsxs(hl,{variant:"split"===m?"secondary":"ghost",size:"sm",onClick:()=>u("split"),children:[i.jsx(qa,{className:"w-4 h-4 mr-1"})," "]})]})]}),"edit"===m?i.jsx(oc,{value:t,onChange:e=>{o(e.target.value)},placeholder:a,className:"min-h-[400px]",disabled:d}):i.jsx(cc,{value:t,onChange:o}),i.jsxs("div",{className:"flex items-center justify-between",children:[e||i.jsx(lc,{disabled:d,onFileSelect:async e=>{const t=await e.text();o(t)},accept:".txt"}),i.jsxs("div",{className:"flex items-center space-x-6",children:[l&&i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx("span",{className:"text-sm",children:":"}),i.jsxs(Bl,{onValueChange:l,defaultValue:p[0].name,children:[i.jsx(El,{className:"flex-1 min-w-[150px]",children:i.jsx(Ul,{placeholder:""})}),i.jsx(Ol,{children:p.map(e=>i.jsx(Ql,{value:e.name,children:e.name},e.name))})]})]}),i.jsxs(hl,{onClick:()=>{c(t)},disabled:d,children:[r&&i.jsx(es,{className:"animate-spin mr-1"}),r||s||""]})]})]})]})}function hc({url:e,className:t}){const[a,s]=n.useState(!1),r=n.useRef(null);return i.jsxs("div",{className:zn("w-full aspect-[1/1] flex justify-center items-center cursor-pointer relative",t),children:[i.jsx("audio",{ref:r,src:e,className:"hidden"}),i.jsx(hl,{onClick:e=>{e.stopPropagation(),r.current&&(a?r.current.pause():r.current.play(),s(!a))},variant:"outline",size:"icon",className:"w-12 h-12",children:a?i.jsx(ts,{className:"h-6 w-6"}):i.jsx(as,{className:"h-6 w-6"})})]})}function mc({url:e,className:t}){return i.jsx("div",{className:zn("w-full h-full cursor-pointer flex justify-center items-center relative",t),style:{backgroundImage:'url(\'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20"><rect width="10" height="10" fill="%23ccc"/><rect x="10" y="10" width="10" height="10" fill="%23ccc"/></svg>\')'},children:e&&i.jsx("img",{src:e,className:"absolute left-0 top-0 h-full w-full object-contain"})})}function uc({fontName:e,fontUrl:t,className:a}){const s=n.useMemo(()=>e||(t?`font-${Date.now()}`:void 0),[e,t]);return n.useEffect(()=>{if(e)return;const a=document.createElement("style");return a.innerHTML=`\n      @font-face {\n        font-family: '${s}';\n        src: url('${t}');\n      }\n    `,document.head.appendChild(a),()=>{e||document.head.removeChild(a)}},[s,e,t]),i.jsxs("div",{className:zn("w-full aspect-[1/1] flex flex-col justify-center items-center relative",a),style:{fontFamily:s},children:[i.jsx("span",{children:""}),i.jsx("span",{children:"Sample Text"}),i.jsx("span",{children:"0123456789"})]})}function pc({url:e,className:t}){return i.jsx("video",{src:e,className:zn("w-full h-full",t),controls:!0,muted:!0})}oc.displayName="Textarea";const xc={[io.Background]:"240px",[io.Character]:"135px",[io.Thing]:"200px",[io.Dialog]:"240px",[io.Audio]:"150px",[io.Font]:"150px"},fc={[io.Background]:"aspect-[16/9]",[io.Character]:"aspect-[9/16]",[io.Thing]:"aspect-[1/1]",[io.Dialog]:"aspect-[16/3]"};function gc({type:e,url:t,ext:a,state:s}){const r=n.useMemo(()=>t||(s&&s.id?po(s):""),[t,s]),o=n.useMemo(()=>a||(s?s.ext:""),[a,s]);return Object.keys(fc).includes(e)?"mp4"===o?i.jsx(pc,{url:r,className:fc[e]}):i.jsx(mc,{url:r,className:fc[e]}):e===io.Audio?i.jsx(hc,{url:r}):e===io.Font?i.jsx(uc,{fontName:s?.name,fontUrl:r}):null}function vc({type:e,state:t,children:a,onSelect:s}){return i.jsx(Rr,{className:"rounded-md cursor-pointer",style:{width:xc[e]},onClick:s,children:a||i.jsxs(i.Fragment,{children:[i.jsx(Lr,{className:"p-2 flex justify-center",children:i.jsx(gc,{type:e,state:t})}),i.jsx(Ir,{className:"font-medium p-2 pt-0 flex justify-center text-sm break-all",children:t.name})]})})}function bc({asset:e,onSelect:t,onEdit:a,onDelete:s}){return i.jsxs(Rr,{className:"rounded-md",children:[i.jsx(Lr,{className:"p-0 flex justify-center cursor-pointer",onClick:t,children:i.jsx(Fr.folder,{className:"w-[120px] h-[120px] text-neutral-600 p-2"})}),i.jsxs(Ir,{className:"w-[120px] font-medium p-2 pt-0 flex justify-between text-sm",children:[i.jsx("div",{className:"max-w-[100px] overflow-hidden text-ellipsis cursor-pointer",onClick:t,children:e.name}),i.jsxs(Yr,{children:[i.jsx(Hr,{children:i.jsx(Fr.more,{className:"w-4 h-4 pointer"})}),i.jsxs(Er,{children:[i.jsx(Jr,{onClick:a,children:""}),e.id!==no&&i.jsx(Jr,{className:"text-destructive",onClick:s,children:""})]})]})]})]})}function wc({isOpen:e,type:t,onClose:a}){const s=Wr(e=>e.editor),r=Wr(e=>e.project),o=Wr(e=>e.setProject),[l,c]=n.useState([]),[d,h]=n.useState(""),{toast:m}=Cl(),[u,p]=n.useState(null),[x,f]=n.useState(null),[g,v]=n.useState(""),[b,w]=n.useState(""),[y,j]=n.useState(""),[k,N]=n.useState(1),{selectAsset:S}=So(),[C,Z]=n.useState("");n.useEffect(()=>{if("ai"===t&&N(1),"formatter"===t){N(2);const e=localStorage.getItem("vnve_import_text");e&&(w(e),localStorage.removeItem("vnve_import_text"),m({title:" Story Painter "}))}},[t]);const G=()=>{a(),c([]),h(""),p(null),f(null),v(""),w("")},V=async e=>{h("");try{const t=Yn(e);await T(t?.scenes?t.scenes:function(e){const t=e.split(/\n\s*\n/).filter(e=>""!==e.trim()).map(e=>{const[t,...a]=e.split("\n");return{name:t,value:a.join("\n")}}),a=[];return t.forEach(e=>{if(""===e.name)a.push({name:e.value,background:{name:"",state:""},dialogues:[]});else if(/(\[.+\])?/.test(e.name)){const t=e.name.match(/(\[.+\])?/)[1]?.replace(/\[|\]/g,"");a[a.length-1]||a.push({name:"",type:t,background:{name:"",state:""},dialogues:[]}),a[a.length-1].type=t,a[a.length-1].background=Lo(e.value)}else a[a.length-1]||a.push({name:"",background:{name:"",state:""},dialogues:[]}),a[a.length-1].dialogues.push({character:Lo(e.name),line:e.value})}),a}(e))}catch(t){m({title:"",description:t.message,variant:"destructive"}),console.error(t)}finally{h("")}},W=async(e,t)=>{h("convert"===e?"":"");try{let a;a="convert"===e?await async function(e){const t=`${e}`;return await rc(' JSON \n\n1.\t Typescript \n\n```typescript\ninterface StoryCharacter {\n  /**\n   * \n   */\n  name: string;\n  /**\n   * \n   */\n  state: string;\n}\n\ninterface StoryDialogue {\n  /**\n   *  3  3 \n   */\n  character: StoryCharacter;\n  /**\n   * \n   */\n  line: string;\n}\n\ninterface StoryBackground {\n  /**\n   * \n   */\n  name: string;\n  /**\n   * \n   */\n  state: string;\n}\n\nexport interface StoryScene {\n  /**\n   * \n   */\n  name: string;\n  /**\n   * \n   */\n  background: StoryBackground;\n  /**\n   * \n   */\n  dialogues: StoryDialogue[];\n}\n```\n\n2.\t\n JSON  StoryScene \n```json\n{\n  "scenes": [{\n    "name": "",\n    "background": {\n      "name": "",\n      "state": ""\n    },\n    "dialogues": [{\n      "character": {\n        "name": "",\n        "state": ""\n      },\n      "line": ""\n    }{\n      "character": {\n        "name": "",\n        "state": ""\n      },\n      "line": ""\n    }, {\n      "character": {\n        "name": "",\n        "state": ""\n      },\n      "line": ""\n    }]\n  }, {\n    "name": "",\n    "background": {\n      "name": "",\n      "state": ""\n    },\n    "dialogues": [{\n      "character": {\n        "name": "",\n        "state": ""\n      },\n      "line": ""\n    }]\n  }]\n}\n```\n',t)}(t):await async function(e){const t=`${e}`;return await rc(' JSON \n\n1.\t Typescript \n\n```typescript\ninterface StoryCharacter {\n  /**\n   * \n   */\n  name: string;\n  /**\n   * \n   */\n  state: string;\n}\n\ninterface StoryDialogue {\n  /**\n   *  3  3 \n   */\n  character: StoryCharacter;\n  /**\n   * \n   */\n  line: string;\n}\n\ninterface StoryBackground {\n  /**\n   * \n   */\n  name: string;\n  /**\n   * \n   */\n  state: string;\n}\n\nexport interface StoryScene {\n  /**\n   * \n   */\n  name: string;\n  /**\n   * \n   */\n  background: StoryBackground;\n  /**\n   * \n   */\n  dialogues: StoryDialogue[];\n}\n```\n\n2.\t\n JSON  StoryScene \n```json\n{\n  "scenes": [{\n    "name": "",\n    "background": {\n      "name": "",\n      "state": ""\n    },\n    "dialogues": [{\n      "character": {\n        "name": "",\n        "state": ""\n      },\n      "line": ""\n    },{\n      "character": {\n        "name": "",\n        "state": ""\n      },\n      "line": ""\n    }, {\n      "character": {\n        "name": "",\n        "state": ""\n      },\n      "line": ""\n    }]\n  }, {\n    "name": "",\n    "background": {\n      "name": "",\n      "state": ""\n    },\n    "dialogues": [{\n      "character": {\n        "name": "",\n        "state": ""\n      },\n      "line": ""\n    }]\n  }]\n}\n```\n',t)}(t);const s=function(e){const t=(e,t)=>t?`${e}[${t}]`:e;return e.map(e=>{const a=[];return e.name&&a.push(`\n${e.name}`),a.push(`\n${t(e.background.name,e.background.state)}`),e.dialogues.forEach(e=>{const{name:s,state:n}=e.character;a.push(`${t(s,n)}\n${e.line}`)}),a.join("\n\n")}).join("\n\n\n")}(a);w(s),N(k+1)}catch(a){m({title:("convert"===e?"":"")+"",description:a.message,variant:"destructive"})}finally{h("")}},T=async e=>{c(e);const t=await async function(e){const t=new Set,a=new Set;e.forEach(e=>{e.dialogues.forEach(e=>{""!==e.character.name&&t.add(e.character.name)}),a.add(e.background.name)});const s={},n={};for(const i of t)s[i]=await vo(i,void 0,io.Character);for(const i of a)n[i]=await vo(i,void 0,io.Background);return{characterAssetMap:s,backgroundAssetMap:n}}(e);p(t.characterAssetMap),f(t.backgroundAssetMap),N(k+1)},X=()=>{Object.keys(u).some(e=>!u[e])?m({title:"",variant:"destructive"}):N(k+1)},R=async()=>{if(Object.keys(x).some(e=>!x[e]))m({title:"",variant:"destructive"});else if(r||y){h("");try{if(!r){const e={name:y,content:"",time:Date.now()},t=await uo.add(e);o({id:t,...e}),s.clear()}await async function(e,t,a,s,n){for(const r of e){let e;const o=r.type??n;if(o){let t={"":Vr,"":Gr,"":Zr}[o];if(!t)try{const e=await mo.where("name").equals(o).first(),a=await Ti.fromJSON(JSON.parse(e.content),!1);t=()=>a}catch(i){console.error("",i),t=Zr}e=t()}else e=Zr();if(e.label=r.name,t.addScene(e),t.setActiveScene(e),r.background){const{name:e,state:a}=r.background,n=s[e];if(n){const s=Io(n,a);n.name=e,n.stateId=s.id;const i=await Wo(n,t);t.addChild(i)}}let l=1;const c=new Set;r.dialogues.forEach(e=>{const{name:t}=e.character;""!==t&&c.add(t)});const d=c.size;for(const s of r.dialogues){const n={targetName:"",speakerTargetName:"",name:""};let i;if(""===s.character.name)n.speakerTargetName="Narrator";else{const{name:r,state:o}=s.character,c=a[r];if(c){const a=e.getChildByLabel(r);if(a){if(n.speakerTargetName=a.name,n.name=a.label,o&&c.states.find(e=>e.name===o)){const e=Io(c,o);i={type:"directive",value:{directive:"ChangeSource",params:{targetName:a.name,source:po(e)},label:`:${a.label}:${o}`},children:[{text:""}]}}}else{const e=Io(c,o);c.stateId=e.id,c.name=r;const a=await Wo(c,t);a.x=t.options.width/(d+1)*l-a.width/2,l++,t.addChild(a),n.speakerTargetName=a.name,n.name=a.label}}else n.name=r}let r=[];i&&(r=[{text:""},i,{text:""}]),t.addDialogue({speak:{speaker:n},lines:[{type:"p",children:[...r,{text:s.line}]}]})}}}(l,s,u,x,C),G()}catch(e){m({title:"",description:e.message,variant:"destructive"})}finally{h("")}}else m({title:"",variant:"destructive"})},L=()=>{localStorage.setItem("vnve_script_draft",b),m({title:"",description:""})},I=()=>{const e=localStorage.getItem("vnve_script_draft");e?(w(e),m({title:"",description:""})):m({title:"",description:"",variant:"destructive"})},z=[()=>i.jsxs(i.Fragment,{children:[i.jsxs(Po,{children:[i.jsxs(Ao,{className:"flex items-center gap-2",children:[i.jsx(Fr.sparkles,{className:"size-5"}),""]}),i.jsx(Qo,{})]}),i.jsxs(_l,{defaultValue:"convert",children:[i.jsxs($l,{className:"grid w-full grid-cols-2",children:[i.jsx(ql,{value:"convert",disabled:!!d,children:""}),i.jsx(ql,{value:"generate",disabled:!!d,children:""})]}),i.jsx(ec,{value:"convert",children:i.jsx(dc,{value:g,onChange:v,placeholder:"",loading:d,onComplete:e=>W("convert",e)})}),i.jsx(ec,{value:"generate",children:i.jsx(dc,{value:g,onChange:v,placeholder:"",loading:d,onComplete:e=>W("generate",e)})})]})]}),()=>i.jsx(i.Fragment,{children:i.jsxs(Po,{children:[i.jsx(Ao,{className:"flex items-center gap-2",children:""}),i.jsx(Qo,{}),!r&&i.jsxs("div",{className:"grid w-full items-center gap-1.5 mb-2",children:[i.jsx($o,{htmlFor:"projectName",children:""}),i.jsx(cl,{id:"projectName",value:y,onChange:e=>j(e.target.value),placeholder:""})]}),i.jsx(dc,{value:b,placeholder:"",loading:d,onChange:w,onComplete:V,onChangeTemplate:Z,children:i.jsxs("div",{className:"flex gap-2",children:[i.jsx(hl,{variant:"outline",onClick:I,children:""}),i.jsx(hl,{variant:"outline",onClick:L,children:""}),"ai"===t&&i.jsx(hl,{variant:"outline",onClick:()=>N(k-1),children:""})]})})]})}),()=>i.jsxs(i.Fragment,{children:[i.jsxs(Po,{children:[i.jsx(Ao,{className:"flex items-center gap-2",children:""}),i.jsx(Qo,{children:""})]}),i.jsxs(zr,{children:[i.jsx("div",{className:"flex gap-1 pb-4",children:Object.keys(u).map(e=>{const t=u[e];let a={name:e,id:0,ext:""};return t&&(a={...t.states.find(e=>e.id===t.stateId)||t.states[0],name:e}),i.jsxs("div",{className:"relative group",children:[i.jsx(vc,{type:io.Character,state:a,onSelect:()=>(async e=>{const t=await S(io.Character);t&&p({...u,[e]:t})})(e)}),i.jsx(hl,{variant:"destructive",size:"icon",className:"absolute -top-1 -right-1 h-6 w-6 rounded-md shadow-md border border-white/50 opacity-0 group-hover:opacity-100 transition-all duration-200 hover:scale-110 z-20",title:"",onClick:t=>{t.stopPropagation(),(e=>{const t={...u};delete t[e],p(t)})(e)},children:i.jsx(oe,{className:"h-3 w-3"})})]},e)})}),i.jsx(Kr,{orientation:"horizontal"})]}),i.jsxs("div",{className:"flex justify-between",children:[i.jsx(hl,{variant:"outline",onClick:()=>N(k-1),children:""}),i.jsx(hl,{onClick:X,children:""})]})]}),()=>i.jsxs(i.Fragment,{children:[i.jsxs(Po,{children:[i.jsx(Ao,{className:"flex items-center gap-2",children:""}),i.jsx(Qo,{children:""})]}),i.jsxs(zr,{children:[i.jsx("div",{className:"flex gap-1 pb-4",children:Object.keys(x).map(e=>{const t=x[e];let a={name:e,id:0,ext:""};return t&&(a={...t.states.find(e=>e.id===t.stateId)||t.states[0],name:e}),i.jsx(vc,{type:io.Background,state:a,onSelect:()=>(async e=>{if(d)return;const t=await S(io.Background);t&&f({...x,[e]:t})})(e)},e)})}),i.jsx(Kr,{orientation:"horizontal"})]}),i.jsxs("div",{className:"flex justify-between",children:[i.jsx(hl,{variant:"outline",disabled:!!d,onClick:()=>N(k-1),children:""}),i.jsxs(hl,{disabled:!!d,onClick:R,children:[d&&i.jsx(es,{className:"animate-spin mr-1"}),d||""]})]})]})];return i.jsx(Do,{open:e,onOpenChange:G,children:i.jsx(Jo,{className:"min-w-[70vw]",onPointerDownOutside:e=>e.preventDefault(),children:k>0&&z[k-1]()})})}var yc=(e=>(e.Animation="Animation",e.Sound="Sound",e.Util="Util",e.Filter="Filter",e.Transition="Transition",e))(yc||{});const jc={[fr.Speak]:"",[fr.Speaker]:"",[fr.ChangeSource]:"",[fr.Show]:"",[fr.Hide]:"",[fr.FadeIn]:"",[fr.FadeOut]:"",[fr.ShakeX]:"",[fr.ShakeY]:"",[fr.ZoomIn]:"",[fr.ZoomOut]:"",[fr.EnterFromLeft]:"",[fr.LeaveFromLeft]:"",[fr.EnterFromRight]:"",[fr.LeaveFromRight]:"",[fr.Play]:"",[fr.Pause]:"",[fr.Stop]:"",[fr.Wait]:"",[fr.FadeInTransition]:"",[fr.AddFilter]:"",[fr.RemoveFilter]:""},kc=[fr.ChangeSource,fr.Show,fr.Hide,fr.FadeIn,fr.FadeOut,fr.ShakeX,fr.ShakeY,fr.ZoomIn,fr.ZoomOut,fr.EnterFromLeft,fr.LeaveFromLeft,fr.EnterFromRight,fr.LeaveFromRight],Nc=kc.map(e=>({name:jc[e],value:e})),Sc=[fr.Play,fr.Pause,fr.Stop],Cc=Sc.map(e=>({name:jc[e],value:e})),Zc=[fr.Wait],Gc=[fr.AddFilter,fr.RemoveFilter],Vc=[fr.FadeInTransition],Wc=[{name:"",type:"Animation",options:Nc},{name:"",type:"Sound",options:Cc},{name:"",type:"Util",options:Zc.map(e=>({name:jc[e],value:e}))},{name:"",type:"Filter",options:Gc.map(e=>({name:jc[e],value:e}))},{name:"",type:"Transition",options:Vc.map(e=>({name:jc[e],value:e}))}],Tc=[{name:"",value:"BlackMaskFilter"},{name:"",value:"BlurFilter"},{name:"",value:"NoiseFilter"},{name:"",value:"OldFilmFilter"},{name:"",value:"VignetteFilter"}];function Xc(){const e=Wr(e=>e.initEditor),t=Wr(e=>e.project),a=Wr(e=>e.editor),s=Wr(e=>e.activeScene),r=Wr(e=>e.scenes),{selectAsset:o}=So(),l=n.useRef(null),c=n.useRef(null),{defaultTemplates:d,customTemplates:h,handleAddDefaultTemplate:m,handleAddCustomTemplate:u}=ko(),[p,x]=n.useState(!1),[f,g]=n.useState(!1),[v,b]=n.useState(!1),[w,y]=n.useState(!1),[j,k]=n.useState(!1),[N,S]=n.useState(!1),[C,Z]=n.useState(!1),G=n.useRef(null),[V,W]=n.useState([]),[T,X]=n.useState(null),R=n.useRef(null),[L,I]=n.useState([]),[z,K]=n.useState({value:0,currentTime:0}),F=n.useRef(0),[Y,H]=n.useState(""),{toast:M}=Cl(),{showLoading:B,hideLoading:D}=Ml(),{isOpenText2Scene:U,text2SceneType:E,handleOpenImportText2Scene:J,handleOpenAiText2Scene:P,handleCloseText2Scene:O}=function(){const[e,t]=n.useState(!1),[a,s]=n.useState();return{isOpenText2Scene:e,text2SceneType:a,handleOpenImportText2Scene:()=>{t(!0),s("formatter")},handleOpenAiText2Scene:()=>{t(!0),s("ai")},handleCloseText2Scene:()=>{t(!1)}}}(),A=ic("(min-width: 768px)"),Q=()=>{K({value:0,currentTime:0})},_=()=>{const e=l.current,t=c.current;if(e&&t){const a=e.clientWidth,s=e.clientHeight,n=16/9;let i=a,r=a/n;r>s&&(r=s,i=s*n),t.style.width=`${i}px`,t.style.height=`${r}px`}},$=n.useCallback(async e=>{try{const s=new Date;await uo.update(t.id,{content:a.saveAsJSON(),time:s.getTime()}),H(s.toLocaleString()),e||M({title:"",duration:1500})}catch(s){M({title:"",description:s.message,variant:"destructive"})}},[M,a,t]),q=e=>async()=>{const t=await o(e);if(t){const e=await Wo(t,a);a.addChild(e)}},ee=e=>"custom"===e.type?`${e.errorSceneName}${e.errorLines?`${e.errorLines}`:""}${jc[e.errorDirectiveName]}`:e.message,te=async(e=0,t)=>{Q(),W([e,t]),k(!0);const s=await a.exportScreenplay(e,t),n=new Nr({canvas:G.current.getPreviewCanvas(),width:1920,height:1080,fps:30,disableAudio:Ro()});R.current.connect(n),R.current.action(s).then(()=>{console.log("")}).catch(e=>{k(!1),M({title:"",description:ee(e),variant:"destructive"})})},ae=async(e=0,t)=>{Q(),y(!0),X(null);const s=await a.exportScreenplay(e,t),n=new kr({width:1920,height:1080,fps:30,disableAudio:Ro()});R.current.connect(n),R.current.action(s).then(({result:e,subtitles:t})=>{const a=URL.createObjectURL(e);I(t),X(a)}).catch(e=>{y(!1),M({title:"",description:ee(e),variant:"destructive"})})},se=async()=>{k(!1),R.current.hasStarted()&&await R.current.cut()};return n.useEffect(()=>{if(t){const e=setInterval(async()=>{$(!0)},6e4);return()=>{clearInterval(e)}}},[t,$]),n.useEffect(()=>(window.addEventListener("resize",_),_(),e(c.current),R.current=new gr({onProgress(e,t){((e,t)=>{if(e>=100)return K({value:e,currentTime:t}),F.current&&clearTimeout(F.current),void(F.current=0);F.current||(F.current=setTimeout(()=>{K({value:e,currentTime:t}),F.current=0},1e3/30))})(e,t)}}),c.current.onselectstart=function(){return!1},localStorage.getItem("vnve_import_text")&&J(),()=>{window.removeEventListener("resize",_)}),[e]),i.jsxs("div",{className:"flex flex-col gap-2 flex-1",children:[i.jsxs(Fo,{className:"relative z-50",children:[i.jsxs(Ko,{children:[i.jsxs(Yo,{className:"data-[disabled]:text-gray-400",children:[A&&i.jsx(Fr.library,{className:"size-4 mr-0.5"}),""]}),i.jsxs(Ho,{children:[i.jsx(Mo,{onClick:()=>x(!0),children:""}),i.jsx(Mo,{onClick:()=>g(!0),children:"..."}),i.jsx(Mo,{disabled:!t,onClick:()=>$(),children:""}),Y&&i.jsxs(Mo,{className:"text-muted-foreground",children:["",Y]}),i.jsx(Bo,{}),i.jsx(Mo,{onClick:async()=>{try{await async function(){const e=await lo.export(),t=URL.createObjectURL(e);Kn("book",t,"vnve"),URL.revokeObjectURL(t)}()}catch(e){M({title:"",description:e.message,variant:"destructive"})}},children:"..."}),i.jsx(Mo,{onClick:async()=>{B("");try{await bo()}catch(e){M({title:"",description:e.message,variant:"destructive"})}finally{D()}},children:"..."})]})]}),i.jsxs(Ko,{children:[i.jsxs(Yo,{className:"data-[disabled]:text-gray-400",children:[A&&i.jsx(Fr.fileText,{className:"size-4 mr-0.5"}),""]}),i.jsx(Ho,{children:i.jsx(Mo,{onClick:()=>{const e=localStorage.getItem("vnve_script_draft");e?(localStorage.setItem("vnve_import_text",e),J()):M({title:"",description:"",variant:"destructive"})},children:""})})]}),i.jsxs(Ko,{children:[i.jsxs(Yo,{className:"data-[disabled]:text-gray-400",disabled:!t,children:[A&&i.jsx(Fr.scene,{className:"size-4 mr-0.5"}),""]}),i.jsxs(Ho,{children:[d.map(e=>i.jsxs(Mo,{onClick:m(e.content),children:["",e.name]},e.name)),h.length>0&&i.jsx(Bo,{}),h.map(e=>i.jsxs(Mo,{onClick:()=>u(e.content),children:["",e.name]},e.id)),i.jsx(Bo,{}),i.jsx(Mo,{onClick:J,children:"..."}),i.jsx(Mo,{onClick:P,children:"..."}),i.jsx(Bo,{}),i.jsx(Mo,{onClick:()=>b(!0),children:"..."})]})]}),i.jsxs(Ko,{children:[i.jsxs(Yo,{className:"data-[disabled]:text-gray-400",disabled:!t,children:[A&&i.jsx(Fr.images,{className:"size-4 mr-0.5"}),""]}),i.jsxs(Ho,{children:[i.jsx(Mo,{disabled:!s,onClick:q(io.Character),children:""}),i.jsx(Mo,{disabled:!s,onClick:q(io.Background),children:""}),i.jsx(Mo,{disabled:!s,onClick:q(io.Thing),children:""}),i.jsx(Mo,{disabled:!s,onClick:()=>{const e=function(e){const t=new xi("",{fill:16777215,breakWords:!0,wordWrap:!0,wordWrapWidth:1600,fontSize:60,leading:15});return t.x=e.options.width/2-t.width/2,t.y=e.options.height/2-t.height/2,t.zIndex=Sr.Text,t.label=""+t.name,t}(a);a.addChild(e)},children:""}),i.jsx(Bo,{}),i.jsx(Mo,{onClick:async()=>{B("");try{await async function(){const e=await window.showDirectoryPicker();for(const t of ro){const a=await e.getDirectoryHandle(t.name).catch(()=>{});if(a)for await(const[e,s]of a.entries())if("directory"===s.kind){const a=await co.add({name:e,type:t.value,states:[]});for await(const[,e]of s.entries())if("file"===e.kind){const s=await e.getFile(),{name:n,ext:i}=Fn(s);if(fo(t.value).includes(i)){const e=await ho.add({mime:s.type,blob:s,ext:i});await co.where("id").equals(a).modify(t=>{t.states.push({id:e,name:n,ext:i})})}}}}}()}catch(e){M({title:"",description:e.message,variant:"destructive"}),console.error(e)}finally{D()}},children:"..."}),i.jsx(Mo,{onClick:()=>o(void 0,!0),children:"..."}),i.jsx(Mo,{className:"text-destructive",onClick:()=>S(!0),children:""})]})]}),i.jsxs(Ko,{children:[i.jsxs(Yo,{disabled:0===r.length,className:"data-[disabled]:text-gray-400",children:[A&&i.jsx(Fr.preview,{className:"size-4 mr-0.5"}),""]}),i.jsxs(Ho,{children:[i.jsx(Mo,{disabled:!s,onClick:()=>{const e=a.getActiveSceneIndex();te(e,e+1)},children:""}),i.jsx(Mo,{disabled:!s,onClick:()=>te(a.getActiveSceneIndex()),children:""}),i.jsx(Mo,{onClick:()=>te(),children:""})]})]}),i.jsxs(Ko,{children:[i.jsxs(Yo,{disabled:0===r.length,className:"data-[disabled]:text-gray-400",children:[A&&i.jsx(Fr.download,{className:"size-4 mr-0.5"}),""]}),i.jsxs(Ho,{children:[i.jsx(Mo,{disabled:!s,onClick:()=>{const e=a.getActiveSceneIndex();ae(e,e+1)},children:""}),i.jsx(Mo,{disabled:!s,onClick:()=>ae(a.getActiveSceneIndex()),children:""}),i.jsx(Mo,{onClick:()=>ae(),children:""})]})]}),i.jsx(Ko,{children:i.jsxs(Yo,{className:"data-[disabled]:text-gray-400",onClick:()=>Z(!0),children:[A&&i.jsx(Fr.settings,{className:"size-4 mr-0.5"}),""]})})]}),i.jsx(Rr,{className:"flex-1 rounded-md relative",children:i.jsx(Lr,{className:"relative h-full p-2",children:i.jsx("div",{className:"w-full h-full flex justify-center items-center",ref:l,children:i.jsx("canvas",{className:"shadow border border-b",ref:c})})})}),f&&i.jsx(Vl,{isOpen:f,onClose:()=>g(!1)}),v&&i.jsx(pl,{isOpen:v,onClose:()=>b(!1)}),w&&i.jsx(fl,{progress:z,url:T,subtitles:L,isOpen:w,onClose:()=>{y(!1),R.current.hasStarted()&&R.current.cut(),T&&URL.revokeObjectURL(T),X(null)}}),j&&i.jsx(gl,{progress:z,ref:G,isOpen:j,onReplay:async()=>{R.current.hasStarted()&&await R.current.cut(),te(...V)},onClose:se,onExport:async()=>{await se(),ae(...V)}}),p&&i.jsx(Gl,{isOpen:p,onClose:()=>x(!1)}),N&&i.jsx(Hl,{isOpen:N,onConfirm:async()=>{await async function(){await ho.clear(),await co.clear()}(),M({title:"",duration:1500})},onClose:()=>S(!1)}),C&&i.jsx(nc,{isOpen:C,onClose:()=>Z(!1)}),U&&i.jsx(wc,{isOpen:U,type:E,onClose:O})]})}function Rc(){const e=Wr(e=>e.editor),t=Wr(e=>e.activeChild),a=Wr(e=>e.activeScene),s=n.useMemo(()=>{if(!a)return[];const e=[],t=[],s=[],n=[],i=a.sounds;for(const r of a.children)r.assetType===io.Character?e.push(r):r.assetType===io.Background?s.push(r):r.assetType===io.Thing?t.push(r):r.name&&n.push(r);return[{label:"",children:e},{label:"",children:t},{label:"",children:s},{label:"",children:n},{label:"",children:i}]},[a]),r=t=>{e.toggleChildVisibleByName(t.name)},o=t=>{e.toggleChildInteractiveByName(t.name)};return i.jsx(zr,{className:"h-full pr-2",children:i.jsx("div",{className:"space-y-4",children:s.map(a=>a.children.length>0&&i.jsxs("fieldset",{className:"rounded-md border p-2",children:[i.jsx("legend",{className:"-ml-1 px-1 text-sm font-medium",children:a.label}),i.jsx("div",{className:"flex flex-col gap-1",children:a.children.map(a=>i.jsx("div",{className:"text-sm p-1 px-2 border rounded "+(t?.name===a.name?"bg-muted":""),children:i.jsxs("div",{className:"flex justify-between items-center",children:[i.jsx("div",{onClick:()=>(t=>{t.assetType!==io.Audio&&e.setActiveChildByName(t.name)})(a),className:"cursor-pointer flex-1",children:a.label}),i.jsxs("div",{className:"flex space-x-2 items-center",children:[a.assetType!==io.Audio&&i.jsxs(i.Fragment,{children:[a.visible?i.jsx(Fr.viewing,{onClick:()=>r(a),className:"size-4 cursor-pointer"}):i.jsx(Fr.viewingOff,{onClick:()=>r(a),className:"size-4 cursor-pointer"}),a.interactive?i.jsx(Fr.lockOpen,{onClick:()=>o(a),className:"size-4 cursor-pointer"}):i.jsx(Fr.lock,{onClick:()=>o(a),className:"size-4 cursor-pointer"})]}),i.jsx(Fr.trash2,{onClick:()=>(a=>{a.assetType!==io.Audio?(e.removeChildByName(a.name),t?.name===a.name&&e.setActiveChild(void 0)):e.removeSoundByName(a.name)})(a),className:"size-4 cursor-pointer hover:text-destructive"})]})]})},a.name))})]},a.label))})})}const Lc=n.forwardRef(({className:e,showPercentage:t=!1,value:a,...s},n)=>{const r=Array.isArray(a)?a[0]:a,o=void 0!==r?`${Math.round(100*r)}%`:"";return i.jsxs("div",{className:"relative flex w-full items-center gap-2",children:[i.jsxs(ss,{ref:n,value:a,className:zn("relative flex w-full touch-none select-none items-center",e),...s,children:[i.jsx(ns,{className:"relative h-1.5 w-full grow overflow-hidden rounded-full bg-primary/20",children:i.jsx(is,{className:"absolute h-full bg-primary"})}),i.jsx(rs,{className:"block h-4 w-4 rounded-full border border-primary/50 bg-background shadow transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50"})]}),t&&i.jsx("span",{className:"min-w-[36px] text-sm text-muted-foreground",children:o})]})});function Ic(){const e=Wr(e=>e.editor),t=Wr(e=>e.activeChild),a=(t,a)=>s=>{e.updateActiveChild(e=>{e[t]="number"===a?Number(s.target.value):s.target.value})};return i.jsxs("div",{className:"flex flex-col gap-3",children:[i.jsxs("div",{className:"flex gap-2",children:[i.jsxs("div",{className:"flex-1 flex gap-1 items-center",children:[i.jsx($o,{className:"w-5",children:""}),i.jsx(cl,{value:t.width.toFixed(0),onChange:a("width","number"),type:"number",min:0,step:10,className:"h-6"})]}),i.jsxs("div",{className:"flex-1 flex gap-1 items-center",children:[i.jsx($o,{className:"w-5",children:""}),i.jsx(cl,{value:t.height.toFixed(0),onChange:a("height","number"),type:"number",min:0,step:10,className:"h-6"})]})]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsxs("div",{className:"flex-1 flex gap-1 items-center",children:[i.jsx($o,{className:"w-5",children:"X"}),i.jsx(cl,{value:t.x.toFixed(0),onChange:a("x","number"),type:"number",min:0,step:10,className:"h-6"})]}),i.jsxs("div",{className:"flex-1 flex gap-1 items-center",children:[i.jsx($o,{className:"w-5",children:"Y"}),i.jsx(cl,{value:t.y.toFixed(0),onChange:a("y","number"),type:"number",min:0,step:10,className:"h-6"})]})]}),i.jsxs("div",{className:"flex-1 flex gap-1 items-center",children:[i.jsx($o,{className:"flex-shrink-0 mr-2",children:""}),i.jsx(Lc,{min:0,max:1,step:.1,value:[t.alpha],onValueChange:t=>{return(a="alpha",t=>{e.updateActiveChild(e=>{e[a]=t})})(t[0]);var a},showPercentage:!0})]})]})}Lc.displayName=ss.displayName;const zc=cs,Kc=ds,Fc=n.forwardRef(({className:e,align:t="center",sideOffset:a=4,...s},n)=>i.jsx(os,{children:i.jsx(ls,{ref:n,align:t,sideOffset:a,className:zn("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...s})}));Fc.displayName=ls.displayName;const Yc=n.forwardRef(({disabled:e,value:t,onChange:a,onBlur:s,name:r,className:o,...l},c)=>{const d=function(e){const t=n.useRef(null);return n.useEffect(()=>{e&&("function"==typeof e?e(t.current):e.current=t.current)}),t}(c),[h,m]=n.useState(!1),u=n.useMemo(()=>t||"#FFFFFF",[t]);return i.jsxs(zc,{onOpenChange:m,open:h,children:[i.jsx(Kc,{asChild:!0,disabled:e,onBlur:s,children:i.jsx(hl,{...l,className:zn("block",o),name:r,onClick:()=>{m(!0)},size:"icon",style:{backgroundColor:u},variant:"outline",children:i.jsx("div",{})})}),i.jsxs(Fc,{className:"w-full",children:[i.jsx(hs,{color:u,onChange:a}),i.jsx(cl,{className:"mt-2",maxLength:7,onChange:e=>{a(e?.currentTarget?.value)},ref:d,value:u})]})]})});Yc.displayName="ColorPicker";const Hc=ca("inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground",{variants:{variant:{default:"bg-transparent",outline:"border border-input bg-transparent shadow-sm hover:bg-accent hover:text-accent-foreground"},size:{default:"h-9 px-3",sm:"h-8 px-2",lg:"h-10 px-3"}},defaultVariants:{variant:"default",size:"default"}});n.forwardRef(({className:e,variant:t,size:a,...s},n)=>i.jsx(ms,{ref:n,className:zn(Hc({variant:t,size:a,className:e})),...s})).displayName=ms.displayName;const Mc=n.createContext({size:"default",variant:"default"}),Bc=n.forwardRef(({className:e,variant:t,size:a,children:s,...n},r)=>i.jsx(us,{ref:r,className:zn("flex items-center justify-center gap-1",e),...n,children:i.jsx(Mc.Provider,{value:{variant:t,size:a},children:s})}));Bc.displayName=us.displayName;const Dc=n.forwardRef(({className:e,children:t,variant:a,size:s,...r},o)=>{const l=n.useContext(Mc);return i.jsx(ps,{ref:o,className:zn(Hc({variant:l.variant||a,size:l.size||s}),e),...r,children:t})});function Uc(){const e=Wr(e=>e.editor),t=Wr(e=>e.activeChild),a=Ht(()=>co.where("type").equals(io.Font).reverse().toArray()),s=n.useMemo(()=>{const e=[];if(!a)return e;for(const t of a)for(const a of t.states)e.push({ch:a.name,en:a.name});return e},[a]),r=t=>a=>{e.updateActiveChild(e=>{e.style[t]=a})};return i.jsxs("div",{className:"flex flex-col gap-3",children:[!t.disableTextEdit&&i.jsx("div",{className:"flex gap-2",children:i.jsxs("div",{className:"flex-1 flex gap-1 items-center",children:[i.jsx(Fr.bookOpenText,{className:"w-5 h-5"}),i.jsx(cl,{value:t.text,onChange:(o="text",t=>{e.updateActiveChild(e=>{e[o]="number"===l?Number(t.target.value):t.target.value})})})]})}),i.jsxs("div",{className:"flex gap-2",children:[i.jsxs("div",{className:"flex-1 flex gap-1 items-center",children:[i.jsx(Fr.color,{className:"w-5 h-5"}),i.jsx(Yc,{value:t.style.fill,onChange:r("fill"),className:"w-6 h-6"})]}),i.jsx("div",{className:"flex-1 flex gap-1 items-center",children:i.jsxs(Bc,{type:"multiple",value:[t.style.fontWeight,t.style.fontStyle],onValueChange:t=>{e.updateActiveChild(e=>{e.style.fontWeight=t.includes(eo.BOLD)?eo.BOLD:eo.NORMAL,e.style.fontStyle=t.includes(to.ITALIC)?to.ITALIC:to.NORMAL})},children:[i.jsx(Dc,{value:eo.BOLD,className:"p-2",children:i.jsx(Fr.bold,{className:"size-4"})}),i.jsx(Dc,{value:to.ITALIC,className:"p-2",children:i.jsx(Fr.italic,{className:"size-4"})})]})})]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsxs("div",{className:"flex-1 shrink-0 flex gap-1 items-center",children:[i.jsx(Fr.type,{className:"w-5 h-5"}),i.jsxs(Bl,{onValueChange:r("fontFamily"),value:t.style.fontFamily,children:[i.jsx(El,{className:"h-6 max-w-[150px]",children:i.jsx(Ul,{placeholder:"---"})}),i.jsx(Ol,{children:[...s,...qr].map(e=>i.jsx(Ql,{value:e.en,children:e.ch},e.en))})]})]}),i.jsxs("div",{className:"flex-1 shrink-0 flex gap-1 items-center",children:[i.jsx(Fr.fontSize,{className:"w-5 h-5"}),i.jsx(cl,{value:String(t.style.fontSize),onChange:((t,a)=>s=>{e.updateActiveChild(e=>{e.style[t]="number"===a?Number(s.target.value):s.target.value})})("fontSize","number"),type:"number",min:1,step:10,className:"h-6"})]})]})]});var o,l}function Ec(){const e=Wr(e=>e.editor),t=Wr(e=>e.activeChild),{selectAsset:a}=So();return i.jsxs("div",{className:"flex gap-2",children:[i.jsxs("div",{className:"flex-1 flex gap-1 items-center",children:[i.jsx($o,{className:"flex-shrink-0 mr-2",children:""}),i.jsx(Yc,{value:t.fillColor,onChange:t=>{e.updateActiveChild(e=>{const a=e.width,s=e.height;e.fillColor=t,e.clear().beginFill(t).drawRect(0,0,a,s).endFill()})},className:"w-6 h-6"})]}),i.jsx(hl,{size:"sm",onClick:async()=>{const s=await a(io.Dialog),n=await Wo(s,e);e.addChild(n),e.updateActiveScene(e=>{e.config.speak.dialogTargetName=n.name}),e.setActiveChildByName(n.name),e.removeChildByName(t.name)},children:""})]})}function Jc(){const e=Wr(e=>e.activeChild);return i.jsx(zr,{className:"h-full pr-2",children:e&&i.jsxs(i.Fragment,{children:[i.jsxs("fieldset",{className:"rounded-md border p-2",children:[i.jsx("legend",{className:"-ml-1 px-1 text-sm font-medium",children:""}),i.jsx(Ic,{})]}),"Text"===e.type&&i.jsxs("fieldset",{className:"rounded-md border p-2 mt-2",children:[i.jsx("legend",{className:"-ml-1 px-1 text-sm font-medium",children:""}),i.jsx(Uc,{})]}),"Graphics"===e.type&&i.jsxs("fieldset",{className:"rounded-md border p-2 mt-2",children:[i.jsx("legend",{className:"-ml-1 px-1 text-sm font-medium",children:""}),i.jsx(Ec,{})]})]})})}Dc.displayName=ps.displayName;const Pc=fs,Oc=gs,Ac=vs,Qc=n.forwardRef(({className:e,sideOffset:t=4,...a},s)=>i.jsx(xs,{ref:s,sideOffset:t,className:zn("z-50 overflow-hidden rounded-md bg-primary px-3 py-1.5 text-xs text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...a}));function _c(){const e=Wr(e=>e.editor),t=Wr(e=>e.activeChild),a=t=>()=>{switch(t){case"top":e.moveChildToTop();break;case"bottom":e.moveChildToBottom();break;case"up":e.moveUpChild();break;case"down":e.moveDownChild()}},s=t=>()=>{e.setChildPosition(t)};return i.jsx(zr,{className:"h-full pr-2",children:t&&i.jsxs("div",{children:[i.jsxs("fieldset",{className:"rounded-md border p-1",children:[i.jsx("legend",{className:"-ml-1 px-1 text-sm font-medium",children:""}),i.jsxs("div",{className:"flex justify-between items-center",children:[i.jsxs("div",{children:[i.jsx(hl,{size:"sm",variant:"ghost",onClick:a("top"),children:""}),i.jsx(hl,{size:"sm",variant:"ghost",onClick:a("up"),children:""}),i.jsx(hl,{size:"sm",variant:"ghost",onClick:a("down"),children:""}),i.jsx(hl,{size:"sm",variant:"ghost",onClick:a("bottom"),children:""})]}),i.jsxs("div",{children:["Graphics"!==t.type&&i.jsx(Pc,{children:i.jsxs(Oc,{children:[i.jsx(Ac,{asChild:!0,children:i.jsx(hl,{size:"sm",variant:"ghost",onClick:()=>{if(e.activeChild){const t=e.activeChild;t.scale.x*=-1,t.scale.x<0?t.x+=t.width:t.x-=t.width}},children:i.jsx(Fr.flip,{className:"size-4"})})}),i.jsx(Qc,{children:i.jsx("p",{children:""})})]})}),i.jsx(Pc,{children:i.jsxs(Oc,{children:[i.jsx(Ac,{asChild:!0,children:i.jsx(hl,{size:"sm",variant:"ghost",onClick:async()=>{const t=e.cloneChild();if("Sprite"===t.type){const e=t;await e.load()}t.x+=.1*t.width,t.y+=.1*t.height,e.addChild(t),e.setActiveChildByName(t.name)},children:i.jsx(Fr.copy,{className:"size-4"})})}),i.jsx(Qc,{children:i.jsx("p",{children:""})})]})}),i.jsx(Pc,{children:i.jsxs(Oc,{children:[i.jsx(Ac,{asChild:!0,children:i.jsx(hl,{size:"sm",variant:"ghost",onClick:()=>{e.activeChild&&e.removeChildByName(e.activeChild.name),e.setActiveChild(void 0)},children:i.jsx(Fr.delete,{className:"size-4"})})}),i.jsx(Qc,{children:i.jsx("p",{children:""})})]})})]})]})]}),i.jsxs("fieldset",{className:"rounded-md border p-1 mt-2",children:[i.jsx("legend",{className:"-ml-1 px-1 text-sm font-medium",children:""}),i.jsxs("div",{className:"flex justify-between",children:[i.jsxs("div",{children:[i.jsx(hl,{size:"sm",variant:"ghost",onClick:s("left"),children:""}),i.jsx(hl,{size:"sm",variant:"ghost",onClick:s("near-left"),children:"1/3"}),i.jsx(hl,{size:"sm",variant:"ghost",onClick:s("center"),children:""}),i.jsx(hl,{size:"sm",variant:"ghost",onClick:s("near-right"),children:"2/3"}),i.jsx(hl,{size:"sm",variant:"ghost",onClick:s("right"),children:""})]}),t.assetType===io.Character&&i.jsx(Pc,{children:i.jsxs(Oc,{children:[i.jsx(Ac,{asChild:!0,children:i.jsx(hl,{size:"sm",variant:"ghost",onClick:()=>{const t=e.activeScene.getChildrenByAssetType(io.Character),a=t.length;let s=1;for(const n of t)n.x=e.options.width/(a+1)*s-n.width/2,n.y=e.options.height-n.height,s++},children:""})}),i.jsx(Qc,{children:i.jsx("p",{children:""})})]})})]})]}),i.jsxs("fieldset",{className:"rounded-md border p-1 mt-2",children:[i.jsx("legend",{className:"-ml-1 px-1 text-sm font-medium",children:""}),i.jsx(hl,{size:"sm",variant:"ghost",onClick:s("top"),children:""}),i.jsx(hl,{size:"sm",variant:"ghost",onClick:s("middle"),children:""}),i.jsx(hl,{size:"sm",variant:"ghost",onClick:s("bottom"),children:""})]})]})})}function $c(){return i.jsx(Rr,{className:"flex-1 shrink-0 max-h-[50%] sm:max-h-full rounded-md",children:i.jsx(Lr,{className:"h-full p-2",children:i.jsxs(_l,{defaultValue:"position",className:"h-full flex flex-col",children:[i.jsxs($l,{className:"self-center",children:[i.jsx(ql,{value:"position",children:""}),i.jsx(ql,{value:"style",children:""}),i.jsx(ql,{value:"list",children:""})]}),i.jsx(ec,{className:"h-[calc(100%-2.5rem)]",value:"position",children:i.jsx(_c,{})}),i.jsx(ec,{className:"h-[calc(100%-2.5rem)]",value:"style",children:i.jsx(Jc,{})}),i.jsx(ec,{className:"h-[calc(100%-2.5rem)]",value:"list",children:i.jsx(Rc,{})})]})})})}Qc.displayName=xs.displayName;const qc=ca("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{defaultVariants:{size:"default",variant:"default"},variants:{isMenu:{true:"h-auto w-full cursor-pointer justify-start"},size:{default:"h-10 px-4 py-2",icon:"size-10",lg:"h-11 rounded-md px-8",none:"",sm:"h-9 rounded-md px-3",sms:"size-9 rounded-md px-0",xs:"h-8 rounded-md px-3"},variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",ghost:"hover:bg-accent hover:text-accent-foreground",inlineLink:"text-base text-primary underline underline-offset-4",link:"text-primary underline-offset-4 hover:underline",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80"}}}),ed=bs(({asChild:e=!1,className:t,isMenu:a,size:s,variant:n,...r},o)=>{const l=e?da:"button";return i.jsx(l,{className:ws(qc({className:t,isMenu:a,size:s,variant:n})),ref:o,...r})});function td(){const e=Wr(e=>e.project),[t,a]=n.useState(!0);return n.useEffect(()=>{const e=document.documentElement.classList.contains("dark");a(e),document.documentElement.classList.contains("dark")||document.documentElement.classList.contains("light")||(document.documentElement.classList.add("dark"),a(!0))},[]),i.jsxs("header",{className:"sticky top-0 z-10 flex h-[53px] items-center justify-between gap-1 border-b bg-background px-4",children:[i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsxs(ed,{variant:"ghost",size:"sm",onClick:()=>{window.location.href="/?no_intro=true"},className:"gap-2",children:[i.jsx(ys,{className:"h-4 w-4"}),"Back to Home"]}),i.jsxs("h1",{className:"text-xl font-bold",children:["VNVE",e&&i.jsxs("span",{className:"text-xs text-muted-foreground ml-2",children:["// ",e.name]})]})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(ed,{variant:"ghost",size:"icon",onClick:()=>{const e=!t;a(e),e?(document.documentElement.classList.add("dark"),document.documentElement.classList.remove("light")):(document.documentElement.classList.remove("dark"),document.documentElement.classList.add("light"))},children:t?i.jsx(yt,{className:"h-5 w-5"}):i.jsx(js,{className:"h-5 w-5"})}),i.jsx(Fr.gitHub,{className:"size-5 cursor-pointer",onClick:()=>{window.location.href="https://github.com/vnve/vnve"}})]})]})}const ad=ca(ws("relative overflow-x-auto whitespace-pre-wrap break-words","min-h-[80px] w-full rounded-md bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none","[&_[data-slate-placeholder]]:text-muted-foreground [&_[data-slate-placeholder]]:!opacity-100","[&_[data-slate-placeholder]]:top-[auto_!important]","[&_strong]:font-bold"),{defaultVariants:{focusRing:!0,size:"sm",variant:"outline"},variants:{disabled:{true:"cursor-not-allowed opacity-50"},focusRing:{false:"",true:"focus-visible:ring-1 focus-visible:ring-ring"},focused:{true:"ring-1 ring-ring"},size:{md:"text-base",sm:"text-sm"},variant:{ghost:"",outline:"border border-input"}}}),sd=ks.forwardRef(({className:e,disabled:t,focusRing:a,focused:s,readOnly:n,size:r,variant:o,...l},c)=>i.jsx("div",{className:"relative w-full",ref:c,children:i.jsx(Ns,{"aria-disabled":t,className:ws(ad({disabled:t,focusRing:a,focused:s,size:r,variant:o}),e),"data-plate-selectable":!0,disableDefaultStyles:!0,readOnly:t??n,...l})}));sd.displayName="Editor";const nd=ca("shrink-0 bg-border",{defaultVariants:{orientation:"horizontal"},variants:{orientation:{horizontal:"h-px w-full",vertical:"h-full w-px"}}}),id=Ss(Cs(Zs,{decorative:!0,orientation:"horizontal"}),nd),rd=fs,od=gs,ld=vs,cd=Vs,dd=Gs(Cs(xs,{sideOffset:4}),"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md"),hd=Gs(Ts,"relative flex select-none items-center gap-1 bg-background"),md=Gs(Xs,"flex items-center");Gs(Rs,"font-medium underline underline-offset-4"),Gs(Ls,"my-1 w-px shrink-0 bg-border");const ud=ca(ws("inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50","[&_svg:not([data-icon])]:size-5"),{defaultVariants:{size:"sm",variant:"default"},variants:{size:{default:"h-10 px-3",lg:"h-11 px-5",sm:"h-9 px-2"},variant:{default:"bg-transparent hover:bg-muted hover:text-muted-foreground aria-checked:bg-accent aria-checked:text-accent-foreground",outline:"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground"}}}),pd=(xd=n.forwardRef(({children:e,className:t,isDropdown:a,pressed:s,size:n,variant:r,...o},l)=>"boolean"==typeof s?i.jsx(md,{disabled:o.disabled,type:"single",value:"single",children:i.jsx(fd,{className:ws(ud({size:n,variant:r}),a&&"my-1 justify-between pr-1",t),ref:l,value:s?"single":"",...o,children:a?i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"flex flex-1",children:e}),i.jsx("div",{children:i.jsx(Fr.arrowDown,{className:"ml-0.5 size-4","data-icon":!0})})]}):e})}):i.jsx(Ws,{className:ws(ud({size:n,variant:r}),a&&"pr-1",t),ref:l,...o,children:e})),ks.forwardRef(function({tooltip:e,tooltipContentProps:t,tooltipProps:a,...s},n){const[r,o]=ks.useState(!1);ks.useEffect(()=>{o(!0)},[]);const l=i.jsx(xd,{ref:n,...s});return e&&r?i.jsx(rd,{children:i.jsxs(od,{...a,children:[i.jsx(ld,{asChild:!0,children:l}),i.jsx(cd,{children:i.jsx(dd,{...t,children:e})})]})}):l}));var xd;pd.displayName="ToolbarButton";const fd=Ss(Is,ud,["variant","size"]),gd=bs(({children:e,className:t,noSeparator:a},s)=>{const r=n.Children.map(e,e=>e);return r&&0!==r.length?i.jsxs("div",{className:ws("flex",t),ref:s,children:[!a&&i.jsx("div",{className:"h-full py-2",children:i.jsx(id,{orientation:"vertical"})}),i.jsx("div",{className:"mx-1 flex items-center gap-1",children:e})]}):null}),vd=Gs(hd,"supports-backdrop-blur:bg-background/60 z-40 w-full justify-between overflow-x-auto rounded-t-lg border-b border-b-border bg-background/95 backdrop-blur"),bd=zt,wd=Kt;bs(({children:e,className:t,inset:a,...s},n)=>i.jsxs(kt,{className:ws("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent","data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a&&"pl-8",t),ref:n,...s,children:[e,i.jsx(Fr.chevronRight,{className:"ml-auto size-4"})]})),Gs(St,"z-50 min-w-32 overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2");const yd=Cs(Zt,{className:ws("z-50 min-w-32 overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2"),sideOffset:4}),jd=bs(({...e},t)=>i.jsx(Ct,{children:i.jsx(yd,{ref:t,...e})})),kd=ca(ws("relative flex h-9 cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors","focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50"),{variants:{inset:{true:"pl-8"}}}),Nd=Ss(Gt,kd,["inset"]);bs(({children:e,className:t,...a},s)=>i.jsxs(Vt,{className:ws("relative flex select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50","cursor-pointer",t),ref:s,...a,children:[i.jsx("span",{className:"absolute left-2 flex size-3.5 items-center justify-center",children:i.jsx(Wt,{children:i.jsx(Fr.check,{className:"size-4"})})}),e]})),bs(({children:e,className:t,hideIcon:a,...s},n)=>i.jsxs(Xt,{className:ws("relative flex select-none items-center rounded-sm pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50","h-9 cursor-pointer px-2 data-[state=checked]:bg-accent data-[state=checked]:text-accent-foreground",t),ref:n,...s,children:[!a&&i.jsx("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:i.jsx(Wt,{children:i.jsx(Fr.check,{className:"size-4"})})}),e]}));const Sd=ca(ws("select-none px-2 py-1.5 text-sm font-semibold"),{variants:{inset:{true:"pl-8"}}}),Cd=Ss(Lt,Sd,["inset"]),Zd=Gs(It,"-mx-1 my-1 h-px bg-muted");Gs(zs("span"),"ml-auto text-xs tracking-widest opacity-60");const Gd=Ks(Fs({key:"directive",node:{isElement:!0,isInline:!0,isMarkableVoid:!0,isVoid:!0},options:{openEditorId:null,mode:"",editingDirective:null,directiveType:null}}).extendOptions(({getOptions:e})=>({isOpen:t=>e().openEditorId===t})).extendEditorApi(({setOptions:e})=>({floatingDirective:{hide:()=>{e({mode:"",openEditorId:null,editingDirective:null,directiveType:null})},show:(t,a,s,n)=>{e({mode:t,openEditorId:a,editingDirective:s,directiveType:n})}}})).extendEditorTransforms(({editor:e,type:t})=>({insert:{directive:({value:a})=>{Ys(e,{children:[{text:""}],type:t,value:a})}},edit:{directive:({value:a,at:s})=>{Hs(e,{children:[{text:""}],type:t,value:a},{at:s})}}}))),Vd=(e,{directiveElement:t,directiveType:a}={})=>{const{api:s}=Ms(e,Gd);if(t){const a=t.value.directive,i=(n=a,kc.includes(n)?"Animation":Sc.includes(n)?"Sound":Zc.includes(n)?"Util":Gc.includes(n)?"Filter":Vc.includes(n)?"Transition":void 0);s.floatingDirective.show("edit",e.id,t,i)}else s.floatingDirective.show("insert",e.id,null,a);var n};function Wd({triggerFloatingLinkHotkeys:e,floatingOptions:t}){const a=ic("(min-width: 640px)"),{editor:s,api:n,tf:i,useOption:r,setOption:o,getOptions:l}=Bs(Gd),c=r("mode"),d=r("isOpen",s.id),h=r("editingDirective"),m=Ds({onOpenChange:e=>o("openEditorId",e?s.id:null),getBoundingClientRect:Us,open:d&&["insert","edit"].includes(c),...t}),u=Es(e=>{const t=e.target;t!==document.documentElement&&(t.closest("[data-disable-click-outside]")||t.closest("#asset-library")||["insert","edit"].includes(l().mode)&&(n.floatingDirective.hide(),Ps(s,s.selection)))},{disabled:!d});return ks.useEffect(()=>{d&&m.update()},[d,m.update]),{props:{style:a?{...m.style,zIndex:50}:{...m.style,position:"fixed",left:"50%",top:"50%",transform:"translate(-50%, -50%)",zIndex:50}},ref:Js(m.refs.setFloating,u),onSubmit:e=>{h?(e=>{const t=s.selection,[,a]=As(s,{at:t,match:{type:s.getType(Gd)}});i.edit.directive({value:e,at:a}),n.floatingDirective.hide()})(e):(e=>{i.insert.directive({value:e}),Os(s,{unit:"offset"}),n.floatingDirective.hide(),setTimeout(()=>{Ps(s,s.selection)},0)})(e)},onCancel:()=>{n.floatingDirective.hide(),setTimeout(()=>{Ps(s,s.selection)},0)}}}const Td=[{items:[{description:"",icon:Fr.squarePlus,label:"",value:yc.Util},{description:"",icon:Fr.squarePlus,label:"",value:yc.Transition},{description:"",icon:Fr.squarePlus,label:"",value:yc.Filter}],label:""}];function Xd(e){const t=ic("(min-width: 640px)"),a=Qs(),s=(()=>{const[e,t]=n.useState(!1);return{onOpenChange:n.useCallback((a=!e)=>{t(a)},[e]),open:e}})();return i.jsxs(bd,{modal:!1,...s,...e,children:[i.jsx(wd,{asChild:!0,children:i.jsx(pd,{isDropdown:!0,pressed:s.open,tooltip:"",children:i.jsx(Fr.add,{className:"size-4"})})}),i.jsx(jd,{align:"start",className:"flex max-h-[500px] min-w-0 flex-col gap-0.5 overflow-y-auto",children:Td.map(({items:e,label:s},n)=>i.jsxs(ks.Fragment,{children:[0!==n&&i.jsx(Zd,{}),i.jsx(Cd,{children:s}),e.map(({icon:e,label:s,value:n})=>i.jsxs(Nd,{className:"min-w-[180px]",onSelect:()=>function(e){Vd(a,{directiveType:e}),t&&Ps(a)}(n),children:[i.jsx(e,{className:"mr-2 size-4"}),s]},n))]},s))})]})}const Rd=n.forwardRef(({className:e,...t},a)=>i.jsx(_s,{className:zn("peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",e),...t,ref:a,children:i.jsx($s,{className:zn("pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0")})}));Rd.displayName=_s.displayName;const Ld=pa({wordsPerMin:qs().optional(),interval:qs().optional(),effect:xa().optional(),effectDuration:qs().optional(),speaker:pa({name:xa().optional(),autoShowSpeaker:pa({inEffect:xa()}).optional(),autoMaskOtherSpeakers:pa({alpha:qs()}).optional()})});function Id({speak:e,onChangeSpeak:t,disableCustomName:a=!1}){const s=fa({resolver:ga(Ld),defaultValues:e}),r=en({control:s.control});return n.useEffect(()=>{s.formState.isDirty&&t({...e,...r,speaker:{...e.speaker,...r.speaker}})},[s.formState.isDirty,r]),i.jsx(qo,{...s,children:i.jsxs("form",{className:"space-y-2",children:[!a&&i.jsx(tl,{control:s.control,name:"speaker.name",render:({field:e})=>i.jsxs(nl,{className:"space-y-1",children:[i.jsx(il,{children:""}),i.jsx(ol,{children:""}),i.jsx(rl,{children:i.jsx(cl,{className:"h-8",placeholder:"",...e})}),i.jsx(ll,{})]})}),i.jsx(tl,{control:s.control,name:"wordsPerMin",render:({field:e})=>i.jsxs(nl,{className:"space-y-1",children:[i.jsx(il,{children:"/"}),i.jsx(ol,{children:""}),i.jsx(rl,{children:i.jsx(cl,{className:"h-8",type:"number",min:0,step:100,placeholder:"",value:String(e.value),onChange:t=>{const a=Number(t.target.value);e.onChange(a)}})}),i.jsx(ll,{})]})}),i.jsx(tl,{control:s.control,name:"interval",render:({field:e})=>i.jsxs(nl,{className:"space-y-1",children:[i.jsx(il,{children:""}),i.jsx(ol,{children:""}),i.jsx(rl,{children:i.jsx(cl,{className:"h-8",type:"number",min:0,step:.1,placeholder:"",value:String(e.value),onChange:t=>{const a=Number(t.target.value);e.onChange(a)}})}),i.jsx(ll,{})]})}),i.jsx(tl,{control:s.control,name:"effect",render:({field:e})=>i.jsxs(nl,{className:"space-y-1",children:[i.jsx(il,{children:""}),i.jsx(rl,{children:i.jsxs(Bl,{onValueChange:e.onChange,value:e.value,children:[i.jsx(El,{className:"h-8",children:i.jsx(Ul,{placeholder:""})}),i.jsxs(Ol,{children:[i.jsx(Ql,{value:"typewriter",children:""}),i.jsx(Ql,{value:"fadeIn",children:""}),i.jsx(Ql,{value:"none",children:""})]})]})}),i.jsx(ll,{})]})}),"fadeIn"===r.effect&&i.jsx(tl,{control:s.control,name:"effectDuration",render:({field:e})=>i.jsxs(nl,{className:"space-y-1",children:[i.jsx(il,{children:""}),i.jsx(rl,{children:i.jsx(cl,{className:"h-8",type:"number",min:0,step:.1,placeholder:"",value:String(e.value),onChange:t=>{const a=Number(t.target.value);e.onChange(a)}})}),i.jsx(ll,{})]})}),i.jsx(tl,{control:s.control,name:"speaker.autoShowSpeaker",render:({field:e})=>i.jsxs(nl,{className:"flex flex-row items-center space-y-0",children:[i.jsx(il,{className:"w-[8rem]",children:""}),i.jsx(rl,{children:i.jsx(Rd,{checked:!!e.value,onCheckedChange:e.onChange})}),i.jsx(ll,{})]})}),i.jsx(tl,{control:s.control,name:"speaker.autoMaskOtherSpeakers",render:({field:e})=>i.jsxs(nl,{className:"flex flex-row items-center space-y-0",children:[i.jsx(il,{className:"w-[8rem]",children:""}),i.jsx(rl,{children:i.jsx(Rd,{checked:!!e.value,onCheckedChange:e.onChange})}),i.jsx(ll,{})]})})]})})}const zd={name:"Narrator",label:""};function Kd({speak:e,lines:t,onChangeSpeak:a,children:s}){const r=ic("(min-width: 640px)"),o=Wr(e=>e.activeScene),l=n.useMemo(()=>{const e=[zd];return o?[...e,...o.children.filter(e=>e.assetType===io.Character)]:e},[o]),c=Qs(),{selectAsset:d}=So(),[h,m]=n.useState(!1),u=Wr(e=>e.editor),p=e=>{Vd(c,{directiveType:e}),r&&Ps(c)};return i.jsxs("div",{className:"w-full flex flex-wrap",children:[i.jsxs(gd,{noSeparator:!0,children:[i.jsxs(Bl,{open:h,onOpenChange:m,value:e.speaker.speakerTargetName||"",onValueChange:t=>{const s=l.find(e=>e.name===t);a({...e,speaker:{...e.speaker,speakerTargetName:s?.name,name:s?.name===zd.name?"":s?.label||""}})},children:[i.jsx(El,{className:"w-[100px] md:w-[130px] h-8",children:i.jsx(Ul,{placeholder:""})}),i.jsxs(Ol,{children:[l.map(e=>i.jsx(Ql,{value:e.name,children:e.label},e.name)),i.jsx("div",{onClick:async()=>{m(!1);const t=await d(io.Character);if(t){const s=await Wo(t,u);u.addChild(s),a({...e,speaker:{...e.speaker,speakerTargetName:s.name,name:s.label}})}},className:"cursor-pointer select-none py-1.5 pl-2 pr-8 text-sm hover:bg-slate-100 rounded-sm","data-disable-click-outside":!0,children:"..."})]})]}),i.jsxs(zc,{children:[i.jsx(Kc,{asChild:!0,children:i.jsx(pd,{className:"px-1",tooltip:"",children:i.jsx(Fr.settings,{className:"!size-4 cursor-pointer mx-1"})})}),i.jsx(Fc,{children:i.jsx(Id,{speak:e,onChangeSpeak:a})})]}),i.jsxs(pd,{className:"px-1 text-xs",onClick:()=>p(yc.Animation),tooltip:"",children:[i.jsx(Fr.squarePlus,{className:"!size-4 md:mr-0.5 hidden md:flex"}),""]}),i.jsxs(pd,{className:"px-1 text-xs",onClick:()=>p(yc.Sound),tooltip:"",children:[i.jsx(Fr.squarePlus,{className:"!size-4 md:mr-0.5 hidden md:flex"}),""]}),i.jsx(Xd,{})]}),i.jsx(gd,{className:"ml-auto",children:s})]})}const Fd=bs(({children:e,className:t,prefix:a,...s},r)=>{const o=tn(),l=an(),c=sn(),d=function(){const[e,t]=n.useState(!1);return n.useEffect(()=>{t(!0)},[]),e}(),{editor:h}=Bs(Gd);return i.jsx(nn,{className:ws("inline-block cursor-pointer rounded-md bg-muted px-1.5 py-0.5 align-baseline text-sm font-medium select-none mx-0.5",l&&c&&"ring-2 ring-ring",!0===o.children[0].bold&&"font-bold",!0===o.children[0].italic&&"italic",!0===o.children[0].underline&&"underline",t),contentEditable:!1,onClick:()=>{Vd(h,{directiveElement:o})},ref:r,...s,children:d&&rn?i.jsxs(ks.Fragment,{children:[e,a,o.value.label||""]}):i.jsxs(ks.Fragment,{children:[a,o.value.label||"",e]})})}),Yd=ca("w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 print:hidden");bs(({align:e="center",className:t,sideOffset:a=4,style:s,...n},r)=>i.jsx(os,{children:i.jsx(ls,{align:e,className:ws(Yd(),t),ref:r,sideOffset:a,style:{zIndex:1e3,...s},...n})}));const Hd=n.forwardRef(({form:e},t)=>{const a=Wr(e=>e.activeScene),[s,r]=n.useState([]),[o,l]=n.useState([]),c=en({control:e.control,name:"directive"}),d=en({control:e.control,name:"params.targetName"}),h=en({control:e.control,name:"params.source"});return n.useEffect(()=>{if(a){const e=[],t=[],s=[];let n=[];for(const i of a.children){const a={value:i.name,label:i.label};i.assetType===io.Character?e.push(a):i.assetType===io.Background?s.push(a):i.assetType===io.Thing?t.push(a):i.name&&n.push(a)}c===fr.ChangeSource&&(n=n.filter(e=>e.assetID)),r([{label:"",options:e},{label:"",options:s},{label:"",options:t},{label:"",options:n}])}},[a,c]),n.useEffect(()=>{if(a&&c===fr.ChangeSource&&d){const e=a.children.find(e=>e.name===d);e?.assetID?co.get(e.assetID).then(e=>{const t=e.states.map(e=>({value:po(e),label:e.name}));l(t)}):l([])}},[a,c,d,e]),n.useImperativeHandle(t,()=>({getDirectiveLabel:()=>{if(a&&c&&d){const e=[jc[c],a.children.find(e=>e.name===d)?.label||""];if(c===fr.ChangeSource&&h){const t=o.find(e=>e.value===h)?.label||"";e.push(t)}return e.join(":")}return""}}),[a,c,d,h,o]),i.jsxs(i.Fragment,{children:[i.jsx(tl,{control:e.control,name:"params.targetName",render:({field:t})=>i.jsxs(nl,{className:"space-y-1",children:[i.jsx(il,{children:""}),i.jsx(rl,{children:i.jsxs(Bl,{onValueChange:a=>{t.onChange(a),e.setValue("params.source","")},value:t.value,children:[i.jsx(El,{className:"h-8",children:i.jsx(Ul,{placeholder:""})}),i.jsxs(Ol,{children:[s.map(e=>e.options.length>0&&i.jsxs(Dl,{children:[i.jsx(Al,{children:e.label}),e.options.map(e=>i.jsx(Ql,{value:e.value,children:e.label},e.value))]},e.label)),s.every(e=>0===e.options.length)&&i.jsx("div",{className:"select-none py-1.5 pl-2 pr-8 text-sm opacity-50",children:""})]})]})}),i.jsx(ll,{})]})}),c===fr.ChangeSource&&o.length>0&&i.jsx(tl,{control:e.control,name:"params.source",render:({field:e})=>i.jsxs(nl,{className:"space-y-1",children:[i.jsx(il,{children:""}),i.jsx(rl,{children:i.jsxs(Bl,{onValueChange:e.onChange,value:e.value,children:[i.jsx(El,{className:"h-8",children:i.jsx(Ul,{placeholder:""})}),i.jsx(Ol,{children:o.map(e=>i.jsx(Ql,{value:e.value,children:e.label},e.value))})]})}),i.jsx(ll,{})]})}),c!==fr.ChangeSource&&i.jsx(tl,{control:e.control,name:"params.duration",render:({field:e})=>i.jsxs(nl,{className:"space-y-1",children:[i.jsx(il,{children:"()"}),i.jsx(rl,{children:i.jsx(cl,{type:"number",min:0,step:.1,placeholder:"",value:e.value||"",onChange:t=>{const a=Number(t.target.value);e.onChange(a)},className:"h-8"})}),i.jsx(ll,{})]})})]})}),Md=n.forwardRef(({form:e},t)=>{const a=en({control:e.control,name:"directive"}),s=en({control:e.control,name:"params.duration"});return n.useImperativeHandle(t,()=>({getDirectiveLabel:()=>`${jc[a]}:${s??0}`}),[s,a]),i.jsx(tl,{control:e.control,name:"params.duration",render:({field:e})=>i.jsxs(nl,{className:"space-y-1",children:[i.jsx(il,{children:"()"}),i.jsx(rl,{children:i.jsx(cl,{type:"number",min:0,step:.1,placeholder:"",value:String(e.value),onChange:t=>{const a=Number(t.target.value);e.onChange(a)},className:"h-8"})}),i.jsx(ll,{})]})})}),Bd=n.forwardRef(({form:e},t)=>{const a=Wr(e=>e.activeScene),s=Wr(e=>e.editor),[r,o]=n.useState([]),l=en({control:e.control,name:"directive"}),c=en({control:e.control,name:"params.targetName"}),{selectAsset:d}=So(),[h,m]=n.useState(!1);return n.useEffect(()=>{if(a){const e=a.dialogues.map(e=>e.speak?.voice?.targetName),t=a.sounds.map(e=>({label:e.label,value:e.name})).filter(t=>!e.includes(t.value));o([{label:"",options:t}])}},[a]),n.useImperativeHandle(t,()=>({getDirectiveLabel:()=>a&&l&&c?[jc[l],a.sounds.find(e=>e.name===c)?.label||""].join(":"):""}),[a,l,c]),i.jsxs(i.Fragment,{children:[i.jsx(tl,{control:e.control,name:"params.targetName",render:({field:e})=>i.jsxs(nl,{className:"space-y-1",children:[i.jsx(il,{children:""}),i.jsx(rl,{children:i.jsxs(Bl,{open:h,onOpenChange:m,onValueChange:e.onChange,value:e.value,children:[i.jsx(El,{className:"h-8",children:i.jsx(Ul,{placeholder:""})}),i.jsxs(Ol,{children:[r.map(e=>e.options.length>0&&i.jsxs(Dl,{children:[i.jsx(Al,{children:e.label}),e.options.map(e=>i.jsx(Ql,{value:e.value,children:e.label},e.value))]},e.label)),i.jsx("div",{onClick:()=>(async e=>{m(!1);const t=await d(io.Audio);if(t){c&&s.removeSoundByName(c);const a=To(t);s.addSound(a),setTimeout(()=>{e(a.name)},150)}})(e.onChange),className:"cursor-pointer select-none py-1.5 pl-2 pr-8 text-sm hover:bg-slate-100 rounded-sm","data-disable-click-outside":!0,children:"..."})]})]})}),i.jsx(ll,{})]})}),l===fr.Play&&i.jsxs(i.Fragment,{children:[i.jsx(tl,{control:e.control,name:"params.start",render:({field:e})=>i.jsxs(nl,{className:"space-y-1",children:[i.jsx(il,{children:"()"}),i.jsx(rl,{children:i.jsx(cl,{type:"number",min:0,step:1,placeholder:"0",value:e.value||"",onChange:t=>{const a=Number(t.target.value);e.onChange(a)},className:"h-8"})}),i.jsx(ll,{})]})}),i.jsx(tl,{control:e.control,name:"params.volume",render:({field:e})=>i.jsxs(nl,{className:"space-y-1",children:[i.jsx(il,{children:""}),i.jsx(rl,{children:i.jsx(Lc,{min:0,max:1,step:.1,value:[e.value??1],onValueChange:t=>e.onChange(t[0]),showPercentage:!0})}),i.jsx(ll,{})]})}),i.jsx(tl,{control:e.control,name:"params.loop",render:({field:e})=>i.jsxs(nl,{className:"space-y-0 flex flex-row items-center",children:[i.jsx(il,{className:"flex flex-col w-[4rem]",children:""}),i.jsx(rl,{children:i.jsx(Rd,{checked:e.value,onCheckedChange:e.onChange})}),i.jsx(ll,{})]})}),i.jsx(tl,{control:e.control,name:"params.untilEnd",render:({field:e})=>i.jsxs(nl,{className:"space-y-0 flex flex-row items-center",children:[i.jsx(il,{className:"flex flex-col w-[4rem]",children:""}),i.jsx(rl,{children:i.jsx(Rd,{checked:e.value,onCheckedChange:e.onChange})}),i.jsx(ll,{})]})})]})]})}),Dd=n.forwardRef(({form:e},t)=>{const a=Wr(e=>e.activeScene),[s,r]=n.useState([]),o=en({control:e.control,name:"directive"});return n.useEffect(()=>{if(a){const e=[],t=[],s=[],n=[];for(const i of a.children){const a={value:i.name,label:i.label};i.assetType===io.Character?e.push(a):i.assetType===io.Background?s.push(a):i.assetType===io.Thing?t.push(a):i.name&&n.push(a)}r([{label:"",options:e},{label:"",options:s},{label:"",options:t},{label:"",options:n}])}},[a]),n.useImperativeHandle(t,()=>({getDirectiveLabel:()=>{const t=[jc[o]],a=e.getValues("params.targetName"),n=s.flatMap(e=>e.options).find(e=>e.value===a),i=n?n.label:"";t.push(i);const r=e.getValues("params.filterName");if(r){const e=Tc.find(e=>e.value===r),a=e?e.name:"";t.push(a)}return t.join(":")}}),[e,o,s]),i.jsxs(i.Fragment,{children:[i.jsx(tl,{control:e.control,name:"params.targetName",render:({field:e})=>i.jsxs(nl,{className:"space-y-1",children:[i.jsx(il,{children:""}),i.jsx(rl,{children:i.jsxs(Bl,{onValueChange:e.onChange,value:e.value,children:[i.jsx(El,{className:"h-8",children:i.jsx(Ul,{placeholder:""})}),i.jsx(Ol,{children:s.map(e=>e.options.length>0&&i.jsxs(Dl,{children:[i.jsx(Al,{children:e.label}),e.options.map(e=>i.jsx(Ql,{value:e.value,children:e.label},e.value))]},e.label))})]})}),i.jsx(ll,{})]})}),o===fr.AddFilter&&i.jsx(tl,{control:e.control,name:"params.filterName",render:({field:e})=>i.jsxs(nl,{className:"space-y-1",children:[i.jsx(il,{children:""}),i.jsx(rl,{children:i.jsxs(Bl,{onValueChange:e.onChange,value:e.value,children:[i.jsx(El,{className:"h-8",children:i.jsx(Ul,{placeholder:""})}),i.jsx(Ol,{children:Tc.map(e=>i.jsx(Ql,{value:e.value,children:e.name},e.value))})]})}),i.jsx(ll,{})]})})]})}),Ud=n.forwardRef(({form:e},t)=>(n.useImperativeHandle(t,()=>({getDirectiveLabel:()=>{const t=e.getValues("directive");return jc[t]}})),i.jsx(i.Fragment,{children:i.jsx(tl,{control:e.control,name:"params.duration",render:({field:e})=>i.jsxs(nl,{className:"space-y-1",children:[i.jsx(il,{children:""}),i.jsx(rl,{children:i.jsx(cl,{type:"number",min:0,step:.1,placeholder:"",value:e.value||"",onChange:t=>{const a=Number(t.target.value);e.onChange(a)},className:"h-8"})}),i.jsx(ll,{})]})})}))),Ed=on("directive",[pa({directive:ln(kc[0]),params:pa({targetName:xa({message:""}),source:xa().min(1,{message:""}),duration:qs().optional(),sequential:cn().optional()})}),...kc.slice(1).map(e=>pa({directive:ln(e),params:pa({targetName:xa({message:""}),duration:qs().optional(),sequential:cn().optional()})})),pa({directive:ln(fr.Wait),params:pa({duration:qs().optional(),sequential:cn().optional()})}),pa({directive:ln(fr.Play),params:pa({targetName:xa({message:""}),start:qs().optional(),volume:qs().optional(),loop:cn().optional(),untilEnd:cn().optional(),sequential:cn().optional()})}),...[fr.Pause,fr.Stop].map(e=>pa({directive:ln(e),params:pa({targetName:xa({message:""}),sequential:cn().optional()})})),pa({directive:ln(fr.AddFilter),params:pa({targetName:xa({message:""}),filterName:xa({message:""}),sequential:cn().optional()})}),pa({directive:ln(fr.RemoveFilter),params:pa({targetName:xa({message:""}),sequential:cn().optional()})}),pa({directive:ln(fr.FadeInTransition),params:pa({duration:qs().optional(),sequential:cn().optional()})})]);function Jd({editingDirective:e,directiveType:t,onSubmitDirective:a,onCancel:s}){const r=fa({resolver:ga(Ed),defaultValues:{directive:void 0,params:{}}}),o=en({control:r.control,name:"directive"}),l=n.useRef(null),c=n.useRef(null),d=n.useRef(null),h=n.useRef(null),m=n.useRef(null),u=n.useMemo(()=>Wc.find(e=>e.type===t),[t]);return n.useEffect(()=>{e?r.reset(e.value,{keepDefaultValues:!0}):r.reset()},[e,r.reset,r]),i.jsx(qo,{...r,children:i.jsxs("form",{onSubmit:r.handleSubmit(function(e){let t="";l.current?t=l.current.getDirectiveLabel():c.current?t=c.current.getDirectiveLabel():d.current?t=d.current.getDirectiveLabel():h.current?t=h.current.getDirectiveLabel():m.current&&(t=m.current.getDirectiveLabel()),a({...e,label:t})}),className:"space-y-2 flex flex-col h-full",children:[i.jsx(tl,{control:r.control,name:"directive",render:({field:e})=>i.jsxs(nl,{className:"space-y-1",children:[i.jsx(il,{children:u?.name}),i.jsx(rl,{children:i.jsxs(Bl,{onValueChange:e.onChange,value:e.value,children:[i.jsx(El,{className:"h-8",children:i.jsx(Ul,{placeholder:""})}),i.jsx(Ol,{children:u?.options.map(e=>i.jsx(Ql,{value:e.value,children:e.name},e.value))})]})})]})}),kc.includes(o)&&i.jsx(Hd,{form:r,ref:l}),Zc.includes(o)&&i.jsx(Md,{form:r,ref:c}),Sc.includes(o)&&i.jsx(Bd,{form:r,ref:d}),Gc.includes(o)&&i.jsx(Dd,{form:r,ref:h}),o===fr.FadeInTransition&&i.jsx(Ud,{form:r,ref:m}),o&&o!==fr.Wait&&i.jsx(tl,{control:r.control,name:"params.sequential",render:({field:e})=>i.jsxs(nl,{className:"space-y-0 flex flex-row items-center !mb-4",children:[i.jsx(il,{className:"flex flex-col w-[4rem]",children:""}),i.jsx(rl,{children:i.jsx(Rd,{checked:e.value,onCheckedChange:e.onChange})}),i.jsx(ll,{})]})}),i.jsxs("div",{className:"pt-2 !mt-auto sticky left-0 bottom-0 bg-white w-full flex justify-center border-t border-t-border gap-2",children:[i.jsx(hl,{size:"sm",type:"submit",children:""}),i.jsx(hl,{size:"sm",type:"button",onClick:s,variant:"outline",children:""})]})]})})}const Pd={middleware:[dn(12),hn({fallbackPlacements:["bottom-end","top-start","top-end"],padding:12})],placement:"bottom-start"};function Od(){const e=un({preventDefaultOnEnterKeydown:!0}),{useOption:t}=Bs(Gd),a=t("editingDirective"),s=t("directiveType"),{ref:n,props:r,onSubmit:o,onCancel:l}=Wd({floatingOptions:Pd,triggerFloatingLinkHotkeys:"mod+k"});return i.jsx(mn,{children:i.jsx("div",{className:ws(Yd(),"w-auto p-1"),...r,ref:n,children:i.jsx("div",{className:"flex w-[200px] h-[400px] overflow-auto flex-col p-2",...e,children:s&&i.jsx(Jd,{editingDirective:a,directiveType:s,onSubmitDirective:o,onCancel:l})})})})}const Ad=({className:e})=>i.jsx(es,{className:zn("h-6 w-6 text-primary/60 animate-spin",e)});function Qd({speak:e,lines:t,onChangeSpeak:a}){const[s,r]=n.useState(!1),[o,l]=n.useState(0),[c,d]=n.useState(0),[h,m]=n.useState(1),u=n.useRef(null),[p,x]=n.useState(""),{selectAsset:f}=So(),g=Wr(e=>e.editor),v=Wr(e=>e.project),b=tc(e=>e.tts),[w,y]=n.useState(!1),{toast:j}=Cl(),k=n.useCallback(t=>{a({...e,voice:{...e.voice||{},...t}})},[a,e]),N=n.useCallback(async()=>{u.current&&(s?u.current.pause():u.current.play(),r(!s))},[s]),S=n.useCallback(()=>{u.current&&d(u.current.currentTime)},[]),C=n.useCallback(()=>{u.current&&l(u.current.duration)},[]),Z=n.useCallback(e=>{u.current&&(u.current.currentTime=e[0],d(e[0]))},[]),G=n.useCallback(e=>{if(u.current){const t=e[0];u.current.volume=t,m(t),k({volume:t})}},[k]),V=n.useCallback(async()=>{const t=await f(io.Audio);if(t){e.voice?.targetName&&g.removeSoundByName(e.voice.targetName);const a=To(t);g.addSound(a),k({targetName:a.name})}},[e,g,k,f]),W=n.useCallback(()=>{x(""),d(0),l(0),r(!1),g.removeSoundByName(e.voice.targetName),k({targetName:""})},[g,k,e]),T=e=>`${Math.floor(e/60)}:${Math.floor(e%60).toString().padStart(2,"0")}`;return n.useEffect(()=>{(async()=>{if(e.voice?.targetName){const t=g.activeScene.getSoundByName(e.voice.targetName),a=xo(await go(t.assetID,t.label));x(a)}})()},[g,e]),n.useEffect(()=>{e.voice?.volume&&m(e.voice.volume)},[e]),n.useEffect(()=>{u.current&&(u.current.volume=h)},[h,p]),i.jsxs("div",{className:"flex items-center w-full gap-2 p-1 border border-t-0 rounded-md rounded-t-none bg-background h-[32px]",children:[i.jsx("audio",{ref:u,src:p,onTimeUpdate:S,onLoadedMetadata:C,onEnded:()=>{r(!1),d(0)}}),e.voice?.targetName?i.jsxs(i.Fragment,{children:[i.jsx(hl,{variant:"ghost",size:"icon",className:"w-6 h-6",onClick:N,children:s?i.jsx(ts,{className:"w-3 h-3"}):i.jsx(as,{className:"w-3 h-3"})}),i.jsxs("div",{className:"flex items-center flex-1 gap-2",children:[i.jsx("span",{className:"text-xs text-muted-foreground min-w-[35px]",children:T(c)}),i.jsx(Lc,{value:[c],max:o,step:.1,className:"w-full",onValueChange:Z}),i.jsx("span",{className:"text-xs text-muted-foreground min-w-[35px]",children:T(o)})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsxs(zc,{children:[i.jsx(Kc,{asChild:!0,children:i.jsx(hl,{variant:"ghost",size:"icon",className:"w-6 h-6",children:i.jsx(pn,{className:"w-3 h-3"})})}),i.jsx(Fc,{className:"w-[260px] p-2",side:"top",children:i.jsx(Lc,{value:[h],max:1,step:.1,className:"w-full",onValueChange:G,showPercentage:!0})})]}),i.jsx(hl,{variant:"ghost",size:"icon",className:"w-6 h-6 hover:text-destructive",onClick:W,children:i.jsx(fe,{className:"w-3 h-3"})})]})]}):i.jsxs("div",{className:"flex items-center justify-around w-full h-full px-1",children:[i.jsxs(hl,{variant:"ghost",size:"icon",className:"flex-1 h-6 mx-1 text-xs",disabled:w,onClick:V,children:[i.jsx(xn,{className:"w-3 h-3 mr-1"}),""]}),i.jsx(hl,{variant:"ghost",size:"icon",disabled:w,className:"flex-1 h-6 mx-1 text-xs",onClick:async()=>{y(!0);try{const{sound:a,url:s}=await zo({lines:t,editor:g,project:v,speak:e,ttsSettings:b});k({targetName:a.name}),x(s),j({title:"!",duration:1500})}catch(a){console.error("TTS generation failed:",a),j({title:"",description:a.message,variant:"destructive"})}finally{y(!1)}},children:w?i.jsxs(i.Fragment,{children:[i.jsx(Ad,{className:"w-3 h-3 mr-1"}),"..."]}):i.jsxs(i.Fragment,{children:[i.jsx(fn,{className:"w-3 h-3 mr-1"}),""]})})]})]})}function _d({value:e,onChange:t,onFocus:a,children:s}){const r=gn({plugins:[vn,Gd.extend({render:{afterEditable:()=>i.jsx(Od,{})}}),bn],override:{components:{[Gd.key]:Fd}},value:e.lines}),o=n.useRef(!1),l=a=>{t({...e,speak:a})};return n.useEffect(()=>{r.children!==e.lines&&(o.current=!0,r.tf.setValue(e.lines))},[e.lines,r]),i.jsxs("div",{className:"flex flex-col",children:[i.jsx(wn,{editor:r,onValueChange:({value:a})=>{o.current?o.current=!1:t({...e,lines:a})},children:i.jsxs("div",{className:"relative rounded-md rounded-b-none border bg-background border-border",onFocus:()=>{a(e)},children:[i.jsx(vd,{children:i.jsx(Kd,{speak:e.speak,lines:e.lines,onChangeSpeak:l,children:s})}),i.jsx(sd,{focusRing:!1,variant:"ghost",size:"sm"})]})}),i.jsx(Qd,{speak:e.speak,lines:e.lines,onChangeSpeak:l})]})}const $d=({isOpen:e,speak:t,autoShowBackground:a,onClose:s,onConfirm:n})=>{const[r,o]=ks.useState({speak:t,autoShowBackground:a});return i.jsx(Do,{open:e,onOpenChange:s,children:i.jsxs(Jo,{className:"sm:max-w-[600px]",children:[i.jsxs(Po,{children:[i.jsx(Ao,{className:"text-base font-bold",children:""}),i.jsx(Qo,{children:""})]}),i.jsxs("div",{className:"flex flex-col gap-2",children:[i.jsx(Id,{speak:r.speak,onChangeSpeak:e=>{o({...r,speak:e})},disableCustomName:!0}),i.jsxs("div",{className:"flex items-center",children:[i.jsx("span",{className:"text-sm font-medium w-[8rem]",children:""}),i.jsx(Rd,{checked:r.autoShowBackground,onCheckedChange:e=>{o({...r,autoShowBackground:e})}})]}),i.jsxs("div",{className:"flex items-center",children:[i.jsx("span",{className:"text-sm font-medium w-[8rem]",children:""}),i.jsx("div",{className:"flex-1",children:i.jsx(Lc,{value:[r.speak.voice?.volume??1],onValueChange:e=>{o({...r,speak:{...r.speak,voice:{...r.speak.voice||{},volume:e[0]}}})},min:0,max:1,step:.1,className:"flex-1",showPercentage:!0})})]})]}),i.jsxs(Oo,{className:"justify-center sm:justify-center",children:[i.jsx(hl,{onClick:()=>{n(r),s()},children:""}),i.jsx(hl,{variant:"outline",onClick:s,children:""})]})]})})};function qd({onClose:e}){const t=Wr(e=>e.editor),a=Wr(e=>e.project),s=Wr(e=>e.activeScene),[r,o]=n.useState(!1),[l,c]=n.useState(!1),d=n.useRef(null),h=tc(e=>e.tts),{toast:m}=Cl(),{showLoading:u,updateLoadingText:p,hideLoading:x}=Ml(),f=(e,a)=>{if(t.activeScene){const{speaker:e,targetName:s}=t.activeScene.config.speak||{};if(e){const s=t.activeScene.getChildByName(e.targetName);s&&(s.text=a.speak.speaker.name)}if(a.lines.length>0){const e=t.activeScene.getChildByName(s),n=Hn(a.lines);n&&e&&(e.text=n)}}},g=(e,a)=>{t.swapDialogue(e,a)},v=()=>{setTimeout(()=>{d.current&&d.current.scrollToBottom()},100)};return i.jsx(Rr,{className:"w-full flex-1 h-full border-0 md:border shadow-none md:shadow rounded-md",children:i.jsx(Lr,{className:"h-full p-1 md:p-2",children:s?i.jsxs(i.Fragment,{children:[i.jsx(zr,{className:"w-full h-full pr-2",ref:d,children:i.jsxs("div",{className:"flex flex-col m-1 mr-0 pr-1",children:[i.jsxs("div",{className:"flex flex-col gap-1",children:[i.jsxs($o,{htmlFor:"sceneName",className:"flex justify-between items-center",children:[i.jsx("span",{children:""}),i.jsxs("div",{className:"flex items-center",children:[i.jsx(Pc,{children:i.jsxs(Oc,{children:[i.jsx(Ac,{asChild:!0,children:i.jsx(hl,{size:"sm",variant:"ghost",onClick:()=>c(!0),children:i.jsx(Fr.settings,{className:"size-4"})})}),i.jsx(Qc,{children:i.jsx("p",{children:""})})]})}),i.jsx(Pc,{children:i.jsxs(Oc,{children:[i.jsx(Ac,{asChild:!0,children:i.jsx(hl,{size:"sm",variant:"ghost",onClick:()=>o(!0),children:i.jsx(Fr.bookmark,{className:"size-4"})})}),i.jsx(Qc,{children:i.jsx("p",{children:""})})]})}),e&&i.jsx(hl,{className:"-mr-3",size:"sm",variant:"ghost",onClick:e,children:i.jsx(Fr.close,{className:"size-4"})})]})]}),i.jsx(cl,{type:"text",id:"sceneName",placeholder:"",value:s.label,onChange:e=>{return a=e.target.value,void t.updateActiveScene(e=>{e.label=a});var a}})]}),i.jsxs("div",{className:"flex flex-col gap-2 mt-4",children:[i.jsxs($o,{className:"flex justify-between items-center",children:[i.jsx("span",{children:""}),i.jsx(Pc,{children:i.jsxs(Oc,{children:[i.jsx(Ac,{asChild:!0,children:i.jsx(hl,{size:"sm",variant:"ghost",onClick:async()=>{if(!h||!h.appid||!h.token)return void m({title:"",variant:"destructive"});const e=s.dialogues;u("");try{for(const[s,i]of e.entries()){p(` ${s+1} `);try{const{sound:e}=await zo({speak:i.speak,lines:i.lines,editor:t,project:a,ttsSettings:h});t.updateDialogue(s,{...i,speak:{...i.speak,voice:{...i.speak.voice||{},targetName:e.name}}})}catch(n){if(n.voice!==Go)throw n}}m({title:"!"})}catch(n){m({title:"",description:n.message,variant:"destructive"})}finally{x()}},children:i.jsx(fn,{className:"size-4"})})}),i.jsx(Qc,{children:i.jsx("p",{children:""})})]})})]}),s.dialogues.map((e,a)=>i.jsx("div",{children:i.jsx(_d,{value:e,onChange:e=>((e,a)=>{t.updateDialogue(e,a),f(0,a)})(a,e),onFocus:e=>f(0,e),children:i.jsxs(Yr,{children:[i.jsx(Hr,{children:i.jsx(Fr.more,{className:"size-4 cursor-pointer mx-1"})}),i.jsxs(Er,{children:[i.jsx(Jr,{onClick:()=>((e,a)=>{t.addDialogue({speak:{...t.cloneDialogueSpeak(a.speak),voice:void 0},lines:[]},e)})(a+1,e),children:""}),i.jsx(Jr,{onClick:()=>((e,a)=>{const s=t.cloneDialogue(e);s.speak.voice=void 0,t.addDialogue(s,a)})(e,a+1),children:""}),i.jsx(Jr,{className:"text-destructive",onClick:()=>{t.removeDialogue(e)},children:""}),i.jsx(Pr,{}),a>0&&i.jsx(Jr,{onClick:()=>g(a,a-1),children:""}),a<s.dialogues.length-1&&i.jsx(Jr,{onClick:()=>g(a,a+1),children:""})]})]})})},a))]}),i.jsx(hl,{className:"mt-2",onClick:()=>(e=>{const{config:a}=s;t.addDialogue({speak:t.cloneDialogueSpeak(a.speak),lines:[]},e),v()})(),children:""})]})}),r&&i.jsx(ul,{isOpen:r,onClose:()=>o(!1),sceneName:s.name}),l&&i.jsx($d,{isOpen:l,speak:s.config.speak,autoShowBackground:s.config.autoShowBackground,onConfirm:e=>{t.updateActiveScene(t=>{t.config.autoShowBackground=e.autoShowBackground,t.config.speak=e.speak,t.dialogues.forEach(t=>{t.speak={...t.speak,...e.speak,speaker:{...t.speak.speaker||{},wordsPerMin:e.speak.speaker.wordsPerMin,interval:e.speak.speaker.interval,effect:e.speak.speaker.effect,effectDuration:e.speak.speaker.effectDuration,autoShowSpeaker:e.speak.speaker.autoShowSpeaker,autoMaskOtherSpeakers:e.speak.speaker.autoMaskOtherSpeakers},voice:{...t.speak.voice||{},volume:e.speak.voice.volume}}})})},onClose:()=>c(!1)})]}):i.jsx("div",{className:"h-full text-lg flex items-center justify-center text-muted-foreground/50",children:a?"":""})})})}function eh({type:e,url:t,ext:a,className:s,onChange:r}){const[o,l]=n.useState(null),[c,d]=n.useState(null),h=n.useMemo(()=>o||t||"",[t,o]),m=n.useMemo(()=>c||a||"",[a,c]),u=n.useMemo(()=>fo(e),[e]),p=n.useRef(null);return n.useEffect(()=>()=>{o&&URL.revokeObjectURL(o)},[o]),i.jsxs("div",{className:zn("flex cursor-pointer group relative",s),onClick:()=>{p.current?.click()},children:[i.jsx("input",{type:"file",ref:p,onChange:e=>{o&&URL.revokeObjectURL(o);const t=e.target.files?.[0];l(URL.createObjectURL(t)),d(Fn(t).ext),r(t)},className:"hidden",accept:u}),i.jsxs("div",{className:"size-full flex justify-center items-center text-sm invisible group-hover:visible bg-muted/80 absolute left-0 right-0 z-20",children:[i.jsx(yn,{className:"size-4"}),i.jsx("div",{children:""})]}),i.jsx(gc,{url:h,type:e,ext:m})]})}const th=ca("relative w-full rounded-lg border px-4 py-3 text-sm [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground [&>svg~*]:pl-7",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),ah=n.forwardRef(({className:e,variant:t,...a},s)=>i.jsx("div",{ref:s,role:"alert",className:zn(th({variant:t}),e),...a}));ah.displayName="Alert",n.forwardRef(({className:e,...t},a)=>i.jsx("h5",{ref:a,className:zn("mb-1 font-medium leading-none tracking-tight",e),...t})).displayName="AlertTitle";const sh=n.forwardRef(({className:e,...t},a)=>i.jsx("div",{ref:a,className:zn("text-sm [&_p]:leading-relaxed",e),...t}));sh.displayName="AlertDescription";const nh=pa({id:qs().optional(),name:xa().min(1,{message:""}),type:xa().min(1,{message:""}),voice:xa().optional(),states:jn(pa({id:qs().optional(),name:xa().min(1,{message:""}),ext:xa().optional(),file:kn(File).optional()}).refine(e=>e.id||e.file,{message:""}))});function ih({asset:e,onSubmit:t,onCancel:a}){const[s,r]=n.useState(!1),o=n.useRef(),l=n.useMemo(()=>oo[e.type],[e.type]),c=fa({resolver:ga(nh),defaultValues:{name:"",type:"",voice:"",states:[]}}),{fields:d,append:h,remove:m}=Nn({control:c.control,name:"states",keyName:"_id"}),u=tc(e=>e.tts),{toast:p}=Cl();return n.useEffect(()=>()=>{o.current?.audio&&(o.current.audio.pause(),o.current=void 0)},[]),n.useEffect(()=>{c.reset({id:e.id,name:e.name,type:e.type,voice:e.voice,states:e.states})},[e,c]),i.jsxs("div",{children:[i.jsxs("h3",{className:"text-base font-bold mb-2",children:[e.id?"":"",l,i.jsx(ah,{className:"p-2 mt-1",children:i.jsxs(sh,{className:"text-muted-foreground font-normal flex gap-1 items-center",children:[i.jsx(Fr.tip,{className:"size-4"}),[io.Background,io.Character,io.Thing,io.Dialog].includes(e.type)&&i.jsx("span",{children:"1920*1080"}),e.type===io.Audio&&i.jsx("span",{children:">=44100Hz"}),e.type===io.Font&&i.jsx("span",{children:"woff/woff2/ttf"})]})})]}),i.jsx(qo,{...c,children:i.jsxs("form",{onSubmit:c.handleSubmit(e=>{t(e)}),className:"space-y-4",children:[i.jsx(tl,{control:c.control,name:"name",render:({field:t})=>i.jsxs(nl,{children:[i.jsxs(il,{children:[l,""]}),i.jsx(rl,{children:i.jsx(cl,{placeholder:`${l}`,disabled:e.id===no,...t})}),i.jsx(ll,{})]})}),e.type===io.Character&&i.jsx(tl,{control:c.control,name:"voice",render:({field:e})=>i.jsxs(nl,{children:[i.jsx(il,{children:""}),i.jsx(rl,{children:i.jsxs("div",{className:"flex gap-2",children:[i.jsxs(Bl,{onValueChange:e.onChange,value:e.value,children:[i.jsx(El,{className:"flex-1",children:i.jsx(Ul,{placeholder:""})}),i.jsx(Ol,{children:Vo.map(e=>i.jsx(Ql,{value:e.value,children:e.name},e.value))})]}),i.jsx(Pc,{children:i.jsxs(Oc,{children:[i.jsx(Ac,{asChild:!0,children:i.jsx(hl,{type:"button",variant:"outline",disabled:!e.value||e.value===Go||s,onClick:()=>(async e=>{if(u&&u.appid&&u.token){if(e!==Go)try{if(r(!0),o.current?.voice===e)return void o.current.audio.play();const t=await Co({text:"",voiceType:e,token:u.token,appid:u.appid}),a=new Audio(t.audio_url);a.onended=()=>{r(!1)},a.play(),o.current={voice:e,audio:a}}catch(t){console.error(t),r(!1)}}else p({title:"",variant:"destructive"})})(e.value),children:s?i.jsx(Ad,{className:"size-4"}):i.jsx(Sn,{className:"size-4"})})}),i.jsx(Qc,{children:i.jsx("p",{children:""})})]})})]})}),i.jsx(ll,{})]})}),e.id!==no&&i.jsxs(nl,{children:[i.jsxs(il,{className:"flex items-center",children:[l,"",i.jsxs(hl,{size:"sm",variant:"outline",onClick:()=>h({name:""}),className:"ml-2",children:[i.jsx(Fr.squarePlus,{className:"size-4 mr-1"}),""]})]}),i.jsx(rl,{children:i.jsx("div",{children:d.length>0&&i.jsxs(zr,{className:"w-full whitespace-nowrap rounded-md border",children:[i.jsx("div",{className:"flex w-full gap-2 p-2",children:d.map((t,a)=>i.jsx(vc,{type:e.type,state:t,children:i.jsxs(i.Fragment,{children:[i.jsx(Lr,{className:"p-2 flex justify-center",children:i.jsx(eh,{className:"w-full h-full",type:e.type,ext:t.ext,url:t.id&&po(t),onChange:e=>((e,t)=>{c.setValue(`states.${t}.file`,e),c.getValues(`states.${t}.name`)||c.setValue(`states.${t}.name`,Fn(e).name)})(e,a)})}),i.jsx(Ir,{className:"font-medium p-2 pt-0 flex flex-col gap-1",children:i.jsxs("div",{className:"flex w-full justify-between",children:[i.jsx(tl,{control:c.control,name:`states.${a}.name`,render:({field:e})=>i.jsx(nl,{children:i.jsx(rl,{children:i.jsx(cl,{className:"h-6 text-sm",placeholder:"",...e})})})}),i.jsx(Fr.delete,{className:"size-4 ml-1 mt-1 flex-shrink-0 cursor-pointer hover:text-destructive",onClick:()=>m(a)})]})})]})},a))}),i.jsx(Kr,{orientation:"horizontal"})]})})}),i.jsx(ll,{})]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx(hl,{type:"submit",children:""}),i.jsx(hl,{type:"button",className:"mr-2",variant:"outline",onClick:a,children:""})]})]})})]})}function rh({asset:e,onEdit:t,onSelectState:a,onCancel:s}){return i.jsxs("div",{className:"h-[calc(100%-2.5rem)] flex flex-col",children:[i.jsxs("h3",{className:"text-base font-bold mb-4 flex justify-between items-center",children:["",i.jsx(hl,{className:"ml-1 mr-auto",variant:"ghost",size:"sm",onClick:()=>t(e),children:i.jsx(Fr.edit,{className:"size-4"})}),i.jsx(hl,{variant:"outline",size:"sm",onClick:s,children:""})]}),i.jsx(zr,{className:"flex-1",children:i.jsx("div",{className:"flex gap-2 flex-wrap",children:e.states?.map(t=>i.jsx(vc,{type:e.type,state:t,onSelect:()=>a(t)},t.id))})})]})}function oh(){const e=ic("(min-width: 640px)"),t=Tr(e=>e.isOpen),a=Tr(e=>e.confirm),s=Tr(e=>e.cancel),r=Tr(e=>e.disableSelect),o=Tr(e=>e.type),[l,c]=n.useState(o),[d,h]=n.useState(null),[m,u]=n.useState(null),p=Ht(async()=>{if(l){const e=await co.where("type").equals(l).and(e=>!e.name.startsWith(so)).reverse().toArray();if(l===io.Character){const t=e.findIndex(e=>e.id===no);if(-1!==t){const a=e[t];e.splice(t,1),e.unshift(a)}}return e}return[]},[l]),x=e=>{c(e)},f=()=>{h({name:"",type:l,states:[]})},g=e=>{h(e)},v=async e=>{if(e.id){if(await(async e=>{for(const t of e.states){if(t.file){t.id&&await ho.delete(t.id);const a=Fn(t.file).ext,s=await ho.add({mime:t.file.type,blob:t.file,ext:a});t.id=s,t.ext=a,e.type===io.Font&&ao(t.name,po(t))}delete t.file}await co.update(e.id,e)})(e),m){const t=await co.get(e.id);u(t)}}else await(async e=>{for(const t of e.states){const a=Fn(t.file).ext,s=await ho.add({mime:t.file.type,blob:t.file,ext:a});t.id=s,t.ext=a,delete t.file,e.type===io.Font&&ao(t.name,po(t))}await co.add(e)})(e);h(null)},b=()=>{h(null)},w=e=>{r||(a({...m,stateId:e.id}),u(null))},y=()=>{u(null)};return n.useEffect(()=>{c(o||io.Character)},[o]),i.jsx(Do,{open:t,onOpenChange:()=>{s(),h(null),u(null)},children:i.jsxs(Jo,{id:"asset-library",className:zn("min-w-[90vw] h-[90vh] flex flex-col",!e&&"px-2"),children:[i.jsxs(Po,{children:[i.jsx(Ao,{children:""}),i.jsx(Qo,{})]}),d?i.jsx(ih,{asset:d,onSubmit:v,onCancel:b}):m?i.jsx(rh,{asset:m,onEdit:e=>g(e),onSelectState:w,onCancel:y}):i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"flex justify-between items-center",children:[i.jsx(_l,{value:l,onValueChange:x,children:i.jsx($l,{children:ro.map(e=>i.jsx(ql,{value:e.value,disabled:o&&o!==e.value,children:e.name},e.value))})}),i.jsxs(hl,{size:"sm",onClick:f,children:[i.jsx(Fr.squarePlus,{className:"w-3.5 h-3.5 mr-0.5"}),e&&""]})]}),i.jsx(zr,{className:"flex-grow",children:i.jsx("div",{className:"flex gap-2 flex-wrap",children:p?.map(e=>i.jsx(bc,{asset:e,onSelect:()=>u(e),onEdit:()=>g(e),onDelete:()=>(e=>{e.states.forEach(e=>{ho.delete(e.id)}),co.delete(e.id)})(e)},e.id))})})]})]})})}const lh=Xn,ch=n.forwardRef(({className:e,...t},a)=>i.jsx(Cn,{ref:a,className:zn("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",e),...t}));ch.displayName=Cn.displayName;const dh=ca("group pointer-events-auto relative flex w-full items-center justify-between space-x-2 overflow-hidden rounded-md border p-4 pr-6 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),hh=n.forwardRef(({className:e,variant:t,...a},s)=>i.jsx(Zn,{ref:s,className:zn(dh({variant:t}),e),...a}));hh.displayName=Zn.displayName,n.forwardRef(({className:e,...t},a)=>i.jsx(Gn,{ref:a,className:zn("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium transition-colors hover:bg-secondary focus:outline-none focus:ring-1 focus:ring-ring disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",e),...t})).displayName=Gn.displayName;const mh=n.forwardRef(({className:e,...t},a)=>i.jsx(Vn,{ref:a,className:zn("absolute right-1 top-1 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-1 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",e),"toast-close":"",...t,children:i.jsx(sa,{className:"h-4 w-4"})}));mh.displayName=Vn.displayName;const uh=n.forwardRef(({className:e,...t},a)=>i.jsx(Wn,{ref:a,className:zn("text-sm font-semibold [&+div]:text-xs",e),...t}));uh.displayName=Wn.displayName;const ph=n.forwardRef(({className:e,...t},a)=>i.jsx(Tn,{ref:a,className:zn("text-sm opacity-90",e),...t}));function xh(){const{toasts:e}=Cl();return i.jsxs(lh,{children:[e.map(function({id:e,title:t,description:a,action:s,...n}){return i.jsxs(hh,{...n,children:[i.jsxs("div",{className:"grid gap-1",children:[t&&i.jsx(uh,{children:t}),a&&i.jsx(ph,{children:a})]}),s,i.jsx(mh,{})]},e)}),i.jsx(ch,{})]})}function fh(){const e=Xr(e=>e.isOpen),t=Xr(e=>e.loadingText);return i.jsx(Do,{open:e,children:i.jsxs(Jo,{disableClose:!0,onPointerDownOutside:e=>e.preventDefault(),children:[i.jsxs(Po,{className:"hidden",children:[i.jsx(Ao,{}),i.jsx(Qo,{})]}),i.jsxs("div",{className:"w-full flex gap-2 justify-center items-center",children:[i.jsx("div",{className:"font-bold text-xl",children:t}),i.jsx(Ad,{})]})]})})}function gh(){const[e,t]=n.useState(!1),a=ic("(min-width: 768px)"),[s,r]=n.useState(null),{toast:o}=Cl();return n.useEffect(()=>{(async function(){let e=!1,t=!1;return"undefined"!=typeof VideoEncoder&&"undefined"!=typeof VideoFrame&&(await VideoEncoder.isConfigSupported(An)).supported&&(e=!0),"undefined"!=typeof OfflineAudioContext&&"undefined"!=typeof AudioEncoder&&"undefined"!=typeof AudioData&&(await AudioEncoder.isConfigSupported(Qn)).supported&&(t=!0),{video:e,audio:t}})().then(e=>{r(e.video),e.audio||(Xo=!0,o({title:"",description:"ChromeEdge",duration:1500}))})},[o]),s?i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"h-screen flex flex-col",children:[i.jsx(td,{}),i.jsxs("main",{className:"grid flex-1 gap-2 overflow-auto p-2 grid-cols-1 md:grid-cols-[minmax(450px,1fr)_2fr] bg-muted/50",children:[i.jsx("div",{className:"relative hidden md:flex h-[calc(100vh-53px-1rem)]",children:a&&i.jsx(qd,{})}),i.jsxs("div",{className:"relative flex h-full flex-col gap-2",children:[i.jsx(Xc,{}),i.jsxs("div",{className:"flex gap-2 h-[50vh] md:h-[30vh] flex-col sm:flex-row",children:[i.jsx($c,{}),i.jsx(No,{onOpenSceneDetailDialog:()=>{t(!0)}})]})]})]})]}),!a&&e&&i.jsx("div",{className:"fixed top-0 left-0 size-full z-50",children:i.jsx(qd,{onClose:()=>t(!1)})}),i.jsx(oh,{}),i.jsx(xh,{}),i.jsx(fh,{})]}):i.jsx("div",{className:"flex h-screen items-center justify-center",children:!1===s?i.jsxs("div",{className:"text-center",children:[i.jsx("h1",{className:"text-2xl font-semibold",children:""}),i.jsx("p",{className:"text-sm",children:"ChromeEdge"})]}):i.jsx("div",{className:"text-center",children:"..."})})}ph.displayName=Tn.displayName;const vh=Rn([{path:"/",element:i.jsx(gh,{})}]);function bh(){return i.jsx(Ln,{router:vh})}window.onbeforeunload=function(){return""},async function(){await co.get(no)||await co.put({id:no,name:"",type:"Character",states:[]})}(),async function(){try{if(localStorage.getItem(yo))return;localStorage.setItem(yo,"true"),0===await ho.count()&&await async function(){for(const t of wo){const{type:a,assets:s}=t;for(const t of s){const{name:s,states:n}=t,i=await co.add({name:s,type:a,states:[]});for(const t of n)try{const{name:e,url:a}=t,s=a.split(".").pop(),n=await fetch(a),r=await n.blob(),o=n.headers.get("Content-Type")||"",l=await ho.add({mime:o,ext:s,blob:r,url:a});await co.where("id").equals(i).modify(t=>{t.states.push({id:l,name:e,ext:s,url:a})})}catch(e){console.error("",e)}}}}()}catch(e){console.error("",e)}}().finally(()=>{!async function(){const e=await co.where("type").equals("Font").toArray();for(const t of e)for(const e of t.states)await ao(e.name,po(e))}()});const wh=document.getElementById("root");In.createRoot(wh).render(i.jsx(bh,{}))}}});
