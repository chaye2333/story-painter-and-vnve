var Fo=Object.defineProperty;var Ko=(a,s,t)=>s in a?Fo(a,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[s]=t;var x=(a,s,t)=>(Ko(a,typeof s!="symbol"?s+"":s,t),t);import{t as zo,c as Do,r as d,j as e,n as Yo,l as Fe,C as Mo,B as Ho,N as Bo,a as ln,T as cn,G as Po,b as Ao,R as Uo,F as Eo,L as Oo,d as Jo,E as Oa,e as Qo,f as us,g as _o,S as ia,A as $o,h as qo,p as er,i as tr,k as Ke,U as dn,M as hn,m as sr,o as ms,q as he,s as ee,u as Ja,P as un,v as ar,w as nr,x as ir,y as or,z as js,D as oa,H as mn,V as rr,I as lr,J as pn,K as cr,O as Js,Q as dr,W as hr,X as ur,Y as mr,Z as pr,_ as fr,$ as xr,a0 as gr,a1 as br,a2 as vr,a3 as fn,a4 as yr,a5 as Qs,a6 as Sr,a7 as jr,a8 as wr,a9 as Nr,aa as Cr,ab as kr,ac as Zr,ad as Gr,ae as _s,af as Tr,ag as Vr,ah as Rr,ai as Wr,aj as Ir,ak as Lr,al as Xr,am as Fr,an as Kr,ao as zr,ap as Dr,aq as Yr,ar as Mr,as as Hr,at as Br,au as Pr,av as $s,aw as Ar,ax as Ur,ay as Er,az as Or,aA as Jr,aB as Qr,aC as _r,aD as $r,aE as qr,aF as el,aG as tl,aH as sl,aI as al,aJ as nl,aK as il,aL as ol,aM as rl,aN as ll,aO as cl,aP as dl,aQ as hl,aR as ul,aS as ml,aT as pl,aU as fl,aV as xl,aW as gl,aX as bl,aY as vl,aZ as yl,a_ as Sl,a$ as jl,b0 as wl,b1 as Nl,b2 as Cl,b3 as kl,b4 as Zl,b5 as Gl,b6 as Tl,b7 as Vl,b8 as Rl,b9 as xn,ba as Wl,bb as ra,bc as gn,bd as la,be as ca,bf as da,bg as ha,bh as ua,bi as ws,bj as ma,bk as pa,bl as bn,bm as fa,bn as xa,bo as vn,bp as yn,bq as Il,br as Ll,bs as Ot,bt as Sn,bu as jn,bv as wn,bw as Nn,bx as Xl,by as Cn,bz as kn,bA as Zn,bB as Gn,bC as Tn,bD as Vn,bE as Rn,bF as Fl,bG as Wn,bH as In,bI as Kl,bJ as Ln,bK as Xn,bL as Fn,bM as zl,bN as Dl,bO as Kn,bP as Se,bQ as ga,bR as Yl,bS as Ml,bT as Hl,bU as P,bV as E,bW as ct,bX as dt,bY as zn,bZ as Bl,b_ as Dn,b$ as Yn,c0 as Mn,c1 as Hn,c2 as Bn,c3 as Pn,c4 as Pl,c5 as Al,c6 as An,c7 as Ul,c8 as El,c9 as Un,ca as Ol,cb as En,cc as Jl,cd as Ql,ce as On,cf as _l,cg as Jn,ch as Qn,ci as $l,cj as ql,ck as _n,cl as ec,cm as tc,cn as sc,co as $n,cp as qn,cq as ei,cr as ac,cs as nc,ct as ic,cu as oc,cv as rc,cw as ba,cx as ti,cy as si,cz as ai,cA as lc,cB as cc,cC as dc,cD as ni,cE as va,cF as hc,cG as uc,cH as mc,cI as ii,cJ as oi,cK as ri,cL as ya,cM as li,cN as ci,cO as di,cP as et,cQ as ae,cR as pc,cS as fc,cT as De,cU as xc,cV as Ns,cW as Sa,cX as gc,cY as Me,cZ as bc,c_ as vc,c$ as yc,d0 as Sc,d1 as jc,d2 as wc,d3 as Nc,d4 as Cc,d5 as kc,d6 as Zc,d7 as Gc,d8 as Tc,d9 as Vc,da as ja,db as Rc,dc as Wc,dd as Ic,de as Lc,df as Ft,dg as Xc,dh as Fc,di as hi,dj as ui,dk as Kc,dl as fe,dm as Ie,dn as zc,dp as Dc,dq as Yc,dr as Mc,ds as Hc,dt as Bc,du as Pe,dv as Ve,dw as Pc,dx as Ac,dy as Uc,dz as Ec,dA as Oc,dB as Jc,dC as mi,dD as Qc,dE as _c,dF as $c,dG as qc,dH as ed,dI as td,dJ as sd,dK as ad,dL as nd,dM as pi,dN as fi,dO as xi,dP as gi,dQ as bi,dR as vi,dS as id,dT as od,dU as rd,dV as ld}from"./vendor-078e422c.js";function yp(){import.meta.url,import("_").catch(()=>1);async function*a(){}}const yi=Object.freeze(Object.defineProperty({__proto__:null,get AddFilter(){return $d},get AnimationDirective(){return ne},get ChangeSource(){return Md},get Directive(){return Zt},get EnterFromLeft(){return Ud},get EnterFromRight(){return Od},get FadeIn(){return Wi},get FadeInTransition(){return _d},get FadeOut(){return Yd},get FilterDirective(){return Na},get Hide(){return Dd},get LeaveFromLeft(){return Ed},get LeaveFromRight(){return Jd},get Pause(){return Rd},get Play(){return Vd},get RemoveFilter(){return qd},get ShakeX(){return Hd},get ShakeY(){return Bd},get Show(){return Ri},get SoundDirective(){return ts},get Speak(){return zd},get Speaker(){return Ii},get Stop(){return Wd},get TransitionDirective(){return Vi},get Voice(){return Li},get Wait(){return Qd},get ZoomIn(){return Pd},get ZoomOut(){return Ad}},Symbol.toStringTag,{value:"Module"}));(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}})();function S(...a){return zo(Do(a))}function Si(a,s,t="mp4"){const n=document.createElement("a");n.setAttribute("download","".concat(a,".").concat(t)),n.setAttribute("href",s),document.body.appendChild(n),n.click(),document.body.removeChild(n)}function wt(a){const s=a.name.split(".").pop()||"";return{name:a.name.substring(0,a.name.lastIndexOf(".")),ext:s}}function cd({accept:a="*",multiple:s=!1}={}){return new Promise((t,n)=>{let i=document.createElement("input");i.type="file",i.accept=a,i.multiple=s,i.style.display="none",i.addEventListener("change",o=>{const r=Array.from(o.target.files||[]);r.length>0?t(r):n(new Error("No files selected")),document.body.removeChild(i),i=null}),i.addEventListener("error",()=>{n(new Error("Error selecting files")),document.body.removeChild(i)}),i.addEventListener("cancel",()=>{n(new Error("File deselected!")),document.body.removeChild(i)}),document.body.appendChild(i),i.click()})}function ji(a){const s=a.match(/\{[\s\S]*\}/);try{const t=s[0];return JSON.parse(t)}catch(t){return null}}function wi(a,s=!1){let t="";return a.forEach(n=>{if(n.type==="p")for(let i=0;i<n.children.length;i++){const o=n.children[i];if(!o.type){let r=o.text;i===n.children.length-1&&(r+="\n"),t+=r}}}),s&&(t=t.replace(/\n/g,"")),t}function dd(a,s,t="mp3"){return fetch(a).then(n=>n.blob()).then(n=>new File([n],"".concat(s,".").concat(t),{type:"audio/".concat(t)}))}const Cs=d.forwardRef(({className:a,...s},t)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:t,className:S("w-full caption-bottom text-sm",a),...s})}));Cs.displayName="Table";const ks=d.forwardRef(({className:a,...s},t)=>e.jsx("thead",{ref:t,className:S("[&_tr]:border-b",a),...s}));ks.displayName="TableHeader";const Zs=d.forwardRef(({className:a,...s},t)=>e.jsx("tbody",{ref:t,className:S("[&_tr:last-child]:border-0",a),...s}));Zs.displayName="TableBody";const hd=d.forwardRef(({className:a,...s},t)=>e.jsx("tfoot",{ref:t,className:S("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",a),...s}));hd.displayName="TableFooter";const ht=d.forwardRef(({className:a,...s},t)=>e.jsx("tr",{ref:t,className:S("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",a),...s}));ht.displayName="TableRow";const ut=d.forwardRef(({className:a,...s},t)=>e.jsx("th",{ref:t,className:S("h-8 px-2 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",a),...s}));ut.displayName="TableHead";const mt=d.forwardRef(({className:a,...s},t)=>e.jsx("td",{ref:t,className:S("p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",a),...s}));mt.displayName="TableCell";const ud=d.forwardRef(({className:a,...s},t)=>e.jsx("caption",{ref:t,className:S("mt-4 text-sm text-muted-foreground",a),...s}));ud.displayName="TableCaption";async function md(a,s,t,n){const i=a.sampleRate,o=a.numberOfChannels,r=Math.floor(s*i),c=i*t,l=new OfflineAudioContext(o,c,i);let m=l.createBuffer(o,c,i);const h=new Float32Array(c);for(let u=0;u<a.numberOfChannels;u++)a.copyFromChannel(h,u,r),m.copyToChannel(h,u);if(typeof n<"u"){const u=l.createBufferSource();u.buffer=m;const f=l.createGain();f.gain.value=n,u.connect(f),f.connect(l.destination),u.start(),m=await l.startRendering()}return m}async function pd(a,s=44100){return new Promise((t,n)=>{const i=new AudioContext({sampleRate:s});i.decodeAudioData(a,t,n).finally(()=>{i.close()})})}async function fd(a){try{const s=await(await fetch(a)).arrayBuffer();return await pd(s)}catch(s){console.error("fetchAudioBuffer error:",s);return}}const Ni={codec:"avc1.42002A",width:1920,height:1080,bitrate:12e6},Ci={codec:"mp4a.40.2",numberOfChannels:2,sampleRate:44100,bitrate:128e3};async function xd(){let a=!1,s=!1;return typeof VideoEncoder<"u"&&typeof VideoFrame<"u"&&(await VideoEncoder.isConfigSupported(Ni)).supported&&(a=!0),typeof OfflineAudioContext<"u"&&typeof AudioEncoder<"u"&&typeof AudioData<"u"&&(await AudioEncoder.isConfigSupported(Ci)).supported&&(s=!0),{video:a,audio:s}}function je(){return Yo(8)}Fe.setLevel("ERROR");function gd(a){return new Promise(s=>setTimeout(s,a))}function bd(a,s,t){return Math.abs(a-s)<t}async function wa(a,s){if(!s)return[];const t=[];for(const n of s){const i=await vd(a,n);t.push(i)}return t}async function vd(a,s){return await a[s.__type].fromJSON(s)}function Jt(a,s,t=!1){t&&(s.name=a.name),s.label=a.label}function Qt(a){return{__type:a.type,label:a.label,name:a.name}}function _t(a,s){s.label=a.label,s.name=a.name}class Dt extends Mo{constructor(){super();x(this,"label","");x(this,"name",je());x(this,"type","BlackMaskFilter");this.blackAndWhite(!0),this.brightness(0,!0)}clone(t=!1){const n=new Dt;return Jt(this,n,t),n}toJSON(){return Qt(this)}static fromJSON(t){const n=new Dt;return _t(t,n),n}}class ps extends Ho{constructor(){super(...arguments);x(this,"label","");x(this,"name",je());x(this,"type","BlurFilter")}clone(t=!1){const n=new ps;return Jt(this,n,t),n}toJSON(){return Qt(this)}static fromJSON(t){const n=new ps;return _t(t,n),n}}class fs extends Bo{constructor(){super(...arguments);x(this,"label","");x(this,"name",je());x(this,"type","NoiseFilter")}clone(t=!1){const n=new fs;return Jt(this,n,t),n}toJSON(){return Qt(this)}static fromJSON(t){const n=new fs;return _t(t,n),n}}class xs extends ln{constructor(){super(...arguments);x(this,"label","");x(this,"name",je());x(this,"type","OldFilmFilter")}clone(t=!1){const n=new xs;return Jt(this,n,t),n}toJSON(){return Qt(this)}static fromJSON(t){const n=new xs;return _t(t,n),n}}class gs extends ln{constructor(){super();x(this,"label","");x(this,"name",je());x(this,"type","VignetteFilter");this.sepia=0,this.noise=0,this.vignetting=.5}clone(t=!1){const n=new gs;return Jt(this,n,t),n}toJSON(){return Qt(this)}static fromJSON(t){const n=new gs;return _t(t,n),n}}const ki={BlackMaskFilter:Dt,BlurFilter:ps,NoiseFilter:fs,OldFilmFilter:xs,VignetteFilter:gs};function Zi(a){return wa(ki,a)}function $t(a,s,t=!1,n=!1){var i;t&&(s.name=a.name),s.label=a.label,s.type=a.type,s.visible=a.visible,s.alpha=a.alpha,s.zIndex=a.zIndex,s.setTransform(...Gi(a)),n||(s.width=a.width,s.height=a.height),s.filters=((i=a.filters)==null?void 0:i.map(o=>o.clone(t)))||null}function qt(a,s=!1){var n;let t={__type:a.type,name:a.name,label:a.label,type:a.type,visible:a.visible,alpha:a.alpha,zIndex:a.zIndex,transform:Gi(a),filters:((n=a.filters)==null?void 0:n.map(i=>i.toJSON()))||null};return s||(t={...t,width:a.width,height:a.height}),t}async function es(a,s,t=!1){s.name=a.name,s.label=a.label,s.type=a.type,s.visible=a.visible,s.alpha=a.alpha,s.zIndex=a.zIndex,s.setTransform(...a.transform),t||(typeof a.width=="number"&&(s.width=a.width),typeof a.height=="number"&&(s.height=a.height)),s.filters=await Zi(a.filters)}function Nt(a){return a.width===a.texture.width&&a.height===a.texture.height&&a.width===1&&a.height===1}function Gi(a){return[a.x,a.y,a.scale.x,a.scale.y,a.rotation,a.skew.x,a.skew.y,a.pivot.x,a.pivot.y]}class Le extends cn{constructor(){super(...arguments);x(this,"name",je());x(this,"label","");x(this,"type","Text");x(this,"disableTextEdit",!1)}async load(){}clone(t=!1){const n=new Le(this.text,this.style.clone());return $t(this,n,t,!0),n.disableTextEdit=this.disableTextEdit,n}toJSON(){return{...qt(this,!0),text:this.text,disableTextEdit:this.disableTextEdit,style:{fontSize:this.style.fontSize,fontWeight:this.style.fontWeight,fontStyle:this.style.fontStyle,fontFamily:this.style.fontFamily,fill:this.style.fill,wordWrap:this.style.wordWrap,breakWords:this.style.breakWords,wordWrapWidth:this.style.wordWrapWidth,leading:this.style.leading}}}static async fromJSON(t){const n=new Le(t.text,t.style);return await es(t,n,!0),n.disableTextEdit=t.disableTextEdit,n}}class Ct extends Po{constructor(){super(...arguments);x(this,"name",je());x(this,"label","");x(this,"type","Graphics");x(this,"fillColor","")}async load(){}clone(t=!1){const n=new Ct(super.clone().geometry);return $t(this,n,t),n.fillColor=this.fillColor,n}toJSON(){return{...qt(this),fillColor:this.fillColor,graphicsData:this.geometry.graphicsData.map(t=>[t.shape,{...t.fillStyle,texture:void 0},{...t.lineStyle,texture:void 0}])}}static async fromJSON(t){const n=new Ao;n.graphicsData=t.graphicsData.map(o=>{const r=new Uo;r.x=o[0].x,r.y=o[0].y,r.width=o[0].width,r.height=o[0].height;const c=new Eo;c.alpha=o[1].alpha,c.color=o[1].color,c.visible=o[1].visible;const l=new Oo;return l.color=o[2].color,l.alpha=o[2].alpha,l.visible=o[2].visible,l.width=o[2].width,l.alignment=o[2].alignment,l.native=o[2].native,l.cap=o[2].cap,l.join=o[2].join,l.miterLimit=o[2].miterLimit,new Jo(r,c,l)});const i=new Ct(n);return await es(t,i),i.fillColor=t.fillColor,i}}const yd={extension:Oa.Asset,detection:{test:async()=>!0,add:async a=>[...a],remove:async a=>a.filter(s=>a.includes(s))},loader:{extension:{type:[Oa.LoadParser],priority:Qo.High},test(a){return a.startsWith("blob:")},async load(a){return us.from(a)}}};_o.add(yd);class Yt extends ia{constructor(t){super();x(this,"name");x(this,"label");x(this,"type");x(this,"source");x(this,"assetID");x(this,"assetType");this.name=je(),this.label="",this.type="Sprite",this.source=t.source,this.assetID=0,this.assetType=""}changeSource(t){this.source=t}async load(){this.source&&(this.texture=await $o.load(this.source))}clone(t=!1){const n=new Yt({source:this.source});return n.assetID=this.assetID,n.assetType=this.assetType,$t(this,n,t,Nt(this)),n}toJSON(){return{...qt(this,Nt(this)),source:this.source,assetID:this.assetID,assetType:this.assetType}}static async fromJSON(t){const n=new Yt({source:t.source});return n.assetID=t.assetID,n.assetType=t.assetType,await es(t,n),n}}const Ue=class Ue extends ia{constructor(t){super(us.EMPTY);x(this,"name");x(this,"label");x(this,"type");x(this,"source");x(this,"assetID");x(this,"assetType");x(this,"animationSpeed",1);x(this,"loop",!0);x(this,"onComplete");x(this,"onFrameChange");x(this,"onLoop");x(this,"duration",0);x(this,"autoPlay",!0);x(this,"_frames");x(this,"_context");x(this,"dirty",!1);x(this,"_currentFrame",0);x(this,"_autoUpdate",!1);x(this,"_isConnectedToTicker",!1);x(this,"_playing",!1);x(this,"_currentTime",0);this.name=je(),this.label="",this.type="AnimatedGIF",this.source=t.source,this.assetID=0,this.assetType="",this._frames=[],this._context=null}static fromBuffer(t,n){if(!t||t.byteLength===0)throw new Error("Invalid buffer");const i=R=>{var H;let W=null;for(const X of R.frames)W=(H=X.gce)!=null?H:W,"image"in X&&!("gce"in X)&&(X.gce=W)},o=er(t);i(o);const r=tr(o,!0),c=[],l=document.createElement("canvas"),m=l.getContext("2d",{willReadFrequently:!0}),h=document.createElement("canvas"),u=h.getContext("2d");l.width=o.lsd.width,l.height=o.lsd.height;let f=0,p=null;const{fps:g}=Object.assign({},Ue.defaultOptions,n),v=1e3/g;for(let R=0;R<r.length;R++){const{disposalType:W=2,delay:H=v,patch:X,dims:{width:O,height:ie,left:T,top:y}}=r[R];h.width=O,h.height=ie,u.clearRect(0,0,O,ie);const w=u.createImageData(O,ie);w.data.set(X),u.putImageData(w,0,0),W===3&&(p=m.getImageData(0,0,l.width,l.height)),m.drawImage(h,T,y);const U=m.getImageData(0,0,l.width,l.height);W===2?m.clearRect(0,0,l.width,l.height):W===3&&m.putImageData(p,0,0),c.push({start:f,end:f+H,imageData:U}),f+=H}l.width=l.height=0,h.width=h.height=0;const{width:b,height:V}=o.lsd;return{frames:c,width:b,height:V}}async load(){const t=await fetch(this.source).then(u=>u.arrayBuffer()),{frames:n,width:i,height:o}=Ue.fromBuffer(t),r=document.createElement("canvas"),c=r.getContext("2d");r.width=i,r.height=o;const{source:l,scaleMode:m,...h}=Ue.defaultOptions;this.texture=us.from(r,{scaleMode:m}),this.duration=n[n.length-1].end,this._frames=n,this._context=c,this._playing=!1,this._currentTime=0,this._isConnectedToTicker=!1,Object.assign(this,h),this.dirty=!0,this.currentFrame=0}stop(){this._playing&&(this._playing=!1,this._autoUpdate&&this._isConnectedToTicker&&(Ke.shared.remove(this.update,this),this._isConnectedToTicker=!1))}play(){this._playing||(this._playing=!0,this._autoUpdate&&!this._isConnectedToTicker&&(Ke.shared.add(this.update,this,dn.HIGH),this._isConnectedToTicker=!0),!this.loop&&this.currentFrame===this._frames.length-1&&(this._currentTime=0))}get progress(){return this._currentTime/this.duration}get playing(){return this._playing}update(t){var r,c;if(!this._playing)return;const n=Ke.shared.time*1e3,i=n%this.duration,o=this._frames.findIndex(l=>l.start<=i&&l.end>i);n>=this.duration?this.loop?(this._currentTime=i,this.updateFrameIndex(o),(r=this.onLoop)==null||r.call(this)):(this._currentTime=this.duration,this.updateFrameIndex(this._frames.length-1),(c=this.onComplete)==null||c.call(this),this.stop()):(this._currentTime=i,this.updateFrameIndex(o))}updateFrame(){if(!this.dirty)return;const{imageData:t}=this._frames[this._currentFrame];this._context.putImageData(t,0,0),this._context.fillStyle="transparent",this._context.fillRect(0,0,0,1),this.texture.update(),this.dirty=!1}_render(t){this.updateFrame(),super._render(t)}_renderCanvas(t){this.updateFrame(),super._renderCanvas(t)}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isConnectedToTicker?(Ke.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._playing&&(Ke.shared.add(this.update,this),this._isConnectedToTicker=!0))}get currentFrame(){return this._currentFrame}set currentFrame(t){this.updateFrameIndex(t),this._currentTime=this._frames[t].start}updateFrameIndex(t){var n;if(t<0||t>=this._frames.length)throw new Error("Frame index out of range, expecting 0 to ".concat(this.totalFrames,", got ").concat(t));this._currentFrame!==t&&(this._currentFrame=t,this.dirty=!0,(n=this.onFrameChange)==null||n.call(this,t))}get totalFrames(){return this._frames.length}destroy(){this.stop(),super.destroy(!0);const t=null;this._context=t,this._frames=t,this.onComplete=t,this.onFrameChange=t,this.onLoop=t}clone(t=!1){const n=new Ue({source:this.source});return n.assetID=this.assetID,n.assetType=this.assetType,$t(this,n,t,Nt(this)),n}toJSON(){return{...qt(this,Nt(this)),source:this.source,assetID:this.assetID,assetType:this.assetType}}static async fromJSON(t){const n=new Ue({source:t.source});return n.assetID=t.assetID,n.assetType=t.assetType,await es(t,n),n}};x(Ue,"defaultOptions",{source:"",scaleMode:qo.LINEAR,fps:30,loop:!0,animationSpeed:1,autoPlay:!0,autoUpdate:!0,onComplete:null,onFrameChange:null,onLoop:null});let bs=Ue;var Ti=(a=>(a[a.AUDIO_STREAM_TYPE=0]="AUDIO_STREAM_TYPE",a[a.VIDEO_STREAM_TYPE=1]="VIDEO_STREAM_TYPE",a))(Ti||{});const{DataStream:Qa}=hn;function qs(...a){Fe.debug(...a)}class Sd{constructor(s){x(this,"fileUri");x(this,"streamType");x(this,"source");x(this,"readySamples");x(this,"_pending_read_resolver");x(this,"audioTrack");x(this,"videoTrack");this.fileUri=s}async initialize(s){this.source=new jd(this.fileUri),this.readySamples=[],this._pending_read_resolver=void 0,this.streamType=s;const t=await this._tracksReady();return this.streamType==0?this._selectTrack(this.audioTrack):this._selectTrack(this.videoTrack),t}getDecoderConfig(){return this.streamType==0?{codec:this.audioTrack.codec,sampleRate:this.audioTrack.audio.sample_rate,numberOfChannels:this.audioTrack.audio.channel_count,description:this.source.getAudioSpecificConfig()}:{codec:this.videoTrack.codec.startsWith("vp08")?"vp8":this.videoTrack.codec,displayWidth:this.videoTrack.track_width,displayHeight:this.videoTrack.track_height,description:this._getDescription(this.source.getDescriptionBox())}}async getNextChunk(){let s=await this._readSample();const t=s.is_sync?"key":"delta",n=s.cts*1e6/s.timescale,i=s.duration*1e6/s.timescale,o=this.streamType==0?EncodedAudioChunk:EncodedVideoChunk;return new o({type:t,timestamp:n,duration:i,data:s.data})}_getDescription(s){const t=new Qa(void 0,0,Qa.BIG_ENDIAN);return s.write(t),new Uint8Array(t.buffer,8)}async _tracksReady(){let s=await this.source.getInfo();return this.videoTrack=s.videoTracks[0],this.audioTrack=s.audioTracks[0],{video:this.videoTrack,audio:this.audioTrack}}_selectTrack(s){this.source.selectTrack(s)}async _readSample(){if(this.readySamples.length)return Promise.resolve(this.readySamples.shift());let s=new Promise(t=>{this._pending_read_resolver=t});return this.source.start(this._onSamples.bind(this)),s}_onSamples(s){this.readySamples.push(...s),this.readySamples.length>=50&&this.source.stop();let n=s[0].cts*1e6/s[0].timescale;qs("adding new ".concat(s.length," samples (first = ").concat(n,"). total = ").concat(this.readySamples.length)),this._pending_read_resolver&&(this._pending_read_resolver(this.readySamples.shift()),this._pending_read_resolver=void 0)}destroy(){this.readySamples=[],this.source.close()}}class jd{constructor(s){x(this,"file");x(this,"_onSamples");x(this,"info");x(this,"_info_resolver");this.file=hn.createFile(),this.file.onError=console.error.bind(console),this.file.onReady=this.onReady.bind(this),this.file.onSamples=this.onSamples.bind(this),qs("fetching file"),fetch(s).then(t=>{qs("fetch responded");const n=t.body.getReader();let i=0,o=this.file;function r({done:c,value:l}){if(c){o.flush();return}let m=l.buffer;return m.fileStart=i,i+=m.byteLength,o.appendBuffer(m),n.read().then(r)}return n.read().then(r)}),this.info=void 0,this._info_resolver=void 0}onReady(s){this.info=s,this._info_resolver&&(this._info_resolver(s),this._info_resolver=void 0)}getInfo(){return this.info?Promise.resolve(this.info):new Promise(s=>{this._info_resolver=s})}getDescriptionBox(){const s=this.file.moov.traks[0].mdia.minf.stbl.stsd.entries[0],t=s.avcC||s.hvcC||s.vpcC||s.av1C;if(!t)throw new Error("avcC, hvcC, vpcC, or av1C box not found!");return t}getAudioSpecificConfig(){try{return this.file.moov.traks[0].mdia.minf.stbl.stsd.entries[0].esds.esd.descs[0].descs[0].data}catch(s){return}}selectTrack(s){this.file.setExtractionOptions(s.id)}start(s){this._onSamples=s,this.file.start()}stop(){this.file.stop()}close(){this.file.flush()}onSamples(s,t,n){this._onSamples(n)}}const Ys=3;function vt(...a){Fe.debug(...a)}class wd{constructor(){x(this,"width");x(this,"height");x(this,"duration");x(this,"demuxer");x(this,"frameBuffer");x(this,"fillInProgress");x(this,"canvasCtx");x(this,"decoder");x(this,"init_resolver")}async initialize(s,t,{width:n,height:i}){this.frameBuffer=[],this.fillInProgress=!1,this.demuxer=new Sd(s);const{video:o}=await this.demuxer.initialize(Ti.VIDEO_STREAM_TYPE),r=this.demuxer.getDecoderConfig();this.width=n>0?n:r.displayWidth,this.height=i>0?i:r.displayHeight,this.duration=o.duration/o.timescale,this.canvasCtx=t,this.canvasCtx.canvas.width=this.width,this.canvasCtx.canvas.height=this.height,this.decoder=new VideoDecoder({output:this.bufferFrame.bind(this),error:m=>console.error(m)});let c=await VideoDecoder.isConfigSupported(r);console.assert(c.supported),this.decoder.configure(r),this.init_resolver=void 0;let l=new Promise(m=>this.init_resolver=m);return this.fillFrameBuffer(),l}render(s){vt("render(%d)",s);let t=this.chooseFrame(s);if(this.fillFrameBuffer(),t==null){console.warn("VideoRenderer.render(): no frame ");return}return this.paint(t),t}chooseFrame(s){if(this.frameBuffer.length==0)return null;let t=Number.MAX_VALUE,n=-1;for(let o=0;o<this.frameBuffer.length;o++){let r=Math.abs(s-this.frameBuffer[o].timestamp);if(r<t)t=r,n=o;else break}console.assert(n!=-1),n>0&&vt("dropping %d stale frames",n);for(let o=0;o<n;o++){let r=this.frameBuffer.shift();r&&r.close()}let i=this.frameBuffer[0];return vt("frame time delta = %dms (%d vs %d)",t/1e3,s,i.timestamp),i}async fillFrameBuffer(){if(this.frameBufferFull()){vt("frame buffer full"),this.init_resolver&&(this.init_resolver(!0),this.init_resolver=void 0);return}if(this.fillInProgress)return!1;for(this.fillInProgress=!0;this.frameBuffer.length<Ys&&this.decoder.decodeQueueSize<Ys;){let s=await this.demuxer.getNextChunk();this.decoder.decode(s)}this.fillInProgress=!1,setTimeout(this.fillFrameBuffer.bind(this),0)}frameBufferFull(){return this.frameBuffer.length>=Ys}bufferFrame(s){vt("bufferFrame(".concat(s.timestamp,")")),this.frameBuffer.push(s)}paint(s){vt("paint(%d)",s.timestamp),this.canvasCtx.drawImage(s,0,0,this.width,this.height)}async destroy(){this.decoder.state!="closed"&&(this.frameBuffer.forEach(s=>s.close()),await this.decoder.flush(),this.decoder.close()),this.demuxer.destroy()}}class Mt extends ia{constructor(t){var n,i,o,r,c,l,m;super();x(this,"name");x(this,"label");x(this,"type");x(this,"source");x(this,"assetID");x(this,"assetType");x(this,"start");x(this,"duration");x(this,"offset");x(this,"loop");x(this,"volume");x(this,"bufferDuration",0);x(this,"options");x(this,"videoRenderer");x(this,"_isConnectedToTicker",!1);this.options=t,this.name=je(),this.label="",this.type="Video",this.source=t.source,this.assetID=0,this.assetType="",this.width=(n=this.options.width)!=null?n:0,this.height=(i=this.options.height)!=null?i:0,this.start=(o=t.start)!=null?o:0,this.duration=(r=t.duration)!=null?r:0,this.offset=(c=t.offset)!=null?c:0,this.loop=(l=t.loop)!=null?l:!1,this.volume=(m=t.volume)!=null?m:1}async load(){if(this.source){const t=this.source,n=document.createElement("canvas"),i=n.getContext("2d"),o=new wd;await o.initialize(t,i,{width:this.width,height:this.height}),this.width=o.width,this.height=o.height;const r=o.duration*1e3;this.duration=this.duration||r,this.bufferDuration=r,this.videoRenderer=o,this.texture=us.from(n),this.videoRenderer.render(0),this.texture.update()}}play(){this._isConnectedToTicker||(Ke.shared.add(this.update,this,dn.HIGH),this._isConnectedToTicker=!0)}stop(){this._isConnectedToTicker&&(Ke.shared.remove(this.update,this),this._isConnectedToTicker=!1)}destroy(){this.stop(),super.destroy(!0),this.videoRenderer=void 0}async update(){var n;const t=Ke.shared.time*1e3;(n=this.videoRenderer)==null||n.render(t*1e3),this.texture.update()}clone(t=!1){const n=new Mt({source:this.source});return n.assetID=this.assetID,n.assetType=this.assetType,$t(this,n,t,Nt(this)),n}toJSON(){return{...qt(this,Nt(this)),source:this.source,assetID:this.assetID,assetType:this.assetType}}static async fromJSON(t){const n=new Mt({source:t.source});return n.assetID=t.assetID,n.assetType=t.assetType,await es(t,n),n}}const Nd={Text:Le,Graphics:Ct,Sprite:Yt,AnimatedGIF:bs,Video:Mt};function Cd(a){return wa(Nd,a)}class Ht{constructor(s){x(this,"name");x(this,"label");x(this,"type");x(this,"source");x(this,"assetID");x(this,"assetType");x(this,"buffer");this.name=je(),this.label="",this.type="Sound",this.source=s.source,this.assetID=0,this.assetType=""}changeSource(s){this.source=s}async load(){this.buffer=await fd(this.source)}clone(s=!1){const t=new Ht({source:this.source});return Ms(this,t,s),t}toJSON(){const s={};return Ms(this,s,!0),{__type:this.type,...s,source:this.source,assetID:this.assetID,assetType:this.assetType}}static async fromJSON(s){const t=new Ht({source:s.source});return Ms(s,t,!0),t}destroy(){this.buffer=void 0}}function Ms(a,s,t=!1){t&&(s.name=a.name),s.label=a.label,s.assetID=a.assetID,s.assetType=a.assetType}function kd(a){return wa({Sound:Ht},a)}class Xe extends sr{constructor(t){super();x(this,"name");x(this,"label");x(this,"config");x(this,"dialogues");x(this,"sounds");this.name=je(),this.label=(t==null?void 0:t.label)||"",this.config={speak:{targetName:"",wordsPerMin:500,interval:.2,effect:"typewriter",speaker:{targetName:"",name:"",autoShowSpeaker:{inEffect:"Show"},autoMaskOtherSpeakers:{alpha:.5}}},autoShowBackground:!0},this.dialogues=[],this.sounds=[],this.sortableChildren=!0}getSoundByName(t){return this.sounds.find(n=>n.name===t)}addSound(t){this.sounds.push(t)}removeSound(t){this.sounds=this.sounds.filter(n=>n.name===t.name?(t.destroy(),!1):!0)}addFilter(t){this.filters?this.filters.push(t):this.filters=[t]}removeFilter(t){this.filters&&(this.filters=this.filters.filter(n=>n!==t))}addDialogue(t,n){typeof n<"u"?this.dialogues.splice(n,0,t):this.dialogues.push(t)}updateDialogue(t,n){this.dialogues[t]=n}removeDialogue(t){this.dialogues=this.dialogues.filter(n=>n!==t)}swapDialogue(t,n){[this.dialogues[t],this.dialogues[n]]=[this.dialogues[n],this.dialogues[t]]}getChildByLabel(t){return this.children.find(n=>n.label===t)}getChildrenByAssetType(t){return this.children.filter(n=>n.assetType===t)}clone(){var i;const t=new Xe;t.label=this.label,t.config=ms(this.config),t.dialogues=ms(this.dialogues);const n=this.children.map(o=>o.clone(!0));return n.length>0&&t.addChild(...n),t.sounds=this.sounds.map(o=>o.clone(!0)),t.filters=((i=this.filters)==null?void 0:i.map(o=>o.clone(!0)))||null,t}toJSON(){return{__type:"Scene",name:this.name,label:this.label,config:this.config,dialogues:this.dialogues,children:this.children,sounds:this.sounds,filters:this.filters}}static async fromJSON(t,n=!0){const i=new Xe;n&&(i.name=t.name),i.label=t.label,i.config=t.config,i.dialogues=t.dialogues;const o=await Cd(t.children);return o.length>0&&i.addChild(...o),i.sounds=await kd(t.sounds),i.filters=await Zi(t.filters),i}async load({skipSoundLoading:t=!1}={}){const n=async i=>{if(typeof i.load=="function"&&await i.load(),i.children&&i.children.length>0)for(const o of i.children)await n(o)};for(const i of this.children)await n(i);if(!t)for(const i of this.sounds)await i.load()}}const Zd={version:"3.12.2",name:"text",init(a,s,t){var i,o,r;typeof s!="object"&&(s={value:s});let n=s.value;this.startText=((r=(o=(i=t.vars)==null?void 0:i.startAt)==null?void 0:o.text)==null?void 0:r.value)||"",this.target=a,this.startText&&(n=n.replace(this.startText,"")),n=n.split(""),this.from=t._from,this.text=n,this._props.push("text")},render(a,s){a>1?a=1:a<0&&(a=0),s.from&&(a=1-a);const{text:t,target:n,startText:i}=s,o=t.length,r=a*o+.5|0;n.text=i+t.slice(0,r).join("")}};class Zt{constructor(s,t){x(this,"options");x(this,"stage");x(this,"executeTime");x(this,"currentTime");var n;this.options=s,this.stage=t,this.executeTime=(n=s.executeTime)!=null?n:0,this.currentTime=0}load(){}check(){return!0}}class ne extends Zt{constructor(t,n){super(t,n);x(this,"target");this.options=t,this.target=this.stage.getChildByName(t.targetName,!0)}check(){return!!this.target}execute(){if(!this.target)return;const{fromVars:t,toVars:n}=this.options;this.target.visible=!0,typeof this.target.play=="function"&&this.target.play(),t&&n?he.fromTo(this.target,t,n):n&&he.to(this.target,n)}getDuration(){var t,n;return this.options.sequential&&(n=(t=this.options.toVars)==null?void 0:t.duration)!=null?n:0}}class ts extends Zt{constructor(t,n){super(t,n);x(this,"target");this.stage=n,this.target=this.stage.getSoundByName(t.targetName)}check(){return!!this.target}getDuration(){return 0}}class Vi extends Zt{constructor(s,t){super(s,t),this.options=s}execute(){const{fromVars:s,toVars:t}=this.options;s&&t?he.fromTo(this.stage,s,t):t&&he.to(this.stage,t)}getDuration(){var s,t;return this.options.sequential&&(t=(s=this.options.toVars)==null?void 0:s.duration)!=null?t:0}}class Na extends Zt{constructor(t,n){super(t,n);x(this,"target");this.options=t,this.stage=n,t.targetName&&(this.target=this.stage.getChildByName(t.targetName))}getDuration(){return 0}}class Ri extends ne{constructor(s,t){super(s,t),this.options=ee({toVars:{pixi:{visible:!0},ease:"none",duration:0}},s)}}class Wi extends ne{constructor(s,t){var n;super(s,t),this.target&&(this.options=ee({fromVars:{pixi:{alpha:0}},toVars:{pixi:{alpha:(n=this.target.alpha)!=null?n:1},ease:"power1.in",duration:.5}},s))}}const Hs="AutoMaskFilter",Gd={Show:Ri,FadeIn:Wi};class Ii extends ne{constructor(t,n){super(t,n);x(this,"speakerTarget");this.options=ee({autoShowSpeaker:{inEffect:"Show"},autoMaskOtherSpeakers:{alpha:.5}},t);const{speakerTargetName:i}=this.options;i&&(this.speakerTarget=this.stage.getChildByName(i))}execute(){const{name:t,autoShowSpeaker:n,autoMaskOtherSpeakers:i,executeTime:o}=this.options;if(this.target&&(this.target.visible=!0,this.target.text=t),n&&this.speakerTarget&&!this.speakerTarget.visible){const{inEffect:r="Show"}=n,c=Gd[r];new c({...n,executeTime:o,targetName:this.speakerTarget.name},this.stage).execute()}if(i){const{alpha:r=.5}=i;this.speakerTarget&&this.checkMaskFilter(this.speakerTarget)&&this.removeMaskFilter(this.speakerTarget),this.stage.children.forEach(c=>{c!==this.speakerTarget&&c.assetType==="Character"&&(this.checkMaskFilter(c)||this.addMaskFilter(c,r))})}}checkMaskFilter(t){var n;return(n=t.filters)==null?void 0:n.some(i=>i.name===Hs)}removeMaskFilter(t){var n;t.filters=((n=t.filters)==null?void 0:n.filter(i=>i.name!==Hs))||[]}addMaskFilter(t,n){const i=new Dt;i.name=Hs,i.alpha=n,t.filters?t.filters.push(i):t.filters=[i]}}class Td{constructor(){x(this,"sliceTaskList",[]);x(this,"soundRecordMap",new Map)}get(s){return this.soundRecordMap.get(s)}play(s,t){const n=this.soundRecordMap.get(s.name);if(n)ee(n,{...t,paused:!1});else{const{start:i,volume:o,loop:r,untilEnd:c}=t;this.soundRecordMap.set(s.name,{sound:s,paused:!1,elapsedTime:0,start:i!=null?i:0,volume:o!=null?o:1,loop:r!=null?r:!1,untilEnd:c!=null?c:!1})}}pause(s){const t=this.soundRecordMap.get(s.name);t&&(t.paused=!0)}stop(s){this.soundRecordMap.delete(s.name)}update(s,t){for(const n of this.soundRecordMap.values()){const{sound:i,paused:o,elapsedTime:r,start:c,loop:l,volume:m}=n;if(!o&&i.buffer){let h=r;const u=i.buffer.duration;if(h>u-c)if(l)h=h%(u-c);else continue;const f=1/t,p=md(i.buffer,h+c,f,m);n.elapsedTime=r+f,this.sliceTaskList.push(p)}}}async getAudioBuffers(){const s=await Promise.all(this.sliceTaskList);return this.sliceTaskList=[],s}resetExceptUtilEnd(){for(const[s,t]of this.soundRecordMap)t.untilEnd||this.soundRecordMap.delete(s)}reset(){this.sliceTaskList=[],this.soundRecordMap.clear()}}const Oe=new Td;class Vd extends ts{constructor(s,t){super(s,t),this.options=s}async load(){this.target.buffer||await this.target.load()}execute(){Oe.play(this.target,this.options)}getDuration(){var s,t;return this.options.sequential&&(t=(s=this.target.buffer)==null?void 0:s.duration)!=null?t:0}}class Rd extends ts{execute(){Oe.pause(this.target)}}class Wd extends ts{execute(){Oe.stop(this.target)}}class Li extends ts{constructor(s,t){super(s,t),this.options=s}async load(){this.target.buffer||await this.target.load()}execute(){Oe.play(this.target,this.options)}getDuration(){var s,t;return this.options.sequential&&(t=(s=this.target.buffer)==null?void 0:s.duration)!=null?t:0}}function Xi(a,s){return s.some(([t,n])=>t<=a&&a<=n)}function Bs(a){const s=a.charCodeAt(0);return Xi(s,[[12352,12447],[19968,40959],[44032,55203],[131072,191456]])}function Id(a){return" \n\r	".includes(a)}function Ld(a){const s=a.charCodeAt(0);return Xi(s,[[33,47],[58,64],[91,96],[123,126],[12288,12351],[65280,65519]])}function Xd(a,s){let t=0,n=0,i=a.length-1;const{wordBound:o=Id}=s;for(;o(a[n]);)n++;for(;o(a[i]);)i--;const r="".concat(a,"\n");for(let c=n;c<=i;c++)if((Bs(r[c])||!o(r[c])&&(o(r[c+1])||Bs(r[c+1])))&&t++,Bs(r[c]))for(;c<=i&&(Ld(r[c+1])||o(r[c+1]));)c++;return{total:t}}function Fd(a,s={}){const{wordsPerMin:t=500}=s,n=a.total/t;return{seconds:parseFloat((n*60).toFixed(1))}}function Kd(a,s={}){const t=Xd(a,s);return{...Fd(t,s),words:t}}class zd extends ne{constructor(t,n){super(t,n);x(this,"speakerDirective");x(this,"voiceDirective");x(this,"inlineList");x(this,"duration");x(this,"text");x(this,"tl");this.options=ee({interval:.2,sequential:!0,effect:"typewriter",effectDuration:.5,alignWithVoice:!0},t),this.duration=0,this.text="";const{speaker:i,voice:o,lines:r,executeTime:c}=this.options;i!=null&&i.targetName&&(this.speakerDirective=new Ii({...i,executeTime:c},n)),o!=null&&o.targetName&&(this.voiceDirective=new Li({...o,executeTime:c,sequential:!0},this.stage)),this.tl=he.timeline({paused:!0}),this.inlineList=[],r.forEach(l=>{if(l.type==="p")for(let m=0;m<l.children.length;m++){const h=l.children[m];if(h.type==="directive"){const{directive:u,params:f}=h.value,p=yi[u];if(p){const g=new p(f,n);this.inlineList.push({type:"directive",value:g,name:u})}}else if(h.text){let u=h.text;m===l.children.length-1&&(u+="\n"),this.inlineList.push({type:"text",value:u})}}})}check(){let t=!0;for(const n of this.inlineList)if(n.type==="directive"&&!n.value.check())throw t=!1,{type:"custom",message:"speak inline directive check failed",errorSceneName:this.stage.label,errorDirectiveName:n.name,errorLines:this.inlineList.filter(o=>o.type==="text").map(o=>o.value).join("").slice(0,10)};return t}async load(){this.voiceDirective&&await this.voiceDirective.load(),this.target&&(this.target.text="");for(const t of this.inlineList)if(t.type==="directive"){const n=t.value;await n.load(),this.tl.add(()=>{n.execute()},this.duration),this.duration+=n.getDuration()}else{const n=t.value,i=this.readingTime(n,this.options.wordsPerMin);this.textAnimate(n,i),this.duration+=i}}execute(){var t,n;this.target&&(this.target.visible=!0),this.tl.play(),(t=this.speakerDirective)==null||t.execute(),(n=this.voiceDirective)==null||n.execute()}textAnimate(t,n){const{effect:i}=this.options;switch(i){case"typewriter":this.typewriter(t,n);break;case"typewriteFadeIn":this.typewriteFadeIn(t,n);break;case"fadeIn":this.fadeIn(t,n);break;case"none":this.none(t);break}}typewriter(t,n){const i=this.text,o=i+t;this.tl.fromTo(this.target,{text:{value:i}},{text:{value:o},duration:n,ease:"none"},this.duration),this.text=o}typewriteFadeIn(t,n){const i=this.text,o=i+t,r=n/t.length;this.target.alpha=0;const c=[],l=this.target.style,m=Ja.measureText(o,l),h=m.lines;let u=this.target.y;h.forEach(f=>{let p=this.target.x;for(let g=0;g<f.length;g++){const v=f[g],b=new cn(v,l),V=Ja.measureText(v,l);b.x=p,b.y=u,b.alpha=c.length<i.length?1:0,b.zIndex=this.target.zIndex,p+=V.width,this.stage.addChild(b),c.push(b)}u+=m.lineHeight}),c.forEach((f,p)=>{p<i.length||this.tl.to(f,{alpha:1,duration:.3,onComplete:()=>{p===c.length-1&&c.forEach(g=>{this.stage.removeChild(g),this.target.text=o,this.target.alpha=1})}},this.duration+p*r)}),this.text=o}fadeIn(t,n){const{effectDuration:i}=this.options,o=this.text,r=o+t;this.tl.fromTo(this.target,{pixi:{alpha:0},text:{value:o}},{pixi:{alpha:1},text:{value:r},duration:Math.min(i!=null?i:.5,n),ease:"none"},this.duration),this.text=r}none(t){const i=this.text+t;this.tl.to(this.target,{pixi:{alpha:1},text:{value:i},duration:0,ease:"none"},this.duration),this.text=i}getDuration(){const{sequential:t,interval:n}=this.options;let i=this.duration;if(this.voiceDirective){const o=this.voiceDirective.getDuration();i=Math.max(i,o)}return i=i+(n!=null?n:0),t?i:0}readingTime(t,n=500){return t?Kd(t,{wordsPerMin:n}).seconds:0}}class Dd extends ne{constructor(s,t){super(s,t),this.options=ee({toVars:{pixi:{visible:!1},ease:"none",duration:0}},s)}}class Yd extends ne{constructor(s,t){super(s,t),this.options=ee({toVars:{pixi:{alpha:0},ease:"power1.in",duration:.5}},s)}}class Md extends ne{constructor(s,t){super(s,t),this.options={...s,immediate:!0}}async execute(){const{source:s,immediate:t}=this.options;this.target.changeSource(s),t?await this.target.load():he.to(this.target,{pixi:{alpha:0},duration:.3,onComplete:()=>{this.target.load().then(()=>{he.to(this.target,{pixi:{alpha:1},duration:.3})})}})}}class Hd extends ne{constructor(s,t){super(s,t);const n=this.target;if(!n)return;const i=n.width?n.width*.05:0,o=n.x,r=o-i,c=o+i;this.options=ee({toVars:{keyframes:{"0%":{x:o},"15%":{x:r},"30%":{x:c},"45%":{x:r},"60%":{x:c},"75%":{x:r},"90%":{x:c},"100%":{x:o}},duration:.5,ease:"none"}},s)}}class Bd extends ne{constructor(s,t){super(s,t);const n=this.target;if(!n)return;const i=n.height?n.height*.05:0,o=n.y,r=o-i,c=o+i;this.options=ee({toVars:{keyframes:{"0%":{y:o},"15%":{y:r},"30%":{y:c},"45%":{y:r},"60%":{y:c},"75%":{y:r},"90%":{y:c},"100%":{y:o}},duration:.5,ease:"none"}},s)}}class Pd extends ne{constructor(s,t){super(s,t);const n=this.target;if(!n)return;const i=n.x,o=n.y;n.anchor.set(.5),n.x=i+n.width*n.anchor.x,n.y=o+n.height*n.anchor.y,this.options=ee({toVars:{pixi:{scale:1.1},ease:"power1.in",duration:.5}},s)}}class Ad extends ne{constructor(s,t){super(s,t);const n=this.target;if(!n)return;const i=n.x,o=n.y;n.anchor.set(.5),n.x=i+n.width*n.anchor.x,n.y=o+n.height*n.anchor.y,this.options=ee({toVars:{pixi:{scale:.9},ease:"power1.out",duration:.5}},s)}}class Ud extends ne{constructor(s,t){var i,o;super(s,t);const n=this.target;n&&(this.options=ee({fromVars:{pixi:{x:n.x-n.width,alpha:0}},toVars:{pixi:{x:(i=n.x)!=null?i:0,alpha:(o=n.alpha)!=null?o:1},ease:"power1.in",duration:.5}},s))}}class Ed extends ne{constructor(s,t){super(s,t);const n=this.target;n&&(this.options=ee({toVars:{pixi:{x:n.x-n.width,alpha:0},ease:"power1.in",duration:.5}},s))}}class Od extends ne{constructor(s,t){var i,o;super(s,t);const n=this.target;n&&(this.options=ee({fromVars:{pixi:{x:n.x+n.width,alpha:0}},toVars:{pixi:{x:(i=n.x)!=null?i:0,alpha:(o=n.alpha)!=null?o:1},ease:"power1.in",duration:.5}},s))}}class Jd extends ne{constructor(s,t){super(s,t);const n=this.target;n&&(this.options=ee({toVars:{pixi:{x:n.x+n.width,alpha:0},ease:"power1.in",duration:.5}},s))}}class Qd extends Zt{constructor(s,t){super(s,t),this.options=ee({sequential:!0},s)}execute(){}getDuration(){return this.options.duration}}class _d extends Vi{constructor(s,t){super(s,t),this.options=ee({fromVars:{pixi:{alpha:0}},toVars:{pixi:{alpha:1},ease:"power1.in",duration:.3}},s)}}class $d extends Na{constructor(s,t){super(s,t),this.options=s}execute(){const{targetName:s,filterName:t}=this.options;s?this.target&&this.addFilter(this.target,t):this.addFilter(this.stage,t)}addFilter(s,t){const n=new ki[t];s.filters?s.filters.push(n):s.filters=[n]}}class qd extends Na{execute(){const{targetName:s}=this.options;s?this.target&&(this.target.filters=[]):this.stage.filters=[]}}he.registerPlugin(un);he.registerPlugin(Zd);un.registerPIXI(ar);he.ticker.remove(he.updateRoot);var C=(a=>(a.ChangeSource="ChangeSource",a.Speak="Speak",a.Speaker="Speaker",a.Show="Show",a.Hide="Hide",a.FadeIn="FadeIn",a.FadeOut="FadeOut",a.ShakeX="ShakeX",a.ShakeY="ShakeY",a.ZoomIn="ZoomIn",a.ZoomOut="ZoomOut",a.EnterFromLeft="EnterFromLeft",a.LeaveFromLeft="LeaveFromLeft",a.EnterFromRight="EnterFromRight",a.LeaveFromRight="LeaveFromRight",a.Wait="Wait",a.Play="Play",a.Pause="Pause",a.Stop="Stop",a.FadeInTransition="FadeInTransition",a.AddFilter="AddFilter",a.RemoveFilter="RemoveFilter",a))(C||{});const Ss=class Ss{constructor(s){x(this,"ticker");x(this,"renderer");x(this,"rendererOptions");x(this,"started");x(this,"subtitles");x(this,"connecter");x(this,"cutResolver");var o;this.ticker=Ke.shared,this.ticker.ctx={},this.ticker.globalTime=0,this.ticker.asyncHandlers=[],this.ticker.autoStart=!1,this.ticker.stop(),this.rendererOptions=Object.assign({},Ss.defaultRendererOptions,s),this.started=!1,this.subtitles=[];const{width:t,height:n,background:i}=this.rendererOptions;this.renderer=(o=this.rendererOptions.renderer)!=null?o:nr({view:new OffscreenCanvas(t,n),width:t,height:n,background:i})}connect(s){this.connecter=s,this.connecter.connect()}disconnect(){var s;(s=this.connecter)==null||s.disconnect(),this.connecter=void 0}hasStarted(){return this.started}async action(s){if(this.started)return;const t=performance.now();try{return await this.run(s)}catch(n){throw Fe.error("Error running screenplay:",n),n}finally{this.reset(),Fe.info("action cost:",performance.now()-t),this.cutResolver&&(this.cutResolver(!0),this.cutResolver=void 0)}}cut(){return new Promise(s=>{this.started=!1,this.cutResolver=s})}reset(){this.started=!1,this.subtitles=[],Oe.reset();let s=this.ticker._head.next;for(;s;)s=s.destroy(!0);this.ticker.time=0,this.ticker.globalTime=0,this.ticker.lastTime=-1,this.ticker.ctx={},this.ticker.asyncHandlers=[]}async parseSceneScript(s){const{scene:t}=s,{directives:n}=s;let i=0;const o=[];s.preload?await s.preload:await t.load(),t.children.forEach(h=>{h.visible=!1});const r=()=>{Fe.debug("switch scene exec:",this.ticker.time),he.updateRoot(0),Oe.resetExceptUtilEnd(),this.ticker.ctx.scene=t,o.forEach(u=>{this.ticker.add(u)});const h=()=>{const u=this.ticker.time;Oe.update(u,this.rendererOptions.fps);const f=async()=>{this.ticker.ctx.audioBuffers=await Oe.getAudioBuffers()};this.ticker.asyncHandlers.push(f()),he.updateRoot(u),this.ticker.ctx.scene&&(this.renderer.render(this.ticker.ctx.scene),this.ticker.ctx.imageSource=this.renderer.view)};return this.ticker.add(h),()=>{this.ticker.remove(h),this.ticker.time=0,this.ticker.lastTime=-1,this.ticker.ctx={},this.ticker.asyncHandlers=[]}};for(const h of n){const{directive:u,params:f}=h,p=yi[u];if(!p){Fe.error("Directive ".concat(u," not found"));continue}const g=i,v=new p({...f,executeTime:g},t);if(!v.check())throw{type:"custom",message:"directive check failed",errorSceneName:t.label,errorDirectiveName:u};v.load&&await v.load();const b=()=>{const{time:V,globalTime:R}=this.ticker;v.currentTime=V,bd(V,v.executeTime,1/this.rendererOptions.fps)&&(Fe.debug("execute directive:",v,V-v.executeTime),this.ticker.asyncHandlers.push(v.execute()),this.ticker.remove(b),u==="Speak"&&this.subtitles.push({start:R,end:R+v.getDuration(),text:v.options.text}))};o.push(b),i+=v.getDuration()}const{fps:c}=this.rendererOptions;return{frameCount:Math.ceil(i*c),install:r}}async run(s){var r,c;const{fps:t}=this.rendererOptions,{scenes:n}=s;let i=0;this.started=!0;for(const[l,m]of n.entries()){const h=await this.parseSceneScript(m),u=n[l+1];u&&(u.preload=u.scene.load());const f=h.install(),p=h.frameCount;for(let g=0;g<=p;g++){const v=g/t*1e3,b=i/t*1e3;if(this.started)this.ticker.time=v/1e3,this.ticker.update(v),this.ticker.globalTime=b/1e3,await Promise.all(this.ticker.asyncHandlers),(r=this.connecter)!=null&&r.connection&&await this.connecter.handle({timestamp:b,imageSource:this.ticker.ctx.imageSource,audioBuffers:this.ticker.ctx.audioBuffers}),this.rendererOptions.onProgress&&this.rendererOptions.onProgress((l/n.length+g/p/n.length)*100,b/1e3);else break;i++}f()}let o;return this.started&&((c=this.connecter)!=null&&c.connection)&&(o=await this.connecter.finish()),this.started=!1,{result:o,subtitles:this.subtitles}}};x(Ss,"defaultRendererOptions",{fps:30,width:1920,height:1080,background:0});let ea=Ss;class Fi{constructor(s){x(this,"connection");x(this,"options");this.connection=!1,this.options=s}connect(){this.connection=!0}disconnect(){this.connection=!1}}const Ki="dmFyIGZpPU9iamVjdC5kZWZpbmVQcm9wZXJ0eTt2YXIgY2k9KFIsRCxOKT0+RCBpbiBSP2ZpKFIsRCx7ZW51bWVyYWJsZTohMCxjb25maWd1cmFibGU6ITAsd3JpdGFibGU6ITAsdmFsdWU6Tn0pOlJbRF09Tjt2YXIgaz0oUixELE4pPT4oY2koUix0eXBlb2YgRCE9InN5bWJvbCI/RCsiIjpELE4pLE4pOyhmdW5jdGlvbigpeyJ1c2Ugc3RyaWN0Ijt2YXIgUj1PYmplY3QuZGVmaW5lUHJvcGVydHksRD1PYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzLE49T2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eSx0dD1PYmplY3QucHJvdG90eXBlLnByb3BlcnR5SXNFbnVtZXJhYmxlLHo9TWF0aC5wb3csemU9KGUsdCxpKT0+dCBpbiBlP1IoZSx0LHtlbnVtZXJhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMCx3cml0YWJsZTohMCx2YWx1ZTppfSk6ZVt0XT1pLGl0PShlLHQpPT57Zm9yKHZhciBpIGluIHR8fCh0PXt9KSlOLmNhbGwodCxpKSYmemUoZSxpLHRbaV0pO2lmKEQpZm9yKHZhciBpIG9mIEQodCkpdHQuY2FsbCh0LGkpJiZ6ZShlLGksdFtpXSk7cmV0dXJuIGV9LHdlPShlLHQsaSk9PntpZighdC5oYXMoZSkpdGhyb3cgVHlwZUVycm9yKCJDYW5ub3QgIitpKX0sbj0oZSx0LGkpPT4od2UoZSx0LCJyZWFkIGZyb20gcHJpdmF0ZSBmaWVsZCIpLGk/aS5jYWxsKGUpOnQuZ2V0KGUpKSxoPShlLHQsaSk9PntpZih0LmhhcyhlKSl0aHJvdyBUeXBlRXJyb3IoIkNhbm5vdCBhZGQgdGhlIHNhbWUgcHJpdmF0ZSBtZW1iZXIgbW9yZSB0aGFuIG9uY2UiKTt0IGluc3RhbmNlb2YgV2Vha1NldD90LmFkZChlKTp0LnNldChlLGkpfSxiPShlLHQsaSxzKT0+KHdlKGUsdCwid3JpdGUgdG8gcHJpdmF0ZSBmaWVsZCIpLHM/cy5jYWxsKGUsaSk6dC5zZXQoZSxpKSxpKSxwPShlLHQsaSk9Pih3ZShlLHQsImFjY2VzcyBwcml2YXRlIG1ldGhvZCIpLGkpLHU9bmV3IFVpbnQ4QXJyYXkoOCksQj1uZXcgRGF0YVZpZXcodS5idWZmZXIpLEw9ZT0+WyhlJTI1NisyNTYpJTI1Nl0sZj1lPT4oQi5zZXRVaW50MTYoMCxlLCExKSxbdVswXSx1WzFdXSksbnQ9ZT0+KEIuc2V0SW50MTYoMCxlLCExKSxbdVswXSx1WzFdXSksQmU9ZT0+KEIuc2V0VWludDMyKDAsZSwhMSksW3VbMV0sdVsyXSx1WzNdXSksYT1lPT4oQi5zZXRVaW50MzIoMCxlLCExKSxbdVswXSx1WzFdLHVbMl0sdVszXV0pLHN0PWU9PihCLnNldFVpbnQzMigwLE1hdGguZmxvb3IoZS96KDIsMzIpKSwhMSksQi5zZXRVaW50MzIoNCxlLCExKSxbdVswXSx1WzFdLHVbMl0sdVszXSx1WzRdLHVbNV0sdVs2XSx1WzddXSksZ2U9ZT0+KEIuc2V0SW50MTYoMCx6KDIsOCkqZSwhMSksW3VbMF0sdVsxXV0pLFA9ZT0+KEIuc2V0SW50MzIoMCx6KDIsMTYpKmUsITEpLFt1WzBdLHVbMV0sdVsyXSx1WzNdXSksbWU9ZT0+KEIuc2V0SW50MzIoMCx6KDIsMzApKmUsITEpLFt1WzBdLHVbMV0sdVsyXSx1WzNdXSksVz0oZSx0PSExKT0+e2xldCBpPUFycmF5KGUubGVuZ3RoKS5maWxsKG51bGwpLm1hcCgocyxyKT0+ZS5jaGFyQ29kZUF0KHIpKTtyZXR1cm4gdCYmaS5wdXNoKDApLGl9LHg9ZT0+ZSYmZVtlLmxlbmd0aC0xXSxZPShlLHQsaT0hMCk9PntsZXQgcz1lKnQ7cmV0dXJuIGk/TWF0aC5yb3VuZChzKTpzfSxrZT1lPT57bGV0IHQ9ZSooTWF0aC5QSS8xODApLGk9TWF0aC5jb3ModCkscz1NYXRoLnNpbih0KTtyZXR1cm5baSxzLDAsLXMsaSwwLDAsMCwxXX0scnQ9a2UoMCksRmU9ZT0+W1AoZVswXSksUChlWzFdKSxtZShlWzJdKSxQKGVbM10pLFAoZVs0XSksbWUoZVs1XSksUChlWzZdKSxQKGVbN10pLG1lKGVbOF0pXSxtPShlLHQsaSk9Pih7dHlwZTplLGNvbnRlbnRzOnQmJm5ldyBVaW50OEFycmF5KHQuZmxhdCgxMCkpLGNoaWxkcmVuOml9KSx5PShlLHQsaSxzLHIpPT5tKGUsW0wodCksQmUoaSkscyE9bnVsbD9zOltdXSxyKSxhdD1lPT5lP20oImZ0eXAiLFtXKCJpc29tIiksYSgwKSxXKCJpc280IiksVygiaHZjMSIpXSk6bSgiZnR5cCIsW1coImlzb20iKSxhKDApLFcoImlzb20iKSxXKCJhdmMxIiksVygibXA0MSIpXSksb3Q9KCk9Pih7dHlwZToibWRhdCIsbGFyZ2VTaXplOiEwfSksbHQ9KGUsdCk9Pm0oIm1vb3YiLG51bGwsW2h0KHQsZSksLi4uZS5tYXAoaT0+dXQoaSx0KSldKSxodD0oZSx0KT0+e2xldCBpPVkoTWF0aC5tYXgoMCwuLi50LmZpbHRlcihyPT5yLnNhbXBsZXMubGVuZ3RoPjApLm1hcChyPT54KHIuc2FtcGxlcykudGltZXN0YW1wK3goci5zYW1wbGVzKS5kdXJhdGlvbikpLEVlKSxzPU1hdGgubWF4KC4uLnQubWFwKHI9PnIuaWQpKSsxO3JldHVybiB5KCJtdmhkIiwwLDAsW2EoZSksYShlKSxhKEVlKSxhKGkpLFAoMSksZ2UoMSksQXJyYXkoMTApLmZpbGwoMCksRmUocnQpLEFycmF5KDI0KS5maWxsKDApLGEocyldKX0sdXQ9KGUsdCk9Pm0oInRyYWsiLG51bGwsW2R0KGUsdCksZnQoZSx0KV0pLGR0PShlLHQpPT57bGV0IGk9eChlLnNhbXBsZXMpLHM9WShpP2kudGltZXN0YW1wK2kuZHVyYXRpb246MCxFZSk7cmV0dXJuIHkoInRraGQiLDAsMyxbYSh0KSxhKHQpLGEoZS5pZCksYSgwKSxhKHMpLEFycmF5KDgpLmZpbGwoMCksZigwKSxmKDApLGdlKGUuaW5mby50eXBlPT09ImF1ZGlvIj8xOjApLGYoMCksRmUoa2UoZS5pbmZvLnR5cGU9PT0idmlkZW8iP2UuaW5mby5yb3RhdGlvbjowKSksUChlLmluZm8udHlwZT09PSJ2aWRlbyI/ZS5pbmZvLndpZHRoOjApLFAoZS5pbmZvLnR5cGU9PT0idmlkZW8iP2UuaW5mby5oZWlnaHQ6MCldKX0sZnQ9KGUsdCk9Pm0oIm1kaWEiLG51bGwsW2N0KGUsdCksdnQoZS5pbmZvLnR5cGU9PT0idmlkZW8iPyJ2aWRlIjoic291biIpLHB0KGUpXSksY3Q9KGUsdCk9PntsZXQgaT14KGUuc2FtcGxlcykscz1ZKGk/aS50aW1lc3RhbXAraS5kdXJhdGlvbjowLGUudGltZXNjYWxlKTtyZXR1cm4geSgibWRoZCIsMCwwLFthKHQpLGEodCksYShlLnRpbWVzY2FsZSksYShzKSxmKDIxOTU2KSxmKDApXSl9LHZ0PWU9PnkoImhkbHIiLDAsMCxbVygibWhsciIpLFcoZSksYSgwKSxhKDApLGEoMCksVygibXA0LW11eGVyLWhkbHIiKV0pLHB0PWU9Pm0oIm1pbmYiLG51bGwsW2UuaW5mby50eXBlPT09InZpZGVvIj93dCgpOmd0KCksbXQoKSxfdChlKV0pLHd0PSgpPT55KCJ2bWhkIiwwLDEsW2YoMCksZigwKSxmKDApLGYoMCldKSxndD0oKT0+eSgic21oZCIsMCwwLFtmKDApLGYoMCldKSxtdD0oKT0+bSgiZGluZiIsbnVsbCxbeXQoKV0pLHl0PSgpPT55KCJkcmVmIiwwLDAsW2EoMSldLFtDdCgpXSksQ3Q9KCk9PnkoInVybCAiLDAsMSksX3Q9ZT0+bSgic3RibCIsbnVsbCxbVHQoZSksVXQoZSksRHQoZSksUHQoZSksV3QoZSksenQoZSldKSxUdD1lPT55KCJzdHNkIiwwLDAsW2EoMSldLFtlLmluZm8udHlwZT09PSJ2aWRlbyI/U3QoQnRbZS5pbmZvLmNvZGVjXSxlKTpMdChGdFtlLmluZm8uY29kZWNdLGUpXSksU3Q9KGUsdCk9Pm0oZSxbQXJyYXkoNikuZmlsbCgwKSxmKDEpLGYoMCksZigwKSxBcnJheSgxMikuZmlsbCgwKSxmKHQuaW5mby53aWR0aCksZih0LmluZm8uaGVpZ2h0KSxhKDQ3MTg1OTIpLGEoNDcxODU5MiksYSgwKSxmKDEpLEFycmF5KDMyKS5maWxsKDApLGYoMjQpLG50KDY1NTM1KV0sW2t0W3QuaW5mby5jb2RlY10odCldKSxFdD1lPT5lLmNvZGVjUHJpdmF0ZSYmbSgiYXZjQyIsWy4uLmUuY29kZWNQcml2YXRlXSksYnQ9ZT0+ZS5jb2RlY1ByaXZhdGUmJm0oImh2Y0MiLFsuLi5lLmNvZGVjUHJpdmF0ZV0pLEl0PWU9PmUuY29kZWNQcml2YXRlJiZtKCJ2cGNDIixbLi4uZS5jb2RlY1ByaXZhdGVdKSxBdD1lPT5lLmNvZGVjUHJpdmF0ZSYmbSgiYXYxQyIsWy4uLmUuY29kZWNQcml2YXRlXSksTHQ9KGUsdCk9Pm0oZSxbQXJyYXkoNikuZmlsbCgwKSxmKDEpLGYoMCksZigwKSxhKDApLGYodC5pbmZvLm51bWJlck9mQ2hhbm5lbHMpLGYoMTYpLGYoMCksZigwKSxQKHQuaW5mby5zYW1wbGVSYXRlKV0sW1J0W3QuaW5mby5jb2RlY10odCldKSxNdD1lPT55KCJlc2RzIiwwLDAsW2EoNTg3NTMxNTIpLEwoMzIrZS5jb2RlY1ByaXZhdGUuYnl0ZUxlbmd0aCksZigxKSxMKDApLGEoNzU1MzAzNjgpLEwoMTgrZS5jb2RlY1ByaXZhdGUuYnl0ZUxlbmd0aCksTCg2NCksTCgyMSksQmUoMCksYSgxMzAwNzEpLGEoMTMwMDcxKSxhKDkyMzA3NTg0KSxMKGUuY29kZWNQcml2YXRlLmJ5dGVMZW5ndGgpLC4uLmUuY29kZWNQcml2YXRlLGEoMTA5MDg0ODAwKSxMKDEpLEwoMildKSxPdD1lPT5tKCJkT3BzIixbTCgwKSxMKGUuaW5mby5udW1iZXJPZkNoYW5uZWxzKSxmKDM4NDApLGEoZS5pbmZvLnNhbXBsZVJhdGUpLGdlKDApLEwoMCldKSxVdD1lPT55KCJzdHRzIiwwLDAsW2EoZS50aW1lVG9TYW1wbGVUYWJsZS5sZW5ndGgpLGUudGltZVRvU2FtcGxlVGFibGUubWFwKHQ9PlthKHQuc2FtcGxlQ291bnQpLGEodC5zYW1wbGVEZWx0YSldKV0pLER0PWU9PntpZihlLnNhbXBsZXMuZXZlcnkoaT0+aS50eXBlPT09ImtleSIpKXJldHVybiBudWxsO2xldCB0PVsuLi5lLnNhbXBsZXMuZW50cmllcygpXS5maWx0ZXIoKFssaV0pPT5pLnR5cGU9PT0ia2V5Iik7cmV0dXJuIHkoInN0c3MiLDAsMCxbYSh0Lmxlbmd0aCksdC5tYXAoKFtpXSk9PmEoaSsxKSldKX0sUHQ9ZT0+eSgic3RzYyIsMCwwLFthKGUuY29tcGFjdGx5Q29kZWRDaHVua1RhYmxlLmxlbmd0aCksZS5jb21wYWN0bHlDb2RlZENodW5rVGFibGUubWFwKHQ9PlthKHQuZmlyc3RDaHVuayksYSh0LnNhbXBsZXNQZXJDaHVuayksYSgxKV0pXSksV3Q9ZT0+eSgic3RzeiIsMCwwLFthKDApLGEoZS5zYW1wbGVzLmxlbmd0aCksZS5zYW1wbGVzLm1hcCh0PT5hKHQuc2l6ZSkpXSksenQ9ZT0+ZS53cml0dGVuQ2h1bmtzLmxlbmd0aD4wJiZ4KGUud3JpdHRlbkNodW5rcykub2Zmc2V0Pj16KDIsMzIpP3koImNvNjQiLDAsMCxbYShlLndyaXR0ZW5DaHVua3MubGVuZ3RoKSxlLndyaXR0ZW5DaHVua3MubWFwKHQ9PnN0KHQub2Zmc2V0KSldKTp5KCJzdGNvIiwwLDAsW2EoZS53cml0dGVuQ2h1bmtzLmxlbmd0aCksZS53cml0dGVuQ2h1bmtzLm1hcCh0PT5hKHQub2Zmc2V0KSldKSxCdD17YXZjOiJhdmMxIixoZXZjOiJodmMxIix2cDk6InZwMDkiLGF2MToiYXYwMSJ9LGt0PXthdmM6RXQsaGV2YzpidCx2cDk6SXQsYXYxOkF0fSxGdD17YWFjOiJtcDRhIixvcHVzOiJvcHVzIn0sUnQ9e2FhYzpNdCxvcHVzOk90fSxSZT1jbGFzc3tjb25zdHJ1Y3Rvcigpe3RoaXMuYnVmZmVyPW51bGx9fSxOZT1jbGFzc3tjb25zdHJ1Y3RvcihlLHQsaSl7dGhpcy5vbkRhdGE9ZSx0aGlzLm9uRG9uZT10LHRoaXMub3B0aW9ucz1pfX0sTnQ9Y2xhc3N7Y29uc3RydWN0b3IoZSx0KXt0aGlzLnN0cmVhbT1lLHRoaXMub3B0aW9ucz10fX0sSCxLLHllPWNsYXNze2NvbnN0cnVjdG9yKCl7dGhpcy5wb3M9MCxoKHRoaXMsSCxuZXcgVWludDhBcnJheSg4KSksaCh0aGlzLEssbmV3IERhdGFWaWV3KG4odGhpcyxIKS5idWZmZXIpKSx0aGlzLm9mZnNldHM9bmV3IFdlYWtNYXB9c2VlayhlKXt0aGlzLnBvcz1lfXdyaXRlVTMyKGUpe24odGhpcyxLKS5zZXRVaW50MzIoMCxlLCExKSx0aGlzLndyaXRlKG4odGhpcyxIKS5zdWJhcnJheSgwLDQpKX13cml0ZVU2NChlKXtuKHRoaXMsSykuc2V0VWludDMyKDAsTWF0aC5mbG9vcihlL3ooMiwzMikpLCExKSxuKHRoaXMsSykuc2V0VWludDMyKDQsZSwhMSksdGhpcy53cml0ZShuKHRoaXMsSCkuc3ViYXJyYXkoMCw4KSl9d3JpdGVBc2NpaShlKXtmb3IobGV0IHQ9MDt0PGUubGVuZ3RoO3QrKyluKHRoaXMsSykuc2V0VWludDgodCU4LGUuY2hhckNvZGVBdCh0KSksdCU4PT09NyYmdGhpcy53cml0ZShuKHRoaXMsSCkpO2UubGVuZ3RoJTghPT0wJiZ0aGlzLndyaXRlKG4odGhpcyxIKS5zdWJhcnJheSgwLGUubGVuZ3RoJTgpKX13cml0ZUJveChlKXt2YXIgdCxpO2lmKHRoaXMub2Zmc2V0cy5zZXQoZSx0aGlzLnBvcyksZS5jb250ZW50cyYmIWUuY2hpbGRyZW4pdGhpcy53cml0ZUJveEhlYWRlcihlLCh0PWUuc2l6ZSkhPW51bGw/dDplLmNvbnRlbnRzLmJ5dGVMZW5ndGgrOCksdGhpcy53cml0ZShlLmNvbnRlbnRzKTtlbHNle2xldCBzPXRoaXMucG9zO2lmKHRoaXMud3JpdGVCb3hIZWFkZXIoZSwwKSxlLmNvbnRlbnRzJiZ0aGlzLndyaXRlKGUuY29udGVudHMpLGUuY2hpbGRyZW4pZm9yKGxldCBvIG9mIGUuY2hpbGRyZW4pbyYmdGhpcy53cml0ZUJveChvKTtsZXQgcj10aGlzLnBvcyxkPShpPWUuc2l6ZSkhPW51bGw/aTpyLXM7dGhpcy5zZWVrKHMpLHRoaXMud3JpdGVCb3hIZWFkZXIoZSxkKSx0aGlzLnNlZWsocil9fXdyaXRlQm94SGVhZGVyKGUsdCl7dGhpcy53cml0ZVUzMihlLmxhcmdlU2l6ZT8xOnQpLHRoaXMud3JpdGVBc2NpaShlLnR5cGUpLGUubGFyZ2VTaXplJiZ0aGlzLndyaXRlVTY0KHQpfXBhdGNoQm94KGUpe2xldCB0PXRoaXMucG9zO3RoaXMuc2Vlayh0aGlzLm9mZnNldHMuZ2V0KGUpKSx0aGlzLndyaXRlQm94KGUpLHRoaXMuc2Vlayh0KX19O0g9bmV3IFdlYWtNYXAsSz1uZXcgV2Vha01hcDt2YXIgc2UsVixKLHJlLENlLHh0PWNsYXNzIGV4dGVuZHMgeWV7Y29uc3RydWN0b3IoZSl7c3VwZXIoKSxoKHRoaXMscmUpLGgodGhpcyxzZSx2b2lkIDApLGgodGhpcyxWLG5ldyBBcnJheUJ1ZmZlcih6KDIsMTYpKSksaCh0aGlzLEosbmV3IFVpbnQ4QXJyYXkobih0aGlzLFYpKSksYih0aGlzLHNlLGUpfXdyaXRlKGUpe3AodGhpcyxyZSxDZSkuY2FsbCh0aGlzLHRoaXMucG9zK2UuYnl0ZUxlbmd0aCksbih0aGlzLEopLnNldChlLHRoaXMucG9zKSx0aGlzLnBvcys9ZS5ieXRlTGVuZ3RofWZpbmFsaXplKCl7cCh0aGlzLHJlLENlKS5jYWxsKHRoaXMsdGhpcy5wb3MpLG4odGhpcyxzZSkuYnVmZmVyPW4odGhpcyxWKS5zbGljZSgwLHRoaXMucG9zKX19O3NlPW5ldyBXZWFrTWFwLFY9bmV3IFdlYWtNYXAsSj1uZXcgV2Vha01hcCxyZT1uZXcgV2Vha1NldCxDZT1mdW5jdGlvbihlKXtsZXQgdD1uKHRoaXMsVikuYnl0ZUxlbmd0aDtmb3IoO3Q8ZTspdCo9MjtpZih0PT09bih0aGlzLFYpLmJ5dGVMZW5ndGgpcmV0dXJuO2xldCBpPW5ldyBBcnJheUJ1ZmZlcih0KSxzPW5ldyBVaW50OEFycmF5KGkpO3Muc2V0KG4odGhpcyxKKSwwKSxiKHRoaXMsVixpKSxiKHRoaXMsSixzKX07dmFyIFosJCx4ZT1jbGFzcyBleHRlbmRzIHlle2NvbnN0cnVjdG9yKGUpe3N1cGVyKCksaCh0aGlzLFosdm9pZCAwKSxoKHRoaXMsJCxbXSksYih0aGlzLFosZSl9d3JpdGUoZSl7bih0aGlzLCQpLnB1c2goe2RhdGE6ZS5zbGljZSgpLHN0YXJ0OnRoaXMucG9zfSksdGhpcy5wb3MrPWUuYnl0ZUxlbmd0aH1mbHVzaCgpe2lmKG4odGhpcywkKS5sZW5ndGg9PT0wKXJldHVybjtsZXQgZT1bXSx0PVsuLi5uKHRoaXMsJCldLnNvcnQoKGkscyk9Pmkuc3RhcnQtcy5zdGFydCk7ZS5wdXNoKHtzdGFydDp0WzBdLnN0YXJ0LHNpemU6dFswXS5kYXRhLmJ5dGVMZW5ndGh9KTtmb3IobGV0IGk9MTtpPHQubGVuZ3RoO2krKyl7bGV0IHM9ZVtlLmxlbmd0aC0xXSxyPXRbaV07ci5zdGFydDw9cy5zdGFydCtzLnNpemU/cy5zaXplPU1hdGgubWF4KHMuc2l6ZSxyLnN0YXJ0K3IuZGF0YS5ieXRlTGVuZ3RoLXMuc3RhcnQpOmUucHVzaCh7c3RhcnQ6ci5zdGFydCxzaXplOnIuZGF0YS5ieXRlTGVuZ3RofSl9Zm9yKGxldCBpIG9mIGUpe2kuZGF0YT1uZXcgVWludDhBcnJheShpLnNpemUpO2ZvcihsZXQgcyBvZiBuKHRoaXMsJCkpaS5zdGFydDw9cy5zdGFydCYmcy5zdGFydDxpLnN0YXJ0K2kuc2l6ZSYmaS5kYXRhLnNldChzLmRhdGEscy5zdGFydC1pLnN0YXJ0KTtuKHRoaXMsWikub25EYXRhKGkuZGF0YSxpLnN0YXJ0KX1uKHRoaXMsJCkubGVuZ3RoPTB9ZmluYWxpemUoKXt2YXIgZSx0Oyh0PShlPW4odGhpcyxaKSkub25Eb25lKT09bnVsbHx8dC5jYWxsKGUpfX07Wj1uZXcgV2Vha01hcCwkPW5ldyBXZWFrTWFwO3ZhciBIdD16KDIsMjQpLFZ0PTIsaixNLEksYWUsX2UsVGUsSGUsU2UsVmUsZWUsb2UsJGU9Y2xhc3MgZXh0ZW5kcyB5ZXtjb25zdHJ1Y3RvcihlKXt2YXIgdCxpO2lmKHN1cGVyKCksaCh0aGlzLGFlKSxoKHRoaXMsVGUpLGgodGhpcyxTZSksaCh0aGlzLGVlKSxoKHRoaXMsaix2b2lkIDApLGgodGhpcyxNLHZvaWQgMCksaCh0aGlzLEksW10pLGIodGhpcyxqLGUpLGIodGhpcyxNLChpPSh0PWUub3B0aW9ucyk9PW51bGw/dm9pZCAwOnQuY2h1bmtTaXplKSE9bnVsbD9pOkh0KSwhTnVtYmVyLmlzSW50ZWdlcihuKHRoaXMsTSkpfHxuKHRoaXMsTSk8eigyLDEwKSl0aHJvdyBuZXcgRXJyb3IoIkludmFsaWQgU3RyZWFtVGFyZ2V0IG9wdGlvbnM6IGNodW5rU2l6ZSBtdXN0IGJlIGFuIGludGVnZXIgbm90IHNtYWxsZXIgdGhhbiAxMDI0LiIpfXdyaXRlKGUpe3AodGhpcyxhZSxfZSkuY2FsbCh0aGlzLGUsdGhpcy5wb3MpLHAodGhpcyxlZSxvZSkuY2FsbCh0aGlzKSx0aGlzLnBvcys9ZS5ieXRlTGVuZ3RofWZpbmFsaXplKCl7dmFyIGUsdDtwKHRoaXMsZWUsb2UpLmNhbGwodGhpcywhMCksKHQ9KGU9bih0aGlzLGopKS5vbkRvbmUpPT1udWxsfHx0LmNhbGwoZSl9fTtqPW5ldyBXZWFrTWFwLE09bmV3IFdlYWtNYXAsST1uZXcgV2Vha01hcCxhZT1uZXcgV2Vha1NldCxfZT1mdW5jdGlvbihlLHQpe2xldCBpPW4odGhpcyxJKS5maW5kSW5kZXgoYz0+Yy5zdGFydDw9dCYmdDxjLnN0YXJ0K24odGhpcyxNKSk7aT09PS0xJiYoaT1wKHRoaXMsU2UsVmUpLmNhbGwodGhpcyx0KSk7bGV0IHM9bih0aGlzLEkpW2ldLHI9dC1zLnN0YXJ0LGQ9ZS5zdWJhcnJheSgwLE1hdGgubWluKG4odGhpcyxNKS1yLGUuYnl0ZUxlbmd0aCkpO3MuZGF0YS5zZXQoZCxyKTtsZXQgbz17c3RhcnQ6cixlbmQ6citkLmJ5dGVMZW5ndGh9O2lmKHAodGhpcyxUZSxIZSkuY2FsbCh0aGlzLHMsbykscy53cml0dGVuWzBdLnN0YXJ0PT09MCYmcy53cml0dGVuWzBdLmVuZD09PW4odGhpcyxNKSYmKHMuc2hvdWxkRmx1c2g9ITApLG4odGhpcyxJKS5sZW5ndGg+VnQpe2ZvcihsZXQgYz0wO2M8bih0aGlzLEkpLmxlbmd0aC0xO2MrKyluKHRoaXMsSSlbY10uc2hvdWxkRmx1c2g9ITA7cCh0aGlzLGVlLG9lKS5jYWxsKHRoaXMpfWQuYnl0ZUxlbmd0aDxlLmJ5dGVMZW5ndGgmJnAodGhpcyxhZSxfZSkuY2FsbCh0aGlzLGUuc3ViYXJyYXkoZC5ieXRlTGVuZ3RoKSx0K2QuYnl0ZUxlbmd0aCl9LFRlPW5ldyBXZWFrU2V0LEhlPWZ1bmN0aW9uKGUsdCl7bGV0IGk9MCxzPWUud3JpdHRlbi5sZW5ndGgtMSxyPS0xO2Zvcig7aTw9czspe2xldCBkPU1hdGguZmxvb3IoaSsocy1pKzEpLzIpO2Uud3JpdHRlbltkXS5zdGFydDw9dC5zdGFydD8oaT1kKzEscj1kKTpzPWQtMX1mb3IoZS53cml0dGVuLnNwbGljZShyKzEsMCx0KSwocj09PS0xfHxlLndyaXR0ZW5bcl0uZW5kPHQuc3RhcnQpJiZyKys7cjxlLndyaXR0ZW4ubGVuZ3RoLTEmJmUud3JpdHRlbltyXS5lbmQ+PWUud3JpdHRlbltyKzFdLnN0YXJ0OyllLndyaXR0ZW5bcl0uZW5kPU1hdGgubWF4KGUud3JpdHRlbltyXS5lbmQsZS53cml0dGVuW3IrMV0uZW5kKSxlLndyaXR0ZW4uc3BsaWNlKHIrMSwxKX0sU2U9bmV3IFdlYWtTZXQsVmU9ZnVuY3Rpb24oZSl7bGV0IGk9e3N0YXJ0Ok1hdGguZmxvb3IoZS9uKHRoaXMsTSkpKm4odGhpcyxNKSxkYXRhOm5ldyBVaW50OEFycmF5KG4odGhpcyxNKSksd3JpdHRlbjpbXSxzaG91bGRGbHVzaDohMX07cmV0dXJuIG4odGhpcyxJKS5wdXNoKGkpLG4odGhpcyxJKS5zb3J0KChzLHIpPT5zLnN0YXJ0LXIuc3RhcnQpLG4odGhpcyxJKS5pbmRleE9mKGkpfSxlZT1uZXcgV2Vha1NldCxvZT1mdW5jdGlvbihlPSExKXtmb3IobGV0IHQ9MDt0PG4odGhpcyxJKS5sZW5ndGg7dCsrKXtsZXQgaT1uKHRoaXMsSSlbdF07aWYoISghaS5zaG91bGRGbHVzaCYmIWUpKXtmb3IobGV0IHMgb2YgaS53cml0dGVuKW4odGhpcyxqKS5vbkRhdGEoaS5kYXRhLnN1YmFycmF5KHMuc3RhcnQscy5lbmQpLGkuc3RhcnQrcy5zdGFydCk7bih0aGlzLEkpLnNwbGljZSh0LS0sMSl9fX07dmFyICR0PWNsYXNzIGV4dGVuZHMgJGV7Y29uc3RydWN0b3IoZSl7dmFyIHQ7c3VwZXIobmV3IE5lKChpLHMpPT5lLnN0cmVhbS53cml0ZSh7dHlwZToid3JpdGUiLGRhdGE6aSxwb3NpdGlvbjpzfSksdm9pZCAwLHtjaHVua1NpemU6KHQ9ZS5vcHRpb25zKT09bnVsbD92b2lkIDA6dC5jaHVua1NpemV9KSl9fSxFZT0xZTMsR3Q9WyJhdmMiLCJoZXZjIiwidnA5IiwiYXYxIl0sWHQ9WyJhYWMiLCJvcHVzIl0scXQ9MjA4Mjg0NDgwMCxLdD0uNSxRdD1bInN0cmljdCIsIm9mZnNldCJdLGcsQyxHLFgscSxiZSxsZSxJZSxHZSxBZSxYZSxMZSxxZSxNZSxLZSxoZSxPZSxVZSxRZSx0ZSx1ZSxpZSxkZSxmZSxEZSxZdD1jbGFzc3tjb25zdHJ1Y3RvcihlKXtoKHRoaXMsSWUpLGgodGhpcyxBZSksaCh0aGlzLExlKSxoKHRoaXMsTWUpLGgodGhpcyxoZSksaCh0aGlzLFVlKSxoKHRoaXMsdGUpLGgodGhpcyxpZSksaCh0aGlzLGZlKSxoKHRoaXMsZyx2b2lkIDApLGgodGhpcyxDLHZvaWQgMCksaCh0aGlzLEcsdm9pZCAwKSxoKHRoaXMsWCxudWxsKSxoKHRoaXMscSxudWxsKSxoKHRoaXMsYmUsTWF0aC5mbG9vcihEYXRlLm5vdygpLzFlMykrcXQpLGgodGhpcyxsZSwhMSk7dmFyIHQ7aWYocCh0aGlzLEllLEdlKS5jYWxsKHRoaXMsZSksdGhpcy50YXJnZXQ9ZS50YXJnZXQsYih0aGlzLGcsaXQoe2ZpcnN0VGltZXN0YW1wQmVoYXZpb3I6InN0cmljdCJ9LGUpKSxlLnRhcmdldCBpbnN0YW5jZW9mIFJlKWIodGhpcyxDLG5ldyB4dChlLnRhcmdldCkpO2Vsc2UgaWYoZS50YXJnZXQgaW5zdGFuY2VvZiBOZSliKHRoaXMsQywodD1lLnRhcmdldC5vcHRpb25zKSE9bnVsbCYmdC5jaHVua2VkP25ldyAkZShlLnRhcmdldCk6bmV3IHhlKGUudGFyZ2V0KSk7ZWxzZSBpZihlLnRhcmdldCBpbnN0YW5jZW9mIE50KWIodGhpcyxDLG5ldyAkdChlLnRhcmdldCkpO2Vsc2UgdGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIHRhcmdldDogIi5jb25jYXQoZS50YXJnZXQpKTtwKHRoaXMsQWUsWGUpLmNhbGwodGhpcykscCh0aGlzLExlLHFlKS5jYWxsKHRoaXMpfWFkZFZpZGVvQ2h1bmsoZSx0LGkpe2xldCBzPW5ldyBVaW50OEFycmF5KGUuYnl0ZUxlbmd0aCk7ZS5jb3B5VG8ocyksdGhpcy5hZGRWaWRlb0NodW5rUmF3KHMsZS50eXBlLGkhPW51bGw/aTplLnRpbWVzdGFtcCxlLmR1cmF0aW9uLHQpfWFkZFZpZGVvQ2h1bmtSYXcoZSx0LGkscyxyKXtpZihwKHRoaXMsZmUsRGUpLmNhbGwodGhpcyksIW4odGhpcyxnKS52aWRlbyl0aHJvdyBuZXcgRXJyb3IoIk5vIHZpZGVvIHRyYWNrIGRlY2xhcmVkLiIpO3AodGhpcyxoZSxPZSkuY2FsbCh0aGlzLG4odGhpcyxYKSxlLHQsaSxzLHIpfWFkZEF1ZGlvQ2h1bmsoZSx0LGkpe2xldCBzPW5ldyBVaW50OEFycmF5KGUuYnl0ZUxlbmd0aCk7ZS5jb3B5VG8ocyksdGhpcy5hZGRBdWRpb0NodW5rUmF3KHMsZS50eXBlLGkhPW51bGw/aTplLnRpbWVzdGFtcCxlLmR1cmF0aW9uLHQpfWFkZEF1ZGlvQ2h1bmtSYXcoZSx0LGkscyxyKXtpZihwKHRoaXMsZmUsRGUpLmNhbGwodGhpcyksIW4odGhpcyxnKS5hdWRpbyl0aHJvdyBuZXcgRXJyb3IoIk5vIGF1ZGlvIHRyYWNrIGRlY2xhcmVkLiIpO3AodGhpcyxoZSxPZSkuY2FsbCh0aGlzLG4odGhpcyxxKSxlLHQsaSxzLHIpfWZpbmFsaXplKCl7bih0aGlzLFgpJiZwKHRoaXMsdGUsdWUpLmNhbGwodGhpcyxuKHRoaXMsWCkpLG4odGhpcyxxKSYmcCh0aGlzLHRlLHVlKS5jYWxsKHRoaXMsbih0aGlzLHEpKTtsZXQgZT1uKHRoaXMsQykub2Zmc2V0cy5nZXQobih0aGlzLEcpKSx0PW4odGhpcyxDKS5wb3MtZTtuKHRoaXMsRykuc2l6ZT10LG4odGhpcyxDKS5wYXRjaEJveChuKHRoaXMsRykpO2xldCBpPWx0KFtuKHRoaXMsWCksbih0aGlzLHEpXS5maWx0ZXIoQm9vbGVhbiksbih0aGlzLGJlKSk7bih0aGlzLEMpLndyaXRlQm94KGkpLHAodGhpcyxpZSxkZSkuY2FsbCh0aGlzKSxuKHRoaXMsQykuZmluYWxpemUoKSxiKHRoaXMsbGUsITApfX07Zz1uZXcgV2Vha01hcCxDPW5ldyBXZWFrTWFwLEc9bmV3IFdlYWtNYXAsWD1uZXcgV2Vha01hcCxxPW5ldyBXZWFrTWFwLGJlPW5ldyBXZWFrTWFwLGxlPW5ldyBXZWFrTWFwLEllPW5ldyBXZWFrU2V0LEdlPWZ1bmN0aW9uKGUpe2lmKGUudmlkZW8pe2lmKCFHdC5pbmNsdWRlcyhlLnZpZGVvLmNvZGVjKSl0aHJvdyBuZXcgRXJyb3IoIlVuc3VwcG9ydGVkIHZpZGVvIGNvZGVjOiAiLmNvbmNhdChlLnZpZGVvLmNvZGVjKSk7aWYoZS52aWRlby5yb3RhdGlvbiE9PXZvaWQgMCYmIVswLDkwLDE4MCwyNzBdLmluY2x1ZGVzKGUudmlkZW8ucm90YXRpb24pKXRocm93IG5ldyBFcnJvcigiSW52YWxpZCB2aWRlbyByb3RhdGlvbjogIi5jb25jYXQoZS52aWRlby5yb3RhdGlvbiwiLiBIYXMgdG8gYmUgMCwgOTAsIDE4MCBvciAyNzAuIikpfWlmKGUuYXVkaW8mJiFYdC5pbmNsdWRlcyhlLmF1ZGlvLmNvZGVjKSl0aHJvdyBuZXcgRXJyb3IoIlVuc3VwcG9ydGVkIGF1ZGlvIGNvZGVjOiAiLmNvbmNhdChlLmF1ZGlvLmNvZGVjKSk7aWYoZS5maXJzdFRpbWVzdGFtcEJlaGF2aW9yJiYhUXQuaW5jbHVkZXMoZS5maXJzdFRpbWVzdGFtcEJlaGF2aW9yKSl0aHJvdyBuZXcgRXJyb3IoIkludmFsaWQgZmlyc3QgdGltZXN0YW1wIGJlaGF2aW9yOiAiLmNvbmNhdChlLmZpcnN0VGltZXN0YW1wQmVoYXZpb3IpKX0sQWU9bmV3IFdlYWtTZXQsWGU9ZnVuY3Rpb24oKXt2YXIgZTtsZXQgdD0oKGU9bih0aGlzLGcpLnZpZGVvKT09bnVsbD92b2lkIDA6ZS5jb2RlYyk9PT0iaGV2YyI7bih0aGlzLEMpLndyaXRlQm94KGF0KHQpKSxiKHRoaXMsRyxvdCgpKSxuKHRoaXMsQykud3JpdGVCb3gobih0aGlzLEcpKSxwKHRoaXMsaWUsZGUpLmNhbGwodGhpcyl9LExlPW5ldyBXZWFrU2V0LHFlPWZ1bmN0aW9uKCl7dmFyIGU7aWYobih0aGlzLGcpLnZpZGVvJiZiKHRoaXMsWCx7aWQ6MSxpbmZvOnt0eXBlOiJ2aWRlbyIsY29kZWM6bih0aGlzLGcpLnZpZGVvLmNvZGVjLHdpZHRoOm4odGhpcyxnKS52aWRlby53aWR0aCxoZWlnaHQ6bih0aGlzLGcpLnZpZGVvLmhlaWdodCxyb3RhdGlvbjooZT1uKHRoaXMsZykudmlkZW8ucm90YXRpb24pIT1udWxsP2U6MH0sdGltZXNjYWxlOjcyMCxjb2RlY1ByaXZhdGU6bmV3IFVpbnQ4QXJyYXkoMCksc2FtcGxlczpbXSx3cml0dGVuQ2h1bmtzOltdLGN1cnJlbnRDaHVuazpudWxsLGZpcnN0VGltZXN0YW1wOnZvaWQgMCxsYXN0VGltZXN0YW1wOi0xLHRpbWVUb1NhbXBsZVRhYmxlOltdLGxhc3RUaW1lc2NhbGVVbml0czpudWxsLGNvbXBhY3RseUNvZGVkQ2h1bmtUYWJsZTpbXX0pLG4odGhpcyxnKS5hdWRpbyl7bGV0IHQ9cCh0aGlzLE1lLEtlKS5jYWxsKHRoaXMsMixuKHRoaXMsZykuYXVkaW8uc2FtcGxlUmF0ZSxuKHRoaXMsZykuYXVkaW8ubnVtYmVyT2ZDaGFubmVscyk7Yih0aGlzLHEse2lkOm4odGhpcyxnKS52aWRlbz8yOjEsaW5mbzp7dHlwZToiYXVkaW8iLGNvZGVjOm4odGhpcyxnKS5hdWRpby5jb2RlYyxudW1iZXJPZkNoYW5uZWxzOm4odGhpcyxnKS5hdWRpby5udW1iZXJPZkNoYW5uZWxzLHNhbXBsZVJhdGU6bih0aGlzLGcpLmF1ZGlvLnNhbXBsZVJhdGV9LHRpbWVzY2FsZTpuKHRoaXMsZykuYXVkaW8uc2FtcGxlUmF0ZSxjb2RlY1ByaXZhdGU6dCxzYW1wbGVzOltdLHdyaXR0ZW5DaHVua3M6W10sY3VycmVudENodW5rOm51bGwsZmlyc3RUaW1lc3RhbXA6dm9pZCAwLGxhc3RUaW1lc3RhbXA6LTEsdGltZVRvU2FtcGxlVGFibGU6W10sbGFzdFRpbWVzY2FsZVVuaXRzOm51bGwsY29tcGFjdGx5Q29kZWRDaHVua1RhYmxlOltdfSl9fSxNZT1uZXcgV2Vha1NldCxLZT1mdW5jdGlvbihlLHQsaSl7bGV0IHI9Wzk2ZTMsODgyMDAsNjRlMyw0OGUzLDQ0MTAwLDMyZTMsMjRlMywyMjA1MCwxNmUzLDEyZTMsMTEwMjUsOGUzLDczNTBdLmluZGV4T2YodCksZD1pLG89IiI7bys9ZS50b1N0cmluZygyKS5wYWRTdGFydCg1LCIwIiksbys9ci50b1N0cmluZygyKS5wYWRTdGFydCg0LCIwIikscj09PTE1JiYobys9dC50b1N0cmluZygyKS5wYWRTdGFydCgyNCwiMCIpKSxvKz1kLnRvU3RyaW5nKDIpLnBhZFN0YXJ0KDQsIjAiKTtsZXQgYz1NYXRoLmNlaWwoby5sZW5ndGgvOCkqODtvPW8ucGFkRW5kKGMsIjAiKTtsZXQgQT1uZXcgVWludDhBcnJheShvLmxlbmd0aC84KTtmb3IobGV0IEU9MDtFPG8ubGVuZ3RoO0UrPTgpQVtFLzhdPXBhcnNlSW50KG8uc2xpY2UoRSxFKzgpLDIpO3JldHVybiBBfSxoZT1uZXcgV2Vha1NldCxPZT1mdW5jdGlvbihlLHQsaSxzLHIsZCl7dmFyIG87bGV0IGM9cy8xZTYsQT1yLzFlNjtpZihlLmZpcnN0VGltZXN0YW1wPT09dm9pZCAwJiYoZS5maXJzdFRpbWVzdGFtcD1jKSxjPXAodGhpcyxVZSxRZSkuY2FsbCh0aGlzLGMsZSksZS5sYXN0VGltZXN0YW1wPWMsKCFlLmN1cnJlbnRDaHVua3x8Yy1lLmN1cnJlbnRDaHVuay5zdGFydFRpbWVzdGFtcD49S3QpJiYoZS5jdXJyZW50Q2h1bmsmJnAodGhpcyx0ZSx1ZSkuY2FsbCh0aGlzLGUpLGUuY3VycmVudENodW5rPXtzdGFydFRpbWVzdGFtcDpjLHNhbXBsZURhdGE6W10sc2FtcGxlQ291bnQ6MH0pLGUuY3VycmVudENodW5rLnNhbXBsZURhdGEucHVzaCh0KSxlLmN1cnJlbnRDaHVuay5zYW1wbGVDb3VudCsrLChvPWQ9PW51bGw/dm9pZCAwOmQuZGVjb2RlckNvbmZpZykhPW51bGwmJm8uZGVzY3JpcHRpb24mJihlLmNvZGVjUHJpdmF0ZT1uZXcgVWludDhBcnJheShkLmRlY29kZXJDb25maWcuZGVzY3JpcHRpb24pKSxlLnNhbXBsZXMucHVzaCh7dGltZXN0YW1wOmMsZHVyYXRpb246QSxzaXplOnQuYnl0ZUxlbmd0aCx0eXBlOml9KSxlLmxhc3RUaW1lc2NhbGVVbml0cyE9PW51bGwpe2xldCBFPVkoYyxlLnRpbWVzY2FsZSwhMSksXz1NYXRoLnJvdW5kKEUtZS5sYXN0VGltZXNjYWxlVW5pdHMpO2UubGFzdFRpbWVzY2FsZVVuaXRzKz1fO2xldCBPPXgoZS50aW1lVG9TYW1wbGVUYWJsZSk7Ty5zYW1wbGVDb3VudD09PTE/KE8uc2FtcGxlRGVsdGE9XyxPLnNhbXBsZUNvdW50KyspOk8uc2FtcGxlRGVsdGE9PT1fP08uc2FtcGxlQ291bnQrKzooTy5zYW1wbGVDb3VudC0tLGUudGltZVRvU2FtcGxlVGFibGUucHVzaCh7c2FtcGxlQ291bnQ6MixzYW1wbGVEZWx0YTpffSkpfWVsc2UgZS5sYXN0VGltZXNjYWxlVW5pdHM9MCxlLnRpbWVUb1NhbXBsZVRhYmxlLnB1c2goe3NhbXBsZUNvdW50OjEsc2FtcGxlRGVsdGE6WShBLGUudGltZXNjYWxlKX0pfSxVZT1uZXcgV2Vha1NldCxRZT1mdW5jdGlvbihlLHQpe2lmKG4odGhpcyxnKS5maXJzdFRpbWVzdGFtcEJlaGF2aW9yPT09InN0cmljdCImJnQubGFzdFRpbWVzdGFtcD09PS0xJiZlIT09MCl0aHJvdyBuZXcgRXJyb3IoIlRoZSBmaXJzdCBjaHVuayBmb3IgeW91ciBtZWRpYSB0cmFjayBtdXN0IGhhdmUgYSB0aW1lc3RhbXAgb2YgMCAocmVjZWl2ZWQgIi5jb25jYXQoZSwiKS4gTm9uLXplcm8gZmlyc3QgdGltZXN0YW1wcyBhcmUgb2Z0ZW4gY2F1c2VkIGJ5IGRpcmVjdGx5IHBpcGluZyBmcmFtZXMgb3IgYXVkaW8gZGF0YSBmcm9tIGEgTWVkaWFTdHJlYW1UcmFjayBpbnRvIHRoZSBlbmNvZGVyLiBUaGVpciB0aW1lc3RhbXBzIGFyZSB0eXBpY2FsbHkgcmVsYXRpdmUgdG8gdGhlIGFnZSBvZiB0aGUgZG9jdW1lbnQsIHdoaWNoIGlzIHByb2JhYmx5IHdoYXQgeW91IHdhbnQuXG5cbklmIHlvdSB3YW50IHRvIG9mZnNldCBhbGwgdGltZXN0YW1wcyBvZiBhIHRyYWNrIHN1Y2ggdGhhdCB0aGUgZmlyc3Qgb25lIGlzIHplcm8sIHNldCBmaXJzdFRpbWVzdGFtcEJlaGF2aW9yOiAnb2Zmc2V0JyBpbiB0aGUgb3B0aW9ucy5cbiIpKTtpZihuKHRoaXMsZykuZmlyc3RUaW1lc3RhbXBCZWhhdmlvcj09PSJvZmZzZXQiJiYoZS09dC5maXJzdFRpbWVzdGFtcCksZTx0Lmxhc3RUaW1lc3RhbXApdGhyb3cgbmV3IEVycm9yKCJUaW1lc3RhbXBzIG11c3QgYmUgbW9ub3RvbmljYWxseSBpbmNyZWFzaW5nICh3ZW50IGZyb20gIi5jb25jYXQodC5sYXN0VGltZXN0YW1wKjFlNiwiIHRvICIpLmNvbmNhdChlKjFlNiwiKS4iKSk7cmV0dXJuIGV9LHRlPW5ldyBXZWFrU2V0LHVlPWZ1bmN0aW9uKGUpe2lmKGUuY3VycmVudENodW5rKXtlLmN1cnJlbnRDaHVuay5vZmZzZXQ9bih0aGlzLEMpLnBvcztmb3IobGV0IHQgb2YgZS5jdXJyZW50Q2h1bmsuc2FtcGxlRGF0YSluKHRoaXMsQykud3JpdGUodCk7ZS5jdXJyZW50Q2h1bmsuc2FtcGxlRGF0YT1udWxsLChlLmNvbXBhY3RseUNvZGVkQ2h1bmtUYWJsZS5sZW5ndGg9PT0wfHx4KGUuY29tcGFjdGx5Q29kZWRDaHVua1RhYmxlKS5zYW1wbGVzUGVyQ2h1bmshPT1lLmN1cnJlbnRDaHVuay5zYW1wbGVDb3VudCkmJmUuY29tcGFjdGx5Q29kZWRDaHVua1RhYmxlLnB1c2goe2ZpcnN0Q2h1bms6ZS53cml0dGVuQ2h1bmtzLmxlbmd0aCsxLHNhbXBsZXNQZXJDaHVuazplLmN1cnJlbnRDaHVuay5zYW1wbGVDb3VudH0pLGUud3JpdHRlbkNodW5rcy5wdXNoKGUuY3VycmVudENodW5rKSxwKHRoaXMsaWUsZGUpLmNhbGwodGhpcyl9fSxpZT1uZXcgV2Vha1NldCxkZT1mdW5jdGlvbigpe24odGhpcyxDKWluc3RhbmNlb2YgeGUmJm4odGhpcyxDKS5mbHVzaCgpfSxmZT1uZXcgV2Vha1NldCxEZT1mdW5jdGlvbigpe2lmKG4odGhpcyxsZSkpdGhyb3cgbmV3IEVycm9yKCJDYW5ub3QgYWRkIG5ldyB2aWRlbyBvciBhdWRpbyBjaHVua3MgYWZ0ZXIgdGhlIGZpbGUgaGFzIGJlZW4gZmluYWxpemVkLiIpfTt2YXIgSnQ9dHlwZW9mIGdsb2JhbFRoaXM8InUiP2dsb2JhbFRoaXM6dHlwZW9mIHdpbmRvdzwidSI/d2luZG93OnR5cGVvZiBnbG9iYWw8InUiP2dsb2JhbDp0eXBlb2Ygc2VsZjwidSI/c2VsZjp7fTtmdW5jdGlvbiBadChlKXtyZXR1cm4gZSYmZS5fX2VzTW9kdWxlJiZPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwiZGVmYXVsdCIpP2UuZGVmYXVsdDplfXZhciBZZT17ZXhwb3J0czp7fX07KGZ1bmN0aW9uKGUpeyhmdW5jdGlvbih0LGkpe2UuZXhwb3J0cz9lLmV4cG9ydHM9aSgpOnQubG9nPWkoKX0pKEp0LGZ1bmN0aW9uKCl7dmFyIHQ9ZnVuY3Rpb24oKXt9LGk9InVuZGVmaW5lZCIscz10eXBlb2Ygd2luZG93IT09aSYmdHlwZW9mIHdpbmRvdy5uYXZpZ2F0b3IhPT1pJiYvVHJpZGVudFwvfE1TSUUgLy50ZXN0KHdpbmRvdy5uYXZpZ2F0b3IudXNlckFnZW50KSxyPVsidHJhY2UiLCJkZWJ1ZyIsImluZm8iLCJ3YXJuIiwiZXJyb3IiXSxkPXt9LG89bnVsbDtmdW5jdGlvbiBjKHYsVCl7dmFyIGw9dltUXTtpZih0eXBlb2YgbC5iaW5kPT0iZnVuY3Rpb24iKXJldHVybiBsLmJpbmQodik7dHJ5e3JldHVybiBGdW5jdGlvbi5wcm90b3R5cGUuYmluZC5jYWxsKGwsdil9Y2F0Y2godmUpe3JldHVybiBmdW5jdGlvbigpe3JldHVybiBGdW5jdGlvbi5wcm90b3R5cGUuYXBwbHkuYXBwbHkobCxbdixhcmd1bWVudHNdKX19fWZ1bmN0aW9uIEEoKXtjb25zb2xlLmxvZyYmKGNvbnNvbGUubG9nLmFwcGx5P2NvbnNvbGUubG9nLmFwcGx5KGNvbnNvbGUsYXJndW1lbnRzKTpGdW5jdGlvbi5wcm90b3R5cGUuYXBwbHkuYXBwbHkoY29uc29sZS5sb2csW2NvbnNvbGUsYXJndW1lbnRzXSkpLGNvbnNvbGUudHJhY2UmJmNvbnNvbGUudHJhY2UoKX1mdW5jdGlvbiBFKHYpe3JldHVybiB2PT09ImRlYnVnIiYmKHY9ImxvZyIpLHR5cGVvZiBjb25zb2xlPT09aT8hMTp2PT09InRyYWNlIiYmcz9BOmNvbnNvbGVbdl0hPT12b2lkIDA/Yyhjb25zb2xlLHYpOmNvbnNvbGUubG9nIT09dm9pZCAwP2MoY29uc29sZSwibG9nIik6dH1mdW5jdGlvbiBfKCl7Zm9yKHZhciB2PXRoaXMuZ2V0TGV2ZWwoKSxUPTA7VDxyLmxlbmd0aDtUKyspe3ZhciBsPXJbVF07dGhpc1tsXT1UPHY/dDp0aGlzLm1ldGhvZEZhY3RvcnkobCx2LHRoaXMubmFtZSl9aWYodGhpcy5sb2c9dGhpcy5kZWJ1Zyx0eXBlb2YgY29uc29sZT09PWkmJnY8dGhpcy5sZXZlbHMuU0lMRU5UKXJldHVybiJObyBjb25zb2xlIGF2YWlsYWJsZSBmb3IgbG9nZ2luZyJ9ZnVuY3Rpb24gTyh2KXtyZXR1cm4gZnVuY3Rpb24oKXt0eXBlb2YgY29uc29sZSE9PWkmJihfLmNhbGwodGhpcyksdGhpc1t2XS5hcHBseSh0aGlzLGFyZ3VtZW50cykpfX1mdW5jdGlvbiBvaSh2LFQsbCl7cmV0dXJuIEUodil8fE8uYXBwbHkodGhpcyxhcmd1bWVudHMpfWZ1bmN0aW9uIEplKHYsVCl7dmFyIGw9dGhpcyx2ZSxXZSxRLFU9ImxvZ2xldmVsIjt0eXBlb2Ygdj09InN0cmluZyI/VSs9IjoiK3Y6dHlwZW9mIHY9PSJzeW1ib2wiJiYoVT12b2lkIDApO2Z1bmN0aW9uIGhpKHcpe3ZhciBTPShyW3ddfHwic2lsZW50IikudG9VcHBlckNhc2UoKTtpZighKHR5cGVvZiB3aW5kb3c9PT1pfHwhVSkpe3RyeXt3aW5kb3cubG9jYWxTdG9yYWdlW1VdPVM7cmV0dXJufWNhdGNoKHBlKXt9dHJ5e3dpbmRvdy5kb2N1bWVudC5jb29raWU9ZW5jb2RlVVJJQ29tcG9uZW50KFUpKyI9IitTKyI7In1jYXRjaChwZSl7fX19ZnVuY3Rpb24gWmUoKXt2YXIgdztpZighKHR5cGVvZiB3aW5kb3c9PT1pfHwhVSkpe3RyeXt3PXdpbmRvdy5sb2NhbFN0b3JhZ2VbVV19Y2F0Y2goZGkpe31pZih0eXBlb2Ygdz09PWkpdHJ5e3ZhciBTPXdpbmRvdy5kb2N1bWVudC5jb29raWUscGU9ZW5jb2RlVVJJQ29tcG9uZW50KFUpLGV0PVMuaW5kZXhPZihwZSsiPSIpO2V0IT09LTEmJih3PS9eKFteO10rKS8uZXhlYyhTLnNsaWNlKGV0K3BlLmxlbmd0aCsxKSlbMV0pfWNhdGNoKGRpKXt9cmV0dXJuIGwubGV2ZWxzW3ddPT09dm9pZCAwJiYodz12b2lkIDApLHd9fWZ1bmN0aW9uIHVpKCl7aWYoISh0eXBlb2Ygd2luZG93PT09aXx8IVUpKXt0cnl7d2luZG93LmxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKFUpfWNhdGNoKHcpe310cnl7d2luZG93LmRvY3VtZW50LmNvb2tpZT1lbmNvZGVVUklDb21wb25lbnQoVSkrIj07IGV4cGlyZXM9VGh1LCAwMSBKYW4gMTk3MCAwMDowMDowMCBVVEMifWNhdGNoKHcpe319fWZ1bmN0aW9uIG5lKHcpe3ZhciBTPXc7aWYodHlwZW9mIFM9PSJzdHJpbmciJiZsLmxldmVsc1tTLnRvVXBwZXJDYXNlKCldIT09dm9pZCAwJiYoUz1sLmxldmVsc1tTLnRvVXBwZXJDYXNlKCldKSx0eXBlb2YgUz09Im51bWJlciImJlM+PTAmJlM8PWwubGV2ZWxzLlNJTEVOVClyZXR1cm4gUzt0aHJvdyBuZXcgVHlwZUVycm9yKCJsb2cuc2V0TGV2ZWwoKSBjYWxsZWQgd2l0aCBpbnZhbGlkIGxldmVsOiAiK3cpfWwubmFtZT12LGwubGV2ZWxzPXtUUkFDRTowLERFQlVHOjEsSU5GTzoyLFdBUk46MyxFUlJPUjo0LFNJTEVOVDo1fSxsLm1ldGhvZEZhY3Rvcnk9VHx8b2ksbC5nZXRMZXZlbD1mdW5jdGlvbigpe3JldHVybiBRIT1udWxsP1E6V2UhPW51bGw/V2U6dmV9LGwuc2V0TGV2ZWw9ZnVuY3Rpb24odyxTKXtyZXR1cm4gUT1uZSh3KSxTIT09ITEmJmhpKFEpLF8uY2FsbChsKX0sbC5zZXREZWZhdWx0TGV2ZWw9ZnVuY3Rpb24odyl7V2U9bmUodyksWmUoKXx8bC5zZXRMZXZlbCh3LCExKX0sbC5yZXNldExldmVsPWZ1bmN0aW9uKCl7UT1udWxsLHVpKCksXy5jYWxsKGwpfSxsLmVuYWJsZUFsbD1mdW5jdGlvbih3KXtsLnNldExldmVsKGwubGV2ZWxzLlRSQUNFLHcpfSxsLmRpc2FibGVBbGw9ZnVuY3Rpb24odyl7bC5zZXRMZXZlbChsLmxldmVscy5TSUxFTlQsdyl9LGwucmVidWlsZD1mdW5jdGlvbigpe2lmKG8hPT1sJiYodmU9bmUoby5nZXRMZXZlbCgpKSksXy5jYWxsKGwpLG89PT1sKWZvcih2YXIgdyBpbiBkKWRbd10ucmVidWlsZCgpfSx2ZT1uZShvP28uZ2V0TGV2ZWwoKToiV0FSTiIpO3ZhciBqZT1aZSgpO2plIT1udWxsJiYoUT1uZShqZSkpLF8uY2FsbChsKX1vPW5ldyBKZSxvLmdldExvZ2dlcj1mdW5jdGlvbihUKXtpZih0eXBlb2YgVCE9InN5bWJvbCImJnR5cGVvZiBUIT0ic3RyaW5nInx8VD09PSIiKXRocm93IG5ldyBUeXBlRXJyb3IoIllvdSBtdXN0IHN1cHBseSBhIG5hbWUgd2hlbiBjcmVhdGluZyBhIGxvZ2dlci4iKTt2YXIgbD1kW1RdO3JldHVybiBsfHwobD1kW1RdPW5ldyBKZShULG8ubWV0aG9kRmFjdG9yeSkpLGx9O3ZhciBsaT10eXBlb2Ygd2luZG93IT09aT93aW5kb3cubG9nOnZvaWQgMDtyZXR1cm4gby5ub0NvbmZsaWN0PWZ1bmN0aW9uKCl7cmV0dXJuIHR5cGVvZiB3aW5kb3chPT1pJiZ3aW5kb3cubG9nPT09byYmKHdpbmRvdy5sb2c9bGkpLG99LG8uZ2V0TG9nZ2Vycz1mdW5jdGlvbigpe3JldHVybiBkfSxvLmRlZmF1bHQ9byxvfSl9KShZZSk7dmFyIGp0PVllLmV4cG9ydHMsY2U9WnQoanQpO2NlLnNldExldmVsKCJFUlJPUiIpO2Z1bmN0aW9uIGVpKGUpe3JldHVybiBuZXcgUHJvbWlzZSh0PT57Y29uc3QgaT0oKT0+e2UoKT90KCk6cmVxdWVzdEFuaW1hdGlvbkZyYW1lKGkpfTtpKCl9KX1jbGFzcyB0aXtjb25zdHJ1Y3Rvcih0KXtrKHRoaXMsImNvbm5lY3Rpb24iKTtrKHRoaXMsIm9wdGlvbnMiKTt0aGlzLmNvbm5lY3Rpb249ITEsdGhpcy5vcHRpb25zPXR9Y29ubmVjdCgpe3RoaXMuY29ubmVjdGlvbj0hMH1kaXNjb25uZWN0KCl7dGhpcy5jb25uZWN0aW9uPSExfX12YXIgRj0oZT0+KGUuTE9BREVEPSJsb2FkZWQiLGUuSU5JVD0iaW5pdCIsZS5TRU5EPSJzZW5kIixlLkZJTklTSD0iZmluaXNoIixlKSkoRnx8e30pO2Z1bmN0aW9uIGlpKGUpe2NlLmVycm9yKCJub29wIGVycm9yIixlKX1jbGFzcyBuaSBleHRlbmRzIHRpe2NvbnN0cnVjdG9yKGkpe3N1cGVyKGkpO2sodGhpcywidmlkZW9Db25maWciKTtrKHRoaXMsImF1ZGlvQ29uZmlnIik7ayh0aGlzLCJtdXhlciIpO2sodGhpcywidmlkZW9FbmNvZGVyIik7ayh0aGlzLCJhdWRpb0VuY29kZXIiKTtrKHRoaXMsImVycm9yUmVqZWN0IixpaSk7dGhpcy52aWRlb0NvbmZpZz1pLnZpZGVvQ29uZmlnLHRoaXMuYXVkaW9Db25maWc9aS5hdWRpb0NvbmZpZyx0aGlzLmNyZWF0ZU11eGVyQW5kRW5jb2RlcigpfWFzeW5jIGhhbmRsZShpKXt2YXIgbyxjLEEsRTtjb25zdHt2aWRlb0ZyYW1lOnMsYXVkaW9JbmZvOnIsdGltZXN0YW1wOmR9PWk7aWYocyYmKChvPXRoaXMudmlkZW9FbmNvZGVyKSE9bnVsbCYmby5lbmNvZGVRdWV1ZVNpemUmJigoYz10aGlzLnZpZGVvRW5jb2Rlcik9PW51bGw/dm9pZCAwOmMuZW5jb2RlUXVldWVTaXplKT4yMCYmYXdhaXQgZWkoKCk9Pnt2YXIgXyxPO3JldHVybihfPXRoaXMudmlkZW9FbmNvZGVyKSE9bnVsbCYmXy5lbmNvZGVRdWV1ZVNpemU/KChPPXRoaXMudmlkZW9FbmNvZGVyKT09bnVsbD92b2lkIDA6Ty5lbmNvZGVRdWV1ZVNpemUpPDEwOiEwfSksKEE9dGhpcy52aWRlb0VuY29kZXIpPT1udWxsfHxBLmVuY29kZShzLHtrZXlGcmFtZTpkLygxZTMvdGhpcy5vcHRpb25zLmZwcyklMTUwPT09MH0pLHMuY2xvc2UoKSkscil7Y29uc3QgXz1uZXcgQXVkaW9EYXRhKHsuLi5yfSk7KEU9dGhpcy5hdWRpb0VuY29kZXIpPT1udWxsfHxFLmVuY29kZShfKSxfLmNsb3NlKCl9fWNyZWF0ZU11eGVyQW5kRW5jb2Rlcigpe3RoaXMubXV4ZXI9bmV3IFl0KHt0YXJnZXQ6bmV3IFJlLHZpZGVvOntjb2RlYzoiYXZjIix3aWR0aDp0aGlzLnZpZGVvQ29uZmlnLndpZHRoLGhlaWdodDp0aGlzLnZpZGVvQ29uZmlnLmhlaWdodH0sYXVkaW86e2NvZGVjOiJhYWMiLG51bWJlck9mQ2hhbm5lbHM6dGhpcy5hdWRpb0NvbmZpZy5udW1iZXJPZkNoYW5uZWxzLHNhbXBsZVJhdGU6dGhpcy5hdWRpb0NvbmZpZy5zYW1wbGVSYXRlfX0pLHRoaXMudmlkZW9FbmNvZGVyPW5ldyBWaWRlb0VuY29kZXIoe291dHB1dDooaSxzKT0+e3ZhciByO3JldHVybihyPXRoaXMubXV4ZXIpPT1udWxsP3ZvaWQgMDpyLmFkZFZpZGVvQ2h1bmsoaSxzKX0sZXJyb3I6aT0+e2NlLmVycm9yKCJ2aWRlbyBlbmNvZGVyIGVycm9yIixpKSx0aGlzLmVycm9yUmVqZWN0KGkpfX0pLHRoaXMudmlkZW9FbmNvZGVyLmNvbmZpZ3VyZSh0aGlzLnZpZGVvQ29uZmlnKSx0aGlzLm9wdGlvbnMuZGlzYWJsZUF1ZGlvfHwodGhpcy5hdWRpb0VuY29kZXI9bmV3IEF1ZGlvRW5jb2Rlcih7b3V0cHV0OihpLHMpPT57dmFyIHI7cmV0dXJuKHI9dGhpcy5tdXhlcik9PW51bGw/dm9pZCAwOnIuYWRkQXVkaW9DaHVuayhpLHMpfSxlcnJvcjppPT57Y2UuZXJyb3IoImF1ZGlvIGVuY29kZXIgZXJyb3IiLGkpLHRoaXMuZXJyb3JSZWplY3QoaSl9fSksdGhpcy5hdWRpb0VuY29kZXIuY29uZmlndXJlKHRoaXMuYXVkaW9Db25maWcpKX1hc3luYyBlbmRFbmNvZGluZygpe3ZhciBzLHIsZCxvLGMsQSxFO3JldHVybiBhd2FpdCgocz10aGlzLnZpZGVvRW5jb2Rlcik9PW51bGw/dm9pZCAwOnMuZmx1c2goKSksKHI9dGhpcy52aWRlb0VuY29kZXIpPT1udWxsfHxyLmNsb3NlKCksYXdhaXQoKGQ9dGhpcy5hdWRpb0VuY29kZXIpPT1udWxsP3ZvaWQgMDpkLmZsdXNoKCkpLChvPXRoaXMuYXVkaW9FbmNvZGVyKT09bnVsbHx8by5jbG9zZSgpLChjPXRoaXMubXV4ZXIpPT1udWxsfHxjLmZpbmFsaXplKCksKEU9KEE9dGhpcy5tdXhlcik9PW51bGw/dm9pZCAwOkEudGFyZ2V0KT09bnVsbD92b2lkIDA6RS5idWZmZXJ9YXN5bmMgZmluaXNoKCl7cmV0dXJuIGF3YWl0IHRoaXMuZW5kRW5jb2RpbmcoKX19bGV0IFBlO3NlbGYuYWRkRXZlbnRMaXN0ZW5lcigibWVzc2FnZSIsYXN5bmMgZT0+e2NvbnN0e3R5cGU6dCxkYXRhOml9PWUuZGF0YTt0cnl7c3dpdGNoKHQpe2Nhc2UgRi5JTklUOnJldHVybiBzaShpKTtjYXNlIEYuU0VORDpyZXR1cm4gYXdhaXQgcmkoaSk7Y2FzZSBGLkZJTklTSDpyZXR1cm4gYXdhaXQgYWkoKTtkZWZhdWx0OnJldHVybn19Y2F0Y2gocyl7c2VsZi5wb3N0TWVzc2FnZSh7dHlwZTp0LGVyck1zZzpzIGluc3RhbmNlb2YgRXJyb3I/cy5tZXNzYWdlOiJVbmtub3duIEVycm9yIn0pfX0pLHNlbGYucG9zdE1lc3NhZ2Uoe3R5cGU6Ri5MT0FERUR9KTtmdW5jdGlvbiBzaShlKXtQZT1uZXcgbmkoZSksc2VsZi5wb3N0TWVzc2FnZSh7dHlwZTpGLklOSVR9KX1hc3luYyBmdW5jdGlvbiByaShlKXthd2FpdCBQZS5oYW5kbGUoZSksc2VsZi5wb3N0TWVzc2FnZSh7dHlwZTpGLlNFTkR9KX1hc3luYyBmdW5jdGlvbiBhaSgpe2NvbnN0IGU9YXdhaXQgUGUuZmluaXNoKCk7c2VsZi5wb3N0TWVzc2FnZSh7dHlwZTpGLkZJTklTSCxyZXN1bHQ6ZX0sZT9bZV06W10pfX0pKCk7Cg==",_a=typeof window<"u"&&window.Blob&&new Blob([atob(Ki)],{type:"text/javascript;charset=utf-8"});function eh(){let a;try{if(a=_a&&(window.URL||window.webkitURL).createObjectURL(_a),!a)throw"";return new Worker(a)}catch(s){return new Worker("data:application/javascript;base64,"+Ki)}finally{a&&(window.URL||window.webkitURL).revokeObjectURL(a)}}var It=(a=>(a.LOADED="loaded",a.INIT="init",a.SEND="send",a.FINISH="finish",a))(It||{});class th extends Fi{constructor(t){var n,i;super(t);x(this,"compositorWorker");x(this,"initialized");x(this,"videoConfig");x(this,"audioConfig");this.videoConfig=(n=t.videoConfig)!=null?n:Ni,this.audioConfig=(i=t.audioConfig)!=null?i:Ci,this.compositorWorker=new eh,this.initialized=new Promise((o,r)=>{this.compositorWorker.addEventListener("message",c=>{const{type:l}=c.data;l===It.LOADED&&this.getFromWorker(It.INIT,{videoConfig:this.videoConfig,audioConfig:this.audioConfig,...t}).then(()=>{o()}).catch(m=>{r(m)})})})}getFromWorker(t,n,i){return new Promise((o,r)=>{const c=({data:l})=>{l.type===t&&(l.errMsg?r(l.errMsg):o(l.result),this.compositorWorker.removeEventListener("message",c))};this.compositorWorker.addEventListener("message",c),this.compositorWorker.postMessage({type:t,data:n},i||[])})}async genAudioInfo(t,n){const i=this.audioConfig.sampleRate,o=this.audioConfig.numberOfChannels,r=this.audioConfig.sampleRate*(1/this.options.fps),l=new OfflineAudioContext(o,r,i).createBuffer(o,r,i);let m;if(n){n.forEach((h,u)=>{for(let f=0;f<o;f++){const p=f<h.numberOfChannels?h.getChannelData(f):h.getChannelData(0),g=l.getChannelData(f);if(u===0)g.set(p);else for(let v=0;v<g.length;v++)g[v]+=p[v]}}),m=new Float32Array(r*o);for(let h=0;h<l.numberOfChannels;h++)m.set(l.getChannelData(h),h*l.length)}else m=new Float32Array(r*o).fill(0);return{timestamp:t,sampleRate:i,numberOfChannels:o,numberOfFrames:r,data:m,format:"f32-planar"}}async handle(t){await this.initialized;const{timestamp:n,imageSource:i,audioBuffers:o}=t,r=new VideoFrame(i,{timestamp:n*1e3}),c=[r];let l;return this.options.disableAudio||(l=await this.genAudioInfo(n,o),c.push(l.data.buffer)),this.getFromWorker(It.SEND,{timestamp:n,videoFrame:r,audioInfo:l},c)}async finish(){await this.initialized;const t=await this.getFromWorker(It.FINISH);if(t)return new Blob([t],{type:"video/mp4"})}}class sh extends Fi{constructor(t){super(t);x(this,"context");x(this,"audioContext");x(this,"audioPlayTime");x(this,"currentTime");x(this,"frameId");x(this,"frameWaitPromise");x(this,"frameWaitResolve");this.options=t,this.audioPlayTime=0;const{canvas:n,width:i,height:o}=this.options;n.width=i,n.height=o,this.context=n.getContext("2d"),this.currentTime=0,this.frameId=0}async handle(t){const{imageSource:n,audioBuffers:i,timestamp:o}=t;this.currentTime=o/1e3,this.options.disableAudio?(this.context&&n&&this.playVideoFrame(n),await gd(1e3/this.options.fps)):(this.audioContext||(this.audioContext=new AudioContext),this.frameId||(this.frameWaitPromise=new Promise(r=>{this.frameWaitResolve=r}),this.frameId=requestAnimationFrame(()=>this.frameCallback())),this.playAudioBuffers(i),await this.frameWaitPromise,this.context&&n&&this.playVideoFrame(n))}frameCallback(){var t;this.audioContext&&(this.audioContext.currentTime>=this.currentTime&&((t=this.frameWaitResolve)==null||t.call(this),this.frameWaitPromise=new Promise(n=>{this.frameWaitResolve=n})),this.frameId=requestAnimationFrame(()=>this.frameCallback()))}playVideoFrame(t){const{width:n,height:i}=this.options;this.context.drawImage(t,0,0,n,i)}playAudioBuffers(t){if(t.length===0||!this.audioContext)return;let n=0;this.audioContext.currentTime>this.audioPlayTime&&(this.audioPlayTime=this.audioContext.currentTime);for(const i of t){const o=this.audioContext.createBufferSource();o.buffer=i,o.connect(this.audioContext.destination),o.onended=()=>{o.disconnect()},o.start(this.audioPlayTime),n=Math.max(n,i.duration)}this.audioPlayTime+=n}async finish(){var t;(t=this.audioContext)==null||t.close(),this.frameId&&cancelAnimationFrame(this.frameId),this.frameWaitPromise=void 0,this.frameWaitResolve=void 0}}var ce=(a=>(a[a.Background=0]="Background",a[a.Character=10]="Character",a[a.Dialog=20]="Dialog",a[a.Text=30]="Text",a))(ce||{}),jt;let ah=(jt=class{constructor(s){x(this,"options");x(this,"app");x(this,"scenes");x(this,"activeScene");x(this,"activeChild");x(this,"activeTransformer");this.options=Object.assign({},jt.defaultEditorOptions,s);const{view:t,width:n,height:i,background:o}=this.options;this.app=new ir({view:t,width:n,height:i,background:o}),this.scenes=[]}addTransformer(){var s;this.activeTransformer=new or({wireframeStyle:{thickness:4,color:41471}}).on("pointertap",()=>{this.activeTransformer&&(this.activeTransformer.__isTapped?(this.activeChild=void 0,this.activeTransformer.group=[],this.options.onChangeActiveChild(void 0),this.activeTransformer.__doubleTapTimer&&clearTimeout(this.activeTransformer.__doubleTapTimer),this.activeTransformer.__isTapped=!1):(this.activeTransformer.__isTapped=!0,this.activeTransformer.__doubleTapTimer=setTimeout(()=>{this.activeTransformer&&(this.activeTransformer.__isTapped=!1)},600)))}),(s=this.activeScene)==null||s.addChild(this.activeTransformer)}removeTransformer(){var s;this.activeTransformer&&((s=this.activeScene)==null||s.removeChild(this.activeTransformer),this.activeTransformer.destroy(),this.activeTransformer=void 0)}addChildTransformListener(s){s.interactive=!0,s.on("pointerdown",()=>{this.setActiveChild(s)})}setActiveChild(s){this.activeChild=s,s&&(this.activeTransformer||this.addTransformer(),this.activeTransformer&&(this.activeTransformer.group=[s],this.moveChildToTop(this.activeTransformer))),this.options.onChangeActiveChild(s)}setActiveChildByName(s){const t=this.activeScene;if(t){const n=t.children.find(i=>i.name===s);n&&this.setActiveChild(n)}}updateActiveChild(s){this.activeChild&&(s(this.activeChild),this.options.onChangeActiveChild(this.activeChild))}removeChildTransformListener(s){s.removeAllListeners("pointerdown")}addScene(s,t){typeof t>"u"?this.scenes.push(s):this.scenes.splice(t,0,s);const n=i=>{if(i.children&&i.children.length>0)for(const o of i.children)n(o);else this.addChildTransformListener(i)};for(const i of s.children)n(i);this.options.onChangeScenes(this.scenes)}loadScenes(s){s.forEach(t=>{this.addScene(t)}),this.options.onChangeScenes(this.scenes)}removeScene(s){this.scenes=this.scenes.filter(t=>t!==s),this.activeScene===s&&(this.stageRemoveChild(this.activeScene),this.activeScene.destroy(),this.activeScene=void 0),this.options.onChangeScenes(this.scenes)}removeSceneByIndex(s){this.removeScene(this.scenes[s])}removeSceneByName(s){const t=this.getSceneByName(s);t&&this.removeScene(t)}getSceneByName(s){return this.scenes.find(t=>t.name===s)}cloneScene(s){this.removeTransformer();const t=s!=null?s:this.activeScene;if(t)return t.clone()}cloneSceneByIndex(s){return this.cloneScene(this.scenes[s])}cloneSceneByName(s){const t=this.getSceneByName(s);if(t)return this.cloneScene(t)}swapScene(s,t){[this.scenes[s],this.scenes[t]]=[this.scenes[t],this.scenes[s]],this.options.onChangeScenes(this.scenes)}setActiveScene(s){this.activeScene&&(this.stageRemoveChild(this.activeScene),this.removeTransformer()),this.activeScene=s,s&&(this.activeScene.load({skipSoundLoading:!0}),this.addTransformer(),this.stageAddChild(s)),this.options.onChangeActiveScene(s)}setActiveSceneByName(s){const t=this.scenes.find(n=>n.name===s);t&&this.setActiveScene(t)}setActiveSceneByIndex(s){this.setActiveScene(this.scenes[s])}getActiveSceneIndex(){return this.activeScene?this.scenes.indexOf(this.activeScene):-1}updateActiveScene(s){this.activeScene&&(s(this.activeScene),this.options.onChangeActiveScene(this.activeScene))}addChild(s){const t=this.activeScene;t&&(this.addChildTransformListener(s),t.addChild(s),this.options.onChangeActiveScene(t))}removeChild(s){var n;const t=this.activeScene;t&&(((n=this.activeChild)==null?void 0:n.name)===s.name&&(this.setActiveChild(void 0),this.removeTransformer()),this.removeChildTransformListener(s),t.removeChild(s),s.destroy(),this.options.onChangeActiveScene(t))}removeChildByName(s){const t=this.activeScene;if(t){const n=t.children.find(i=>i.name===s);n&&this.removeChild(n)}}toggleChildVisibleByName(s){const t=this.activeScene;if(t){const n=t.children.find(i=>i.name===s);n&&(n.visible=!n.visible),this.options.onChangeActiveScene(t)}}toggleChildInteractiveByName(s){const t=this.activeScene;if(t){const n=t.children.find(i=>i.name===s);n&&(n.interactive=!n.interactive),this.options.onChangeActiveScene(t)}}cloneChild(s){const t=s!=null?s:this.activeChild;if(t)return t.clone()}addSound(s){const t=this.activeScene;t&&(t.addSound(s),this.options.onChangeActiveScene(t))}removeSound(s){const t=this.activeScene;t&&(t.removeSound(s),this.options.onChangeActiveScene(t))}removeSoundByName(s){const t=this.activeScene;if(t){const n=t.sounds.find(i=>i.name===s);n&&this.removeSound(n)}}cloneDialogue(s){return ms(s)}cloneDialogueSpeak(s){return ms(s)}addDialogue(s,t){const n=this.activeScene;n&&(n.addDialogue(s,t),this.options.onChangeActiveScene(n))}updateDialogue(s,t){const n=this.activeScene;n&&(n.updateDialogue(s,t),this.options.onChangeActiveScene(n))}removeDialogue(s){const t=this.activeScene;t&&(t.removeDialogue(s),this.options.onChangeActiveScene(t))}swapDialogue(s,t){const n=this.activeScene;n&&(n.swapDialogue(s,t),this.options.onChangeActiveScene(n))}swapChildren(s,t){var n;(n=this.activeScene)==null||n.swapChildren(s,t)}moveChildTo(s,t){const n=t!=null?t:this.activeChild;n&&(n.zIndex=s)}moveChildToTop(s){const t=s!=null?s:this.activeChild;this.activeScene&&t&&(t.zIndex=ce.Text,this.activeScene.setChildIndex(t,this.activeScene.children.length-1))}moveChildToBottom(s){var n;const t=s!=null?s:this.activeChild;this.activeScene&&t&&(t.zIndex=ce.Background,(n=this.activeScene)==null||n.setChildIndex(t,0))}moveUpChild(s){const t=s!=null?s:this.activeChild;if(this.activeScene&&t){const n=this.activeScene.children.indexOf(t);if(n<this.activeScene.children.length-1){const i=this.activeScene.children[n+1];i.zIndex>t.zIndex&&(t.zIndex=i.zIndex),this.swapChildren(t,i)}}}moveDownChild(s){const t=s!=null?s:this.activeChild;if(this.activeScene&&t){const n=this.activeScene.children.indexOf(t);if(n>0){const i=this.activeScene.children[n-1];i.zIndex<t.zIndex&&(t.zIndex=i.zIndex),this.swapChildren(t,i)}}}stageAddChild(s){this.app.stage.addChild(s)}stageRemoveChild(s){const t=this.app.stage.children.find(n=>n.name===s.name);t&&this.app.stage.removeChild(t)}setChildPosition(s,t){const n=t!=null?t:this.activeChild,{width:i,height:o}=this.options;if(n)switch(s){case"top":n.y=0;break;case"middle":n.y=o/2-n.height/2;break;case"bottom":n.y=o-n.height;break;case"left":n.x=0;break;case"near-left":n.x=i/3-n.width/2;break;case"center":n.x=i/2-n.width/2;break;case"near-right":n.x=i/3*2-n.width/2;break;case"right":n.x=i-n.width;break}}genSceneScript(s){var c,l,m,h,u;const{dialogues:t,config:n}=s,i=n.speak,o=[],r=s.children.find(f=>f.assetType==="Background");r&&n.autoShowBackground&&o.push({directive:C.Show,params:{targetName:r.name}});for(const f of t){const{speak:p,lines:g}=f;i!=null&&i.dialogTargetName&&o.push({directive:C.Show,params:{targetName:i.dialogTargetName}}),o.push({directive:C.Speak,params:{lines:g,targetName:i.targetName,wordsPerMin:p.wordsPerMin,interval:p.interval,effect:p.effect,effectDuration:p.effectDuration,speaker:i.speaker.targetName?{targetName:i.speaker.targetName,name:((c=p.speaker)==null?void 0:c.name)||"",speakerTargetName:(l=p.speaker)==null?void 0:l.speakerTargetName,autoShowSpeaker:(m=p.speaker)==null?void 0:m.autoShowSpeaker,autoMaskOtherSpeakers:(h=p.speaker)==null?void 0:h.autoMaskOtherSpeakers}:void 0,voice:(u=p.voice)!=null&&u.targetName?p.voice:void 0}})}return{scene:s,config:n,directives:o}}async exportScreenplay(s=0,t){const i=this.exportScenes(s,t).map(this.genSceneScript);return{config:{},scenes:i}}exportScenes(s=0,t){this.removeTransformer();const n=performance.now(),i=this.scenes.slice(s,t).map(o=>o.clone());return Fe.info("editor export cost:",performance.now()-n),i}saveAsJSON(){return this.removeTransformer(),JSON.stringify({version:"2.0",config:{},scenes:this.scenes})}async loadFromJSON(s){const t=JSON.parse(s),n=[];for(const i of t.scenes){const o=await Xe.fromJSON(i);n.push(o)}this.loadScenes(n)}clear(){this.scenes.forEach(s=>{this.removeScene(s)}),this.setActiveScene(void 0),this.setActiveChild(void 0),this.removeTransformer()}},x(jt,"defaultEditorOptions",{width:1920,height:1080,background:0,onChangeActiveChild:()=>{},onChangeActiveScene:()=>{},onChangeScenes:()=>{}}),jt);function ls(){const a=new Xe,s=new Ct;s.alpha=.7,s.beginFill(0),s.drawRect(0,0,1920,400),s.endFill(),s.x=0,s.y=680,s.zIndex=ce.Dialog,s.label="",s.fillColor="#000000";const t=new Le("",{fill:16777215,fontSize:44,fontWeight:"bold",leading:15});t.x=160,t.y=700,t.zIndex=ce.Text,t.label="",t.disableTextEdit=!0;const n=new Le("",{fill:16777215,wordWrap:!0,breakWords:!0,wordWrapWidth:1600,fontSize:38,leading:15});return n.x=160,n.y=770,n.zIndex=ce.Text,n.label="",n.disableTextEdit=!0,a.addChild(s),a.addChild(t),a.addChild(n),a.config.speak.targetName=n.name,a.config.speak.dialogTargetName=s.name,a.config.speak.speaker.targetName=t.name,a.config.speak.speaker.name=t.text,a}function zi(){const a=new Xe,s=new Ct;s.alpha=.7,s.beginFill(0),s.drawRect(0,0,1920,1080),s.endFill(),s.x=0,s.y=0,s.zIndex=ce.Dialog,s.label="";const t=new Le("",{fill:16777215,breakWords:!0,wordWrap:!0,wordWrapWidth:1600,fontSize:45,leading:15});return t.x=160,t.y=160,t.zIndex=ce.Text,t.label="",t.disableTextEdit=!0,a.addChild(s),a.addChild(t),a.config.speak.targetName=t.name,a.config.speak.dialogTargetName=s.name,a}function Di(){const a=new Xe,s=new Le("",{fill:16777215,breakWords:!0,fontSize:100,fontWeight:"bold"});s.x=1920/2-s.width/2,s.y=1080/2-200,s.zIndex=ce.Text,s.label="";const t=new Le("",{fill:16777215,breakWords:!0,fontSize:60});return t.x=1920/2-t.width/2,t.y=1080/2-40,t.zIndex=ce.Text,t.label="",a.addChild(s),a.addChild(t),a.dialogues=[{speak:{wordsPerMin:500,interval:.2,effect:"typewriter",speaker:{targetName:"",name:"",autoShowSpeaker:{inEffect:"Show"},autoMaskOtherSpeakers:{alpha:.5},speakerTargetName:"Narrator"}},lines:[{children:[{text:""},{children:[{text:""}],type:"directive",value:{directive:"FadeIn",params:{targetName:s.name},label:":"}},{text:""},{children:[{text:""}],type:"directive",value:{directive:"FadeIn",params:{targetName:t.name},label:":"}},{text:""},{children:[{text:""}],type:"directive",value:{directive:"Wait",params:{duration:3},label:":3"}},{text:""}],type:"p"}]}],a}const L=js()(oa(a=>{let s;return{project:null,editor:null,activeChild:null,activeScene:null,scenes:[],setProject(t){a(n=>{n.project={id:t.id,name:t.name}})},initEditor(t){s=new ah({view:t,onChangeActiveChild(n){a(i=>{if(!n){i.activeChild=null;return}let o={...n,width:n.width,height:n.height,x:n.x,y:n.y};if(n.type==="Text"){const r=n;o={...o,text:r.text,style:r.style&&{...r.style,fontFamily:r.style.fontFamily,fontWeight:r.style.fontWeight,fontStyle:r.style.fontStyle,fontSize:r.style.fontSize,fill:r.style.fill}}}i.activeChild=o})},onChangeActiveScene(n){a(i=>{n?i.activeScene={...n}:i.activeScene=null})},onChangeScenes(n){a(i=>{i.scenes=[...n]})}}),a(n=>{n.editor=s})}}})),Re=js()(oa(a=>({isOpen:!1,type:null,disableSelect:!1,confirm:null,cancel:null,setConfirm(s){a(t=>{t.confirm=s})},setCancel(s){a(t=>{t.cancel=s})},setOpen(s){a(t=>{t.isOpen=s})},setType(s){a(t=>{t.type=s})},setDisableSelect(s){a(t=>{t.disableSelect=s})}}))),vs=js()(oa(a=>({isOpen:!1,loadingText:"",setOpen(s){a(t=>{t.isOpen=s})},setLoadingText(s){a(t=>{t.loadingText=s})}}))),bt=d.forwardRef(({className:a,...s},t)=>e.jsx("div",{ref:t,className:S("rounded-xl border bg-card text-card-foreground shadow",a),...s}));bt.displayName="Card";const nh=d.forwardRef(({className:a,...s},t)=>e.jsx("div",{ref:t,className:S("flex flex-col space-y-1.5 p-6",a),...s}));nh.displayName="CardHeader";const ih=d.forwardRef(({className:a,...s},t)=>e.jsx("h3",{ref:t,className:S("font-semibold leading-none tracking-tight",a),...s}));ih.displayName="CardTitle";const oh=d.forwardRef(({className:a,...s},t)=>e.jsx("p",{ref:t,className:S("text-sm text-muted-foreground",a),...s}));oh.displayName="CardDescription";const tt=d.forwardRef(({className:a,...s},t)=>e.jsx("div",{ref:t,className:S("p-6 pt-0",a),...s}));tt.displayName="CardContent";const Gs=d.forwardRef(({className:a,...s},t)=>e.jsx("div",{ref:t,className:S("flex items-center p-6 pt-0",a),...s}));Gs.displayName="CardFooter";const be=d.forwardRef(({className:a,children:s,...t},n)=>{const i=d.useRef(null);return d.useImperativeHandle(n,()=>({scrollToBottom:()=>{i.current&&i.current.scrollTo({top:i.current.scrollHeight,behavior:"smooth"})}})),e.jsxs(mn,{className:S("relative overflow-hidden",a),...t,children:[e.jsx(rr,{ref:i,className:"h-full w-full rounded-[inherit]",children:s}),e.jsx(Bt,{}),e.jsx(lr,{})]})});be.displayName=mn.displayName;const Bt=d.forwardRef(({className:a,orientation:s="vertical",...t},n)=>e.jsx(pn,{ref:n,orientation:s,className:S("flex touch-none select-none transition-colors",s==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",s==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",a),...t,children:e.jsx(cr,{className:"relative flex-1 rounded-full bg-border"})}));Bt.displayName=pn.displayName;const rh=a=>e.jsx("svg",{viewBox:"0 0 24 24",height:"48",width:"48",focusable:"false",role:"img",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...a,children:e.jsx("path",{d:"M3 6a3 3 0 0 1 3-3h12a3 3 0 0 1 3 3v12a3 3 0 0 1-3 3H6a3 3 0 0 1-3-3V6zm10 13h5a1 1 0 0 0 1-1v-5h-6v6zm-2-6H5v5a1 1 0 0 0 1 1h5v-6zm2-2h6V6a1 1 0 0 0-1-1h-5v6zm-2-6H6a1 1 0 0 0-1 1v5h6V5z"})}),lh=a=>e.jsx("svg",{viewBox:"0 0 24 24",height:"48",width:"48",focusable:"false",role:"img",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...a,children:e.jsx("path",{d:"M13 5a1 1 0 1 0 0-2h-2a1 1 0 1 0 0 2h2zm-8 6a1 1 0 1 0-2 0v2a1 1 0 1 0 2 0v-2zm-2 7a1 1 0 1 1 2 0 1 1 0 0 0 1 1h12a1 1 0 0 0 1-1 1 1 0 1 1 2 0 3 3 0 0 1-3 3H6a3 3 0 0 1-3-3zm17-8a1 1 0 0 0-1 1v2a1 1 0 1 0 2 0v-2a1 1 0 0 0-1-1zM7 4a1 1 0 0 0-1-1 3 3 0 0 0-3 3 1 1 0 0 0 2 0 1 1 0 0 1 1-1 1 1 0 0 0 1-1zm11-1a1 1 0 1 0 0 2 1 1 0 0 1 1 1 1 1 0 1 0 2 0 3 3 0 0 0-3-3z"})}),ch=a=>e.jsx("svg",{viewBox:"0 0 24 24",height:"48",width:"48",focusable:"false",role:"img",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...a,children:e.jsx("path",{d:"M6 21a1 1 0 1 0 0-2 1 1 0 0 1-1-1V6a1 1 0 0 1 1-1 1 1 0 0 0 0-2 3 3 0 0 0-3 3v12a3 3 0 0 0 3 3zm7-16a1 1 0 1 0 0-2h-2a1 1 0 1 0 0 2h2zm6 6a1 1 0 1 1 2 0v2a1 1 0 1 1-2 0v-2zm-5 9a1 1 0 0 1-1 1h-2a1 1 0 1 1 0-2h2a1 1 0 0 1 1 1zm4-17a1 1 0 1 0 0 2 1 1 0 0 1 1 1 1 1 0 1 0 2 0 3 3 0 0 0-3-3zm-1 17a1 1 0 0 0 1 1 3 3 0 0 0 3-3 1 1 0 1 0-2 0 1 1 0 0 1-1 1 1 1 0 0 0-1 1z"})}),dh=a=>e.jsx("svg",{viewBox:"0 0 24 24",height:"48",width:"48",focusable:"false",role:"img",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...a,children:e.jsx("path",{d:"M14 4a1 1 0 0 1-1 1h-2a1 1 0 1 1 0-2h2a1 1 0 0 1 1 1zm-9 7a1 1 0 1 0-2 0v2a1 1 0 1 0 2 0v-2zm14 0a1 1 0 1 1 2 0v2a1 1 0 1 1-2 0v-2zm-6 10a1 1 0 1 0 0-2h-2a1 1 0 1 0 0 2h2zM7 4a1 1 0 0 0-1-1 3 3 0 0 0-3 3 1 1 0 0 0 2 0 1 1 0 0 1 1-1 1 1 0 0 0 1-1zm11-1a1 1 0 1 0 0 2 1 1 0 0 1 1 1 1 1 0 1 0 2 0 3 3 0 0 0-3-3zM7 20a1 1 0 0 1-1 1 3 3 0 0 1-3-3 1 1 0 1 1 2 0 1 1 0 0 0 1 1 1 1 0 0 1 1 1zm11 1a1 1 0 1 1 0-2 1 1 0 0 0 1-1 1 1 0 1 1 2 0 3 3 0 0 1-3 3z"})}),hh=a=>e.jsx("svg",{viewBox:"0 0 24 24",height:"48",width:"48",focusable:"false",role:"img",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...a,children:e.jsx("path",{d:"M13 5a1 1 0 1 0 0-2h-2a1 1 0 1 0 0 2h2zm-8 6a1 1 0 1 0-2 0v2a1 1 0 1 0 2 0v-2zm9 9a1 1 0 0 1-1 1h-2a1 1 0 1 1 0-2h2a1 1 0 0 1 1 1zM6 3a1 1 0 0 1 0 2 1 1 0 0 0-1 1 1 1 0 0 1-2 0 3 3 0 0 1 3-3zm1 17a1 1 0 0 1-1 1 3 3 0 0 1-3-3 1 1 0 1 1 2 0 1 1 0 0 0 1 1 1 1 0 0 1 1 1zm11 1a1 1 0 1 1 0-2 1 1 0 0 0 1-1V6a1 1 0 0 0-1-1 1 1 0 1 1 0-2 3 3 0 0 1 3 3v12a3 3 0 0 1-3 3z"})}),uh=a=>e.jsx("svg",{viewBox:"0 0 24 24",height:"48",width:"48",focusable:"false",role:"img",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...a,children:e.jsx("path",{d:"M3 6a1 1 0 0 0 2 0 1 1 0 0 1 1-1h12a1 1 0 0 1 1 1 1 1 0 1 0 2 0 3 3 0 0 0-3-3H6a3 3 0 0 0-3 3zm2 5a1 1 0 1 0-2 0v2a1 1 0 1 0 2 0v-2zm14 0a1 1 0 1 1 2 0v2a1 1 0 1 1-2 0v-2zm-5 9a1 1 0 0 1-1 1h-2a1 1 0 1 1 0-2h2a1 1 0 0 1 1 1zm-8 1a1 1 0 1 0 0-2 1 1 0 0 1-1-1 1 1 0 1 0-2 0 3 3 0 0 0 3 3zm11-1a1 1 0 0 0 1 1 3 3 0 0 0 3-3 1 1 0 1 0-2 0 1 1 0 0 1-1 1 1 1 0 0 0-1 1z"})}),Z={add:Js,alignCenter:dr,alignJustify:hr,alignLeft:ur,alignRight:mr,arrowDown:pr,bg:fr,blockquote:xr,bold:gr,borderAll:rh,borderBottom:lh,borderLeft:ch,borderNone:dh,borderRight:hh,borderTop:uh,check:br,chevronRight:vr,fileText:fn,chevronsUpDown:yr,clear:Qs,close:Qs,code:Sr,codeblock:jr,color:wr,column:Nr,combine:Cr,ungroup:kr,comment:Zr,commentAdd:Gr,delete:_s,dragHandle:Tr,editing:Vr,emoji:Rr,externalLink:Wr,h1:Ir,h2:Lr,h3:Xr,h4:Fr,h5:Kr,h6:zr,image:Dr,indent:Yr,italic:Mr,kbd:Hr,lineHeight:Br,link:Pr,minus:$s,more:Ar,ol:Ur,outdent:Er,paragraph:Or,refresh:Jr,row:Qr,search:_r,settings:$r,strikethrough:qr,subscript:el,superscript:tl,table:sl,text:al,trash:nl,trash2:_s,ul:il,underline:ol,unlink:rl,viewing:ll,viewingOff:cl,lock:dl,lockOpen:hl,type:ul,fontSize:ml,bookOpenText:pl,copy:fl,moveUp:xl,moveDown:gl,squarePlus:bl,folder:vl,bookmark:yl,mic:Sl,download:jl,edit:wl,library:Nl,scene:Cl,images:kl,preview:Zl,tip:Gl,wandSparkles:Tl,sparkles:Vl,flip:Rl,gitHub:a=>e.jsx("svg",{viewBox:"0 0 438.549 438.549",...a,children:e.jsx("path",{fill:"currentColor",d:"M409.132 114.573c-19.608-33.596-46.205-60.194-79.798-79.8-33.598-19.607-70.277-29.408-110.063-29.408-39.781 0-76.472 9.804-110.063 29.408-33.596 19.605-60.192 46.204-79.8 79.8C9.803 148.168 0 184.854 0 224.63c0 47.78 13.94 90.745 41.827 128.906 27.884 38.164 63.906 64.572 108.063 79.227 5.14.954 8.945.283 11.419-1.996 2.475-2.282 3.711-5.14 3.711-8.562 0-.571-.049-5.708-.144-15.417a2549.81 2549.81 0 01-.144-25.406l-6.567 1.136c-4.187.767-9.469 1.092-15.846 1-6.374-.089-12.991-.757-19.842-1.999-6.854-1.231-13.229-4.086-19.13-8.559-5.898-4.473-10.085-10.328-12.56-17.556l-2.855-6.57c-1.903-4.374-4.899-9.233-8.992-14.559-4.093-5.331-8.232-8.945-12.419-10.848l-1.999-1.431c-1.332-.951-2.568-2.098-3.711-3.429-1.142-1.331-1.997-2.663-2.568-3.997-.572-1.335-.098-2.43 1.427-3.289 1.525-.859 4.281-1.276 8.28-1.276l5.708.853c3.807.763 8.516 3.042 14.133 6.851 5.614 3.806 10.229 8.754 13.846 14.842 4.38 7.806 9.657 13.754 15.846 17.847 6.184 4.093 12.419 6.136 18.699 6.136 6.28 0 11.704-.476 16.274-1.423 4.565-.952 8.848-2.383 12.847-4.285 1.713-12.758 6.377-22.559 13.988-29.41-10.848-1.14-20.601-2.857-29.264-5.14-8.658-2.286-17.605-5.996-26.835-11.14-9.235-5.137-16.896-11.516-22.985-19.126-6.09-7.614-11.088-17.61-14.987-29.979-3.901-12.374-5.852-26.648-5.852-42.826 0-23.035 7.52-42.637 22.557-58.817-7.044-17.318-6.379-36.732 1.997-58.24 5.52-1.715 13.706-.428 24.554 3.853 10.85 4.283 18.794 7.952 23.84 10.994 5.046 3.041 9.089 5.618 12.135 7.708 17.705-4.947 35.976-7.421 54.818-7.421s37.117 2.474 54.823 7.421l10.849-6.849c7.419-4.57 16.18-8.758 26.262-12.565 10.088-3.805 17.802-4.853 23.134-3.138 8.562 21.509 9.325 40.922 2.279 58.24 15.036 16.18 22.559 35.787 22.559 58.817 0 16.178-1.958 30.497-5.853 42.966-3.9 12.471-8.941 22.457-15.125 29.979-6.191 7.521-13.901 13.85-23.131 18.986-9.232 5.14-18.182 8.85-26.84 11.136-8.662 2.286-18.415 4.004-29.263 5.146 9.894 8.562 14.842 22.077 14.842 40.539v60.237c0 3.422 1.19 6.279 3.572 8.562 2.379 2.279 6.136 2.95 11.276 1.995 44.163-14.653 80.185-41.062 108.068-79.226 27.88-38.161 41.825-81.126 41.825-128.906-.01-39.771-9.818-76.454-29.414-110.049z"})}),logo:a=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",...a,children:e.jsx("path",{fill:"currentColor",d:"M11.572 0c-.176 0-.31.001-.358.007a19.76 19.76 0 0 1-.364.033C7.443.346 4.25 2.185 2.228 5.012a11.875 11.875 0 0 0-2.119 5.243c-.096.659-.108.854-.108 1.747s.012 1.089.108 1.748c.652 4.506 3.86 8.292 8.209 9.695.779.25 1.6.422 2.534.525.363.04 1.935.04 2.299 0 1.611-.178 2.977-.577 4.323-1.264.207-.106.247-.134.219-.158-.02-.013-.9-1.193-1.955-2.62l-1.919-2.592-2.404-3.558a338.739 338.739 0 0 0-2.422-3.556c-.009-.002-.018 1.579-.023 3.51-.007 3.38-.01 3.515-.052 3.595a.426.426 0 0 1-.206.214c-.075.037-.14.044-.495.044H7.81l-.108-.068a.438.438 0 0 1-.157-.171l-.05-.106.006-4.703.007-4.705.072-.092a.645.645 0 0 1 .174-.143c.096-.047.134-.051.54-.051.478 0 .558.018.682.154.035.038 1.337 1.999 2.895 4.361a10760.433 10760.433 0 0 0 4.735 7.17l1.9 2.879.096-.063a12.317 12.317 0 0 0 2.466-2.163 11.944 11.944 0 0 0 2.824-6.134c.096-.66.108-.854.108-1.748 0-.893-.012-1.088-.108-1.747-.652-4.506-3.859-8.292-8.208-9.695a12.597 12.597 0 0 0-2.499-.523A33.119 33.119 0 0 0 11.573 0zm4.069 7.217c.347 0 .408.005.486.047a.473.473 0 0 1 .237.277c.018.06.023 1.365.018 4.304l-.006 4.218-.744-1.14-.746-1.14v-3.066c0-1.982.01-3.097.023-3.15a.478.478 0 0 1 .233-.296c.096-.05.13-.054.5-.054z"})}),moon:xn,sun:Wl},Ca=vn,ka=yn,mh=ca,ph=Il,Yi=d.forwardRef(({className:a,inset:s,children:t,...n},i)=>e.jsxs(ra,{ref:i,className:S("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",s&&"pl-8",a),...n,children:[t,e.jsx(gn,{className:"ml-auto h-4 w-4"})]}));Yi.displayName=ra.displayName;const Mi=d.forwardRef(({className:a,...s},t)=>e.jsx(la,{ref:t,className:S("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...s}));Mi.displayName=la.displayName;const Ts=d.forwardRef(({className:a,sideOffset:s=4,...t},n)=>e.jsx(ca,{children:e.jsx(da,{ref:n,sideOffset:s,className:S("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...t})}));Ts.displayName=da.displayName;const de=d.forwardRef(({className:a,inset:s,...t},n)=>e.jsx(ha,{ref:n,className:S("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",s&&"pl-8",a),...t}));de.displayName=ha.displayName;const fh=d.forwardRef(({className:a,children:s,checked:t,...n},i)=>e.jsxs(ua,{ref:i,className:S("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),checked:t,...n,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(ws,{children:e.jsx(ma,{className:"h-4 w-4"})})}),s]}));fh.displayName=ua.displayName;const xh=d.forwardRef(({className:a,children:s,...t},n)=>e.jsxs(pa,{ref:n,className:S("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...t,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(ws,{children:e.jsx(bn,{className:"h-4 w-4 fill-current"})})}),s]}));xh.displayName=pa.displayName;const gh=d.forwardRef(({className:a,inset:s,...t},n)=>e.jsx(fa,{ref:n,className:S("px-2 py-1.5 text-sm font-semibold",s&&"pl-8",a),...t}));gh.displayName=fa.displayName;const Za=d.forwardRef(({className:a,...s},t)=>e.jsx(xa,{ref:t,className:S("-mx-1 my-1 h-px bg-muted",a),...s}));Za.displayName=xa.displayName;const bh=function(){const a=["monospace","sans-serif","serif"],s="mmmmmmmmmmlli",t="72px",n=document.getElementsByTagName("body")[0],i=document.createElement("span");i.style.fontSize=t,i.innerHTML=s;const o={},r={};for(const l in a)i.style.fontFamily=a[l],n.appendChild(i),o[a[l]]=i.offsetWidth,r[a[l]]=i.offsetHeight,n.removeChild(i);function c(l){let m=!1;for(const h in a){i.style.fontFamily=l+","+a[h],n.appendChild(i);const u=i.offsetWidth!=o[a[h]]||i.offsetHeight!=r[a[h]];n.removeChild(i),m=m||u}return m}this.detect=c},rs={windows:[{ch:"",en:"SimSun"},{ch:"",en:"SimHei"},{ch:"",en:"Microsoft Yahei"},{ch:"",en:"Microsoft JhengHei"},{ch:"",en:"KaiTi"},{ch:"",en:"NSimSun"},{ch:"",en:"FangSong"}],"OS X":[{ch:"",en:"PingFang SC"},{ch:"",en:"Hiragino Sans GB"},{ch:"-",en:"Lantinghei SC"},{ch:"-",en:"Hanzipen SC"},{ch:"-",en:"Hannotate SC"},{ch:"-",en:"Songti SC"},{ch:"-",en:"Wawati SC"},{ch:"-",en:"Weibei SC"},{ch:"-",en:"Xingkai SC"},{ch:"-",en:"Yapi SC"},{ch:"-",en:"Yuanti SC"}],office:[{ch:"",en:"YouYuan"},{ch:"",en:"LiSu"},{ch:"",en:"STXihei"},{ch:"",en:"STHeiti"},{ch:"",en:"STKaiti"},{ch:"",en:"STSong"},{ch:"",en:"STFangsong"},{ch:"",en:"STZhongsong"},{ch:"",en:"STCaiyun"},{ch:"",en:"STHupo"},{ch:"",en:"STXinwei"},{ch:"",en:"STLiti"},{ch:"",en:"STXingkai"},{ch:"",en:"FZShuTi"},{ch:"",en:"FZYaoti"}],open:[{ch:"",en:"Source Han Sans CN"},{ch:"",en:"Source Han Serif SC"},{ch:"",en:"WenQuanYi Micro Hei"},{ch:"",en:"LXGW WenKai"},{ch:"",en:"Ark Pixel 12px Monospaced zh_cn"},{ch:"DW Pica Roman V",en:"DW Pica Roman V"}]},vh=new bh,yh=[{ch:"Arial",en:"Arial"}].concat([...rs["OS X"],...rs.windows,...rs.open,...rs.office].filter(a=>vh.detect(a.en)));var Lt=(a=>(a.NORMAL="normal",a.BOLD="bold",a))(Lt||{}),Xt=(a=>(a.NORMAL="normal",a.ITALIC="italic",a))(Xt||{});async function ta(a,s){const t=new FontFace(a,typeof s=="string"?"url(".concat(s,")"):s);document.fonts.add(t),await t.load()}const Ga="__TMP__",pt=1e5;var k=(a=>(a.Character="Character",a.Background="Background",a.Thing="Thing",a.Dialog="Dialog",a.Audio="Audio",a.Font="Font",a))(k||{});const Ta=[{name:"",value:"Character"},{name:"",value:"Background"},{name:"",value:"Thing"},{name:"",value:"Dialog"},{name:"",value:"Audio"},{name:"",value:"Font"}],Sh=Ta.reduce((a,{name:s,value:t})=>(a[t]=s,a),{});class jh extends Ll{constructor(){super("vnve2");x(this,"asset");x(this,"assetSource");x(this,"template");x(this,"project");this.version(4).stores({asset:"++id, name, type, voice, states, [name+type]",assetSource:"++id, mime, blob, ext",template:"++id, name, type, content",project:"++id, name, time, content"})}}const Gt=new jh,Q=Gt.asset,We=Gt.assetSource,Pt=Gt.template,Ee=Gt.project;function ge(a){return a.url||"https://s/".concat(a.id,".").concat(a.ext)}function Hi(a){const s=a.states.find(t=>t.id===a.stateId);return s?ge(s):""}function Bi(a){switch(a){case"Background":case"Character":case"Thing":case"Dialog":return".webp, .png, .jpg, .jpeg, .gif, .mp4";case"Audio":return".mp3, .wav, .m4a, .aac";case"Font":return".ttf, .woff, .woff2";default:return""}}async function wh(){const a=await window.showDirectoryPicker();for(const s of Ta){const t=await a.getDirectoryHandle(s.name).catch(()=>{});if(t){for await(const[n,i]of t.entries())if(i.kind==="directory"){const o=await Q.add({name:n,type:s.value,states:[]});for await(const[,r]of i.entries())if(r.kind==="file"){const c=await r.getFile(),{name:l,ext:m}=wt(c);if(Bi(s.value).includes(m)){const u=await We.add({mime:c.type,blob:c,ext:m});await Q.where("id").equals(o).modify(f=>{f.states.push({id:u,name:l,ext:m})})}}}}}}async function Nh(){await We.clear(),await Q.clear()}async function Ch(){const a=await Q.where("type").equals("Font").toArray();for(const s of a)for(const t of s.states)await ta(t.name,ge(t))}async function Va(a,s){const t=await Q.get(a);if(s){const n=t.states.find(i=>i.name===s);return n?{...t,stateId:n.id}:void 0}return t}async function sa(a,s,t){const n={name:a};t&&(n.type=t);const i=await Q.where(n).first();if(i&&s){const o=i.states.find(r=>r.name===s);return o?{...i,stateId:o.id}:void 0}return i}async function kh(){const a=await Gt.export(),s=URL.createObjectURL(a);Si("book",s,"vnve"),URL.revokeObjectURL(s)}async function Zh(){const s=(await cd({accept:".vnve"}))[0];s&&await Gt.import(s)}function Gh(){return Math.random().toString(36).substring(2,8)}async function Th(a,s,t){const n="".concat(Ga).concat(a);let i=await sa(n,void 0,s);if(!i){const l=await Q.add({name:n,type:s,states:[]});i=await Va(l)}const{name:o,ext:r}=wt(t),c=await We.add({mime:t.type,blob:t,ext:r});return i.stateId=c,i.states.push({id:c,name:"".concat(o,"_").concat(Gh()),ext:r}),await Q.update(i.id,{states:i.states}),i}async function Vh(a){const s="".concat(Ga).concat(a),t=await Q.where("name").equals(s).toArray();for(const n of t){await Q.delete(n.id);for(const i of n.states)await We.delete(i.id)}}async function Rh(){await Q.get(pt)||await Q.put({id:pt,name:"",type:"Character",states:[]})}const Wh="/vnve/assets/day-b6ef6b0c.webp",Ih="/vnve/assets/night-da7c9955.webp",Lh="/vnve/assets/day-c525641b.webp",Xh="/vnve/assets/night-61088675.webp",Fh="/vnve/assets/default-9e36bbf3.webp",Kh="/vnve/assets/happy-61fa7adf.webp",zh="/vnve/assets/default-6a415d65.webp",Dh="/vnve/assets/happy-77097254.webp",Yh="/vnve/assets/red-628f973d.webp",Mh="/vnve/assets/bgm1-865a2e82.mp3",Hh="/vnve/assets/bgm2-9df28d45.mp3",Bh="/vnve/assets/thunder-fcdc6cdf.mp3",Ph="/vnve/assets/rain-2ed4ca49.mp3",Ah="/vnve/assets/open-door-0aa9286c.mp3",Uh="/vnve/assets/knock-door-25770f6b.mp3",Eh="/vnve/assets/zh-hans-17f9a740.woff2",Oh="/vnve/assets/zh-hant-df9154bf.woff2",Jh=[{type:k.Background,assets:[{name:"",states:[{name:"",url:Wh},{name:"",url:Ih}]},{name:"",states:[{name:"",url:Lh},{name:"",url:Xh}]}]},{type:k.Character,assets:[{name:"",states:[{name:"",url:Fh},{name:"",url:Kh}]},{name:"",states:[{name:"",url:zh},{name:"",url:Dh}]}]},{type:k.Thing,assets:[{name:"",states:[{name:"",url:Yh}]}]},{type:k.Audio,assets:[{name:"BGM",states:[{name:"bgm1",url:Mh},{name:"bgm2",url:Hh}]},{name:"",states:[{name:"",url:Ah},{name:"",url:Uh},{name:"",url:Ph},{name:"",url:Bh}]}]},{type:k.Font,assets:[{name:"",states:[{name:"",url:Eh},{name:"",url:Oh}]}]}];async function Qh(){for(const a of Jh){const{type:s,assets:t}=a;for(const n of t){const{name:i,states:o}=n,r=await Q.add({name:i,type:s,states:[]});for(const c of o)try{const{name:l,url:m}=c,h=m.split(".").pop(),u=await fetch(m),f=await u.blob(),p=u.headers.get("Content-Type")||"",g=await We.add({mime:p,ext:h,blob:f,url:m});await Q.where("id").equals(r).modify(v=>{v.states.push({id:g,name:l,ext:h,url:m})})}catch(l){console.error("",l)}}}}const $a="IS_PRESET_IMPORTED";async function _h(){try{if(localStorage.getItem($a))return;localStorage.setItem($a,"true"),await We.count()===0&&await Qh()}catch(a){console.error("",a)}}const $h=[{name:"",content:ls},{name:"",content:zi},{name:"",content:Di},{name:"",content:()=>new Xe}];function Ra(){const a=L(i=>i.editor),s=Ot(()=>Pt.reverse().toArray());return{defaultTemplates:$h,customTemplates:s||[],handleAddDefaultTemplate:(i,o)=>()=>{const r=i();a.addScene(r,o),a.setActiveSceneByName(r.name)},handleAddCustomTemplate:async(i,o)=>{const r=await Xe.fromJSON(JSON.parse(i),!1);a.addScene(r,o),a.setActiveSceneByName(r.name)}}}function qh({onOpenSceneDetailDialog:a}){const s=L(f=>f.editor),t=L(f=>f.activeScene),n=L(f=>f.scenes),{defaultTemplates:i,customTemplates:o,handleAddDefaultTemplate:r,handleAddCustomTemplate:c}=Ra(),l=d.useRef(null);d.useEffect(()=>{l.current&&l.current.scrollIntoView({behavior:"smooth"})},[n.length]);const m=f=>{f.name===(t==null?void 0:t.name)&&s.setActiveScene(void 0),s.removeSceneByName(f.name)},h=(f,p)=>{const g=s.cloneSceneByName(f.name);s.addScene(g,p),s.setActiveSceneByName(g.name)},u=(f,p)=>{s.swapScene(f,p)};return e.jsx(bt,{className:"flex-1 shrink-0 max-h-[50%] sm:max-h-full rounded-md",children:e.jsx(tt,{className:"h-full p-1",children:e.jsx(be,{className:"h-full p-2",children:e.jsxs(Cs,{children:[e.jsx(ks,{children:e.jsxs(ht,{children:[e.jsx(ut,{children:""}),e.jsx(ut,{className:"w-[3rem] text-right",children:""})]})}),e.jsx(Zs,{children:n.map((f,p)=>e.jsxs(ht,{ref:(t==null?void 0:t.name)===f.name?l:null,className:"".concat((t==null?void 0:t.name)===f.name?"bg-muted":""," cursor-pointer"),children:[e.jsxs(mt,{onClick:()=>{s.setActiveSceneByName(f.name)},children:[e.jsxs("span",{className:"font-medium mr-1",children:[p+1,"."]}),f.label]}),e.jsxs(mt,{className:"flex gap-1 justify-end",children:[p>0&&e.jsx(Z.moveUp,{className:"size-4 cursor-pointer",onClick:()=>u(p,p-1)}),p<n.length-1&&e.jsx(Z.moveDown,{className:"size-4 cursor-pointer",onClick:()=>u(p,p+1),children:""}),e.jsxs(Ca,{modal:!1,children:[e.jsx(ka,{children:e.jsx(Z.more,{className:"size-4 cursor-pointer"})}),e.jsxs(Ts,{children:[e.jsx(de,{className:"flex md:hidden",onClick:a,children:""}),e.jsxs(ph,{children:[e.jsx(Yi,{children:""}),e.jsx(mh,{children:e.jsxs(Mi,{children:[i.map(g=>e.jsx(de,{onClick:r(g.content,p+1),children:g.name},g.name)),o.length>0&&e.jsx(Za,{}),o.map(g=>e.jsx(de,{onClick:()=>c(g.content,p+1),children:g.name},g.id))]})})]}),e.jsx(de,{onClick:()=>h(f,p+1),children:""}),e.jsx(de,{className:"text-destructive",onClick:()=>m(f),children:""})]})]})]})]},f.name))})]})})})})}function Tt(){const a=Re(r=>r.setConfirm),s=Re(r=>r.setCancel),t=Re(r=>r.setOpen),n=Re(r=>r.setType),i=Re(r=>r.setDisableSelect);return{selectAsset:(r,c)=>new Promise(l=>{a(m=>{l(m),t(!1)}),s(()=>{l(void 0),t(!1)}),t(!0),n(r),i(c)})}}async function Pi(a){const{text:s,voiceType:t,volume:n,speed:i,pitch:o,token:r,appid:c,resourceId:l="volc.tts_async.default"}=a,m=5*60*1e3,h=Date.now(),u=await tu({text:s,voiceType:t,volume:n,speed:i,pitch:o,token:r,appid:c,resourceId:l});if(!u.task_id)throw new Error(": ".concat(u.message));if(u.task_status===2)throw new Error(": ".concat(JSON.stringify(u)));const f=u.task_id;let p;for(;;){if(Date.now()-h>m)throw new Error("");const g=await su({taskId:f,token:r,appid:c,resourceId:l});if(g.task_status===1){p=g;break}else{if(g.task_status===2)throw new Error(": ".concat(JSON.stringify(g)));await new Promise(v=>setTimeout(v,1e3))}}return p}function eu(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){const s=Math.random()*16|0;return(a==="x"?s:s&3|8).toString(16)})}async function tu(a){const{text:s,voiceType:t,volume:n,speed:i,pitch:o,token:r,appid:c,resourceId:l}=a,h={"volc.tts_async.default":"/api/tts/ark/api/v1/tts_async/submit","volc.tts_async.emotion":"/api/tts/ark/api/v1/tts_async_with_emotion/submit"}[l],u=eu(),f="mp3",p={"Content-Type":"application/json","Resource-Id":l,Authorization:"Bearer; ".concat(r)};return await(await fetch(h,{method:"POST",headers:p,body:JSON.stringify({appid:c,reqid:u,text:s,format:f,voice_type:t,volume:n,speed:i,pitch:o})})).json()}async function su(a){const{taskId:s,token:t,appid:n,resourceId:i}=a,r={"volc.tts_async.default":"/api/tts/ark/api/v1/tts_async/query","volc.tts_async.emotion":"/api/tts/ark/api/v1/tts_async_with_emotion/query"}[i],c="appid=".concat(n,"&task_id=").concat(s),l={"Resource-Id":i,Authorization:"Bearer; ".concat(t)};return await(await fetch("".concat(r,"?").concat(c),{method:"GET",headers:l})).json()}const At="NONE_VOICE",au=[{name:"",value:At},{name:" 2.0",value:"BV700_V2_streaming"},{name:"",value:"BV705_streaming"},{name:" 2.0",value:"BV701_V2_streaming"},{name:" 2.0",value:"BV001_V2_streaming"},{name:"",value:"BV700_streaming"},{name:"-2.0",value:"BV406_V2_streaming"},{name:"-",value:"BV406_streaming"},{name:"-2.0",value:"BV407_V2_streaming"},{name:"-",value:"BV407_streaming"},{name:"",value:"BV001_streaming"},{name:"",value:"BV002_streaming"},{name:"",value:"BV701_streaming"},{name:"",value:"BV123_streaming"},{name:"",value:"BV120_streaming"},{name:"",value:"BV119_streaming"},{name:"",value:"BV115_streaming"},{name:"",value:"BV107_streaming"},{name:"",value:"BV100_streaming"},{name:"",value:"BV104_streaming"},{name:"",value:"BV004_streaming"},{name:"",value:"BV113_streaming"},{name:"",value:"BV102_streaming"},{name:"",value:"BV405_streaming"},{name:"",value:"BV007_streaming"},{name:"",value:"BV009_streaming"},{name:"",value:"BV419_streaming"},{name:"",value:"BV415_streaming"},{name:"",value:"BV008_streaming"},{name:"",value:"BV408_streaming"},{name:"",value:"BV426_streaming"},{name:"",value:"BV428_streaming"},{name:"",value:"BV403_streaming"},{name:"",value:"BV158_streaming"},{name:"",value:"BV157_streaming"},{name:"",value:"BR001_streaming"},{name:"",value:"BV410_streaming"},{name:"",value:"BV411_streaming"},{name:"-",value:"BV437_streaming"},{name:"",value:"BV412_streaming"},{name:"",value:"BV159_streaming"},{name:"",value:"BV418_streaming"},{name:"",value:"BV142_streaming"},{name:"",value:"BV143_streaming"},{name:"",value:"BV056_streaming"},{name:"",value:"BV005_streaming"},{name:"",value:"BV064_streaming"},{name:"",value:"BV051_streaming"},{name:"",value:"BV063_streaming"},{name:"",value:"BV417_streaming"},{name:"",value:"BV050_streaming"},{name:"",value:"BV061_streaming"},{name:"",value:"BV401_streaming"},{name:"",value:"BV402_streaming"},{name:"",value:"BV006_streaming"},{name:"",value:"BV011_streaming"},{name:"",value:"BV012_streaming"},{name:"-",value:"BV034_streaming"},{name:"",value:"BV033_streaming"}];async function Ut(a,s){var o;const t=a.states,n=(o=t.find(r=>r.id===a.stateId))!=null?o:t[0];let i;return n.ext==="gif"?i=new bs({source:ge(n)}):n.ext==="mp4"?i=new Mt({source:ge(n)}):i=new Yt({source:ge(n)}),i.label=a.name,i.assetID=a.id,i.assetType=a.type,await i.load(),a.type===k.Character?(i.zIndex=ce.Character,i.x=s.options.width/2-i.width/2,i.y=s.options.height-i.height):a.type===k.Background?(i.zIndex=ce.Background,i.width=s.options.width,i.height=s.options.height):a.type===k.Dialog&&(i.zIndex=ce.Dialog,i.x=s.options.width/2-i.width/2,i.y=s.options.height-i.height),i}function nu(a){const s=new Le("",{fill:16777215,breakWords:!0,wordWrap:!0,wordWrapWidth:1600,fontSize:60,leading:15});return s.x=a.options.width/2-s.width/2,s.y=a.options.height/2-s.height/2,s.zIndex=ce.Text,s.label=""+s.name,s}function Wa(a){var i;const s=a.states,t=(i=s.find(o=>o.id===a.stateId))!=null?i:s[0],n=new Ht({source:ge(t)});return n.label=t.name,n.assetID=a.id,n.assetType=a.type,n}let Ai=!1;function iu(a){Ai=a}function qa(){return Ai}function en(a){let s=a,t="";const n=a.match(/^(.+)\[(.+)\]$/);return n&&(s=n[1],t=n[2]),{name:s,state:t}}function ou(a){const s=(t,n)=>n?"".concat(t,"[").concat(n,"]"):t;return a.map(t=>{const n=[];return t.name&&n.push("\n".concat(t.name)),n.push("\n".concat(s(t.background.name,t.background.state))),t.dialogues.forEach(i=>{const{name:o,state:r}=i.character;n.push("".concat(s(o,r),"\n").concat(i.line))}),n.join("\n\n")}).join("\n\n\n")}function ru(a){const s=a.split(/\n\s*\n/).filter(n=>n.trim()!=="").map(n=>{const[i,...o]=n.split("\n");return{name:i,value:o.join("\n")}}),t=[];return s.forEach(n=>{var i;if(n.name==="")t.push({name:n.value,background:{name:"",state:""},dialogues:[]});else if(/(\[.+\])?/.test(n.name)){const o=(i=n.name.match(/(\[.+\])?/)[1])==null?void 0:i.replace(/\[|\]/g,"");t[t.length-1]||t.push({name:"",type:o,background:{name:"",state:""},dialogues:[]}),t[t.length-1].type=o,t[t.length-1].background=en(n.value)}else t[t.length-1]||t.push({name:"",background:{name:"",state:""},dialogues:[]}),t[t.length-1].dialogues.push({character:en(n.name),line:n.value})}),t}async function lu(a){const s=new Set,t=new Set;a.forEach(o=>{o.dialogues.forEach(r=>{r.character.name!==""&&s.add(r.character.name)}),t.add(o.background.name)});const n={},i={};for(const o of s)n[o]=await sa(o,void 0,k.Character);for(const o of t)i[o]=await sa(o,void 0,k.Background);return{characterAssetMap:n,backgroundAssetMap:i}}function Ps(a,s){return a.states.find(t=>t.name===s)||a.states.find(t=>t.id===a.stateId)||a.states[0]}async function cu(a,s,t,n,i){var o;for(const r of a){let c;const l=(o=r.type)!=null?o:i;if(l){let p={:Di,:zi,:ls}[l];if(!p)try{const g=await Pt.where("name").equals(l).first(),v=await Xe.fromJSON(JSON.parse(g.content),!1);p=()=>v}catch(g){console.error("",g),p=ls}c=p()}else c=ls();if(c.label=r.name,s.addScene(c),s.setActiveScene(c),r.background){const{name:f,state:p}=r.background,g=n[f];if(g){const v=Ps(g,p);g.name=f,g.stateId=v.id;const b=await Ut(g,s);s.addChild(b)}}let m=1;const h=new Set;r.dialogues.forEach(f=>{const{name:p}=f.character;p!==""&&h.add(p)});const u=h.size;for(const f of r.dialogues){const p={targetName:"",speakerTargetName:"",name:""};let g;if(f.character.name==="")p.speakerTargetName="Narrator";else{const{name:b,state:V}=f.character,R=t[b];if(R){const W=c.getChildByLabel(b);if(W){if(p.speakerTargetName=W.name,p.name=W.label,V&&R.states.find(H=>H.name===V)){const H=Ps(R,V);g={type:"directive",value:{directive:"ChangeSource",params:{targetName:W.name,source:ge(H)},label:":".concat(W.label,":").concat(V)},children:[{text:""}]}}}else{const H=Ps(R,V);R.stateId=H.id,R.name=b;const X=await Ut(R,s);X.x=s.options.width/(u+1)*m-X.width/2,m++,s.addChild(X),p.speakerTargetName=X.name,p.name=X.label}}else p.name=b}let v=[];g&&(v=[{text:""},g,{text:""}]),s.addDialogue({speak:{speaker:p},lines:[{type:"p",children:[...v,{text:f.line}]}]})}}}async function Ui({lines:a,editor:s,project:t,speak:n,ttsSettings:i}){var h;if(!i||!i.appid||!i.token)throw new Error("");const o=n.speaker.speakerTargetName;let r;o==="Narrator"?r=pt:r=s.activeScene.getChildByName(o).assetID;const l=(await Va(r)).voice;if(!l)throw new Error(", ");if(l===At)throw{voice:l,message:" "};(h=n.voice)!=null&&h.targetName&&s.removeSoundByName(n.voice.targetName);const m=wi(a);try{const u=await Pi({token:i.token,appid:i.appid,text:m,voiceType:l}),f=await dd(u.audio_url,m.slice(0,6)),p=await Th(t.id,k.Audio,f),g=Wa(p);s.addSound(g);const v=Hi(p);return{sound:g,url:v}}catch(u){throw console.error(u),new Error("".concat(m.slice(0,6),"... : ").concat(u.message))}}const rt=Fl,Ei=d.forwardRef(({className:a,...s},t)=>e.jsx(Sn,{ref:t,className:S("flex h-9 items-center space-x-1 rounded-md border bg-background p-1 shadow-sm",a),...s}));Ei.displayName=Sn.displayName;const Ae=d.forwardRef(({className:a,...s},t)=>e.jsx(jn,{ref:t,className:S("flex cursor-default select-none items-center rounded-sm px-2 sm:px-3 py-1 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground",a),...s}));Ae.displayName=jn.displayName;const du=d.forwardRef(({className:a,inset:s,children:t,...n},i)=>e.jsxs(wn,{ref:i,className:S("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground",s&&"pl-8",a),...n,children:[t,e.jsx(gn,{className:"ml-auto h-4 w-4"})]}));du.displayName=wn.displayName;const hu=d.forwardRef(({className:a,...s},t)=>e.jsx(Nn,{ref:t,className:S("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...s}));hu.displayName=Nn.displayName;const lt=d.forwardRef(({className:a,align:s="start",alignOffset:t=-4,sideOffset:n=8,...i},o)=>e.jsx(Xl,{children:e.jsx(Cn,{ref:o,align:s,alignOffset:t,sideOffset:n,className:S("z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...i})}));lt.displayName=Cn.displayName;const B=d.forwardRef(({className:a,inset:s,...t},n)=>e.jsx(kn,{ref:n,className:S("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s&&"pl-8",a),...t}));B.displayName=kn.displayName;const uu=d.forwardRef(({className:a,children:s,checked:t,...n},i)=>e.jsxs(Zn,{ref:i,className:S("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),checked:t,...n,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Gn,{children:e.jsx(ma,{className:"h-4 w-4"})})}),s]}));uu.displayName=Zn.displayName;const mu=d.forwardRef(({className:a,children:s,...t},n)=>e.jsxs(Tn,{ref:n,className:S("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...t,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Gn,{children:e.jsx(bn,{className:"h-4 w-4 fill-current"})})}),s]}));mu.displayName=Tn.displayName;const pu=d.forwardRef(({className:a,inset:s,...t},n)=>e.jsx(Vn,{ref:n,className:S("px-2 py-1.5 text-sm font-semibold",s&&"pl-8",a),...t}));pu.displayName=Vn.displayName;const yt=d.forwardRef(({className:a,...s},t)=>e.jsx(Rn,{ref:t,className:S("-mx-1 my-1 h-px bg-muted",a),...s}));yt.displayName=Rn.displayName;const Ce=zl,fu=Dl,Oi=d.forwardRef(({className:a,...s},t)=>e.jsx(Wn,{ref:t,className:S("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...s}));Oi.displayName=Wn.displayName;const we=d.forwardRef(({className:a,children:s,disableClose:t,...n},i)=>e.jsxs(fu,{children:[e.jsx(Oi,{}),e.jsxs(In,{ref:i,className:S("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...n,children:[s,!t&&e.jsxs(Kl,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[e.jsx(Ln,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));we.displayName=In.displayName;const oe=({className:a,...s})=>e.jsx("div",{className:S("flex flex-col space-y-1.5 text-center sm:text-left",a),...s});oe.displayName="DialogHeader";const Vs=({className:a,...s})=>e.jsx("div",{className:S("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",a),...s});Vs.displayName="DialogFooter";const re=d.forwardRef(({className:a,...s},t)=>e.jsx(Xn,{ref:t,className:S("text-lg font-semibold leading-none tracking-tight",a),...s}));re.displayName=Xn.displayName;const le=d.forwardRef(({className:a,...s},t)=>e.jsx(Fn,{ref:t,className:S("text-sm text-muted-foreground",a),...s}));le.displayName=Fn.displayName;const xu=Se("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),xe=d.forwardRef(({className:a,...s},t)=>e.jsx(Kn,{ref:t,className:S(xu(),a),...s}));xe.displayName=Kn.displayName;const ft=Hl,Ji=d.createContext({}),Y=({...a})=>e.jsx(Ji.Provider,{value:{name:a.name},children:e.jsx(Yl,{...a})}),Rs=()=>{const a=d.useContext(Ji),s=d.useContext(Qi),{getFieldState:t,formState:n}=Ml(),i=t(a.name,n);if(!a)throw new Error("useFormField should be used within <FormField>");const{id:o}=s;return{id:o,name:a.name,formItemId:"".concat(o,"-form-item"),formDescriptionId:"".concat(o,"-form-item-description"),formMessageId:"".concat(o,"-form-item-message"),...i}},Qi=d.createContext({}),F=d.forwardRef(({className:a,...s},t)=>{const n=d.useId();return e.jsx(Qi.Provider,{value:{id:n},children:e.jsx("div",{ref:t,className:S("space-y-2",a),...s})})});F.displayName="FormItem";const z=d.forwardRef(({className:a,...s},t)=>{const{error:n,formItemId:i}=Rs();return e.jsx(xe,{ref:t,className:S(n&&"text-destructive",a),htmlFor:i,...s})});z.displayName="FormLabel";const K=d.forwardRef(({...a},s)=>{const{error:t,formItemId:n,formDescriptionId:i,formMessageId:o}=Rs();return e.jsx(ga,{ref:s,id:n,"aria-describedby":t?"".concat(i," ").concat(o):"".concat(i),"aria-invalid":!!t,...a})});K.displayName="FormControl";const cs=d.forwardRef(({className:a,...s},t)=>{const{formDescriptionId:n}=Rs();return e.jsx("p",{ref:t,id:n,className:S("text-[0.8rem] text-muted-foreground",a),...s})});cs.displayName="FormDescription";const M=d.forwardRef(({className:a,children:s,...t},n)=>{const{error:i,formMessageId:o}=Rs(),r=i?String(i==null?void 0:i.message):s;return r?e.jsx("p",{ref:n,id:o,className:S("text-[0.8rem] font-medium text-destructive",a),...t,children:r}):null});M.displayName="FormMessage";const A=d.forwardRef(({className:a,type:s,...t},n)=>e.jsx("input",{type:s,className:S("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",a),ref:n,...t}));A.displayName="Input";const Ia=Se("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),j=d.forwardRef(({className:a,variant:s,size:t,asChild:n=!1,...i},o)=>{const r=n?ga:"button";return e.jsx(r,{className:S(Ia({variant:s,size:t,className:a})),ref:o,...i})});j.displayName="Button";const gu=P({templateName:E().min(1,"")});function bu({isOpen:a,sceneName:s,onClose:t}){const n=L(c=>c.editor),i=ct({resolver:dt(gu),defaultValues:{templateName:""}}),o=c=>{c||t()},r=async c=>{await Pt.add({name:c.templateName,type:"",content:JSON.stringify(n.cloneSceneByName(s))}),t(),i.reset()};return e.jsx(Ce,{open:a,onOpenChange:o,children:e.jsxs(we,{children:[e.jsxs(oe,{children:[e.jsx(re,{children:""}),e.jsx(le,{})]}),e.jsx(ft,{...i,children:e.jsxs("form",{onSubmit:i.handleSubmit(r),className:"space-y-8",children:[e.jsx(Y,{control:i.control,name:"templateName",render:({field:c})=>e.jsxs(F,{children:[e.jsx(z,{children:""}),e.jsx(K,{children:e.jsx(A,{placeholder:"",...c})}),e.jsx(M,{})]})}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx(j,{type:"button",variant:"outline",onClick:t,children:""}),e.jsx(j,{type:"submit",children:""})]})]})})]})})}function vu({isOpen:a,onClose:s}){const t=Ot(()=>Pt.reverse().toArray()),n=async o=>{await Pt.delete(o)},i=o=>{o||s()};return e.jsx(Ce,{open:a,onOpenChange:i,children:e.jsxs(we,{className:"max-h-[80vh] overflow-auto",children:[e.jsxs(oe,{children:[e.jsx(re,{children:""}),e.jsx(le,{})]}),e.jsxs(Cs,{children:[e.jsx(ks,{children:e.jsxs(ht,{children:[e.jsx(ut,{children:""}),e.jsx(ut,{className:"w-[100px]",children:""})]})}),e.jsx(Zs,{children:t==null?void 0:t.map(o=>e.jsxs(ht,{children:[e.jsx(mt,{children:o.name}),e.jsx(mt,{children:e.jsxs(j,{variant:"ghost",size:"icon",onClick:()=>n(o.id),children:[e.jsx(Z.delete,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:""})]})})]},o.id))})]})]})})}const La=d.forwardRef(({className:a,value:s,...t},n)=>e.jsx(zn,{ref:n,className:S("relative h-2 w-full overflow-hidden rounded-full bg-primary/20",a),...t,children:e.jsx(Bl,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:"translateX(-".concat(100-(s||0),"%)")}})}));La.displayName=zn.displayName;function yu({progress:a,url:s,subtitles:t,isOpen:n,onClose:i}){const o=L(l=>l.project),r=l=>{l||i()},c=()=>{Si(o.name,s)};return e.jsx(Ce,{open:n,onOpenChange:r,children:e.jsxs(we,{className:"min-w-[80vw]",onPointerDownOutside:l=>l.preventDefault(),children:[e.jsxs(oe,{children:[e.jsx(re,{children:""}),e.jsx(le,{})]}),!s&&e.jsx(La,{value:a.value}),s&&e.jsx("video",{src:s,className:"w-full aspect-[16/9]",controls:!0}),e.jsx(Vs,{children:s&&e.jsxs(j,{onClick:c,children:[e.jsx(Z.download,{className:"size-4 mr-1"}),""]})})]})})}const Su=d.forwardRef(({progress:a,isOpen:s,onReplay:t,onClose:n,onExport:i},o)=>{const r=d.useRef(null);d.useImperativeHandle(o,()=>({getPreviewCanvas:()=>r.current}));const c=l=>{l||n()};return e.jsx(Ce,{open:s,onOpenChange:c,children:e.jsxs(we,{className:"min-w-[80vw]",onPointerDownOutside:l=>l.preventDefault(),children:[e.jsxs(oe,{children:[e.jsx(re,{children:""}),e.jsx(le,{}),e.jsx("canvas",{ref:r,className:"w-full aspect-[16/9]"}),e.jsx(La,{value:a.value,className:"mt-2"})]}),e.jsxs(Vs,{children:[e.jsx(j,{variant:"ghost",onClick:t,children:e.jsx(Z.refresh,{className:"size-5"})}),e.jsxs(j,{onClick:i,children:[e.jsx(Z.download,{className:"size-4 mr-1"}),""]})]})]})})}),ju=1,wu=1e6;let As=0;function Nu(){return As=(As+1)%Number.MAX_SAFE_INTEGER,As.toString()}const Us=new Map,tn=a=>{if(Us.has(a))return;const s=setTimeout(()=>{Us.delete(a),Kt({type:"REMOVE_TOAST",toastId:a})},wu);Us.set(a,s)},Cu=(a,s)=>{switch(s.type){case"ADD_TOAST":return{...a,toasts:[s.toast,...a.toasts].slice(0,ju)};case"UPDATE_TOAST":return{...a,toasts:a.toasts.map(t=>t.id===s.toast.id?{...t,...s.toast}:t)};case"DISMISS_TOAST":{const{toastId:t}=s;return t?tn(t):a.toasts.forEach(n=>{tn(n.id)}),{...a,toasts:a.toasts.map(n=>n.id===t||t===void 0?{...n,open:!1}:n)}}case"REMOVE_TOAST":return s.toastId===void 0?{...a,toasts:[]}:{...a,toasts:a.toasts.filter(t=>t.id!==s.toastId)}}},ds=[];let hs={toasts:[]};function Kt(a){hs=Cu(hs,a),ds.forEach(s=>{s(hs)})}function ku({...a}){const s=Nu(),t=i=>Kt({type:"UPDATE_TOAST",toast:{...i,id:s}}),n=()=>Kt({type:"DISMISS_TOAST",toastId:s});return Kt({type:"ADD_TOAST",toast:{...a,id:s,open:!0,onOpenChange:i=>{i||n()}}}),{id:s,dismiss:n,update:t}}function st(){const[a,s]=d.useState(hs);return d.useEffect(()=>(ds.push(s),()=>{const t=ds.indexOf(s);t>-1&&ds.splice(t,1)}),[a]),{...a,toast:ku,dismiss:t=>Kt({type:"DISMISS_TOAST",toastId:t})}}const Zu=P({projectName:E().min(1,"")});function Gu({isOpen:a,onClose:s}){const t=L(l=>l.editor),n=L(l=>l.setProject),{toast:i}=st(),o=ct({resolver:dt(Zu),defaultValues:{projectName:""}}),r=l=>{l||s()},c=async l=>{const m={name:l.projectName,content:"",time:Date.now()},h=await Ee.add(m);t.clear(),n({id:h,...m}),s(),o.reset(),i({title:"!",description:"",duration:1e3})};return e.jsx(Ce,{open:a,onOpenChange:r,children:e.jsxs(we,{children:[e.jsxs(oe,{children:[e.jsx(re,{children:""}),e.jsx(le,{})]}),e.jsx(ft,{...o,children:e.jsxs("form",{onSubmit:o.handleSubmit(c),className:"space-y-8",children:[e.jsx(Y,{control:o.control,name:"projectName",render:({field:l})=>e.jsxs(F,{children:[e.jsx(z,{children:""}),e.jsx(K,{children:e.jsx(A,{placeholder:"",...l})}),e.jsx(M,{})]})}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx(j,{type:"button",variant:"outline",onClick:s,children:""}),e.jsx(j,{type:"submit",children:""})]})]})})]})})}function Tu({isOpen:a,onClose:s}){const t=L(h=>h.editor),n=L(h=>h.setProject),i=Ot(()=>Ee.reverse().toArray()),o=d.useRef(!1),r=h=>{h||s()},c=async h=>{if(o.current)return;o.current=!0;const u=await Ee.get(h);t.clear(),u.content&&(await t.loadFromJSON(u.content),t.setActiveSceneByIndex(0)),n(u),s(),setTimeout(()=>{o.current=!1},100)},l=async h=>{await Ee.delete(h),await Vh(h)},m=async h=>{const u=await Ee.get(h);await Ee.add({name:"".concat(u.name," - "),content:u.content,time:Date.now()})};return e.jsx(Ce,{open:a,onOpenChange:r,children:e.jsxs(we,{className:"max-h-[80vh] overflow-auto",children:[e.jsxs(oe,{children:[e.jsx(re,{children:""}),e.jsx(le,{})]}),e.jsxs(Cs,{children:[e.jsx(ks,{children:e.jsxs(ht,{children:[e.jsx(ut,{children:""}),e.jsx(ut,{className:"w-[80px]",children:""})]})}),e.jsx(Zs,{children:i==null?void 0:i.map(h=>e.jsxs(ht,{children:[e.jsx(mt,{onClick:()=>c(h.id),children:e.jsx("span",{className:"cursor-pointer",children:h.name})}),e.jsxs(mt,{className:"flex gap-2",children:[e.jsx(Z.copy,{className:"h-4 w-4 cursor-pointer",onClick:()=>m(h.id)}),e.jsx(Z.delete,{className:"h-4 w-4 cursor-pointer",onClick:()=>l(h.id)})]})]},h.id))})]})]})})}const Vu=Al,Ru=Pl,_i=d.forwardRef(({className:a,...s},t)=>e.jsx(Dn,{className:S("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...s,ref:t}));_i.displayName=Dn.displayName;const $i=d.forwardRef(({className:a,...s},t)=>e.jsxs(Ru,{children:[e.jsx(_i,{}),e.jsx(Yn,{ref:t,className:S("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...s})]}));$i.displayName=Yn.displayName;const qi=({className:a,...s})=>e.jsx("div",{className:S("flex flex-col space-y-2 text-center sm:text-left",a),...s});qi.displayName="AlertDialogHeader";const eo=({className:a,...s})=>e.jsx("div",{className:S("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",a),...s});eo.displayName="AlertDialogFooter";const to=d.forwardRef(({className:a,...s},t)=>e.jsx(Mn,{ref:t,className:S("text-lg font-semibold",a),...s}));to.displayName=Mn.displayName;const so=d.forwardRef(({className:a,...s},t)=>e.jsx(Hn,{ref:t,className:S("text-sm text-muted-foreground",a),...s}));so.displayName=Hn.displayName;const ao=d.forwardRef(({className:a,...s},t)=>e.jsx(Bn,{ref:t,className:S(Ia(),a),...s}));ao.displayName=Bn.displayName;const no=d.forwardRef(({className:a,...s},t)=>e.jsx(Pn,{ref:t,className:S(Ia({variant:"outline"}),"mt-2 sm:mt-0",a),...s}));no.displayName=Pn.displayName;function Wu({isOpen:a,onConfirm:s,onClose:t}){const n=o=>{o||t()},i=()=>{s(),t()};return e.jsx(Vu,{open:a,onOpenChange:n,children:e.jsxs($i,{children:[e.jsxs(qi,{children:[e.jsx(to,{children:""}),e.jsx(so,{})]}),e.jsxs(eo,{children:[e.jsx(no,{children:""}),e.jsx(ao,{onClick:i,children:""})]})]})})}function io(){const a=vs(o=>o.setOpen),s=vs(o=>o.setLoadingText);return{showLoading:o=>{a(!0),s(o)},updateLoadingText:o=>{s(o)},hideLoading:()=>{a(!1),s("")}}}const ve=ec,Xa=tc,ye=sc,ue=d.forwardRef(({className:a,children:s,...t},n)=>e.jsxs(An,{ref:n,className:S("flex h-9 w-full items-center justify-between whitespace-nowrap rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",a),"data-disable-click-outside":!0,...t,children:[s,e.jsx(Ul,{asChild:!0,children:e.jsx(El,{"data-disable-click-outside":!0,className:"h-4 w-4 opacity-50"})})]}));ue.displayName=An.displayName;const oo=d.forwardRef(({className:a,...s},t)=>e.jsx(Un,{ref:t,className:S("flex cursor-default items-center justify-center py-1",a),"data-disable-click-outside":!0,...s,children:e.jsx(Ol,{})}));oo.displayName=Un.displayName;const ro=d.forwardRef(({className:a,...s},t)=>e.jsx(En,{ref:t,className:S("flex cursor-default items-center justify-center py-1",a),"data-disable-click-outside":!0,...s,children:e.jsx(Jl,{})}));ro.displayName=En.displayName;const me=d.forwardRef(({className:a,children:s,position:t="popper",...n},i)=>e.jsx(Ql,{children:e.jsxs(On,{ref:i,className:S("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",a),position:t,"data-disable-click-outside":!0,...n,children:[e.jsx(oo,{}),e.jsx(_l,{className:S("p-1",t==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),"data-disable-click-outside":!0,children:s}),e.jsx(ro,{})]})}));me.displayName=On.displayName;const Ws=d.forwardRef(({className:a,...s},t)=>e.jsx(Jn,{ref:t,className:S("px-2 py-1.5 text-sm font-semibold",a),...s,"data-disable-click-outside":!0}));Ws.displayName=Jn.displayName;const q=d.forwardRef(({className:a,children:s,...t},n)=>e.jsxs(Qn,{ref:n,className:S("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),"data-disable-click-outside":!0,...t,children:[e.jsx("span",{className:"absolute right-2 flex h-3.5 w-3.5 items-center justify-center","data-disable-click-outside":!0,children:e.jsx($l,{children:e.jsx(ma,{className:"h-4 w-4"})})}),e.jsx(ql,{"data-disable-click-outside":!0,children:s})]}));q.displayName=Qn.displayName;const Iu=d.forwardRef(({className:a,...s},t)=>e.jsx(_n,{ref:t,className:S("-mx-1 my-1 h-px bg-muted",a),"data-disable-click-outside":!0,...s}));Iu.displayName=_n.displayName;const Is=ac,ss=d.forwardRef(({className:a,...s},t)=>e.jsx($n,{ref:t,className:S("inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground",a),...s}));ss.displayName=$n.displayName;const Ye=d.forwardRef(({className:a,...s},t)=>e.jsx(qn,{ref:t,className:S("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow",a),...s}));Ye.displayName=qn.displayName;const qe=d.forwardRef(({className:a,...s},t)=>e.jsx(ei,{ref:t,className:S("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",a),...s}));qe.displayName=ei.displayName;const Je=js()(nc(a=>({ai:null,updateAI:s=>a({ai:s}),tts:null,updateTTS:s=>a({tts:s})}),{name:"settings"})),Lu=P({platform:E().min(1,""),key:E().min(1,"API KEY"),model:E().min(1,"")}),Xu=P({token:E().min(1,"Token"),appid:E().min(1,"AppID")});function Fu({isOpen:a,onClose:s}){const[t,n]=d.useState("llm"),i=Je(p=>p.ai),o=Je(p=>p.tts),r=Je(p=>p.updateAI),c=Je(p=>p.updateTTS),l=p=>{p||s()},m=ct({resolver:dt(Lu),defaultValues:{platform:"deepseek",key:"",model:"deepseek-chat"}}),h=ct({resolver:dt(Xu),defaultValues:{appid:"",token:""}});function u(p){r(p),s()}function f(p){c(p),s()}return d.useEffect(()=>{i&&m.reset(i)},[i,m]),d.useEffect(()=>{o&&h.reset(o)},[o,h]),e.jsx(Ce,{open:a,onOpenChange:l,children:e.jsxs(we,{className:"min-w-[400px]",onPointerDownOutside:p=>p.preventDefault(),children:[e.jsxs(oe,{children:[e.jsx(re,{children:""}),e.jsx(le,{})]}),e.jsxs(Is,{value:t,onValueChange:n,className:"w-full",children:[e.jsxs(ss,{className:"grid grid-cols-2 mb-4",children:[e.jsx(Ye,{value:"llm",children:""}),e.jsx(Ye,{value:"tts",children:""})]}),e.jsx(qe,{value:"llm",children:e.jsx(ft,{...m,children:e.jsxs("form",{onSubmit:m.handleSubmit(u),className:"space-y-4",children:[e.jsx(Y,{control:m.control,name:"platform",render:({field:p})=>e.jsxs(F,{children:[e.jsx(z,{children:"AI"}),e.jsx(K,{children:e.jsxs(ve,{onValueChange:p.onChange,value:p.value,children:[e.jsx(ue,{children:e.jsx(ye,{placeholder:"AI"})}),e.jsxs(me,{children:[e.jsx(q,{value:"deepseek",children:"DeepSeek"}),e.jsx(q,{value:"ark",children:""}),e.jsx(q,{value:"openai",children:"OpenAI"})]})]})}),e.jsx(M,{})]})}),e.jsx(Y,{control:m.control,name:"key",render:({field:p})=>e.jsxs(F,{children:[e.jsx(z,{children:"API KEY"}),e.jsx(K,{children:e.jsx(A,{type:"password",placeholder:"API KEY",...p})}),e.jsx(M,{})]})}),e.jsx(Y,{control:m.control,name:"model",render:({field:p})=>e.jsxs(F,{children:[e.jsx(z,{children:"Model"}),e.jsx(K,{children:e.jsx(A,{placeholder:"",...p})}),e.jsx(M,{})]})}),e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx(j,{type:"submit",children:""}),e.jsx(j,{variant:"ghost",onClick:s,children:""})]})]})})}),e.jsx(qe,{value:"tts",children:e.jsx(ft,{...h,children:e.jsxs("form",{onSubmit:h.handleSubmit(f),className:"space-y-4",children:[e.jsx(Y,{control:h.control,name:"appid",render:({field:p})=>e.jsxs(F,{children:[e.jsx(z,{children:"AppID"}),e.jsx(K,{children:e.jsx(A,{placeholder:"AppID",...p})}),e.jsx(M,{})]})}),e.jsx(Y,{control:h.control,name:"token",render:({field:p})=>e.jsxs(F,{children:[e.jsx(z,{children:"Token"}),e.jsx(K,{children:e.jsx(A,{type:"password",placeholder:"Token",...p})}),e.jsx(M,{})]})}),e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx(j,{type:"submit",children:""}),e.jsx(j,{variant:"ghost",onClick:s,children:""})]})]})})})]})]})})}function Vt(a){const[s,t]=d.useState(window.matchMedia(a).matches);return d.useEffect(()=>{const n=window.matchMedia(a);n.matches!==s&&t(n.matches);const i=()=>t(n.matches);return n.addEventListener("change",i),()=>n.removeEventListener("change",i)},[s,a]),s}function Ku(){const[a,s]=d.useState(!1),[t,n]=d.useState();return{isOpenText2Scene:a,text2SceneType:t,handleOpenImportText2Scene:()=>{s(!0),n("formatter")},handleOpenAiText2Scene:()=>{s(!0),n("ai")},handleCloseText2Scene:()=>{s(!1)}}}async function lo(a,s){var u,f,p;const t=new URLSearchParams(window.location.search),n=Je.getState().ai;let i=t.get("key"),o=t.get("model"),r=(u=t.get("platform"))!=null?u:"deepseek";if(i||(i=n.key,o=n.model,r=n.platform),!i||!o||!r)throw new Error(" AI ");const m=(p=(f=(await new ic({apiKey:i,baseURL:"".concat(location.origin,"/api/llm/").concat(r),dangerouslyAllowBrowser:!0}).chat.completions.create({messages:[{role:"system",content:a},{role:"user",content:s}],model:o})).choices[0])==null?void 0:f.message)==null?void 0:p.content;console.log("LLM Response:",m);const h=ji(m);if(h)return h.scenes;throw new Error(" JSON ")}async function zu(a){const s=' JSON \n\n1.	 Typescript \n\n```typescript\ninterface StoryCharacter {\n  /**\n   * \n   */\n  name: string;\n  /**\n   * \n   */\n  state: string;\n}\n\ninterface StoryDialogue {\n  /**\n   *  3  3 \n   */\n  character: StoryCharacter;\n  /**\n   * \n   */\n  line: string;\n}\n\ninterface StoryBackground {\n  /**\n   * \n   */\n  name: string;\n  /**\n   * \n   */\n  state: string;\n}\n\nexport interface StoryScene {\n  /**\n   * \n   */\n  name: string;\n  /**\n   * \n   */\n  background: StoryBackground;\n  /**\n   * \n   */\n  dialogues: StoryDialogue[];\n}\n```\n\n2.	\n JSON  StoryScene \n```json\n{\n  "scenes": [{\n    "name": "",\n    "background": {\n      "name": "",\n      "state": ""\n    },\n    "dialogues": [{\n      "character": {\n        "name": "",\n        "state": ""\n      },\n      "line": ""\n    }{\n      "character": {\n        "name": "",\n        "state": ""\n      },\n      "line": ""\n    }, {\n      "character": {\n        "name": "",\n        "state": ""\n      },\n      "line": ""\n    }]\n  }, {\n    "name": "",\n    "background": {\n      "name": "",\n      "state": ""\n    },\n    "dialogues": [{\n      "character": {\n        "name": "",\n        "state": ""\n      },\n      "line": ""\n    }]\n  }]\n}\n```\n',t="".concat(a);return await lo(s,t)}async function Du(a){const s=' JSON \n\n1.	 Typescript \n\n```typescript\ninterface StoryCharacter {\n  /**\n   * \n   */\n  name: string;\n  /**\n   * \n   */\n  state: string;\n}\n\ninterface StoryDialogue {\n  /**\n   *  3  3 \n   */\n  character: StoryCharacter;\n  /**\n   * \n   */\n  line: string;\n}\n\ninterface StoryBackground {\n  /**\n   * \n   */\n  name: string;\n  /**\n   * \n   */\n  state: string;\n}\n\nexport interface StoryScene {\n  /**\n   * \n   */\n  name: string;\n  /**\n   * \n   */\n  background: StoryBackground;\n  /**\n   * \n   */\n  dialogues: StoryDialogue[];\n}\n```\n\n2.	\n JSON  StoryScene \n```json\n{\n  "scenes": [{\n    "name": "",\n    "background": {\n      "name": "",\n      "state": ""\n    },\n    "dialogues": [{\n      "character": {\n        "name": "",\n        "state": ""\n      },\n      "line": ""\n    },{\n      "character": {\n        "name": "",\n        "state": ""\n      },\n      "line": ""\n    }, {\n      "character": {\n        "name": "",\n        "state": ""\n      },\n      "line": ""\n    }]\n  }, {\n    "name": "",\n    "background": {\n      "name": "",\n      "state": ""\n    },\n    "dialogues": [{\n      "character": {\n        "name": "",\n        "state": ""\n      },\n      "line": ""\n    }]\n  }]\n}\n```\n',t="".concat(a);return await lo(s,t)}const co=d.forwardRef(({className:a,...s},t)=>e.jsx("textarea",{className:S("flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",a),ref:t,...s}));co.displayName="Textarea";function Yu({accept:a,disabled:s,onFileSelect:t}){const[n,i]=d.useState(null),o=d.useRef(null),r=l=>{var h;const m=(h=l.target.files)==null?void 0:h[0];m&&(i(m.name),t(m))},c=()=>{var l;(l=o.current)==null||l.click()};return e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(j,{variant:"outline",size:"icon",onClick:c,"aria-label":"",disabled:s,children:e.jsx(oc,{className:"h-4 w-4"})}),e.jsx("input",{type:"file",ref:o,onChange:r,className:"hidden",accept:a}),n&&e.jsxs("span",{className:"text-sm text-gray-600",children:[": ",n]})]})}function Mu({value:a,onChange:s}){const t=a.split("\n"),n=o=>{const r=[...t];r.splice(o,0,"",""," ".concat(o+1),""),s(r.join("\n"))},i=o=>{const r=[...t];if(r[o].trim()===""){let c=1;o+1<r.length&&r[o+1].trim().startsWith("")&&c++,o>0&&r[o-1].trim()===""&&(r.splice(o-1,1),o--),r.splice(o,c),s(r.join("\n"))}};return e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"text-xs text-muted-foreground bg-muted/50 p-2 rounded",children:[" ",e.jsx(Js,{className:"inline w-3 h-3"}),"  ",e.jsx($s,{className:"inline w-3 h-3"})," "]}),e.jsx(be,{className:"h-[50vh] md:h-[400px] w-full border rounded-md relative bg-background outline-none focus:outline-none focus:ring-0",children:e.jsx("div",{className:"p-4 outline-none focus:outline-none",children:t.map((o,r)=>{const c=o.trim()==="",l=r>0&&t[r-1].trim()==="",m=c;return e.jsxs("div",{className:S("group flex items-start py-1 px-2 hover:bg-muted/50 rounded transition-colors border-l-2 border-transparent outline-none focus:outline-none focus:ring-0 select-none tap-highlight-transparent",(c||l)&&"bg-yellow-500/20 font-bold border-l-yellow-500",m&&"border-t border-t-yellow-500/50 mt-4 pt-2"),children:[e.jsx("div",{className:"w-8 text-xs text-muted-foreground pt-1 select-none text-right mr-3",children:r+1}),e.jsx("div",{className:"relative w-6 h-6 mr-2 flex-shrink-0 flex items-center justify-center",children:c?e.jsx(j,{size:"icon",variant:"ghost",className:"h-6 w-6 opacity-60 hover:opacity-100 transition-all hover:bg-destructive hover:text-destructive-foreground text-destructive",title:"",onClick:()=>i(r),children:e.jsx($s,{className:"h-3 w-3"})}):e.jsx(j,{size:"icon",variant:"ghost",className:"h-6 w-6 opacity-0 group-hover:opacity-100 transition-all hover:bg-primary hover:text-primary-foreground",title:"",onClick:()=>n(r),children:e.jsx(Js,{className:"h-3 w-3"})})}),e.jsx("div",{className:"flex-1 whitespace-pre-wrap break-all text-sm leading-6",children:o||e.jsx("span",{className:"text-muted-foreground/30 italic h-6 block"})})]},r)})})})]})}function Es({children:a,value:s,placeholder:t,completeButtonLabel:n,loading:i,onChange:o,onChangeTemplate:r,onComplete:c}){const l=d.useMemo(()=>!!i,[i]),{customTemplates:m}=Ra(),[h,u]=d.useState("edit"),f=async b=>{const V=await b.text();o(V)},p=b=>{o(b.target.value)},g=()=>{c(s)},v=d.useMemo(()=>[{name:"",value:""},...m.map(b=>({name:b.name,value:b.name}))],[m]);return e.jsxs("div",{className:"space-y-4 w-full",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(xe,{children:""}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(j,{variant:h==="edit"?"secondary":"ghost",size:"sm",onClick:()=>u("edit"),children:[e.jsx(fn,{className:"w-4 h-4 mr-1"})," "]}),e.jsxs(j,{variant:h==="split"?"secondary":"ghost",size:"sm",onClick:()=>u("split"),children:[e.jsx(rc,{className:"w-4 h-4 mr-1"})," "]})]})]}),h==="edit"?e.jsx(co,{value:s,onChange:p,placeholder:t,className:"min-h-[50vh] md:min-h-[400px]",disabled:l}):e.jsx(Mu,{value:s,onChange:o}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[a||e.jsx(Yu,{disabled:l,onFileSelect:f,accept:".txt"}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-4 md:space-x-6",children:[r&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm whitespace-nowrap",children:":"}),e.jsxs(ve,{onValueChange:r,defaultValue:v[0].name,children:[e.jsx(ue,{className:"flex-1 min-w-[150px]",children:e.jsx(ye,{placeholder:""})}),e.jsx(me,{children:v.map(b=>e.jsx(q,{value:b.name,children:b.name},b.name))})]})]}),e.jsxs(j,{onClick:g,disabled:l,className:"w-full md:w-auto",children:[i&&e.jsx(ba,{className:"animate-spin mr-1"}),i||n||""]})]})]})]})}function Hu({url:a,className:s}){const[t,n]=d.useState(!1),i=d.useRef(null),o=r=>{r.stopPropagation(),i.current&&(t?i.current.pause():i.current.play(),n(!t))};return e.jsxs("div",{className:S("w-full aspect-[1/1] flex justify-center items-center cursor-pointer relative",s),children:[e.jsx("audio",{ref:i,src:a,className:"hidden"}),e.jsx(j,{onClick:o,variant:"outline",size:"icon",className:"w-12 h-12",children:t?e.jsx(ti,{className:"h-6 w-6"}):e.jsx(si,{className:"h-6 w-6"})})]})}function Bu({url:a,className:s}){return e.jsx("div",{className:S("w-full h-full cursor-pointer flex justify-center items-center relative",s),style:{backgroundImage:'url(\'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20"><rect width="10" height="10" fill="%23ccc"/><rect x="10" y="10" width="10" height="10" fill="%23ccc"/></svg>\')'},children:a&&e.jsx("img",{src:a,className:"absolute left-0 top-0 h-full w-full object-contain"})})}function Pu(){return"font-".concat(Date.now())}function Au({fontName:a,fontUrl:s,className:t}){const n=d.useMemo(()=>{if(a)return a;if(s)return Pu()},[a,s]);return d.useEffect(()=>{if(a)return;const i=document.createElement("style");return i.innerHTML="\n      @font-face {\n        font-family: '".concat(n,"';\n        src: url('").concat(s,"');\n      }\n    "),document.head.appendChild(i),()=>{a||document.head.removeChild(i)}},[n,a,s]),e.jsxs("div",{className:S("w-full aspect-[1/1] flex flex-col justify-center items-center relative",t),style:{fontFamily:n},children:[e.jsx("span",{children:""}),e.jsx("span",{children:"Sample Text"}),e.jsx("span",{children:"0123456789"})]})}function Uu({url:a,className:s}){return e.jsx("video",{src:a,className:S("w-full h-full",s),controls:!0,muted:!0})}const Eu={[k.Background]:"240px",[k.Character]:"135px",[k.Thing]:"200px",[k.Dialog]:"240px",[k.Audio]:"150px",[k.Font]:"150px"},Os={[k.Background]:"aspect-[16/9]",[k.Character]:"aspect-[9/16]",[k.Thing]:"aspect-[1/1]",[k.Dialog]:"aspect-[16/3]"};function ho({type:a,url:s,ext:t,state:n}){const i=d.useMemo(()=>s||(n&&n.id?ge(n):""),[s,n]),o=d.useMemo(()=>t||(n?n.ext:""),[t,n]);return Object.keys(Os).includes(a)?o==="mp4"?e.jsx(Uu,{url:i,className:Os[a]}):e.jsx(Bu,{url:i,className:Os[a]}):a===k.Audio?e.jsx(Hu,{url:i}):a===k.Font?e.jsx(Au,{fontName:n==null?void 0:n.name,fontUrl:i}):null}function ys({type:a,state:s,children:t,onSelect:n}){return e.jsx(bt,{className:"rounded-md cursor-pointer",style:{width:Eu[a]},onClick:n,children:t||e.jsxs(e.Fragment,{children:[e.jsx(tt,{className:"p-2 flex justify-center",children:e.jsx(ho,{type:a,state:s})}),e.jsx(Gs,{className:"font-medium p-2 pt-0 flex justify-center text-sm break-all",children:s.name})]})})}function Ou({asset:a,onSelect:s,onEdit:t,onDelete:n}){return e.jsxs(bt,{className:"rounded-md",children:[e.jsx(tt,{className:"p-0 flex justify-center cursor-pointer",onClick:s,children:e.jsx(Z.folder,{className:"w-[120px] h-[120px] text-neutral-600 p-2"})}),e.jsxs(Gs,{className:"w-[120px] font-medium p-2 pt-0 flex justify-between text-sm",children:[e.jsx("div",{className:"max-w-[100px] overflow-hidden text-ellipsis cursor-pointer",onClick:s,children:a.name}),e.jsxs(Ca,{children:[e.jsx(ka,{children:e.jsx(Z.more,{className:"w-4 h-4 pointer"})}),e.jsxs(Ts,{children:[e.jsx(de,{onClick:t,children:""}),a.id!==pt&&e.jsx(de,{className:"text-destructive",onClick:n,children:""})]})]})]})]})}function Ju({isOpen:a,type:s,onClose:t}){const n=L(G=>G.editor),i=L(G=>G.project),o=L(G=>G.setProject),[r,c]=d.useState([]),[l,m]=d.useState(""),{toast:h}=st(),[u,f]=d.useState(null),[p,g]=d.useState(null),[v,b]=d.useState(""),[V,R]=d.useState(""),[W,H]=d.useState(""),[X,O]=d.useState(1),{selectAsset:ie}=Tt(),[T,y]=d.useState("");d.useEffect(()=>{if(s==="ai"&&O(1),s==="formatter"){O(2);const G=localStorage.getItem("vnve_import_text");G&&(R(G),localStorage.removeItem("vnve_import_text"),h({title:" Story Painter "}))}},[s]);const w=()=>{t(),c([]),m(""),f(null),g(null),b(""),R("")},U=async G=>{m("");try{const I=ji(G);await Ze(I!=null&&I.scenes?I.scenes:ru(G))}catch(I){h({title:"",description:I.message,variant:"destructive"}),console.error(I)}finally{m("")}},te=async(G,I)=>{m(G==="convert"?"":"");try{let $;G==="convert"?$=await zu(I):$=await Du(I);const nt=ou($);R(nt),O(X+1)}catch($){h({title:"".concat(G==="convert"?"":"",""),description:$.message,variant:"destructive"})}finally{m("")}},Ze=async G=>{c(G);const I=await lu(G);f(I.characterAssetMap),g(I.backgroundAssetMap),O(X+1)},He=()=>{if(Object.keys(u).some(I=>!u[I])){h({title:"",variant:"destructive"});return}O(X+1)},se=async()=>{if(Object.keys(p).some(I=>!p[I])){h({title:"",variant:"destructive"});return}if(!i&&!W){h({title:"",variant:"destructive"});return}m("");try{if(!i){const I={name:W,content:"",time:Date.now()},$=await Ee.add(I);o({id:$,...I}),n.clear()}await cu(r,n,u,p,T),w()}catch(I){h({title:"",description:I.message,variant:"destructive"})}finally{m("")}},D=async G=>{const I=await ie(k.Character);I&&f({...u,[G]:I})},_=G=>{const I={...u};delete I[G],f(I)},pe=async G=>{if(l)return;const I=await ie(k.Background);I&&g({...p,[G]:I})},at=()=>{localStorage.setItem("vnve_script_draft",V),h({title:"",description:""})},Ge=()=>{const G=localStorage.getItem("vnve_script_draft");G?(R(G),h({title:"",description:""})):h({title:"",description:"",variant:"destructive"})},as=[()=>e.jsxs(e.Fragment,{children:[e.jsxs(oe,{children:[e.jsxs(re,{className:"flex items-center gap-2",children:[e.jsx(Z.sparkles,{className:"size-5"}),""]}),e.jsx(le,{})]}),e.jsxs(Is,{defaultValue:"convert",children:[e.jsxs(ss,{className:"grid w-full grid-cols-2",children:[e.jsx(Ye,{value:"convert",disabled:!!l,children:""}),e.jsx(Ye,{value:"generate",disabled:!!l,children:""})]}),e.jsx(qe,{value:"convert",children:e.jsx(Es,{value:v,onChange:b,placeholder:"",loading:l,onComplete:G=>te("convert",G)})}),e.jsx(qe,{value:"generate",children:e.jsx(Es,{value:v,onChange:b,placeholder:"",loading:l,onComplete:G=>te("generate",G)})})]})]}),()=>e.jsx(e.Fragment,{children:e.jsxs(oe,{children:[e.jsx(re,{className:"flex items-center gap-2",children:""}),e.jsx(le,{}),!i&&e.jsxs("div",{className:"grid w-full items-center gap-1.5 mb-2",children:[e.jsx(xe,{htmlFor:"projectName",children:""}),e.jsx(A,{id:"projectName",value:W,onChange:G=>H(G.target.value),placeholder:""})]}),e.jsx(Es,{value:V,placeholder:"",loading:l,onChange:R,onComplete:U,onChangeTemplate:y,children:e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx(j,{variant:"outline",onClick:Ge,children:""}),e.jsx(j,{variant:"outline",onClick:at,children:""}),s==="ai"&&e.jsx(j,{variant:"outline",onClick:()=>O(X-1),children:""})]})})]})}),()=>e.jsxs(e.Fragment,{children:[e.jsxs(oe,{children:[e.jsx(re,{className:"flex items-center gap-2",children:""}),e.jsx(le,{children:""})]}),e.jsxs(be,{children:[e.jsx("div",{className:"flex gap-1 pb-4",children:Object.keys(u).map(G=>{const I=u[G];let $={name:G,id:0,ext:""};return I&&($={...I.states.find(Rt=>Rt.id===I.stateId)||I.states[0],name:G}),e.jsxs("div",{className:"relative group",children:[e.jsx(ys,{type:k.Character,state:$,onSelect:()=>D(G)}),e.jsx(j,{variant:"destructive",size:"icon",className:"absolute -top-1 -right-1 h-6 w-6 rounded-md shadow-md border border-white/50 opacity-0 group-hover:opacity-100 transition-all duration-200 hover:scale-110 z-20",title:"",onClick:nt=>{nt.stopPropagation(),_(G)},children:e.jsx(Qs,{className:"h-3 w-3"})})]},G)})}),e.jsx(Bt,{orientation:"horizontal"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(j,{variant:"outline",onClick:()=>O(X-1),children:""}),e.jsx(j,{onClick:He,children:""})]})]}),()=>e.jsxs(e.Fragment,{children:[e.jsxs(oe,{children:[e.jsx(re,{className:"flex items-center gap-2",children:""}),e.jsx(le,{children:""})]}),e.jsxs(be,{children:[e.jsx("div",{className:"flex gap-1 pb-4",children:Object.keys(p).map(G=>{const I=p[G];let $={name:G,id:0,ext:""};return I&&($={...I.states.find(Rt=>Rt.id===I.stateId)||I.states[0],name:G}),e.jsx(ys,{type:k.Background,state:$,onSelect:()=>pe(G)},G)})}),e.jsx(Bt,{orientation:"horizontal"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(j,{variant:"outline",disabled:!!l,onClick:()=>O(X-1),children:""}),e.jsxs(j,{disabled:!!l,onClick:se,children:[l&&e.jsx(ba,{className:"animate-spin mr-1"}),l||""]})]})]})];return e.jsx(Ce,{open:a,onOpenChange:w,children:e.jsx(we,{className:"min-w-[90vw] md:min-w-[70vw] max-h-[90vh] overflow-y-auto outline-none focus:outline-none focus:ring-0",onPointerDownOutside:G=>G.preventDefault(),children:X>0&&as[X-1]()})})}var St=(a=>(a.Animation="Animation",a.Sound="Sound",a.Util="Util",a.Filter="Filter",a.Transition="Transition",a))(St||{});const ke={[C.Speak]:"",[C.Speaker]:"",[C.ChangeSource]:"",[C.Show]:"",[C.Hide]:"",[C.FadeIn]:"",[C.FadeOut]:"",[C.ShakeX]:"",[C.ShakeY]:"",[C.ZoomIn]:"",[C.ZoomOut]:"",[C.EnterFromLeft]:"",[C.LeaveFromLeft]:"",[C.EnterFromRight]:"",[C.LeaveFromRight]:"",[C.Play]:"",[C.Pause]:"",[C.Stop]:"",[C.Wait]:"",[C.FadeInTransition]:"",[C.AddFilter]:"",[C.RemoveFilter]:""},Et=[C.ChangeSource,C.Show,C.Hide,C.FadeIn,C.FadeOut,C.ShakeX,C.ShakeY,C.ZoomIn,C.ZoomOut,C.EnterFromLeft,C.LeaveFromLeft,C.EnterFromRight,C.LeaveFromRight],Qu=Et.map(a=>({name:ke[a],value:a})),Fa=[C.Play,C.Pause,C.Stop],_u=Fa.map(a=>({name:ke[a],value:a})),Ka=[C.Wait],za=[C.AddFilter,C.RemoveFilter],uo=[C.FadeInTransition],$u=Ka.map(a=>({name:ke[a],value:a})),qu=za.map(a=>({name:ke[a],value:a})),em=uo.map(a=>({name:ke[a],value:a})),tm=[{name:"",type:"Animation",options:Qu},{name:"",type:"Sound",options:_u},{name:"",type:"Util",options:$u},{name:"",type:"Filter",options:qu},{name:"",type:"Transition",options:em}];function sm(a){if(Et.includes(a))return"Animation";if(Fa.includes(a))return"Sound";if(Ka.includes(a))return"Util";if(za.includes(a))return"Filter";if(uo.includes(a))return"Transition"}const sn=[{name:"",value:"BlackMaskFilter"},{name:"",value:"BlurFilter"},{name:"",value:"NoiseFilter"},{name:"",value:"OldFilmFilter"},{name:"",value:"VignetteFilter"}];function am(){const a=L(N=>N.initEditor),s=L(N=>N.project),t=L(N=>N.editor),n=L(N=>N.activeScene),i=L(N=>N.scenes),{selectAsset:o}=Tt(),r=d.useRef(null),c=d.useRef(null),{defaultTemplates:l,customTemplates:m,handleAddDefaultTemplate:h,handleAddCustomTemplate:u}=Ra(),[f,p]=d.useState(!1),[g,v]=d.useState(!1),[b,V]=d.useState(!1),[R,W]=d.useState(!1),[H,X]=d.useState(!1),[O,ie]=d.useState(!1),[T,y]=d.useState(!1),w=d.useRef(null),[U,te]=d.useState([]),[Ze,He]=d.useState(null),se=d.useRef(null),[D,_]=d.useState([]),[pe,at]=d.useState({value:0,currentTime:0}),Ge=d.useRef(0),[Xs,Pa]=d.useState(""),{toast:Ne}=st(),{showLoading:Fs,hideLoading:as}=io(),{isOpenText2Scene:G,text2SceneType:I,handleOpenImportText2Scene:$,handleOpenAiText2Scene:nt,handleCloseText2Scene:Rt}=Ku(),it=Vt("(min-width: 768px)"),ko=async()=>{try{await kh()}catch(N){Ne({title:"",description:N.message,variant:"destructive"})}},Zo=async()=>{Fs("");try{await Zh()}catch(N){Ne({title:"",description:N.message,variant:"destructive"})}finally{as()}},Go=(N,J)=>{if(N>=100){at({value:N,currentTime:J}),Ge.current&&clearTimeout(Ge.current),Ge.current=0;return}Ge.current||(Ge.current=setTimeout(()=>{at({value:N,currentTime:J}),Ge.current=0},1e3/30))},Aa=()=>{at({value:0,currentTime:0})},Ks=()=>{const N=r.current,J=c.current;if(N&&J){const Te=N.clientWidth,ot=N.clientHeight,Be=16/9;let os=Te,Wt=Te/Be;Wt>ot&&(Wt=ot,os=ot*Be),J.style.width="".concat(os,"px"),J.style.height="".concat(Wt,"px")}},zs=d.useCallback(async N=>{try{const J=new Date;await Ee.update(s.id,{content:t.saveAsJSON(),time:J.getTime()}),Pa(J.toLocaleString()),N||Ne({title:"",duration:1500})}catch(J){Ne({title:"",description:J.message,variant:"destructive"})}},[Ne,t,s]),Ds=N=>async()=>{const J=await o(N);if(J){const Te=await Ut(J,t);t.addChild(Te)}},To=()=>{const N=nu(t);t.addChild(N)},Ua=N=>N.type==="custom"?"".concat(N.errorSceneName,"").concat(N.errorLines?"".concat(N.errorLines,""):"","").concat(ke[N.errorDirectiveName],""):N.message,ns=async(N=0,J)=>{Aa(),te([N,J]),X(!0);const Te=await t.exportScreenplay(N,J),ot=new sh({canvas:w.current.getPreviewCanvas(),width:1920,height:1080,fps:30,disableAudio:qa()});se.current.connect(ot),se.current.action(Te).then(()=>{console.log("")}).catch(Be=>{X(!1),Ne({title:"",description:Ua(Be),variant:"destructive"})})},Vo=async()=>{se.current.hasStarted()&&await se.current.cut(),ns(...U)},is=async(N=0,J)=>{Aa(),W(!0),He(null);const Te=await t.exportScreenplay(N,J),ot=new th({width:1920,height:1080,fps:30,disableAudio:qa()});se.current.connect(ot),se.current.action(Te).then(({result:Be,subtitles:os})=>{const Wt=URL.createObjectURL(Be);_(os),He(Wt)}).catch(Be=>{W(!1),Ne({title:"",description:Ua(Be),variant:"destructive"})})},Ro=()=>{W(!1),se.current.hasStarted()&&se.current.cut(),Ze&&URL.revokeObjectURL(Ze),He(null)},Ea=async()=>{X(!1),se.current.hasStarted()&&await se.current.cut()},Wo=async()=>{await Ea(),is(...U)},Io=async()=>{Fs("");try{await wh()}catch(N){Ne({title:"",description:N.message,variant:"destructive"}),console.error(N)}finally{as()}},Lo=async()=>{await Nh(),Ne({title:"",duration:1500})};d.useEffect(()=>{if(s){const N=setInterval(async()=>{zs(!0)},6e4);return()=>{clearInterval(N)}}},[s,zs]),d.useEffect(()=>(window.addEventListener("resize",Ks),Ks(),a(c.current),se.current=new ea({onProgress(J,Te){Go(J,Te)}}),c.current.onselectstart=function(){return!1},localStorage.getItem("vnve_import_text")&&$(),()=>{window.removeEventListener("resize",Ks)}),[a]);const Xo=()=>{const N=localStorage.getItem("vnve_script_draft");N?(localStorage.setItem("vnve_import_text",N),$()):Ne({title:"",description:"",variant:"destructive"})};return e.jsxs("div",{className:"flex flex-col gap-2 flex-1",children:[e.jsxs(Ei,{className:"relative z-50",children:[e.jsxs(rt,{children:[e.jsxs(Ae,{className:"data-[disabled]:text-gray-400",children:[it&&e.jsx(Z.library,{className:"size-4 mr-0.5"}),""]}),e.jsxs(lt,{children:[e.jsx(B,{onClick:()=>p(!0),children:""}),e.jsx(B,{onClick:()=>v(!0),children:"..."}),e.jsx(B,{disabled:!s,onClick:()=>zs(),children:""}),Xs&&e.jsxs(B,{className:"text-muted-foreground",children:["",Xs]}),e.jsx(yt,{}),e.jsx(B,{onClick:ko,children:"..."}),e.jsx(B,{onClick:Zo,children:"..."})]})]}),e.jsxs(rt,{children:[e.jsxs(Ae,{className:"data-[disabled]:text-gray-400",children:[it&&e.jsx(Z.fileText,{className:"size-4 mr-0.5"}),""]}),e.jsx(lt,{children:e.jsx(B,{onClick:Xo,children:""})})]}),e.jsxs(rt,{children:[e.jsxs(Ae,{className:"data-[disabled]:text-gray-400",disabled:!s,children:[it&&e.jsx(Z.scene,{className:"size-4 mr-0.5"}),""]}),e.jsxs(lt,{children:[l.map(N=>e.jsxs(B,{onClick:h(N.content),children:["",N.name]},N.name)),m.length>0&&e.jsx(yt,{}),m.map(N=>e.jsxs(B,{onClick:()=>u(N.content),children:["",N.name]},N.id)),e.jsx(yt,{}),e.jsx(B,{onClick:$,children:"..."}),e.jsx(B,{onClick:nt,children:"..."}),e.jsx(yt,{}),e.jsx(B,{onClick:()=>V(!0),children:"..."})]})]}),e.jsxs(rt,{children:[e.jsxs(Ae,{className:"data-[disabled]:text-gray-400",disabled:!s,children:[it&&e.jsx(Z.images,{className:"size-4 mr-0.5"}),""]}),e.jsxs(lt,{children:[e.jsx(B,{disabled:!n,onClick:Ds(k.Character),children:""}),e.jsx(B,{disabled:!n,onClick:Ds(k.Background),children:""}),e.jsx(B,{disabled:!n,onClick:Ds(k.Thing),children:""}),e.jsx(B,{disabled:!n,onClick:To,children:""}),e.jsx(yt,{}),e.jsx(B,{onClick:Io,children:"..."}),e.jsx(B,{onClick:()=>o(void 0,!0),children:"..."}),e.jsx(B,{className:"text-destructive",onClick:()=>ie(!0),children:""})]})]}),e.jsxs(rt,{children:[e.jsxs(Ae,{disabled:i.length===0,className:"data-[disabled]:text-gray-400",children:[it&&e.jsx(Z.preview,{className:"size-4 mr-0.5"}),""]}),e.jsxs(lt,{children:[e.jsx(B,{disabled:!n,onClick:()=>{const N=t.getActiveSceneIndex();ns(N,N+1)},children:""}),e.jsx(B,{disabled:!n,onClick:()=>ns(t.getActiveSceneIndex()),children:""}),e.jsx(B,{onClick:()=>ns(),children:""})]})]}),e.jsxs(rt,{children:[e.jsxs(Ae,{disabled:i.length===0,className:"data-[disabled]:text-gray-400",children:[it&&e.jsx(Z.download,{className:"size-4 mr-0.5"}),""]}),e.jsxs(lt,{children:[e.jsx(B,{disabled:!n,onClick:()=>{const N=t.getActiveSceneIndex();is(N,N+1)},children:""}),e.jsx(B,{disabled:!n,onClick:()=>is(t.getActiveSceneIndex()),children:""}),e.jsx(B,{onClick:()=>is(),children:""})]})]}),e.jsx(rt,{children:e.jsxs(Ae,{className:"data-[disabled]:text-gray-400",onClick:()=>y(!0),children:[it&&e.jsx(Z.settings,{className:"size-4 mr-0.5"}),""]})})]}),e.jsx(bt,{className:"flex-1 rounded-md relative",children:e.jsx(tt,{className:"relative h-full p-2",children:e.jsx("div",{className:"w-full h-full flex justify-center items-center",ref:r,children:e.jsx("canvas",{className:"shadow border border-b",ref:c})})})}),g&&e.jsx(Tu,{isOpen:g,onClose:()=>v(!1)}),b&&e.jsx(vu,{isOpen:b,onClose:()=>V(!1)}),R&&e.jsx(yu,{progress:pe,url:Ze,subtitles:D,isOpen:R,onClose:Ro}),H&&e.jsx(Su,{progress:pe,ref:w,isOpen:H,onReplay:Vo,onClose:Ea,onExport:Wo}),f&&e.jsx(Gu,{isOpen:f,onClose:()=>p(!1)}),O&&e.jsx(Wu,{isOpen:O,onConfirm:Lo,onClose:()=>ie(!1)}),T&&e.jsx(Fu,{isOpen:T,onClose:()=>y(!1)}),G&&e.jsx(Ju,{isOpen:G,type:I,onClose:Rt})]})}function nm(){const a=L(l=>l.editor),s=L(l=>l.activeChild),t=L(l=>l.activeScene),n=d.useMemo(()=>{if(!t)return[];const l=[],m=[],h=[],u=[],f=t.sounds;for(const p of t.children)p.assetType===k.Character?l.push(p):p.assetType===k.Background?h.push(p):p.assetType===k.Thing?m.push(p):p.name&&u.push(p);return[{label:"",children:l},{label:"",children:m},{label:"",children:h},{label:"",children:u},{label:"",children:f}]},[t]),i=l=>{l.assetType!==k.Audio&&a.setActiveChildByName(l.name)},o=l=>{if(l.assetType===k.Audio){a.removeSoundByName(l.name);return}a.removeChildByName(l.name),(s==null?void 0:s.name)===l.name&&a.setActiveChild(void 0)},r=l=>{a.toggleChildVisibleByName(l.name)},c=l=>{a.toggleChildInteractiveByName(l.name)};return e.jsx(be,{className:"h-full pr-2",children:e.jsx("div",{className:"space-y-4",children:n.map(l=>l.children.length>0&&e.jsxs("fieldset",{className:"rounded-md border p-2",children:[e.jsx("legend",{className:"-ml-1 px-1 text-sm font-medium",children:l.label}),e.jsx("div",{className:"flex flex-col gap-1",children:l.children.map(m=>e.jsx("div",{className:"text-sm p-1 px-2 border rounded ".concat((s==null?void 0:s.name)===m.name?"bg-muted":""),children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{onClick:()=>i(m),className:"cursor-pointer flex-1",children:m.label}),e.jsxs("div",{className:"flex space-x-2 items-center",children:[m.assetType!==k.Audio&&e.jsxs(e.Fragment,{children:[m.visible?e.jsx(Z.viewing,{onClick:()=>r(m),className:"size-4 cursor-pointer"}):e.jsx(Z.viewingOff,{onClick:()=>r(m),className:"size-4 cursor-pointer"}),m.interactive?e.jsx(Z.lockOpen,{onClick:()=>c(m),className:"size-4 cursor-pointer"}):e.jsx(Z.lock,{onClick:()=>c(m),className:"size-4 cursor-pointer"})]}),e.jsx(Z.trash2,{onClick:()=>o(m),className:"size-4 cursor-pointer hover:text-destructive"})]})]})},m.name))})]},l.label))})})}const kt=d.forwardRef(({className:a,showPercentage:s=!1,value:t,...n},i)=>{const o=Array.isArray(t)?t[0]:t,r=o!==void 0?"".concat(Math.round(o*100),"%"):"";return e.jsxs("div",{className:"relative flex w-full items-center gap-2",children:[e.jsxs(ai,{ref:i,value:t,className:S("relative flex w-full touch-none select-none items-center",a),...n,children:[e.jsx(lc,{className:"relative h-1.5 w-full grow overflow-hidden rounded-full bg-primary/20",children:e.jsx(cc,{className:"absolute h-full bg-primary"})}),e.jsx(dc,{className:"block h-4 w-4 rounded-full border border-primary/50 bg-background shadow transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50"})]}),s&&e.jsx("span",{className:"min-w-[36px] text-sm text-muted-foreground",children:r})]})});kt.displayName=ai.displayName;function im(){const a=L(i=>i.editor),s=L(i=>i.activeChild),t=(i,o)=>r=>{a.updateActiveChild(c=>{o==="number"?c[i]=Number(r.target.value):c[i]=r.target.value})},n=i=>o=>{a.updateActiveChild(r=>{r[i]=o})};return e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1 flex gap-1 items-center",children:[e.jsx(xe,{className:"w-5",children:""}),e.jsx(A,{value:s.width.toFixed(0),onChange:t("width","number"),type:"number",min:0,step:10,className:"h-6"})]}),e.jsxs("div",{className:"flex-1 flex gap-1 items-center",children:[e.jsx(xe,{className:"w-5",children:""}),e.jsx(A,{value:s.height.toFixed(0),onChange:t("height","number"),type:"number",min:0,step:10,className:"h-6"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1 flex gap-1 items-center",children:[e.jsx(xe,{className:"w-5",children:"X"}),e.jsx(A,{value:s.x.toFixed(0),onChange:t("x","number"),type:"number",min:0,step:10,className:"h-6"})]}),e.jsxs("div",{className:"flex-1 flex gap-1 items-center",children:[e.jsx(xe,{className:"w-5",children:"Y"}),e.jsx(A,{value:s.y.toFixed(0),onChange:t("y","number"),type:"number",min:0,step:10,className:"h-6"})]})]}),e.jsxs("div",{className:"flex-1 flex gap-1 items-center",children:[e.jsx(xe,{className:"flex-shrink-0 mr-2",children:""}),e.jsx(kt,{min:0,max:1,step:.1,value:[s.alpha],onValueChange:i=>n("alpha")(i[0]),showPercentage:!0})]})]})}const Da=hc,Ya=uc,Ls=d.forwardRef(({className:a,align:s="center",sideOffset:t=4,...n},i)=>e.jsx(ni,{children:e.jsx(va,{ref:i,align:s,sideOffset:t,className:S("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...n})}));Ls.displayName=va.displayName;function om(a){const s=d.useRef(null);return d.useEffect(()=>{a&&(typeof a=="function"?a(s.current):a.current=s.current)}),s}const Ma=d.forwardRef(({disabled:a,value:s,onChange:t,onBlur:n,name:i,className:o,...r},c)=>{const l=om(c),[m,h]=d.useState(!1),u=d.useMemo(()=>s||"#FFFFFF",[s]);return e.jsxs(Da,{onOpenChange:h,open:m,children:[e.jsx(Ya,{asChild:!0,disabled:a,onBlur:n,children:e.jsx(j,{...r,className:S("block",o),name:i,onClick:()=>{h(!0)},size:"icon",style:{backgroundColor:u},variant:"outline",children:e.jsx("div",{})})}),e.jsxs(Ls,{className:"w-full",children:[e.jsx(mc,{color:u,onChange:t}),e.jsx(A,{className:"mt-2",maxLength:7,onChange:f=>{var p;t((p=f==null?void 0:f.currentTarget)==null?void 0:p.value)},ref:l,value:u})]})]})});Ma.displayName="ColorPicker";const mo=Se("inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground",{variants:{variant:{default:"bg-transparent",outline:"border border-input bg-transparent shadow-sm hover:bg-accent hover:text-accent-foreground"},size:{default:"h-9 px-3",sm:"h-8 px-2",lg:"h-10 px-3"}},defaultVariants:{variant:"default",size:"default"}}),rm=d.forwardRef(({className:a,variant:s,size:t,...n},i)=>e.jsx(ii,{ref:i,className:S(mo({variant:s,size:t,className:a})),...n}));rm.displayName=ii.displayName;const po=d.createContext({size:"default",variant:"default"}),fo=d.forwardRef(({className:a,variant:s,size:t,children:n,...i},o)=>e.jsx(oi,{ref:o,className:S("flex items-center justify-center gap-1",a),...i,children:e.jsx(po.Provider,{value:{variant:s,size:t},children:n})}));fo.displayName=oi.displayName;const aa=d.forwardRef(({className:a,children:s,variant:t,size:n,...i},o)=>{const r=d.useContext(po);return e.jsx(ri,{ref:o,className:S(mo({variant:r.variant||t,size:r.size||n}),a),...i,children:s})});aa.displayName=ri.displayName;function lm(){const a=L(l=>l.editor),s=L(l=>l.activeChild),t=Ot(()=>Q.where("type").equals(k.Font).reverse().toArray()),n=d.useMemo(()=>{const l=[];if(!t)return l;for(const m of t)for(const h of m.states)l.push({ch:h.name,en:h.name});return l},[t]),i=(l,m)=>h=>{a.updateActiveChild(u=>{m==="number"?u[l]=Number(h.target.value):u[l]=h.target.value})},o=(l,m)=>h=>{a.updateActiveChild(u=>{m==="number"?u.style[l]=Number(h.target.value):u.style[l]=h.target.value})},r=l=>m=>{a.updateActiveChild(h=>{h.style[l]=m})},c=l=>{a.updateActiveChild(m=>{m.style.fontWeight=l.includes(Lt.BOLD)?Lt.BOLD:Lt.NORMAL,m.style.fontStyle=l.includes(Xt.ITALIC)?Xt.ITALIC:Xt.NORMAL})};return e.jsxs("div",{className:"flex flex-col gap-3",children:[!s.disableTextEdit&&e.jsx("div",{className:"flex gap-2",children:e.jsxs("div",{className:"flex-1 flex gap-1 items-center",children:[e.jsx(Z.bookOpenText,{className:"w-5 h-5"}),e.jsx(A,{value:s.text,onChange:i("text")})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1 flex gap-1 items-center",children:[e.jsx(Z.color,{className:"w-5 h-5"}),e.jsx(Ma,{value:s.style.fill,onChange:r("fill"),className:"w-6 h-6"})]}),e.jsx("div",{className:"flex-1 flex gap-1 items-center",children:e.jsxs(fo,{type:"multiple",value:[s.style.fontWeight,s.style.fontStyle],onValueChange:c,children:[e.jsx(aa,{value:Lt.BOLD,className:"p-2",children:e.jsx(Z.bold,{className:"size-4"})}),e.jsx(aa,{value:Xt.ITALIC,className:"p-2",children:e.jsx(Z.italic,{className:"size-4"})})]})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1 shrink-0 flex gap-1 items-center",children:[e.jsx(Z.type,{className:"w-5 h-5"}),e.jsxs(ve,{onValueChange:r("fontFamily"),value:s.style.fontFamily,children:[e.jsx(ue,{className:"h-6 max-w-[150px]",children:e.jsx(ye,{placeholder:"---"})}),e.jsx(me,{children:[...n,...yh].map(l=>e.jsx(q,{value:l.en,children:l.ch},l.en))})]})]}),e.jsxs("div",{className:"flex-1 shrink-0 flex gap-1 items-center",children:[e.jsx(Z.fontSize,{className:"w-5 h-5"}),e.jsx(A,{value:String(s.style.fontSize),onChange:o("fontSize","number"),type:"number",min:1,step:10,className:"h-6"})]})]})]})}function cm(){const a=L(o=>o.editor),s=L(o=>o.activeChild),{selectAsset:t}=Tt(),n=o=>{a.updateActiveChild(r=>{const c=r.width,l=r.height;r.fillColor=o,r.clear().beginFill(o).drawRect(0,0,c,l).endFill()})},i=async()=>{const o=await t(k.Dialog),r=await Ut(o,a);a.addChild(r),a.updateActiveScene(c=>{c.config.speak.dialogTargetName=r.name}),a.setActiveChildByName(r.name),a.removeChildByName(s.name)};return e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1 flex gap-1 items-center",children:[e.jsx(xe,{className:"flex-shrink-0 mr-2",children:""}),e.jsx(Ma,{value:s.fillColor,onChange:n,className:"w-6 h-6"})]}),e.jsx(j,{size:"sm",onClick:i,children:""})]})}function dm(){const a=L(s=>s.activeChild);return e.jsx(be,{className:"h-full pr-2",children:a&&e.jsxs(e.Fragment,{children:[e.jsxs("fieldset",{className:"rounded-md border p-2",children:[e.jsx("legend",{className:"-ml-1 px-1 text-sm font-medium",children:""}),e.jsx(im,{})]}),a.type==="Text"&&e.jsxs("fieldset",{className:"rounded-md border p-2 mt-2",children:[e.jsx("legend",{className:"-ml-1 px-1 text-sm font-medium",children:""}),e.jsx(lm,{})]}),a.type==="Graphics"&&e.jsxs("fieldset",{className:"rounded-md border p-2 mt-2",children:[e.jsx("legend",{className:"-ml-1 px-1 text-sm font-medium",children:""}),e.jsx(cm,{})]})]})})}const Qe=li,_e=ci,$e=di,ze=d.forwardRef(({className:a,sideOffset:s=4,...t},n)=>e.jsx(ya,{ref:n,sideOffset:s,className:S("z-50 overflow-hidden rounded-md bg-primary px-3 py-1.5 text-xs text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...t}));ze.displayName=ya.displayName;function hm(){const a=L(l=>l.editor),s=L(l=>l.activeChild),t=()=>{if(a.activeChild){const l=a.activeChild;l.scale.x*=-1,l.scale.x<0?l.x+=l.width:l.x-=l.width}},n=async()=>{const l=a.cloneChild();l.type==="Sprite"&&await l.load(),l.x+=l.width*.1,l.y+=l.height*.1,a.addChild(l),a.setActiveChildByName(l.name)},i=()=>{a.activeChild&&a.removeChildByName(a.activeChild.name),a.setActiveChild(void 0)},o=l=>()=>{switch(l){case"top":a.moveChildToTop();break;case"bottom":a.moveChildToBottom();break;case"up":a.moveUpChild();break;case"down":a.moveDownChild();break}},r=l=>()=>{a.setChildPosition(l)},c=()=>{const l=a.activeScene.getChildrenByAssetType(k.Character),m=l.length;let h=1;for(const u of l)u.x=a.options.width/(m+1)*h-u.width/2,u.y=a.options.height-u.height,h++};return e.jsx(be,{className:"h-full pr-2",children:s&&e.jsxs("div",{children:[e.jsxs("fieldset",{className:"rounded-md border p-1",children:[e.jsx("legend",{className:"-ml-1 px-1 text-sm font-medium",children:""}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx(j,{size:"sm",variant:"ghost",onClick:o("top"),children:""}),e.jsx(j,{size:"sm",variant:"ghost",onClick:o("up"),children:""}),e.jsx(j,{size:"sm",variant:"ghost",onClick:o("down"),children:""}),e.jsx(j,{size:"sm",variant:"ghost",onClick:o("bottom"),children:""})]}),e.jsxs("div",{children:[s.type!=="Graphics"&&e.jsx(Qe,{children:e.jsxs(_e,{children:[e.jsx($e,{asChild:!0,children:e.jsx(j,{size:"sm",variant:"ghost",onClick:t,children:e.jsx(Z.flip,{className:"size-4"})})}),e.jsx(ze,{children:e.jsx("p",{children:""})})]})}),e.jsx(Qe,{children:e.jsxs(_e,{children:[e.jsx($e,{asChild:!0,children:e.jsx(j,{size:"sm",variant:"ghost",onClick:n,children:e.jsx(Z.copy,{className:"size-4"})})}),e.jsx(ze,{children:e.jsx("p",{children:""})})]})}),e.jsx(Qe,{children:e.jsxs(_e,{children:[e.jsx($e,{asChild:!0,children:e.jsx(j,{size:"sm",variant:"ghost",onClick:i,children:e.jsx(Z.delete,{className:"size-4"})})}),e.jsx(ze,{children:e.jsx("p",{children:""})})]})})]})]})]}),e.jsxs("fieldset",{className:"rounded-md border p-1 mt-2",children:[e.jsx("legend",{className:"-ml-1 px-1 text-sm font-medium",children:""}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{children:[e.jsx(j,{size:"sm",variant:"ghost",onClick:r("left"),children:""}),e.jsx(j,{size:"sm",variant:"ghost",onClick:r("near-left"),children:"1/3"}),e.jsx(j,{size:"sm",variant:"ghost",onClick:r("center"),children:""}),e.jsx(j,{size:"sm",variant:"ghost",onClick:r("near-right"),children:"2/3"}),e.jsx(j,{size:"sm",variant:"ghost",onClick:r("right"),children:""})]}),s.assetType===k.Character&&e.jsx(Qe,{children:e.jsxs(_e,{children:[e.jsx($e,{asChild:!0,children:e.jsx(j,{size:"sm",variant:"ghost",onClick:c,children:""})}),e.jsx(ze,{children:e.jsx("p",{children:""})})]})})]})]}),e.jsxs("fieldset",{className:"rounded-md border p-1 mt-2",children:[e.jsx("legend",{className:"-ml-1 px-1 text-sm font-medium",children:""}),e.jsx(j,{size:"sm",variant:"ghost",onClick:r("top"),children:""}),e.jsx(j,{size:"sm",variant:"ghost",onClick:r("middle"),children:""}),e.jsx(j,{size:"sm",variant:"ghost",onClick:r("bottom"),children:""})]})]})})}function um(){return e.jsx(bt,{className:"flex-1 shrink-0 max-h-[50%] sm:max-h-full rounded-md",children:e.jsx(tt,{className:"h-full p-2",children:e.jsxs(Is,{defaultValue:"position",className:"h-full flex flex-col",children:[e.jsxs(ss,{className:"self-center",children:[e.jsx(Ye,{value:"position",children:""}),e.jsx(Ye,{value:"style",children:""}),e.jsx(Ye,{value:"list",children:""})]}),e.jsx(qe,{className:"h-[calc(100%-2.5rem)]",value:"position",children:e.jsx(hm,{})}),e.jsx(qe,{className:"h-[calc(100%-2.5rem)]",value:"style",children:e.jsx(dm,{})}),e.jsx(qe,{className:"h-[calc(100%-2.5rem)]",value:"list",children:e.jsx(nm,{})})]})})})}const mm=Se("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{defaultVariants:{size:"default",variant:"default"},variants:{isMenu:{true:"h-auto w-full cursor-pointer justify-start"},size:{default:"h-10 px-4 py-2",icon:"size-10",lg:"h-11 rounded-md px-8",none:"",sm:"h-9 rounded-md px-3",sms:"size-9 rounded-md px-0",xs:"h-8 rounded-md px-3"},variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",ghost:"hover:bg-accent hover:text-accent-foreground",inlineLink:"text-base text-primary underline underline-offset-4",link:"text-primary underline-offset-4 hover:underline",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80"}}}),an=et(({asChild:a=!1,className:s,isMenu:t,size:n,variant:i,...o},r)=>{const c=a?ga:"button";return e.jsx(c,{className:ae(mm({className:s,isMenu:t,size:n,variant:i})),ref:r,...o})});function pm(){const a=L(o=>o.project),[s,t]=d.useState(!0);d.useEffect(()=>{const o=document.documentElement.classList.contains("dark");t(o),!document.documentElement.classList.contains("dark")&&!document.documentElement.classList.contains("light")&&(document.documentElement.classList.add("dark"),t(!0))},[]);const n=()=>{const o=!s;t(o),o?(document.documentElement.classList.add("dark"),document.documentElement.classList.remove("light")):(document.documentElement.classList.remove("dark"),document.documentElement.classList.add("light"))},i=()=>{window.location.href="/?no_intro=true"};return e.jsxs("header",{className:"sticky top-0 z-10 flex h-[53px] items-center justify-between gap-1 border-b bg-background px-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(an,{variant:"ghost",size:"sm",onClick:i,className:"gap-2",children:[e.jsx(pc,{className:"h-4 w-4"}),"Back to Home"]}),e.jsxs("h1",{className:"text-xl font-bold",children:["VNVE",a&&e.jsxs("span",{className:"text-xs text-muted-foreground ml-2",children:["// ",a.name]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(an,{variant:"ghost",size:"icon",onClick:n,children:s?e.jsx(xn,{className:"h-5 w-5"}):e.jsx(fc,{className:"h-5 w-5"})}),e.jsx(Z.gitHub,{className:"size-5 cursor-pointer",onClick:()=>{window.location.href="https://github.com/vnve/vnve"}})]})]})}const fm=Se(ae("relative overflow-x-auto whitespace-pre-wrap break-words","min-h-[80px] w-full rounded-md bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none","[&_[data-slate-placeholder]]:text-muted-foreground [&_[data-slate-placeholder]]:!opacity-100","[&_[data-slate-placeholder]]:top-[auto_!important]","[&_strong]:font-bold"),{defaultVariants:{focusRing:!0,size:"sm",variant:"outline"},variants:{disabled:{true:"cursor-not-allowed opacity-50"},focusRing:{false:"",true:"focus-visible:ring-1 focus-visible:ring-ring"},focused:{true:"ring-1 ring-ring"},size:{md:"text-base",sm:"text-sm"},variant:{ghost:"",outline:"border border-input"}}}),xo=De.forwardRef(({className:a,disabled:s,focusRing:t,focused:n,readOnly:i,size:o,variant:r,...c},l)=>e.jsx("div",{className:"relative w-full",ref:l,children:e.jsx(xc,{"aria-disabled":s,className:ae(fm({disabled:s,focusRing:t,focused:n,size:o,variant:r}),a),"data-plate-selectable":!0,disableDefaultStyles:!0,readOnly:s!=null?s:i,...c})}));xo.displayName="Editor";const xm=Se("shrink-0 bg-border",{defaultVariants:{orientation:"horizontal"},variants:{orientation:{horizontal:"h-px w-full",vertical:"h-full w-px"}}}),gm=Ns(Sa(gc,{decorative:!0,orientation:"horizontal"}),xm),bm=li,vm=ci,ym=di,Sm=bc,jm=Me(Sa(ya,{sideOffset:4}),"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md");function wm(a){return De.forwardRef(function({tooltip:t,tooltipContentProps:n,tooltipProps:i,...o},r){const[c,l]=De.useState(!1);De.useEffect(()=>{l(!0)},[]);const m=e.jsx(a,{ref:r,...o});return t&&c?e.jsx(bm,{children:e.jsxs(vm,{...i,children:[e.jsx(ym,{asChild:!0,children:m}),e.jsx(Sm,{children:e.jsx(jm,{...n,children:t})})]})}):m})}const Nm=Me(yc,"relative flex select-none items-center gap-1 bg-background"),Cm=Me(Sc,"flex items-center");Me(jc,"font-medium underline underline-offset-4");Me(wc,"my-1 w-px shrink-0 bg-border");const na=Se(ae("inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50","[&_svg:not([data-icon])]:size-5"),{defaultVariants:{size:"sm",variant:"default"},variants:{size:{default:"h-10 px-3",lg:"h-11 px-5",sm:"h-9 px-2"},variant:{default:"bg-transparent hover:bg-muted hover:text-muted-foreground aria-checked:bg-accent aria-checked:text-accent-foreground",outline:"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground"}}}),zt=wm(d.forwardRef(({children:a,className:s,isDropdown:t,pressed:n,size:i,variant:o,...r},c)=>typeof n=="boolean"?e.jsx(Cm,{disabled:r.disabled,type:"single",value:"single",children:e.jsx(km,{className:ae(na({size:i,variant:o}),t&&"my-1 justify-between pr-1",s),ref:c,value:n?"single":"",...r,children:t?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-1",children:a}),e.jsx("div",{children:e.jsx(Z.arrowDown,{className:"ml-0.5 size-4","data-icon":!0})})]}):a})}):e.jsx(vc,{className:ae(na({size:i,variant:o}),t&&"pr-1",s),ref:c,...r,children:a})));zt.displayName="ToolbarButton";const km=Ns(Nc,na,["variant","size"]),nn=et(({children:a,className:s,noSeparator:t},n)=>{const i=d.Children.map(a,o=>o);return!i||i.length===0?null:e.jsxs("div",{className:ae("flex",s),ref:n,children:[!t&&e.jsx("div",{className:"h-full py-2",children:e.jsx(gm,{orientation:"vertical"})}),e.jsx("div",{className:"mx-1 flex items-center gap-1",children:a})]})}),Zm=Me(Nm,"supports-backdrop-blur:bg-background/60 z-40 w-full justify-between overflow-x-auto rounded-t-lg border-b border-b-border bg-background/95 backdrop-blur"),Gm=vn,Tm=yn;et(({children:a,className:s,inset:t,...n},i)=>e.jsxs(ra,{className:ae("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent","data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t&&"pl-8",s),ref:i,...n,children:[a,e.jsx(Z.chevronRight,{className:"ml-auto size-4"})]}));Me(la,"z-50 min-w-32 overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2");const Vm=Sa(da,{className:ae("z-50 min-w-32 overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2"),sideOffset:4}),Rm=et(({...a},s)=>e.jsx(ca,{children:e.jsx(Vm,{ref:s,...a})})),Wm=Se(ae("relative flex h-9 cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors","focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50"),{variants:{inset:{true:"pl-8"}}}),Im=Ns(ha,Wm,["inset"]);et(({children:a,className:s,...t},n)=>e.jsxs(ua,{className:ae("relative flex select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50","cursor-pointer",s),ref:n,...t,children:[e.jsx("span",{className:"absolute left-2 flex size-3.5 items-center justify-center",children:e.jsx(ws,{children:e.jsx(Z.check,{className:"size-4"})})}),a]}));et(({children:a,className:s,hideIcon:t,...n},i)=>e.jsxs(pa,{className:ae("relative flex select-none items-center rounded-sm pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50","h-9 cursor-pointer px-2 data-[state=checked]:bg-accent data-[state=checked]:text-accent-foreground",s),ref:i,...n,children:[!t&&e.jsx("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:e.jsx(ws,{children:e.jsx(Z.check,{className:"size-4"})})}),a]}));const Lm=Se(ae("select-none px-2 py-1.5 text-sm font-semibold"),{variants:{inset:{true:"pl-8"}}}),Xm=Ns(fa,Lm,["inset"]),Fm=Me(xa,"-mx-1 my-1 h-px bg-muted");Me(Cc("span"),"ml-auto text-xs tracking-widest opacity-60");const Km=()=>{const[a,s]=d.useState(!1);return{onOpenChange:d.useCallback((n=!a)=>{s(n)},[a]),open:a}},xt=kc(Zc({key:"directive",node:{isElement:!0,isInline:!0,isMarkableVoid:!0,isVoid:!0},options:{openEditorId:null,mode:"",editingDirective:null,directiveType:null}}).extendOptions(({getOptions:a})=>({isOpen:s=>a().openEditorId===s})).extendEditorApi(({setOptions:a})=>({floatingDirective:{hide:()=>{a({mode:"",openEditorId:null,editingDirective:null,directiveType:null})},show:(s,t,n,i)=>{a({mode:s,openEditorId:t,editingDirective:n,directiveType:i})}}})).extendEditorTransforms(({editor:a,type:s})=>({insert:{directive:({value:t})=>{Gc(a,{children:[{text:""}],type:s,value:t})}},edit:{directive:({value:t,at:n})=>{Tc(a,{children:[{text:""}],type:s,value:t},{at:n})}}}))),Ha=(a,{directiveElement:s,directiveType:t}={})=>{const{api:n}=Vc(a,xt);if(s){const i=s.value.directive,o=sm(i);n.floatingDirective.show("edit",a.id,s,o)}else n.floatingDirective.show("insert",a.id,null,t)};function zm({triggerFloatingLinkHotkeys:a,floatingOptions:s}){const t=Vt("(min-width: 640px)"),{editor:n,api:i,tf:o,useOption:r,setOption:c,getOptions:l}=ja(xt),m=r("mode"),h=r("isOpen",n.id),u=r("editingDirective"),f=Rc({onOpenChange:W=>c("openEditorId",W?n.id:null),getBoundingClientRect:Wc,open:h&&["insert","edit"].includes(m),...s}),p=Ic(W=>{const H=W.target;H!==document.documentElement&&(H.closest("[data-disable-click-outside]")||H.closest("#asset-library")||["insert","edit"].includes(l().mode)&&(i.floatingDirective.hide(),Ft(n,n.selection)))},{disabled:!h});De.useEffect(()=>{h&&f.update()},[h,f.update]);const g=W=>{o.insert.directive({value:W}),Xc(n,{unit:"offset"}),i.floatingDirective.hide(),setTimeout(()=>{Ft(n,n.selection)},0)},v=W=>{const H=n.selection,[,X]=Fc(n,{at:H,match:{type:n.getType(xt)}});o.edit.directive({value:W,at:X}),i.floatingDirective.hide()},b=W=>{u?v(W):g(W)},V=()=>{i.floatingDirective.hide(),setTimeout(()=>{Ft(n,n.selection)},0)};return{props:{style:t?{...f.style,zIndex:50}:{...f.style,position:"fixed",left:"50%",top:"50%",transform:"translate(-50%, -50%)",zIndex:50}},ref:Lc(f.refs.setFloating,p),onSubmit:b,onCancel:V}}const Dm=[{items:[{description:"",icon:Z.squarePlus,label:"",value:St.Util},{description:"",icon:Z.squarePlus,label:"",value:St.Transition},{description:"",icon:Z.squarePlus,label:"",value:St.Filter}],label:""}];function Ym(a){const s=Vt("(min-width: 640px)"),t=hi(),n=Km();function i(o){Ha(t,{directiveType:o}),s&&Ft(t)}return e.jsxs(Gm,{modal:!1,...n,...a,children:[e.jsx(Tm,{asChild:!0,children:e.jsx(zt,{isDropdown:!0,pressed:n.open,tooltip:"",children:e.jsx(Z.add,{className:"size-4"})})}),e.jsx(Rm,{align:"start",className:"flex max-h-[500px] min-w-0 flex-col gap-0.5 overflow-y-auto",children:Dm.map(({items:o,label:r},c)=>e.jsxs(De.Fragment,{children:[c!==0&&e.jsx(Fm,{}),e.jsx(Xm,{children:r}),o.map(({icon:l,label:m,value:h})=>e.jsxs(Im,{className:"min-w-[180px]",onSelect:()=>i(h),children:[e.jsx(l,{className:"mr-2 size-4"}),m]},h))]},r))})]})}const gt=d.forwardRef(({className:a,...s},t)=>e.jsx(ui,{className:S("peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",a),...s,ref:t,children:e.jsx(Kc,{className:S("pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0")})}));gt.displayName=ui.displayName;const Mm=P({wordsPerMin:fe().optional(),interval:fe().optional(),effect:E().optional(),effectDuration:fe().optional(),speaker:P({name:E().optional(),autoShowSpeaker:P({inEffect:E()}).optional(),autoMaskOtherSpeakers:P({alpha:fe()}).optional()})});function go({speak:a,onChangeSpeak:s,disableCustomName:t=!1}){const n=ct({resolver:dt(Mm),defaultValues:a}),i=Ie({control:n.control});return d.useEffect(()=>{n.formState.isDirty&&s({...a,...i,speaker:{...a.speaker,...i.speaker}})},[n.formState.isDirty,i]),e.jsx(ft,{...n,children:e.jsxs("form",{className:"space-y-2",children:[!t&&e.jsx(Y,{control:n.control,name:"speaker.name",render:({field:o})=>e.jsxs(F,{className:"space-y-1",children:[e.jsx(z,{children:""}),e.jsx(cs,{children:""}),e.jsx(K,{children:e.jsx(A,{className:"h-8",placeholder:"",...o})}),e.jsx(M,{})]})}),e.jsx(Y,{control:n.control,name:"wordsPerMin",render:({field:o})=>e.jsxs(F,{className:"space-y-1",children:[e.jsx(z,{children:"/"}),e.jsx(cs,{children:""}),e.jsx(K,{children:e.jsx(A,{className:"h-8",type:"number",min:0,step:100,placeholder:"",value:String(o.value),onChange:r=>{const c=Number(r.target.value);o.onChange(c)}})}),e.jsx(M,{})]})}),e.jsx(Y,{control:n.control,name:"interval",render:({field:o})=>e.jsxs(F,{className:"space-y-1",children:[e.jsx(z,{children:""}),e.jsx(cs,{children:""}),e.jsx(K,{children:e.jsx(A,{className:"h-8",type:"number",min:0,step:.1,placeholder:"",value:String(o.value),onChange:r=>{const c=Number(r.target.value);o.onChange(c)}})}),e.jsx(M,{})]})}),e.jsx(Y,{control:n.control,name:"effect",render:({field:o})=>e.jsxs(F,{className:"space-y-1",children:[e.jsx(z,{children:""}),e.jsx(K,{children:e.jsxs(ve,{onValueChange:o.onChange,value:o.value,children:[e.jsx(ue,{className:"h-8",children:e.jsx(ye,{placeholder:""})}),e.jsxs(me,{children:[e.jsx(q,{value:"typewriter",children:""}),e.jsx(q,{value:"fadeIn",children:""}),e.jsx(q,{value:"none",children:""})]})]})}),e.jsx(M,{})]})}),i.effect==="fadeIn"&&e.jsx(Y,{control:n.control,name:"effectDuration",render:({field:o})=>e.jsxs(F,{className:"space-y-1",children:[e.jsx(z,{children:""}),e.jsx(K,{children:e.jsx(A,{className:"h-8",type:"number",min:0,step:.1,placeholder:"",value:String(o.value),onChange:r=>{const c=Number(r.target.value);o.onChange(c)}})}),e.jsx(M,{})]})}),e.jsx(Y,{control:n.control,name:"speaker.autoShowSpeaker",render:({field:o})=>e.jsxs(F,{className:"flex flex-row items-center space-y-0",children:[e.jsx(z,{className:"w-[8rem]",children:""}),e.jsx(K,{children:e.jsx(gt,{checked:!!o.value,onCheckedChange:o.onChange})}),e.jsx(M,{})]})}),e.jsx(Y,{control:n.control,name:"speaker.autoMaskOtherSpeakers",render:({field:o})=>e.jsxs(F,{className:"flex flex-row items-center space-y-0",children:[e.jsx(z,{className:"w-[8rem]",children:""}),e.jsx(K,{children:e.jsx(gt,{checked:!!o.value,onCheckedChange:o.onChange})}),e.jsx(M,{})]})})]})})}const on={name:"Narrator",label:""};function Hm({speak:a,lines:s,onChangeSpeak:t,children:n}){const i=Vt("(min-width: 640px)"),o=L(v=>v.activeScene),r=d.useMemo(()=>{const v=[on];return o?[...v,...o.children.filter(b=>b.assetType===k.Character)]:v},[o]),c=hi(),{selectAsset:l}=Tt(),[m,h]=d.useState(!1),u=L(v=>v.editor),f=v=>{const b=r.find(V=>V.name===v);t({...a,speaker:{...a.speaker,speakerTargetName:b==null?void 0:b.name,name:(b==null?void 0:b.name)===on.name?"":(b==null?void 0:b.label)||""}})},p=v=>{Ha(c,{directiveType:v}),i&&Ft(c)},g=async()=>{h(!1);const v=await l(k.Character);if(v){const b=await Ut(v,u);u.addChild(b),t({...a,speaker:{...a.speaker,speakerTargetName:b.name,name:b.label}})}};return e.jsxs("div",{className:"w-full flex flex-wrap",children:[e.jsxs(nn,{noSeparator:!0,children:[e.jsxs(ve,{open:m,onOpenChange:h,value:a.speaker.speakerTargetName||"",onValueChange:f,children:[e.jsx(ue,{className:"w-[100px] md:w-[130px] h-8",children:e.jsx(ye,{placeholder:""})}),e.jsxs(me,{children:[r.map(v=>e.jsx(q,{value:v.name,children:v.label},v.name)),e.jsx("div",{onClick:g,className:"cursor-pointer select-none py-1.5 pl-2 pr-8 text-sm hover:bg-slate-100 rounded-sm","data-disable-click-outside":!0,children:"..."})]})]}),e.jsxs(Da,{children:[e.jsx(Ya,{asChild:!0,children:e.jsx(zt,{className:"px-1",tooltip:"",children:e.jsx(Z.settings,{className:"!size-4 cursor-pointer mx-1"})})}),e.jsx(Ls,{children:e.jsx(go,{speak:a,onChangeSpeak:t})})]}),e.jsxs(zt,{className:"px-1 text-xs",onClick:()=>p(St.Animation),tooltip:"",children:[e.jsx(Z.squarePlus,{className:"!size-4 md:mr-0.5 hidden md:flex"}),""]}),e.jsxs(zt,{className:"px-1 text-xs",onClick:()=>p(St.Sound),tooltip:"",children:[e.jsx(Z.squarePlus,{className:"!size-4 md:mr-0.5 hidden md:flex"}),""]}),e.jsx(Ym,{})]}),e.jsx(nn,{className:"ml-auto",children:n})]})}function Bm(){const[a,s]=d.useState(!1);return d.useEffect(()=>{s(!0)},[]),a}const Pm=et(({children:a,className:s,prefix:t,...n},i)=>{const o=zc(),r=Dc(),c=Yc(),l=Bm(),{editor:m}=ja(xt),h=()=>{Ha(m,{directiveElement:o})};return e.jsx(Mc,{className:ae("inline-block cursor-pointer rounded-md bg-muted px-1.5 py-0.5 align-baseline text-sm font-medium select-none mx-0.5",r&&c&&"ring-2 ring-ring",o.children[0].bold===!0&&"font-bold",o.children[0].italic===!0&&"italic",o.children[0].underline===!0&&"underline",s),contentEditable:!1,onClick:h,ref:i,...n,children:l&&Hc?e.jsxs(De.Fragment,{children:[a,t,o.value.label||""]}):e.jsxs(De.Fragment,{children:[t,o.value.label||"",a]})})}),bo=Se("w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 print:hidden");et(({align:a="center",className:s,sideOffset:t=4,style:n,...i},o)=>e.jsx(ni,{children:e.jsx(va,{align:a,className:ae(bo(),s),ref:o,sideOffset:t,style:{zIndex:1e3,...n},...i})}));const Am=d.forwardRef(({form:a},s)=>{const t=L(h=>h.activeScene),[n,i]=d.useState([]),[o,r]=d.useState([]),c=Ie({control:a.control,name:"directive"}),l=Ie({control:a.control,name:"params.targetName"}),m=Ie({control:a.control,name:"params.source"});return d.useEffect(()=>{if(t){const h=[],u=[],f=[];let p=[];for(const g of t.children){const v={value:g.name,label:g.label};g.assetType===k.Character?h.push(v):g.assetType===k.Background?f.push(v):g.assetType===k.Thing?u.push(v):g.name&&p.push(v)}c===C.ChangeSource&&(p=p.filter(g=>g.assetID)),i([{label:"",options:h},{label:"",options:f},{label:"",options:u},{label:"",options:p}])}},[t,c]),d.useEffect(()=>{if(t&&c===C.ChangeSource&&l){const h=t.children.find(u=>u.name===l);h!=null&&h.assetID?Q.get(h.assetID).then(u=>{const f=u.states.map(p=>({value:ge(p),label:p.name}));r(f)}):r([])}},[t,c,l,a]),d.useImperativeHandle(s,()=>({getDirectiveLabel:()=>{var h,u;if(t&&c&&l){const f=ke[c],p=((h=t.children.find(v=>v.name===l))==null?void 0:h.label)||"",g=[f,p];if(c===C.ChangeSource&&m){const v=((u=o.find(b=>b.value===m))==null?void 0:u.label)||"";g.push(v)}return g.join(":")}return""}}),[t,c,l,m,o]),e.jsxs(e.Fragment,{children:[e.jsx(Y,{control:a.control,name:"params.targetName",render:({field:h})=>e.jsxs(F,{className:"space-y-1",children:[e.jsx(z,{children:""}),e.jsx(K,{children:e.jsxs(ve,{onValueChange:u=>{h.onChange(u),a.setValue("params.source","")},value:h.value,children:[e.jsx(ue,{className:"h-8",children:e.jsx(ye,{placeholder:""})}),e.jsxs(me,{children:[n.map(u=>u.options.length>0&&e.jsxs(Xa,{children:[e.jsx(Ws,{children:u.label}),u.options.map(f=>e.jsx(q,{value:f.value,children:f.label},f.value))]},u.label)),n.every(u=>u.options.length===0)&&e.jsx("div",{className:"select-none py-1.5 pl-2 pr-8 text-sm opacity-50",children:""})]})]})}),e.jsx(M,{})]})}),c===C.ChangeSource&&o.length>0&&e.jsx(Y,{control:a.control,name:"params.source",render:({field:h})=>e.jsxs(F,{className:"space-y-1",children:[e.jsx(z,{children:""}),e.jsx(K,{children:e.jsxs(ve,{onValueChange:h.onChange,value:h.value,children:[e.jsx(ue,{className:"h-8",children:e.jsx(ye,{placeholder:""})}),e.jsx(me,{children:o.map(u=>e.jsx(q,{value:u.value,children:u.label},u.value))})]})}),e.jsx(M,{})]})}),c!==C.ChangeSource&&e.jsx(Y,{control:a.control,name:"params.duration",render:({field:h})=>e.jsxs(F,{className:"space-y-1",children:[e.jsx(z,{children:"()"}),e.jsx(K,{children:e.jsx(A,{type:"number",min:0,step:.1,placeholder:"",value:h.value||"",onChange:u=>{const f=Number(u.target.value);h.onChange(f)},className:"h-8"})}),e.jsx(M,{})]})})]})}),Um=d.forwardRef(({form:a},s)=>{const t=Ie({control:a.control,name:"directive"}),n=Ie({control:a.control,name:"params.duration"});return d.useImperativeHandle(s,()=>({getDirectiveLabel:()=>"".concat(ke[t],":").concat(n!=null?n:0,"")}),[n,t]),e.jsx(Y,{control:a.control,name:"params.duration",render:({field:i})=>e.jsxs(F,{className:"space-y-1",children:[e.jsx(z,{children:"()"}),e.jsx(K,{children:e.jsx(A,{type:"number",min:0,step:.1,placeholder:"",value:String(i.value),onChange:o=>{const r=Number(o.target.value);i.onChange(r)},className:"h-8"})}),e.jsx(M,{})]})})}),Em=d.forwardRef(({form:a},s)=>{const t=L(f=>f.activeScene),n=L(f=>f.editor),[i,o]=d.useState([]),r=Ie({control:a.control,name:"directive"}),c=Ie({control:a.control,name:"params.targetName"}),{selectAsset:l}=Tt(),[m,h]=d.useState(!1),u=async f=>{h(!1);const p=await l(k.Audio);if(p){c&&n.removeSoundByName(c);const g=Wa(p);n.addSound(g),setTimeout(()=>{f(g.name)},150)}};return d.useEffect(()=>{if(t){const f=t.dialogues.map(g=>{var v,b;return(b=(v=g.speak)==null?void 0:v.voice)==null?void 0:b.targetName}),p=t.sounds.map(g=>({label:g.label,value:g.name})).filter(g=>!f.includes(g.value));o([{label:"",options:p}])}},[t]),d.useImperativeHandle(s,()=>({getDirectiveLabel:()=>{var f;if(t&&r&&c){const p=ke[r],g=((f=t.sounds.find(b=>b.name===c))==null?void 0:f.label)||"";return[p,g].join(":")}return""}}),[t,r,c]),e.jsxs(e.Fragment,{children:[e.jsx(Y,{control:a.control,name:"params.targetName",render:({field:f})=>e.jsxs(F,{className:"space-y-1",children:[e.jsx(z,{children:""}),e.jsx(K,{children:e.jsxs(ve,{open:m,onOpenChange:h,onValueChange:f.onChange,value:f.value,children:[e.jsx(ue,{className:"h-8",children:e.jsx(ye,{placeholder:""})}),e.jsxs(me,{children:[i.map(p=>p.options.length>0&&e.jsxs(Xa,{children:[e.jsx(Ws,{children:p.label}),p.options.map(g=>e.jsx(q,{value:g.value,children:g.label},g.value))]},p.label)),e.jsx("div",{onClick:()=>u(f.onChange),className:"cursor-pointer select-none py-1.5 pl-2 pr-8 text-sm hover:bg-slate-100 rounded-sm","data-disable-click-outside":!0,children:"..."})]})]})}),e.jsx(M,{})]})}),r===C.Play&&e.jsxs(e.Fragment,{children:[e.jsx(Y,{control:a.control,name:"params.start",render:({field:f})=>e.jsxs(F,{className:"space-y-1",children:[e.jsx(z,{children:"()"}),e.jsx(K,{children:e.jsx(A,{type:"number",min:0,step:1,placeholder:"0",value:f.value||"",onChange:p=>{const g=Number(p.target.value);f.onChange(g)},className:"h-8"})}),e.jsx(M,{})]})}),e.jsx(Y,{control:a.control,name:"params.volume",render:({field:f})=>{var p;return e.jsxs(F,{className:"space-y-1",children:[e.jsx(z,{children:""}),e.jsx(K,{children:e.jsx(kt,{min:0,max:1,step:.1,value:[(p=f.value)!=null?p:1],onValueChange:g=>f.onChange(g[0]),showPercentage:!0})}),e.jsx(M,{})]})}}),e.jsx(Y,{control:a.control,name:"params.loop",render:({field:f})=>e.jsxs(F,{className:"space-y-0 flex flex-row items-center",children:[e.jsx(z,{className:"flex flex-col w-[4rem]",children:""}),e.jsx(K,{children:e.jsx(gt,{checked:f.value,onCheckedChange:f.onChange})}),e.jsx(M,{})]})}),e.jsx(Y,{control:a.control,name:"params.untilEnd",render:({field:f})=>e.jsxs(F,{className:"space-y-0 flex flex-row items-center",children:[e.jsx(z,{className:"flex flex-col w-[4rem]",children:""}),e.jsx(K,{children:e.jsx(gt,{checked:f.value,onCheckedChange:f.onChange})}),e.jsx(M,{})]})})]})]})}),Om=d.forwardRef(({form:a},s)=>{const t=L(r=>r.activeScene),[n,i]=d.useState([]),o=Ie({control:a.control,name:"directive"});return d.useEffect(()=>{if(t){const r=[],c=[],l=[],m=[];for(const h of t.children){const u={value:h.name,label:h.label};h.assetType===k.Character?r.push(u):h.assetType===k.Background?l.push(u):h.assetType===k.Thing?c.push(u):h.name&&m.push(u)}i([{label:"",options:r},{label:"",options:l},{label:"",options:c},{label:"",options:m}])}},[t]),d.useImperativeHandle(s,()=>({getDirectiveLabel:()=>{const r=[ke[o]],c=a.getValues("params.targetName"),l=n.flatMap(u=>u.options).find(u=>u.value===c),m=l?l.label:"";r.push(m);const h=a.getValues("params.filterName");if(h){const u=sn.find(p=>p.value===h),f=u?u.name:"";r.push(f)}return r.join(":")}}),[a,o,n]),e.jsxs(e.Fragment,{children:[e.jsx(Y,{control:a.control,name:"params.targetName",render:({field:r})=>e.jsxs(F,{className:"space-y-1",children:[e.jsx(z,{children:""}),e.jsx(K,{children:e.jsxs(ve,{onValueChange:r.onChange,value:r.value,children:[e.jsx(ue,{className:"h-8",children:e.jsx(ye,{placeholder:""})}),e.jsx(me,{children:n.map(c=>c.options.length>0&&e.jsxs(Xa,{children:[e.jsx(Ws,{children:c.label}),c.options.map(l=>e.jsx(q,{value:l.value,children:l.label},l.value))]},c.label))})]})}),e.jsx(M,{})]})}),o===C.AddFilter&&e.jsx(Y,{control:a.control,name:"params.filterName",render:({field:r})=>e.jsxs(F,{className:"space-y-1",children:[e.jsx(z,{children:""}),e.jsx(K,{children:e.jsxs(ve,{onValueChange:r.onChange,value:r.value,children:[e.jsx(ue,{className:"h-8",children:e.jsx(ye,{placeholder:""})}),e.jsx(me,{children:sn.map(c=>e.jsx(q,{value:c.value,children:c.name},c.value))})]})}),e.jsx(M,{})]})})]})}),Jm=d.forwardRef(({form:a},s)=>(d.useImperativeHandle(s,()=>({getDirectiveLabel:()=>{const t=a.getValues("directive");return ke[t]}})),e.jsx(e.Fragment,{children:e.jsx(Y,{control:a.control,name:"params.duration",render:({field:t})=>e.jsxs(F,{className:"space-y-1",children:[e.jsx(z,{children:""}),e.jsx(K,{children:e.jsx(A,{type:"number",min:0,step:.1,placeholder:"",value:t.value||"",onChange:n=>{const i=Number(n.target.value);t.onChange(i)},className:"h-8"})}),e.jsx(M,{})]})})}))),Qm=Bc("directive",[P({directive:Pe(Et[0]),params:P({targetName:E({message:""}),source:E().min(1,{message:""}),duration:fe().optional(),sequential:Ve().optional()})}),...Et.slice(1).map(a=>P({directive:Pe(a),params:P({targetName:E({message:""}),duration:fe().optional(),sequential:Ve().optional()})})),P({directive:Pe(C.Wait),params:P({duration:fe().optional(),sequential:Ve().optional()})}),P({directive:Pe(C.Play),params:P({targetName:E({message:""}),start:fe().optional(),volume:fe().optional(),loop:Ve().optional(),untilEnd:Ve().optional(),sequential:Ve().optional()})}),...[C.Pause,C.Stop].map(a=>P({directive:Pe(a),params:P({targetName:E({message:""}),sequential:Ve().optional()})})),P({directive:Pe(C.AddFilter),params:P({targetName:E({message:""}),filterName:E({message:""}),sequential:Ve().optional()})}),P({directive:Pe(C.RemoveFilter),params:P({targetName:E({message:""}),sequential:Ve().optional()})}),P({directive:Pe(C.FadeInTransition),params:P({duration:fe().optional(),sequential:Ve().optional()})})]);function _m({editingDirective:a,directiveType:s,onSubmitDirective:t,onCancel:n}){const i=ct({resolver:dt(Qm),defaultValues:{directive:void 0,params:{}}}),o=Ie({control:i.control,name:"directive"}),r=d.useRef(null),c=d.useRef(null),l=d.useRef(null),m=d.useRef(null),h=d.useRef(null),u=d.useMemo(()=>tm.find(p=>p.type===s),[s]);d.useEffect(()=>{a?i.reset(a.value,{keepDefaultValues:!0}):i.reset()},[a,i.reset,i]);function f(p){let g="";r.current?g=r.current.getDirectiveLabel():c.current?g=c.current.getDirectiveLabel():l.current?g=l.current.getDirectiveLabel():m.current?g=m.current.getDirectiveLabel():h.current&&(g=h.current.getDirectiveLabel()),t({...p,label:g})}return e.jsx(ft,{...i,children:e.jsxs("form",{onSubmit:i.handleSubmit(f),className:"space-y-2 flex flex-col h-full",children:[e.jsx(Y,{control:i.control,name:"directive",render:({field:p})=>e.jsxs(F,{className:"space-y-1",children:[e.jsx(z,{children:u==null?void 0:u.name}),e.jsx(K,{children:e.jsxs(ve,{onValueChange:p.onChange,value:p.value,children:[e.jsx(ue,{className:"h-8",children:e.jsx(ye,{placeholder:""})}),e.jsx(me,{children:u==null?void 0:u.options.map(g=>e.jsx(q,{value:g.value,children:g.name},g.value))})]})})]})}),Et.includes(o)&&e.jsx(Am,{form:i,ref:r}),Ka.includes(o)&&e.jsx(Um,{form:i,ref:c}),Fa.includes(o)&&e.jsx(Em,{form:i,ref:l}),za.includes(o)&&e.jsx(Om,{form:i,ref:m}),o===C.FadeInTransition&&e.jsx(Jm,{form:i,ref:h}),o&&o!==C.Wait&&e.jsx(Y,{control:i.control,name:"params.sequential",render:({field:p})=>e.jsxs(F,{className:"space-y-0 flex flex-row items-center !mb-4",children:[e.jsx(z,{className:"flex flex-col w-[4rem]",children:""}),e.jsx(K,{children:e.jsx(gt,{checked:p.value,onCheckedChange:p.onChange})}),e.jsx(M,{})]})}),e.jsxs("div",{className:"pt-2 !mt-auto sticky left-0 bottom-0 bg-white w-full flex justify-center border-t border-t-border gap-2",children:[e.jsx(j,{size:"sm",type:"submit",children:""}),e.jsx(j,{size:"sm",type:"button",onClick:n,variant:"outline",children:""})]})]})})}const $m={middleware:[Pc(12),Ac({fallbackPlacements:["bottom-end","top-start","top-end"],padding:12})],placement:"bottom-start"};function qm(){const a=Ec({preventDefaultOnEnterKeydown:!0}),{useOption:s}=ja(xt),t=s("editingDirective"),n=s("directiveType"),{ref:i,props:o,onSubmit:r,onCancel:c}=zm({floatingOptions:$m,triggerFloatingLinkHotkeys:"mod+k"});return e.jsx(Uc,{children:e.jsx("div",{className:ae(bo(),"w-auto p-1"),...o,ref:i,children:e.jsx("div",{className:"flex w-[200px] h-[400px] overflow-auto flex-col p-2",...a,children:n&&e.jsx(_m,{editingDirective:t,directiveType:n,onSubmitDirective:r,onCancel:c})})})})}const Ba=({className:a})=>e.jsx(ba,{className:S("h-6 w-6 text-primary/60 animate-spin",a)});function ep({speak:a,lines:s,onChangeSpeak:t}){var se;const[n,i]=d.useState(!1),[o,r]=d.useState(0),[c,l]=d.useState(0),[m,h]=d.useState(1),u=d.useRef(null),[f,p]=d.useState(""),{selectAsset:g}=Tt(),v=L(D=>D.editor),b=L(D=>D.project),V=Je(D=>D.tts),[R,W]=d.useState(!1),{toast:H}=st(),X=d.useCallback(D=>{t({...a,voice:{...a.voice||{},...D}})},[t,a]),O=async()=>{W(!0);try{const{sound:D,url:_}=await Ui({lines:s,editor:v,project:b,speak:a,ttsSettings:V});X({targetName:D.name}),p(_),H({title:"!",duration:1500})}catch(D){console.error("TTS generation failed:",D),H({title:"",description:D.message,variant:"destructive"})}finally{W(!1)}},ie=d.useCallback(async()=>{u.current&&(n?u.current.pause():u.current.play(),i(!n))},[n]),T=d.useCallback(()=>{u.current&&l(u.current.currentTime)},[]),y=d.useCallback(()=>{u.current&&r(u.current.duration)},[]),w=d.useCallback(D=>{u.current&&(u.current.currentTime=D[0],l(D[0]))},[]),U=d.useCallback(D=>{if(u.current){const _=D[0];u.current.volume=_,h(_),X({volume:_})}},[X]),te=d.useCallback(async()=>{var _;const D=await g(k.Audio);if(D){(_=a.voice)!=null&&_.targetName&&v.removeSoundByName(a.voice.targetName);const pe=Wa(D);v.addSound(pe),X({targetName:pe.name})}},[a,v,X,g]),Ze=d.useCallback(()=>{p(""),l(0),r(0),i(!1),v.removeSoundByName(a.voice.targetName),X({targetName:""})},[v,X,a]),He=D=>{const _=Math.floor(D/60),pe=Math.floor(D%60);return"".concat(_,":").concat(pe.toString().padStart(2,"0"))};return d.useEffect(()=>{(async()=>{var _;if((_=a.voice)!=null&&_.targetName){const pe=v.activeScene.getSoundByName(a.voice.targetName),at=await Va(pe.assetID,pe.label),Ge=Hi(at);p(Ge)}})()},[v,a]),d.useEffect(()=>{var D;(D=a.voice)!=null&&D.volume&&h(a.voice.volume)},[a]),d.useEffect(()=>{u.current&&(u.current.volume=m)},[m,f]),e.jsxs("div",{className:"flex items-center w-full gap-2 p-1 border border-t-0 rounded-md rounded-t-none bg-background h-[32px]",children:[e.jsx("audio",{ref:u,src:f,onTimeUpdate:T,onLoadedMetadata:y,onEnded:()=>{i(!1),l(0)}}),(se=a.voice)!=null&&se.targetName?e.jsxs(e.Fragment,{children:[e.jsx(j,{variant:"ghost",size:"icon",className:"w-6 h-6",onClick:ie,children:n?e.jsx(ti,{className:"w-3 h-3"}):e.jsx(si,{className:"w-3 h-3"})}),e.jsxs("div",{className:"flex items-center flex-1 gap-2",children:[e.jsx("span",{className:"text-xs text-muted-foreground min-w-[35px]",children:He(c)}),e.jsx(kt,{value:[c],max:o,step:.1,className:"w-full",onValueChange:w}),e.jsx("span",{className:"text-xs text-muted-foreground min-w-[35px]",children:He(o)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(Da,{children:[e.jsx(Ya,{asChild:!0,children:e.jsx(j,{variant:"ghost",size:"icon",className:"w-6 h-6",children:e.jsx(Oc,{className:"w-3 h-3"})})}),e.jsx(Ls,{className:"w-[260px] p-2",side:"top",children:e.jsx(kt,{value:[m],max:1,step:.1,className:"w-full",onValueChange:U,showPercentage:!0})})]}),e.jsx(j,{variant:"ghost",size:"icon",className:"w-6 h-6 hover:text-destructive",onClick:Ze,children:e.jsx(_s,{className:"w-3 h-3"})})]})]}):e.jsxs("div",{className:"flex items-center justify-around w-full h-full px-1",children:[e.jsxs(j,{variant:"ghost",size:"icon",className:"flex-1 h-6 mx-1 text-xs",disabled:R,onClick:te,children:[e.jsx(Jc,{className:"w-3 h-3 mr-1"}),""]}),e.jsx(j,{variant:"ghost",size:"icon",disabled:R,className:"flex-1 h-6 mx-1 text-xs",onClick:O,children:R?e.jsxs(e.Fragment,{children:[e.jsx(Ba,{className:"w-3 h-3 mr-1"}),"..."]}):e.jsxs(e.Fragment,{children:[e.jsx(mi,{className:"w-3 h-3 mr-1"}),""]})})]})]})}function tp({value:a,onChange:s,onFocus:t,children:n}){const i=Qc({plugins:[_c,xt.extend({render:{afterEditable:()=>e.jsx(qm,{})}}),$c],override:{components:{[xt.key]:Pm}},value:a.lines}),o=d.useRef(!1),r=({value:m})=>{if(o.current){o.current=!1;return}s({...a,lines:m})},c=m=>{s({...a,speak:m})},l=()=>{t(a)};return d.useEffect(()=>{i.children!==a.lines&&(o.current=!0,i.tf.setValue(a.lines))},[a.lines,i]),e.jsxs("div",{className:"flex flex-col",children:[e.jsx(qc,{editor:i,onValueChange:r,children:e.jsxs("div",{className:"relative rounded-md rounded-b-none border bg-background border-border",onFocus:l,children:[e.jsx(Zm,{children:e.jsx(Hm,{speak:a.speak,lines:a.lines,onChangeSpeak:c,children:n})}),e.jsx(xo,{focusRing:!1,variant:"ghost",size:"sm"})]})}),e.jsx(ep,{speak:a.speak,lines:a.lines,onChangeSpeak:c})]})}const sp=({isOpen:a,speak:s,autoShowBackground:t,onClose:n,onConfirm:i})=>{var u,f;const[o,r]=De.useState({speak:s,autoShowBackground:t}),c=p=>{r({...o,speak:p})},l=p=>{r({...o,autoShowBackground:p})},m=p=>{r({...o,speak:{...o.speak,voice:{...o.speak.voice||{},volume:p[0]}}})},h=()=>{i(o),n()};return e.jsx(Ce,{open:a,onOpenChange:n,children:e.jsxs(we,{className:"sm:max-w-[600px]",children:[e.jsxs(oe,{children:[e.jsx(re,{className:"text-base font-bold",children:""}),e.jsx(le,{children:""})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(go,{speak:o.speak,onChangeSpeak:c,disableCustomName:!0}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-sm font-medium w-[8rem]",children:""}),e.jsx(gt,{checked:o.autoShowBackground,onCheckedChange:l})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-sm font-medium w-[8rem]",children:""}),e.jsx("div",{className:"flex-1",children:e.jsx(kt,{value:[(f=(u=o.speak.voice)==null?void 0:u.volume)!=null?f:1],onValueChange:m,min:0,max:1,step:.1,className:"flex-1",showPercentage:!0})})]})]}),e.jsxs(Vs,{className:"justify-center sm:justify-center",children:[e.jsx(j,{onClick:h,children:""}),e.jsx(j,{variant:"outline",onClick:n,children:""})]})]})})};function rn({onClose:a}){const s=L(T=>T.editor),t=L(T=>T.project),n=L(T=>T.activeScene),[i,o]=d.useState(!1),[r,c]=d.useState(!1),l=d.useRef(null),m=Je(T=>T.tts),{toast:h}=st(),{showLoading:u,updateLoadingText:f,hideLoading:p}=io(),g=T=>{s.updateActiveScene(y=>{y.config.autoShowBackground=T.autoShowBackground,y.config.speak=T.speak,y.dialogues.forEach(w=>{w.speak={...w.speak,...T.speak,speaker:{...w.speak.speaker||{},wordsPerMin:T.speak.speaker.wordsPerMin,interval:T.speak.speaker.interval,effect:T.speak.speaker.effect,effectDuration:T.speak.speaker.effectDuration,autoShowSpeaker:T.speak.speaker.autoShowSpeaker,autoMaskOtherSpeakers:T.speak.speaker.autoMaskOtherSpeakers},voice:{...w.speak.voice||{},volume:T.speak.voice.volume}}})})},v=T=>{const{config:y}=n;s.addDialogue({speak:s.cloneDialogueSpeak(y.speak),lines:[]},T),O()},b=(T,y)=>{s.addDialogue({speak:{...s.cloneDialogueSpeak(y.speak),voice:void 0},lines:[]},T)},V=T=>{s.updateActiveScene(y=>{y.label=T})},R=(T,y)=>{if(s.activeScene){const{speaker:w,targetName:U}=s.activeScene.config.speak||{};if(w){const te=s.activeScene.getChildByName(w.targetName);te&&(te.text=y.speak.speaker.name)}if(y.lines.length>0){const te=s.activeScene.getChildByName(U),Ze=wi(y.lines);Ze&&te&&(te.text=Ze)}}},W=(T,y)=>{s.updateDialogue(T,y),R(T,y)},H=(T,y)=>{const w=s.cloneDialogue(T);w.speak.voice=void 0,s.addDialogue(w,y)},X=(T,y)=>{s.swapDialogue(T,y)},O=()=>{setTimeout(()=>{l.current&&l.current.scrollToBottom()},100)},ie=async()=>{if(!m||!m.appid||!m.token){h({title:"",variant:"destructive"});return}const T=n.dialogues;u("");try{for(const[y,w]of T.entries()){f(" ".concat(y+1," "));try{const{sound:U}=await Ui({speak:w.speak,lines:w.lines,editor:s,project:t,ttsSettings:m});s.updateDialogue(y,{...w,speak:{...w.speak,voice:{...w.speak.voice||{},targetName:U.name}}})}catch(U){if(U.voice!==At)throw U}}h({title:"!"})}catch(y){h({title:"",description:y.message,variant:"destructive"})}finally{p()}};return e.jsx(bt,{className:"w-full flex-1 h-full border-0 md:border shadow-none md:shadow rounded-md",children:e.jsx(tt,{className:"h-full p-1 md:p-2",children:n?e.jsxs(e.Fragment,{children:[e.jsx(be,{className:"w-full h-full pr-2",ref:l,children:e.jsxs("div",{className:"flex flex-col m-1 mr-0 pr-1",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs(xe,{htmlFor:"sceneName",className:"flex justify-between items-center",children:[e.jsx("span",{children:""}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(Qe,{children:e.jsxs(_e,{children:[e.jsx($e,{asChild:!0,children:e.jsx(j,{size:"sm",variant:"ghost",onClick:()=>c(!0),children:e.jsx(Z.settings,{className:"size-4"})})}),e.jsx(ze,{children:e.jsx("p",{children:""})})]})}),e.jsx(Qe,{children:e.jsxs(_e,{children:[e.jsx($e,{asChild:!0,children:e.jsx(j,{size:"sm",variant:"ghost",onClick:()=>o(!0),children:e.jsx(Z.bookmark,{className:"size-4"})})}),e.jsx(ze,{children:e.jsx("p",{children:""})})]})}),a&&e.jsx(j,{className:"-mr-3",size:"sm",variant:"ghost",onClick:a,children:e.jsx(Z.close,{className:"size-4"})})]})]}),e.jsx(A,{type:"text",id:"sceneName",placeholder:"",value:n.label,onChange:T=>V(T.target.value)})]}),e.jsxs("div",{className:"flex flex-col gap-2 mt-4",children:[e.jsxs(xe,{className:"flex justify-between items-center",children:[e.jsx("span",{children:""}),e.jsx(Qe,{children:e.jsxs(_e,{children:[e.jsx($e,{asChild:!0,children:e.jsx(j,{size:"sm",variant:"ghost",onClick:ie,children:e.jsx(mi,{className:"size-4"})})}),e.jsx(ze,{children:e.jsx("p",{children:""})})]})})]}),n.dialogues.map((T,y)=>e.jsx("div",{children:e.jsx(tp,{value:T,onChange:w=>W(y,w),onFocus:w=>R(y,w),children:e.jsxs(Ca,{children:[e.jsx(ka,{children:e.jsx(Z.more,{className:"size-4 cursor-pointer mx-1"})}),e.jsxs(Ts,{children:[e.jsx(de,{onClick:()=>b(y+1,T),children:""}),e.jsx(de,{onClick:()=>H(T,y+1),children:""}),e.jsx(de,{className:"text-destructive",onClick:()=>{s.removeDialogue(T)},children:""}),e.jsx(Za,{}),y>0&&e.jsx(de,{onClick:()=>X(y,y-1),children:""}),y<n.dialogues.length-1&&e.jsx(de,{onClick:()=>X(y,y+1),children:""})]})]})})},y))]}),e.jsx(j,{className:"mt-2",onClick:()=>v(),children:""})]})}),i&&e.jsx(bu,{isOpen:i,onClose:()=>o(!1),sceneName:n.name}),r&&e.jsx(sp,{isOpen:r,speak:n.config.speak,autoShowBackground:n.config.autoShowBackground,onConfirm:g,onClose:()=>c(!1)})]}):e.jsx("div",{className:"h-full text-lg flex items-center justify-center text-muted-foreground/50",children:t?"":""})})})}function ap({type:a,url:s,ext:t,className:n,onChange:i}){const[o,r]=d.useState(null),[c,l]=d.useState(null),m=d.useMemo(()=>o||s||"",[s,o]),h=d.useMemo(()=>c||t||"",[t,c]),u=d.useMemo(()=>Bi(a),[a]),f=d.useRef(null),p=v=>{var V;o&&URL.revokeObjectURL(o);const b=(V=v.target.files)==null?void 0:V[0];r(URL.createObjectURL(b)),l(wt(b).ext),i(b)},g=()=>{var v;(v=f.current)==null||v.click()};return d.useEffect(()=>()=>{o&&URL.revokeObjectURL(o)},[o]),e.jsxs("div",{className:S("flex cursor-pointer group relative",n),onClick:g,children:[e.jsx("input",{type:"file",ref:f,onChange:p,className:"hidden",accept:u}),e.jsxs("div",{className:"size-full flex justify-center items-center text-sm invisible group-hover:visible bg-muted/80 absolute left-0 right-0 z-20",children:[e.jsx(ed,{className:"size-4"}),e.jsx("div",{children:""})]}),e.jsx(ho,{url:m,type:a,ext:h})]})}const np=Se("relative w-full rounded-lg border px-4 py-3 text-sm [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground [&>svg~*]:pl-7",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),vo=d.forwardRef(({className:a,variant:s,...t},n)=>e.jsx("div",{ref:n,role:"alert",className:S(np({variant:s}),a),...t}));vo.displayName="Alert";const ip=d.forwardRef(({className:a,...s},t)=>e.jsx("h5",{ref:t,className:S("mb-1 font-medium leading-none tracking-tight",a),...s}));ip.displayName="AlertTitle";const yo=d.forwardRef(({className:a,...s},t)=>e.jsx("div",{ref:t,className:S("text-sm [&_p]:leading-relaxed",a),...s}));yo.displayName="AlertDescription";const op=P({id:fe().optional(),name:E().min(1,{message:""}),type:E().min(1,{message:""}),voice:E().optional(),states:td(P({id:fe().optional(),name:E().min(1,{message:""}),ext:E().optional(),file:sd(File).optional()}).refine(a=>a.id||a.file,{message:""}))});function rp({asset:a,onSubmit:s,onCancel:t}){const[n,i]=d.useState(!1),o=d.useRef(),r=d.useMemo(()=>Sh[a.type],[a.type]),c=ct({resolver:dt(op),defaultValues:{name:"",type:"",voice:"",states:[]}}),{fields:l,append:m,remove:h}=ad({control:c.control,name:"states",keyName:"_id"}),u=Je(b=>b.tts),{toast:f}=st(),p=b=>{s(b)},g=(b,V)=>{c.setValue("states.".concat(V,".file"),b),c.getValues("states.".concat(V,".name"))||c.setValue("states.".concat(V,".name"),wt(b).name)},v=async b=>{var V;if(!u||!u.appid||!u.token){f({title:"",variant:"destructive"});return}if(b!==At)try{if(i(!0),((V=o.current)==null?void 0:V.voice)===b){o.current.audio.play();return}const R=await Pi({text:"",voiceType:b,token:u.token,appid:u.appid}),W=new Audio(R.audio_url);W.onended=()=>{i(!1)},W.play(),o.current={voice:b,audio:W}}catch(R){console.error(R),i(!1)}};return d.useEffect(()=>()=>{var b;(b=o.current)!=null&&b.audio&&(o.current.audio.pause(),o.current=void 0)},[]),d.useEffect(()=>{c.reset({id:a.id,name:a.name,type:a.type,voice:a.voice,states:a.states})},[a,c]),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-base font-bold mb-2",children:[a.id?"":"",r,e.jsx(vo,{className:"p-2 mt-1",children:e.jsxs(yo,{className:"text-muted-foreground font-normal flex gap-1 items-center",children:[e.jsx(Z.tip,{className:"size-4"}),[k.Background,k.Character,k.Thing,k.Dialog].includes(a.type)&&e.jsx("span",{children:"1920*1080"}),a.type===k.Audio&&e.jsx("span",{children:">=44100Hz"}),a.type===k.Font&&e.jsx("span",{children:"woff/woff2/ttf"})]})})]}),e.jsx(ft,{...c,children:e.jsxs("form",{onSubmit:c.handleSubmit(p),className:"space-y-4",children:[e.jsx(Y,{control:c.control,name:"name",render:({field:b})=>e.jsxs(F,{children:[e.jsxs(z,{children:[r,""]}),e.jsx(K,{children:e.jsx(A,{placeholder:"".concat(r,""),disabled:a.id===pt,...b})}),e.jsx(M,{})]})}),a.type===k.Character&&e.jsx(Y,{control:c.control,name:"voice",render:({field:b})=>e.jsxs(F,{children:[e.jsx(z,{children:""}),e.jsx(K,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(ve,{onValueChange:b.onChange,value:b.value,children:[e.jsx(ue,{className:"flex-1",children:e.jsx(ye,{placeholder:""})}),e.jsx(me,{children:au.map(V=>e.jsx(q,{value:V.value,children:V.name},V.value))})]}),e.jsx(Qe,{children:e.jsxs(_e,{children:[e.jsx($e,{asChild:!0,children:e.jsx(j,{type:"button",variant:"outline",disabled:!b.value||b.value===At||n,onClick:()=>v(b.value),children:n?e.jsx(Ba,{className:"size-4"}):e.jsx(nd,{className:"size-4"})})}),e.jsx(ze,{children:e.jsx("p",{children:""})})]})})]})}),e.jsx(M,{})]})}),a.id!==pt&&e.jsxs(F,{children:[e.jsxs(z,{className:"flex items-center",children:[r,"",e.jsxs(j,{size:"sm",variant:"outline",onClick:()=>m({name:""}),className:"ml-2",children:[e.jsx(Z.squarePlus,{className:"size-4 mr-1"}),""]})]}),e.jsx(K,{children:e.jsx("div",{children:l.length>0&&e.jsxs(be,{className:"w-full whitespace-nowrap rounded-md border",children:[e.jsx("div",{className:"flex w-full gap-2 p-2",children:l.map((b,V)=>e.jsx(ys,{type:a.type,state:b,children:e.jsxs(e.Fragment,{children:[e.jsx(tt,{className:"p-2 flex justify-center",children:e.jsx(ap,{className:"w-full h-full",type:a.type,ext:b.ext,url:b.id&&ge(b),onChange:R=>g(R,V)})}),e.jsx(Gs,{className:"font-medium p-2 pt-0 flex flex-col gap-1",children:e.jsxs("div",{className:"flex w-full justify-between",children:[e.jsx(Y,{control:c.control,name:"states.".concat(V,".name"),render:({field:R})=>e.jsx(F,{children:e.jsx(K,{children:e.jsx(A,{className:"h-6 text-sm",placeholder:"",...R})})})}),e.jsx(Z.delete,{className:"size-4 ml-1 mt-1 flex-shrink-0 cursor-pointer hover:text-destructive",onClick:()=>h(V)})]})})]})},V))}),e.jsx(Bt,{orientation:"horizontal"})]})})}),e.jsx(M,{})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(j,{type:"submit",children:""}),e.jsx(j,{type:"button",className:"mr-2",variant:"outline",onClick:t,children:""})]})]})})]})}function lp({asset:a,onEdit:s,onSelectState:t,onCancel:n}){var i;return e.jsxs("div",{className:"h-[calc(100%-2.5rem)] flex flex-col",children:[e.jsxs("h3",{className:"text-base font-bold mb-4 flex justify-between items-center",children:["",e.jsx(j,{className:"ml-1 mr-auto",variant:"ghost",size:"sm",onClick:()=>s(a),children:e.jsx(Z.edit,{className:"size-4"})}),e.jsx(j,{variant:"outline",size:"sm",onClick:n,children:""})]}),e.jsx(be,{className:"flex-1",children:e.jsx("div",{className:"flex gap-2 flex-wrap",children:(i=a.states)==null?void 0:i.map(o=>e.jsx(ys,{type:a.type,state:o,onSelect:()=>t(o)},o.id))})})]})}function cp(){const a=Vt("(min-width: 640px)"),s=Re(y=>y.isOpen),t=Re(y=>y.confirm),n=Re(y=>y.cancel),i=Re(y=>y.disableSelect),o=Re(y=>y.type),[r,c]=d.useState(o),[l,m]=d.useState(null),[h,u]=d.useState(null),f=Ot(async()=>{if(r){const y=await Q.where("type").equals(r).and(w=>!w.name.startsWith(Ga)).reverse().toArray();if(r===k.Character){const w=y.findIndex(U=>U.id===pt);if(w!==-1){const U=y[w];y.splice(w,1),y.unshift(U)}}return y}return[]},[r]),p=y=>{c(y)},g=()=>{m({name:"",type:r,states:[]})},v=y=>{m(y)},b=y=>{y.states.forEach(w=>{We.delete(w.id)}),Q.delete(y.id)},V=()=>{n(),m(null),u(null)},R=async y=>{for(const w of y.states){const U=wt(w.file).ext,te=await We.add({mime:w.file.type,blob:w.file,ext:U});w.id=te,w.ext=U,delete w.file,y.type===k.Font&&ta(w.name,ge(w))}await Q.add(y)},W=async y=>{for(const w of y.states){if(w.file){w.id&&await We.delete(w.id);const U=wt(w.file).ext,te=await We.add({mime:w.file.type,blob:w.file,ext:U});w.id=te,w.ext=U,y.type===k.Font&&ta(w.name,ge(w))}delete w.file}await Q.update(y.id,y)},H=async y=>{if(y.id){if(await W(y),h){const w=await Q.get(y.id);u(w)}}else await R(y);m(null)},X=()=>{m(null)},O=y=>{i||(t({...h,stateId:y.id}),u(null))},ie=()=>{u(null)};d.useEffect(()=>{c(o||k.Character)},[o]);const T=()=>l?e.jsx(rp,{asset:l,onSubmit:H,onCancel:X}):h?e.jsx(lp,{asset:h,onEdit:y=>v(y),onSelectState:O,onCancel:ie}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(Is,{value:r,onValueChange:p,children:e.jsx(ss,{children:Ta.map(y=>e.jsx(Ye,{value:y.value,disabled:o&&o!==y.value,children:y.name},y.value))})}),e.jsxs(j,{size:"sm",onClick:g,children:[e.jsx(Z.squarePlus,{className:"w-3.5 h-3.5 mr-0.5"}),a&&""]})]}),e.jsx(be,{className:"flex-grow",children:e.jsx("div",{className:"flex gap-2 flex-wrap",children:f==null?void 0:f.map(y=>e.jsx(Ou,{asset:y,onSelect:()=>u(y),onEdit:()=>v(y),onDelete:()=>b(y)},y.id))})})]});return e.jsx(Ce,{open:s,onOpenChange:V,children:e.jsxs(we,{id:"asset-library",className:S("min-w-[90vw] h-[90vh] flex flex-col",!a&&"px-2"),children:[e.jsxs(oe,{children:[e.jsx(re,{children:""}),e.jsx(le,{})]}),T()]})})}const dp=id,So=d.forwardRef(({className:a,...s},t)=>e.jsx(pi,{ref:t,className:S("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",a),...s}));So.displayName=pi.displayName;const hp=Se("group pointer-events-auto relative flex w-full items-center justify-between space-x-2 overflow-hidden rounded-md border p-4 pr-6 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),jo=d.forwardRef(({className:a,variant:s,...t},n)=>e.jsx(fi,{ref:n,className:S(hp({variant:s}),a),...t}));jo.displayName=fi.displayName;const up=d.forwardRef(({className:a,...s},t)=>e.jsx(xi,{ref:t,className:S("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium transition-colors hover:bg-secondary focus:outline-none focus:ring-1 focus:ring-ring disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",a),...s}));up.displayName=xi.displayName;const wo=d.forwardRef(({className:a,...s},t)=>e.jsx(gi,{ref:t,className:S("absolute right-1 top-1 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-1 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",a),"toast-close":"",...s,children:e.jsx(Ln,{className:"h-4 w-4"})}));wo.displayName=gi.displayName;const No=d.forwardRef(({className:a,...s},t)=>e.jsx(bi,{ref:t,className:S("text-sm font-semibold [&+div]:text-xs",a),...s}));No.displayName=bi.displayName;const Co=d.forwardRef(({className:a,...s},t)=>e.jsx(vi,{ref:t,className:S("text-sm opacity-90",a),...s}));Co.displayName=vi.displayName;function mp(){const{toasts:a}=st();return e.jsxs(dp,{children:[a.map(function({id:s,title:t,description:n,action:i,...o}){return e.jsxs(jo,{...o,children:[e.jsxs("div",{className:"grid gap-1",children:[t&&e.jsx(No,{children:t}),n&&e.jsx(Co,{children:n})]}),i,e.jsx(wo,{})]},s)}),e.jsx(So,{})]})}function pp(){const a=vs(t=>t.isOpen),s=vs(t=>t.loadingText);return e.jsx(Ce,{open:a,children:e.jsxs(we,{disableClose:!0,onPointerDownOutside:t=>t.preventDefault(),children:[e.jsxs(oe,{className:"hidden",children:[e.jsx(re,{}),e.jsx(le,{})]}),e.jsxs("div",{className:"w-full flex gap-2 justify-center items-center",children:[e.jsx("div",{className:"font-bold text-xl",children:s}),e.jsx(Ba,{})]})]})})}function fp(){const[a,s]=d.useState(!1),t=Vt("(min-width: 768px)"),[n,i]=d.useState(null),{toast:o}=st(),r=()=>{s(!0)};return d.useEffect(()=>{xd().then(c=>{i(c.video),c.audio||(iu(!0),o({title:"",description:"ChromeEdge",duration:1500}))})},[o]),n?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"h-screen flex flex-col",children:[e.jsx(pm,{}),e.jsxs("main",{className:"grid flex-1 gap-2 overflow-auto p-2 grid-cols-1 md:grid-cols-[minmax(450px,1fr)_2fr] bg-muted/50",children:[e.jsx("div",{className:"relative hidden md:flex h-[calc(100vh-53px-1rem)]",children:t&&e.jsx(rn,{})}),e.jsxs("div",{className:"relative flex h-full flex-col gap-2",children:[e.jsx(am,{}),e.jsxs("div",{className:"flex gap-2 h-[50vh] md:h-[30vh] flex-col sm:flex-row",children:[e.jsx(um,{}),e.jsx(qh,{onOpenSceneDetailDialog:r})]})]})]})]}),!t&&a&&e.jsx("div",{className:"fixed top-0 left-0 size-full z-50",children:e.jsx(rn,{onClose:()=>s(!1)})}),e.jsx(cp,{}),e.jsx(mp,{}),e.jsx(pp,{})]}):e.jsx("div",{className:"flex h-screen items-center justify-center",children:n===!1?e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-semibold",children:""}),e.jsx("p",{className:"text-sm",children:"ChromeEdge"})]}):e.jsx("div",{className:"text-center",children:"..."})})}const xp=od([{path:"/",element:e.jsx(fp,{})}]);function gp(){return e.jsx(rd,{router:xp})}window.onbeforeunload=function(){return""};Rh();_h().finally(()=>{Ch()});const bp=document.getElementById("root");ld.createRoot(bp).render(e.jsx(gp,{}));export{yp as __vite_legacy_guard};
