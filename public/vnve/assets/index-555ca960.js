var Wr=Object.defineProperty;var Ir=(a,s,t)=>s in a?Wr(a,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[s]=t;var x=(a,s,t)=>(Ir(a,typeof s!="symbol"?s+"":s,t),t);import{t as Lr,c as Xr,r as d,j as e,n as Fr,l as Xe,C as Kr,B as zr,N as Dr,a as nn,T as rn,G as Yr,b as Mr,R as Hr,F as Br,L as Pr,d as Ar,E as Pa,e as Ur,f as ds,g as Er,S as ta,A as Or,h as Jr,p as Qr,i as _r,k as Fe,U as on,M as ln,m as $r,o as hs,q as he,s as q,u as Aa,P as cn,v as qr,w as eo,x as to,y as so,z as ys,D as sa,H as dn,V as ao,I as no,J as hn,K as io,O as Es,Q as ro,W as oo,X as lo,Y as co,Z as ho,_ as uo,$ as mo,a0 as po,a1 as fo,a2 as xo,a3 as go,a4 as Ua,a5 as bo,a6 as vo,a7 as yo,a8 as So,a9 as jo,aa as wo,ab as No,ac as Co,ad as Os,ae as ko,af as Zo,ag as Go,ah as To,ai as Vo,aj as Ro,ak as Wo,al as Io,am as Lo,an as Xo,ao as Fo,ap as Ko,aq as zo,ar as Do,as as Yo,at as Mo,au as Ho,av as Bo,aw as Po,ax as Ao,ay as Uo,az as Eo,aA as Oo,aB as Jo,aC as Qo,aD as _o,aE as $o,aF as qo,aG as el,aH as tl,aI as sl,aJ as al,aK as nl,aL as il,aM as rl,aN as ol,aO as ll,aP as cl,aQ as dl,aR as hl,aS as ul,aT as ml,aU as pl,aV as fl,aW as xl,aX as gl,aY as bl,aZ as vl,a_ as yl,a$ as Sl,b0 as jl,b1 as wl,b2 as Nl,b3 as Cl,b4 as kl,b5 as Zl,b6 as Gl,b7 as Tl,b8 as un,b9 as Vl,ba as aa,bb as mn,bc as na,bd as ia,be as ra,bf as oa,bg as la,bh as Ss,bi as ca,bj as da,bk as pn,bl as ha,bm as ua,bn as fn,bo as xn,bp as Rl,bq as Wl,br as Et,bs as gn,bt as bn,bu as vn,bv as yn,bw as Il,bx as Sn,by as jn,bz as wn,bA as Nn,bB as Cn,bC as kn,bD as Zn,bE as Ll,bF as Gn,bG as Tn,bH as Xl,bI as Vn,bJ as Rn,bK as Wn,bL as Fl,bM as Kl,bN as In,bO as ye,bP as ma,bQ as zl,bR as Dl,bS as Yl,bT as B,bU as E,bV as at,bW as nt,bX as Ln,bY as Ml,bZ as Xn,b_ as Fn,b$ as Kn,c0 as zn,c1 as Dn,c2 as Yn,c3 as Hl,c4 as Bl,c5 as Mn,c6 as Pl,c7 as Al,c8 as Hn,c9 as Ul,ca as Bn,cb as El,cc as Ol,cd as Pn,ce as Jl,cf as An,cg as Un,ch as Ql,ci as _l,cj as En,ck as $l,cl as ql,cm as ec,cn as On,co as Jn,cp as Qn,cq as tc,cr as sc,cs as ac,ct as nc,cu as ic,cv as rc,cw as pa,cx as _n,cy as $n,cz as qn,cA as oc,cB as lc,cC as cc,cD as ei,cE as fa,cF as dc,cG as hc,cH as uc,cI as ti,cJ as si,cK as ai,cL as xa,cM as ni,cN as ii,cO as ri,cP as $e,cQ as ae,cR as mc,cS as pc,cT as ze,cU as fc,cV as js,cW as ga,cX as xc,cY as Ye,cZ as gc,c_ as bc,c$ as vc,d0 as yc,d1 as Sc,d2 as jc,d3 as wc,d4 as Nc,d5 as Cc,d6 as kc,d7 as Zc,d8 as Gc,d9 as Tc,da as ba,db as Vc,dc as Rc,dd as Wc,de as Ic,df as Xt,dg as Lc,dh as Xc,di as oi,dj as li,dk as Fc,dl as pe,dm as Re,dn as Kc,dp as zc,dq as Dc,dr as Yc,ds as Mc,dt as Hc,du as Be,dv as Ge,dw as Bc,dx as Pc,dy as Ac,dz as Uc,dA as Ec,dB as Oc,dC as ci,dD as Jc,dE as Qc,dF as _c,dG as $c,dH as qc,dI as ed,dJ as td,dK as sd,dL as ad,dM as di,dN as hi,dO as ui,dP as mi,dQ as pi,dR as fi,dS as nd,dT as id,dU as rd,dV as od}from"./vendor-4ccb8978.js";function vp(){import.meta.url,import("_").catch(()=>1);async function*a(){}}const xi=Object.freeze(Object.defineProperty({__proto__:null,get AddFilter(){return _d},get AnimationDirective(){return ne},get ChangeSource(){return Yd},get Directive(){return kt},get EnterFromLeft(){return Ad},get EnterFromRight(){return Ed},get FadeIn(){return Gi},get FadeInTransition(){return Qd},get FadeOut(){return Dd},get FilterDirective(){return ya},get Hide(){return zd},get LeaveFromLeft(){return Ud},get LeaveFromRight(){return Od},get Pause(){return Vd},get Play(){return Td},get RemoveFilter(){return $d},get ShakeX(){return Md},get ShakeY(){return Hd},get Show(){return Zi},get SoundDirective(){return es},get Speak(){return Kd},get Speaker(){return Ti},get Stop(){return Rd},get TransitionDirective(){return ki},get Voice(){return Vi},get Wait(){return Jd},get ZoomIn(){return Bd},get ZoomOut(){return Pd}},Symbol.toStringTag,{value:"Module"}));(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(i){if(i.ep)return;i.ep=!0;const r=t(i);fetch(i.href,r)}})();function S(...a){return Lr(Xr(a))}function gi(a,s,t="mp4"){const n=document.createElement("a");n.setAttribute("download","".concat(a,".").concat(t)),n.setAttribute("href",s),document.body.appendChild(n),n.click(),document.body.removeChild(n)}function jt(a){const s=a.name.split(".").pop()||"";return{name:a.name.substring(0,a.name.lastIndexOf(".")),ext:s}}function ld({accept:a="*",multiple:s=!1}={}){return new Promise((t,n)=>{let i=document.createElement("input");i.type="file",i.accept=a,i.multiple=s,i.style.display="none",i.addEventListener("change",r=>{const o=Array.from(r.target.files||[]);o.length>0?t(o):n(new Error("No files selected")),document.body.removeChild(i),i=null}),i.addEventListener("error",()=>{n(new Error("Error selecting files")),document.body.removeChild(i)}),i.addEventListener("cancel",()=>{n(new Error("File deselected!")),document.body.removeChild(i)}),document.body.appendChild(i),i.click()})}function bi(a){const s=a.match(/\{[\s\S]*\}/);try{const t=s[0];return JSON.parse(t)}catch(t){return null}}function vi(a,s=!1){let t="";return a.forEach(n=>{if(n.type==="p")for(let i=0;i<n.children.length;i++){const r=n.children[i];if(!r.type){let o=r.text;i===n.children.length-1&&(o+="\n"),t+=o}}}),s&&(t=t.replace(/\n/g,"")),t}function cd(a,s,t="mp3"){return fetch(a).then(n=>n.blob()).then(n=>new File([n],"".concat(s,".").concat(t),{type:"audio/".concat(t)}))}const ws=d.forwardRef(({className:a,...s},t)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:t,className:S("w-full caption-bottom text-sm",a),...s})}));ws.displayName="Table";const Ns=d.forwardRef(({className:a,...s},t)=>e.jsx("thead",{ref:t,className:S("[&_tr]:border-b",a),...s}));Ns.displayName="TableHeader";const Cs=d.forwardRef(({className:a,...s},t)=>e.jsx("tbody",{ref:t,className:S("[&_tr:last-child]:border-0",a),...s}));Cs.displayName="TableBody";const dd=d.forwardRef(({className:a,...s},t)=>e.jsx("tfoot",{ref:t,className:S("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",a),...s}));dd.displayName="TableFooter";const it=d.forwardRef(({className:a,...s},t)=>e.jsx("tr",{ref:t,className:S("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",a),...s}));it.displayName="TableRow";const rt=d.forwardRef(({className:a,...s},t)=>e.jsx("th",{ref:t,className:S("h-8 px-2 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",a),...s}));rt.displayName="TableHead";const ot=d.forwardRef(({className:a,...s},t)=>e.jsx("td",{ref:t,className:S("p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",a),...s}));ot.displayName="TableCell";const hd=d.forwardRef(({className:a,...s},t)=>e.jsx("caption",{ref:t,className:S("mt-4 text-sm text-muted-foreground",a),...s}));hd.displayName="TableCaption";async function ud(a,s,t,n){const i=a.sampleRate,r=a.numberOfChannels,o=Math.floor(s*i),c=i*t,l=new OfflineAudioContext(r,c,i);let p=l.createBuffer(r,c,i);const h=new Float32Array(c);for(let u=0;u<a.numberOfChannels;u++)a.copyFromChannel(h,u,o),p.copyToChannel(h,u);if(typeof n<"u"){const u=l.createBufferSource();u.buffer=p;const f=l.createGain();f.gain.value=n,u.connect(f),f.connect(l.destination),u.start(),p=await l.startRendering()}return p}async function md(a,s=44100){return new Promise((t,n)=>{const i=new AudioContext({sampleRate:s});i.decodeAudioData(a,t,n).finally(()=>{i.close()})})}async function pd(a){try{const s=await(await fetch(a)).arrayBuffer();return await md(s)}catch(s){console.error("fetchAudioBuffer error:",s);return}}const yi={codec:"avc1.42002A",width:1920,height:1080,bitrate:12e6},Si={codec:"mp4a.40.2",numberOfChannels:2,sampleRate:44100,bitrate:128e3};async function fd(){let a=!1,s=!1;return typeof VideoEncoder<"u"&&typeof VideoFrame<"u"&&(await VideoEncoder.isConfigSupported(yi)).supported&&(a=!0),typeof OfflineAudioContext<"u"&&typeof AudioEncoder<"u"&&typeof AudioData<"u"&&(await AudioEncoder.isConfigSupported(Si)).supported&&(s=!0),{video:a,audio:s}}function Se(){return Fr(8)}Xe.setLevel("ERROR");function xd(a){return new Promise(s=>setTimeout(s,a))}function gd(a,s,t){return Math.abs(a-s)<t}async function va(a,s){if(!s)return[];const t=[];for(const n of s){const i=await bd(a,n);t.push(i)}return t}async function bd(a,s){return await a[s.__type].fromJSON(s)}function Ot(a,s,t=!1){t&&(s.name=a.name),s.label=a.label}function Jt(a){return{__type:a.type,label:a.label,name:a.name}}function Qt(a,s){s.label=a.label,s.name=a.name}class zt extends Kr{constructor(){super();x(this,"label","");x(this,"name",Se());x(this,"type","BlackMaskFilter");this.blackAndWhite(!0),this.brightness(0,!0)}clone(t=!1){const n=new zt;return Ot(this,n,t),n}toJSON(){return Jt(this)}static fromJSON(t){const n=new zt;return Qt(t,n),n}}class us extends zr{constructor(){super(...arguments);x(this,"label","");x(this,"name",Se());x(this,"type","BlurFilter")}clone(t=!1){const n=new us;return Ot(this,n,t),n}toJSON(){return Jt(this)}static fromJSON(t){const n=new us;return Qt(t,n),n}}class ms extends Dr{constructor(){super(...arguments);x(this,"label","");x(this,"name",Se());x(this,"type","NoiseFilter")}clone(t=!1){const n=new ms;return Ot(this,n,t),n}toJSON(){return Jt(this)}static fromJSON(t){const n=new ms;return Qt(t,n),n}}class ps extends nn{constructor(){super(...arguments);x(this,"label","");x(this,"name",Se());x(this,"type","OldFilmFilter")}clone(t=!1){const n=new ps;return Ot(this,n,t),n}toJSON(){return Jt(this)}static fromJSON(t){const n=new ps;return Qt(t,n),n}}class fs extends nn{constructor(){super();x(this,"label","");x(this,"name",Se());x(this,"type","VignetteFilter");this.sepia=0,this.noise=0,this.vignetting=.5}clone(t=!1){const n=new fs;return Ot(this,n,t),n}toJSON(){return Jt(this)}static fromJSON(t){const n=new fs;return Qt(t,n),n}}const ji={BlackMaskFilter:zt,BlurFilter:us,NoiseFilter:ms,OldFilmFilter:ps,VignetteFilter:fs};function wi(a){return va(ji,a)}function _t(a,s,t=!1,n=!1){var i;t&&(s.name=a.name),s.label=a.label,s.type=a.type,s.visible=a.visible,s.alpha=a.alpha,s.zIndex=a.zIndex,s.setTransform(...Ni(a)),n||(s.width=a.width,s.height=a.height),s.filters=((i=a.filters)==null?void 0:i.map(r=>r.clone(t)))||null}function $t(a,s=!1){var n;let t={__type:a.type,name:a.name,label:a.label,type:a.type,visible:a.visible,alpha:a.alpha,zIndex:a.zIndex,transform:Ni(a),filters:((n=a.filters)==null?void 0:n.map(i=>i.toJSON()))||null};return s||(t={...t,width:a.width,height:a.height}),t}async function qt(a,s,t=!1){s.name=a.name,s.label=a.label,s.type=a.type,s.visible=a.visible,s.alpha=a.alpha,s.zIndex=a.zIndex,s.setTransform(...a.transform),t||(typeof a.width=="number"&&(s.width=a.width),typeof a.height=="number"&&(s.height=a.height)),s.filters=await wi(a.filters)}function wt(a){return a.width===a.texture.width&&a.height===a.texture.height&&a.width===1&&a.height===1}function Ni(a){return[a.x,a.y,a.scale.x,a.scale.y,a.rotation,a.skew.x,a.skew.y,a.pivot.x,a.pivot.y]}class We extends rn{constructor(){super(...arguments);x(this,"name",Se());x(this,"label","");x(this,"type","Text");x(this,"disableTextEdit",!1)}async load(){}clone(t=!1){const n=new We(this.text,this.style.clone());return _t(this,n,t,!0),n.disableTextEdit=this.disableTextEdit,n}toJSON(){return{...$t(this,!0),text:this.text,disableTextEdit:this.disableTextEdit,style:{fontSize:this.style.fontSize,fontWeight:this.style.fontWeight,fontStyle:this.style.fontStyle,fontFamily:this.style.fontFamily,fill:this.style.fill,wordWrap:this.style.wordWrap,breakWords:this.style.breakWords,wordWrapWidth:this.style.wordWrapWidth,leading:this.style.leading}}}static async fromJSON(t){const n=new We(t.text,t.style);return await qt(t,n,!0),n.disableTextEdit=t.disableTextEdit,n}}class Nt extends Yr{constructor(){super(...arguments);x(this,"name",Se());x(this,"label","");x(this,"type","Graphics");x(this,"fillColor","")}async load(){}clone(t=!1){const n=new Nt(super.clone().geometry);return _t(this,n,t),n.fillColor=this.fillColor,n}toJSON(){return{...$t(this),fillColor:this.fillColor,graphicsData:this.geometry.graphicsData.map(t=>[t.shape,{...t.fillStyle,texture:void 0},{...t.lineStyle,texture:void 0}])}}static async fromJSON(t){const n=new Mr;n.graphicsData=t.graphicsData.map(r=>{const o=new Hr;o.x=r[0].x,o.y=r[0].y,o.width=r[0].width,o.height=r[0].height;const c=new Br;c.alpha=r[1].alpha,c.color=r[1].color,c.visible=r[1].visible;const l=new Pr;return l.color=r[2].color,l.alpha=r[2].alpha,l.visible=r[2].visible,l.width=r[2].width,l.alignment=r[2].alignment,l.native=r[2].native,l.cap=r[2].cap,l.join=r[2].join,l.miterLimit=r[2].miterLimit,new Ar(o,c,l)});const i=new Nt(n);return await qt(t,i),i.fillColor=t.fillColor,i}}const vd={extension:Pa.Asset,detection:{test:async()=>!0,add:async a=>[...a],remove:async a=>a.filter(s=>a.includes(s))},loader:{extension:{type:[Pa.LoadParser],priority:Ur.High},test(a){return a.startsWith("blob:")},async load(a){return ds.from(a)}}};Er.add(vd);class Dt extends ta{constructor(t){super();x(this,"name");x(this,"label");x(this,"type");x(this,"source");x(this,"assetID");x(this,"assetType");this.name=Se(),this.label="",this.type="Sprite",this.source=t.source,this.assetID=0,this.assetType=""}changeSource(t){this.source=t}async load(){this.source&&(this.texture=await Or.load(this.source))}clone(t=!1){const n=new Dt({source:this.source});return n.assetID=this.assetID,n.assetType=this.assetType,_t(this,n,t,wt(this)),n}toJSON(){return{...$t(this,wt(this)),source:this.source,assetID:this.assetID,assetType:this.assetType}}static async fromJSON(t){const n=new Dt({source:t.source});return n.assetID=t.assetID,n.assetType=t.assetType,await qt(t,n),n}}const Pe=class Pe extends ta{constructor(t){super(ds.EMPTY);x(this,"name");x(this,"label");x(this,"type");x(this,"source");x(this,"assetID");x(this,"assetType");x(this,"animationSpeed",1);x(this,"loop",!0);x(this,"onComplete");x(this,"onFrameChange");x(this,"onLoop");x(this,"duration",0);x(this,"autoPlay",!0);x(this,"_frames");x(this,"_context");x(this,"dirty",!1);x(this,"_currentFrame",0);x(this,"_autoUpdate",!1);x(this,"_isConnectedToTicker",!1);x(this,"_playing",!1);x(this,"_currentTime",0);this.name=Se(),this.label="",this.type="AnimatedGIF",this.source=t.source,this.assetID=0,this.assetType="",this._frames=[],this._context=null}static fromBuffer(t,n){if(!t||t.byteLength===0)throw new Error("Invalid buffer");const i=W=>{var H;let R=null;for(const X of W.frames)R=(H=X.gce)!=null?H:R,"image"in X&&!("gce"in X)&&(X.gce=R)},r=Qr(t);i(r);const o=_r(r,!0),c=[],l=document.createElement("canvas"),p=l.getContext("2d",{willReadFrequently:!0}),h=document.createElement("canvas"),u=h.getContext("2d");l.width=r.lsd.width,l.height=r.lsd.height;let f=0,m=null;const{fps:g}=Object.assign({},Pe.defaultOptions,n),v=1e3/g;for(let W=0;W<o.length;W++){const{disposalType:R=2,delay:H=v,patch:X,dims:{width:O,height:ie,left:T,top:y}}=o[W];h.width=O,h.height=ie,u.clearRect(0,0,O,ie);const w=u.createImageData(O,ie);w.data.set(X),u.putImageData(w,0,0),R===3&&(m=p.getImageData(0,0,l.width,l.height)),p.drawImage(h,T,y);const A=p.getImageData(0,0,l.width,l.height);R===2?p.clearRect(0,0,l.width,l.height):R===3&&p.putImageData(m,0,0),c.push({start:f,end:f+H,imageData:A}),f+=H}l.width=l.height=0,h.width=h.height=0;const{width:b,height:V}=r.lsd;return{frames:c,width:b,height:V}}async load(){const t=await fetch(this.source).then(u=>u.arrayBuffer()),{frames:n,width:i,height:r}=Pe.fromBuffer(t),o=document.createElement("canvas"),c=o.getContext("2d");o.width=i,o.height=r;const{source:l,scaleMode:p,...h}=Pe.defaultOptions;this.texture=ds.from(o,{scaleMode:p}),this.duration=n[n.length-1].end,this._frames=n,this._context=c,this._playing=!1,this._currentTime=0,this._isConnectedToTicker=!1,Object.assign(this,h),this.dirty=!0,this.currentFrame=0}stop(){this._playing&&(this._playing=!1,this._autoUpdate&&this._isConnectedToTicker&&(Fe.shared.remove(this.update,this),this._isConnectedToTicker=!1))}play(){this._playing||(this._playing=!0,this._autoUpdate&&!this._isConnectedToTicker&&(Fe.shared.add(this.update,this,on.HIGH),this._isConnectedToTicker=!0),!this.loop&&this.currentFrame===this._frames.length-1&&(this._currentTime=0))}get progress(){return this._currentTime/this.duration}get playing(){return this._playing}update(t){var o,c;if(!this._playing)return;const n=Fe.shared.time*1e3,i=n%this.duration,r=this._frames.findIndex(l=>l.start<=i&&l.end>i);n>=this.duration?this.loop?(this._currentTime=i,this.updateFrameIndex(r),(o=this.onLoop)==null||o.call(this)):(this._currentTime=this.duration,this.updateFrameIndex(this._frames.length-1),(c=this.onComplete)==null||c.call(this),this.stop()):(this._currentTime=i,this.updateFrameIndex(r))}updateFrame(){if(!this.dirty)return;const{imageData:t}=this._frames[this._currentFrame];this._context.putImageData(t,0,0),this._context.fillStyle="transparent",this._context.fillRect(0,0,0,1),this.texture.update(),this.dirty=!1}_render(t){this.updateFrame(),super._render(t)}_renderCanvas(t){this.updateFrame(),super._renderCanvas(t)}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isConnectedToTicker?(Fe.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._playing&&(Fe.shared.add(this.update,this),this._isConnectedToTicker=!0))}get currentFrame(){return this._currentFrame}set currentFrame(t){this.updateFrameIndex(t),this._currentTime=this._frames[t].start}updateFrameIndex(t){var n;if(t<0||t>=this._frames.length)throw new Error("Frame index out of range, expecting 0 to ".concat(this.totalFrames,", got ").concat(t));this._currentFrame!==t&&(this._currentFrame=t,this.dirty=!0,(n=this.onFrameChange)==null||n.call(this,t))}get totalFrames(){return this._frames.length}destroy(){this.stop(),super.destroy(!0);const t=null;this._context=t,this._frames=t,this.onComplete=t,this.onFrameChange=t,this.onLoop=t}clone(t=!1){const n=new Pe({source:this.source});return n.assetID=this.assetID,n.assetType=this.assetType,_t(this,n,t,wt(this)),n}toJSON(){return{...$t(this,wt(this)),source:this.source,assetID:this.assetID,assetType:this.assetType}}static async fromJSON(t){const n=new Pe({source:t.source});return n.assetID=t.assetID,n.assetType=t.assetType,await qt(t,n),n}};x(Pe,"defaultOptions",{source:"",scaleMode:Jr.LINEAR,fps:30,loop:!0,animationSpeed:1,autoPlay:!0,autoUpdate:!0,onComplete:null,onFrameChange:null,onLoop:null});let xs=Pe;var Ci=(a=>(a[a.AUDIO_STREAM_TYPE=0]="AUDIO_STREAM_TYPE",a[a.VIDEO_STREAM_TYPE=1]="VIDEO_STREAM_TYPE",a))(Ci||{});const{DataStream:Ea}=ln;function Js(...a){Xe.debug(...a)}class yd{constructor(s){x(this,"fileUri");x(this,"streamType");x(this,"source");x(this,"readySamples");x(this,"_pending_read_resolver");x(this,"audioTrack");x(this,"videoTrack");this.fileUri=s}async initialize(s){this.source=new Sd(this.fileUri),this.readySamples=[],this._pending_read_resolver=void 0,this.streamType=s;const t=await this._tracksReady();return this.streamType==0?this._selectTrack(this.audioTrack):this._selectTrack(this.videoTrack),t}getDecoderConfig(){return this.streamType==0?{codec:this.audioTrack.codec,sampleRate:this.audioTrack.audio.sample_rate,numberOfChannels:this.audioTrack.audio.channel_count,description:this.source.getAudioSpecificConfig()}:{codec:this.videoTrack.codec.startsWith("vp08")?"vp8":this.videoTrack.codec,displayWidth:this.videoTrack.track_width,displayHeight:this.videoTrack.track_height,description:this._getDescription(this.source.getDescriptionBox())}}async getNextChunk(){let s=await this._readSample();const t=s.is_sync?"key":"delta",n=s.cts*1e6/s.timescale,i=s.duration*1e6/s.timescale,r=this.streamType==0?EncodedAudioChunk:EncodedVideoChunk;return new r({type:t,timestamp:n,duration:i,data:s.data})}_getDescription(s){const t=new Ea(void 0,0,Ea.BIG_ENDIAN);return s.write(t),new Uint8Array(t.buffer,8)}async _tracksReady(){let s=await this.source.getInfo();return this.videoTrack=s.videoTracks[0],this.audioTrack=s.audioTracks[0],{video:this.videoTrack,audio:this.audioTrack}}_selectTrack(s){this.source.selectTrack(s)}async _readSample(){if(this.readySamples.length)return Promise.resolve(this.readySamples.shift());let s=new Promise(t=>{this._pending_read_resolver=t});return this.source.start(this._onSamples.bind(this)),s}_onSamples(s){this.readySamples.push(...s),this.readySamples.length>=50&&this.source.stop();let n=s[0].cts*1e6/s[0].timescale;Js("adding new ".concat(s.length," samples (first = ").concat(n,"). total = ").concat(this.readySamples.length)),this._pending_read_resolver&&(this._pending_read_resolver(this.readySamples.shift()),this._pending_read_resolver=void 0)}destroy(){this.readySamples=[],this.source.close()}}class Sd{constructor(s){x(this,"file");x(this,"_onSamples");x(this,"info");x(this,"_info_resolver");this.file=ln.createFile(),this.file.onError=console.error.bind(console),this.file.onReady=this.onReady.bind(this),this.file.onSamples=this.onSamples.bind(this),Js("fetching file"),fetch(s).then(t=>{Js("fetch responded");const n=t.body.getReader();let i=0,r=this.file;function o({done:c,value:l}){if(c){r.flush();return}let p=l.buffer;return p.fileStart=i,i+=p.byteLength,r.appendBuffer(p),n.read().then(o)}return n.read().then(o)}),this.info=void 0,this._info_resolver=void 0}onReady(s){this.info=s,this._info_resolver&&(this._info_resolver(s),this._info_resolver=void 0)}getInfo(){return this.info?Promise.resolve(this.info):new Promise(s=>{this._info_resolver=s})}getDescriptionBox(){const s=this.file.moov.traks[0].mdia.minf.stbl.stsd.entries[0],t=s.avcC||s.hvcC||s.vpcC||s.av1C;if(!t)throw new Error("avcC, hvcC, vpcC, or av1C box not found!");return t}getAudioSpecificConfig(){try{return this.file.moov.traks[0].mdia.minf.stbl.stsd.entries[0].esds.esd.descs[0].descs[0].data}catch(s){return}}selectTrack(s){this.file.setExtractionOptions(s.id)}start(s){this._onSamples=s,this.file.start()}stop(){this.file.stop()}close(){this.file.flush()}onSamples(s,t,n){this._onSamples(n)}}const zs=3;function xt(...a){Xe.debug(...a)}class jd{constructor(){x(this,"width");x(this,"height");x(this,"duration");x(this,"demuxer");x(this,"frameBuffer");x(this,"fillInProgress");x(this,"canvasCtx");x(this,"decoder");x(this,"init_resolver")}async initialize(s,t,{width:n,height:i}){this.frameBuffer=[],this.fillInProgress=!1,this.demuxer=new yd(s);const{video:r}=await this.demuxer.initialize(Ci.VIDEO_STREAM_TYPE),o=this.demuxer.getDecoderConfig();this.width=n>0?n:o.displayWidth,this.height=i>0?i:o.displayHeight,this.duration=r.duration/r.timescale,this.canvasCtx=t,this.canvasCtx.canvas.width=this.width,this.canvasCtx.canvas.height=this.height,this.decoder=new VideoDecoder({output:this.bufferFrame.bind(this),error:p=>console.error(p)});let c=await VideoDecoder.isConfigSupported(o);console.assert(c.supported),this.decoder.configure(o),this.init_resolver=void 0;let l=new Promise(p=>this.init_resolver=p);return this.fillFrameBuffer(),l}render(s){xt("render(%d)",s);let t=this.chooseFrame(s);if(this.fillFrameBuffer(),t==null){console.warn("VideoRenderer.render(): no frame ");return}return this.paint(t),t}chooseFrame(s){if(this.frameBuffer.length==0)return null;let t=Number.MAX_VALUE,n=-1;for(let r=0;r<this.frameBuffer.length;r++){let o=Math.abs(s-this.frameBuffer[r].timestamp);if(o<t)t=o,n=r;else break}console.assert(n!=-1),n>0&&xt("dropping %d stale frames",n);for(let r=0;r<n;r++){let o=this.frameBuffer.shift();o&&o.close()}let i=this.frameBuffer[0];return xt("frame time delta = %dms (%d vs %d)",t/1e3,s,i.timestamp),i}async fillFrameBuffer(){if(this.frameBufferFull()){xt("frame buffer full"),this.init_resolver&&(this.init_resolver(!0),this.init_resolver=void 0);return}if(this.fillInProgress)return!1;for(this.fillInProgress=!0;this.frameBuffer.length<zs&&this.decoder.decodeQueueSize<zs;){let s=await this.demuxer.getNextChunk();this.decoder.decode(s)}this.fillInProgress=!1,setTimeout(this.fillFrameBuffer.bind(this),0)}frameBufferFull(){return this.frameBuffer.length>=zs}bufferFrame(s){xt("bufferFrame(".concat(s.timestamp,")")),this.frameBuffer.push(s)}paint(s){xt("paint(%d)",s.timestamp),this.canvasCtx.drawImage(s,0,0,this.width,this.height)}async destroy(){this.decoder.state!="closed"&&(this.frameBuffer.forEach(s=>s.close()),await this.decoder.flush(),this.decoder.close()),this.demuxer.destroy()}}class Yt extends ta{constructor(t){var n,i,r,o,c,l,p;super();x(this,"name");x(this,"label");x(this,"type");x(this,"source");x(this,"assetID");x(this,"assetType");x(this,"start");x(this,"duration");x(this,"offset");x(this,"loop");x(this,"volume");x(this,"bufferDuration",0);x(this,"options");x(this,"videoRenderer");x(this,"_isConnectedToTicker",!1);this.options=t,this.name=Se(),this.label="",this.type="Video",this.source=t.source,this.assetID=0,this.assetType="",this.width=(n=this.options.width)!=null?n:0,this.height=(i=this.options.height)!=null?i:0,this.start=(r=t.start)!=null?r:0,this.duration=(o=t.duration)!=null?o:0,this.offset=(c=t.offset)!=null?c:0,this.loop=(l=t.loop)!=null?l:!1,this.volume=(p=t.volume)!=null?p:1}async load(){if(this.source){const t=this.source,n=document.createElement("canvas"),i=n.getContext("2d"),r=new jd;await r.initialize(t,i,{width:this.width,height:this.height}),this.width=r.width,this.height=r.height;const o=r.duration*1e3;this.duration=this.duration||o,this.bufferDuration=o,this.videoRenderer=r,this.texture=ds.from(n),this.videoRenderer.render(0),this.texture.update()}}play(){this._isConnectedToTicker||(Fe.shared.add(this.update,this,on.HIGH),this._isConnectedToTicker=!0)}stop(){this._isConnectedToTicker&&(Fe.shared.remove(this.update,this),this._isConnectedToTicker=!1)}destroy(){this.stop(),super.destroy(!0),this.videoRenderer=void 0}async update(){var n;const t=Fe.shared.time*1e3;(n=this.videoRenderer)==null||n.render(t*1e3),this.texture.update()}clone(t=!1){const n=new Yt({source:this.source});return n.assetID=this.assetID,n.assetType=this.assetType,_t(this,n,t,wt(this)),n}toJSON(){return{...$t(this,wt(this)),source:this.source,assetID:this.assetID,assetType:this.assetType}}static async fromJSON(t){const n=new Yt({source:t.source});return n.assetID=t.assetID,n.assetType=t.assetType,await qt(t,n),n}}const wd={Text:We,Graphics:Nt,Sprite:Dt,AnimatedGIF:xs,Video:Yt};function Nd(a){return va(wd,a)}class Mt{constructor(s){x(this,"name");x(this,"label");x(this,"type");x(this,"source");x(this,"assetID");x(this,"assetType");x(this,"buffer");this.name=Se(),this.label="",this.type="Sound",this.source=s.source,this.assetID=0,this.assetType=""}changeSource(s){this.source=s}async load(){this.buffer=await pd(this.source)}clone(s=!1){const t=new Mt({source:this.source});return Ds(this,t,s),t}toJSON(){const s={};return Ds(this,s,!0),{__type:this.type,...s,source:this.source,assetID:this.assetID,assetType:this.assetType}}static async fromJSON(s){const t=new Mt({source:s.source});return Ds(s,t,!0),t}destroy(){this.buffer=void 0}}function Ds(a,s,t=!1){t&&(s.name=a.name),s.label=a.label,s.assetID=a.assetID,s.assetType=a.assetType}function Cd(a){return va({Sound:Mt},a)}class Ie extends $r{constructor(t){super();x(this,"name");x(this,"label");x(this,"config");x(this,"dialogues");x(this,"sounds");this.name=Se(),this.label=(t==null?void 0:t.label)||"",this.config={speak:{targetName:"",wordsPerMin:500,interval:.2,effect:"typewriter",speaker:{targetName:"",name:"",autoShowSpeaker:{inEffect:"Show"},autoMaskOtherSpeakers:{alpha:.5}}},autoShowBackground:!0},this.dialogues=[],this.sounds=[],this.sortableChildren=!0}getSoundByName(t){return this.sounds.find(n=>n.name===t)}addSound(t){this.sounds.push(t)}removeSound(t){this.sounds=this.sounds.filter(n=>n.name===t.name?(t.destroy(),!1):!0)}addFilter(t){this.filters?this.filters.push(t):this.filters=[t]}removeFilter(t){this.filters&&(this.filters=this.filters.filter(n=>n!==t))}addDialogue(t,n){typeof n<"u"?this.dialogues.splice(n,0,t):this.dialogues.push(t)}updateDialogue(t,n){this.dialogues[t]=n}removeDialogue(t){this.dialogues=this.dialogues.filter(n=>n!==t)}swapDialogue(t,n){[this.dialogues[t],this.dialogues[n]]=[this.dialogues[n],this.dialogues[t]]}getChildByLabel(t){return this.children.find(n=>n.label===t)}getChildrenByAssetType(t){return this.children.filter(n=>n.assetType===t)}clone(){var i;const t=new Ie;t.label=this.label,t.config=hs(this.config),t.dialogues=hs(this.dialogues);const n=this.children.map(r=>r.clone(!0));return n.length>0&&t.addChild(...n),t.sounds=this.sounds.map(r=>r.clone(!0)),t.filters=((i=this.filters)==null?void 0:i.map(r=>r.clone(!0)))||null,t}toJSON(){return{__type:"Scene",name:this.name,label:this.label,config:this.config,dialogues:this.dialogues,children:this.children,sounds:this.sounds,filters:this.filters}}static async fromJSON(t,n=!0){const i=new Ie;n&&(i.name=t.name),i.label=t.label,i.config=t.config,i.dialogues=t.dialogues;const r=await Nd(t.children);return r.length>0&&i.addChild(...r),i.sounds=await Cd(t.sounds),i.filters=await wi(t.filters),i}async load({skipSoundLoading:t=!1}={}){const n=async i=>{if(typeof i.load=="function"&&await i.load(),i.children&&i.children.length>0)for(const r of i.children)await n(r)};for(const i of this.children)await n(i);if(!t)for(const i of this.sounds)await i.load()}}const kd={version:"3.12.2",name:"text",init(a,s,t){var i,r,o;typeof s!="object"&&(s={value:s});let n=s.value;this.startText=((o=(r=(i=t.vars)==null?void 0:i.startAt)==null?void 0:r.text)==null?void 0:o.value)||"",this.target=a,this.startText&&(n=n.replace(this.startText,"")),n=n.split(""),this.from=t._from,this.text=n,this._props.push("text")},render(a,s){a>1?a=1:a<0&&(a=0),s.from&&(a=1-a);const{text:t,target:n,startText:i}=s,r=t.length,o=a*r+.5|0;n.text=i+t.slice(0,o).join("")}};class kt{constructor(s,t){x(this,"options");x(this,"stage");x(this,"executeTime");x(this,"currentTime");var n;this.options=s,this.stage=t,this.executeTime=(n=s.executeTime)!=null?n:0,this.currentTime=0}load(){}check(){return!0}}class ne extends kt{constructor(t,n){super(t,n);x(this,"target");this.options=t,this.target=this.stage.getChildByName(t.targetName,!0)}check(){return!!this.target}execute(){if(!this.target)return;const{fromVars:t,toVars:n}=this.options;this.target.visible=!0,typeof this.target.play=="function"&&this.target.play(),t&&n?he.fromTo(this.target,t,n):n&&he.to(this.target,n)}getDuration(){var t,n;return this.options.sequential&&(n=(t=this.options.toVars)==null?void 0:t.duration)!=null?n:0}}class es extends kt{constructor(t,n){super(t,n);x(this,"target");this.stage=n,this.target=this.stage.getSoundByName(t.targetName)}check(){return!!this.target}getDuration(){return 0}}class ki extends kt{constructor(s,t){super(s,t),this.options=s}execute(){const{fromVars:s,toVars:t}=this.options;s&&t?he.fromTo(this.stage,s,t):t&&he.to(this.stage,t)}getDuration(){var s,t;return this.options.sequential&&(t=(s=this.options.toVars)==null?void 0:s.duration)!=null?t:0}}class ya extends kt{constructor(t,n){super(t,n);x(this,"target");this.options=t,this.stage=n,t.targetName&&(this.target=this.stage.getChildByName(t.targetName))}getDuration(){return 0}}class Zi extends ne{constructor(s,t){super(s,t),this.options=q({toVars:{pixi:{visible:!0},ease:"none",duration:0}},s)}}class Gi extends ne{constructor(s,t){var n;super(s,t),this.target&&(this.options=q({fromVars:{pixi:{alpha:0}},toVars:{pixi:{alpha:(n=this.target.alpha)!=null?n:1},ease:"power1.in",duration:.5}},s))}}const Ys="AutoMaskFilter",Zd={Show:Zi,FadeIn:Gi};class Ti extends ne{constructor(t,n){super(t,n);x(this,"speakerTarget");this.options=q({autoShowSpeaker:{inEffect:"Show"},autoMaskOtherSpeakers:{alpha:.5}},t);const{speakerTargetName:i}=this.options;i&&(this.speakerTarget=this.stage.getChildByName(i))}execute(){const{name:t,autoShowSpeaker:n,autoMaskOtherSpeakers:i,executeTime:r}=this.options;if(this.target&&(this.target.visible=!0,this.target.text=t),n&&this.speakerTarget&&!this.speakerTarget.visible){const{inEffect:o="Show"}=n,c=Zd[o];new c({...n,executeTime:r,targetName:this.speakerTarget.name},this.stage).execute()}if(i){const{alpha:o=.5}=i;this.speakerTarget&&this.checkMaskFilter(this.speakerTarget)&&this.removeMaskFilter(this.speakerTarget),this.stage.children.forEach(c=>{c!==this.speakerTarget&&c.assetType==="Character"&&(this.checkMaskFilter(c)||this.addMaskFilter(c,o))})}}checkMaskFilter(t){var n;return(n=t.filters)==null?void 0:n.some(i=>i.name===Ys)}removeMaskFilter(t){var n;t.filters=((n=t.filters)==null?void 0:n.filter(i=>i.name!==Ys))||[]}addMaskFilter(t,n){const i=new zt;i.name=Ys,i.alpha=n,t.filters?t.filters.push(i):t.filters=[i]}}class Gd{constructor(){x(this,"sliceTaskList",[]);x(this,"soundRecordMap",new Map)}get(s){return this.soundRecordMap.get(s)}play(s,t){const n=this.soundRecordMap.get(s.name);if(n)q(n,{...t,paused:!1});else{const{start:i,volume:r,loop:o,untilEnd:c}=t;this.soundRecordMap.set(s.name,{sound:s,paused:!1,elapsedTime:0,start:i!=null?i:0,volume:r!=null?r:1,loop:o!=null?o:!1,untilEnd:c!=null?c:!1})}}pause(s){const t=this.soundRecordMap.get(s.name);t&&(t.paused=!0)}stop(s){this.soundRecordMap.delete(s.name)}update(s,t){for(const n of this.soundRecordMap.values()){const{sound:i,paused:r,elapsedTime:o,start:c,loop:l,volume:p}=n;if(!r&&i.buffer){let h=o;const u=i.buffer.duration;if(h>u-c)if(l)h=h%(u-c);else continue;const f=1/t,m=ud(i.buffer,h+c,f,p);n.elapsedTime=o+f,this.sliceTaskList.push(m)}}}async getAudioBuffers(){const s=await Promise.all(this.sliceTaskList);return this.sliceTaskList=[],s}resetExceptUtilEnd(){for(const[s,t]of this.soundRecordMap)t.untilEnd||this.soundRecordMap.delete(s)}reset(){this.sliceTaskList=[],this.soundRecordMap.clear()}}const Ue=new Gd;class Td extends es{constructor(s,t){super(s,t),this.options=s}async load(){this.target.buffer||await this.target.load()}execute(){Ue.play(this.target,this.options)}getDuration(){var s,t;return this.options.sequential&&(t=(s=this.target.buffer)==null?void 0:s.duration)!=null?t:0}}class Vd extends es{execute(){Ue.pause(this.target)}}class Rd extends es{execute(){Ue.stop(this.target)}}class Vi extends es{constructor(s,t){super(s,t),this.options=s}async load(){this.target.buffer||await this.target.load()}execute(){Ue.play(this.target,this.options)}getDuration(){var s,t;return this.options.sequential&&(t=(s=this.target.buffer)==null?void 0:s.duration)!=null?t:0}}function Ri(a,s){return s.some(([t,n])=>t<=a&&a<=n)}function Ms(a){const s=a.charCodeAt(0);return Ri(s,[[12352,12447],[19968,40959],[44032,55203],[131072,191456]])}function Wd(a){return" \n\r	".includes(a)}function Id(a){const s=a.charCodeAt(0);return Ri(s,[[33,47],[58,64],[91,96],[123,126],[12288,12351],[65280,65519]])}function Ld(a,s){let t=0,n=0,i=a.length-1;const{wordBound:r=Wd}=s;for(;r(a[n]);)n++;for(;r(a[i]);)i--;const o="".concat(a,"\n");for(let c=n;c<=i;c++)if((Ms(o[c])||!r(o[c])&&(r(o[c+1])||Ms(o[c+1])))&&t++,Ms(o[c]))for(;c<=i&&(Id(o[c+1])||r(o[c+1]));)c++;return{total:t}}function Xd(a,s={}){const{wordsPerMin:t=500}=s,n=a.total/t;return{seconds:parseFloat((n*60).toFixed(1))}}function Fd(a,s={}){const t=Ld(a,s);return{...Xd(t,s),words:t}}class Kd extends ne{constructor(t,n){super(t,n);x(this,"speakerDirective");x(this,"voiceDirective");x(this,"inlineList");x(this,"duration");x(this,"text");x(this,"tl");this.options=q({interval:.2,sequential:!0,effect:"typewriter",effectDuration:.5,alignWithVoice:!0},t),this.duration=0,this.text="";const{speaker:i,voice:r,lines:o,executeTime:c}=this.options;i!=null&&i.targetName&&(this.speakerDirective=new Ti({...i,executeTime:c},n)),r!=null&&r.targetName&&(this.voiceDirective=new Vi({...r,executeTime:c,sequential:!0},this.stage)),this.tl=he.timeline({paused:!0}),this.inlineList=[],o.forEach(l=>{if(l.type==="p")for(let p=0;p<l.children.length;p++){const h=l.children[p];if(h.type==="directive"){const{directive:u,params:f}=h.value,m=xi[u];if(m){const g=new m(f,n);this.inlineList.push({type:"directive",value:g,name:u})}}else if(h.text){let u=h.text;p===l.children.length-1&&(u+="\n"),this.inlineList.push({type:"text",value:u})}}})}check(){let t=!0;for(const n of this.inlineList)if(n.type==="directive"&&!n.value.check())throw t=!1,{type:"custom",message:"speak inline directive check failed",errorSceneName:this.stage.label,errorDirectiveName:n.name,errorLines:this.inlineList.filter(r=>r.type==="text").map(r=>r.value).join("").slice(0,10)};return t}async load(){this.voiceDirective&&await this.voiceDirective.load(),this.target&&(this.target.text="");for(const t of this.inlineList)if(t.type==="directive"){const n=t.value;await n.load(),this.tl.add(()=>{n.execute()},this.duration),this.duration+=n.getDuration()}else{const n=t.value,i=this.readingTime(n,this.options.wordsPerMin);this.textAnimate(n,i),this.duration+=i}}execute(){var t,n;this.target&&(this.target.visible=!0),this.tl.play(),(t=this.speakerDirective)==null||t.execute(),(n=this.voiceDirective)==null||n.execute()}textAnimate(t,n){const{effect:i}=this.options;switch(i){case"typewriter":this.typewriter(t,n);break;case"typewriteFadeIn":this.typewriteFadeIn(t,n);break;case"fadeIn":this.fadeIn(t,n);break;case"none":this.none(t);break}}typewriter(t,n){const i=this.text,r=i+t;this.tl.fromTo(this.target,{text:{value:i}},{text:{value:r},duration:n,ease:"none"},this.duration),this.text=r}typewriteFadeIn(t,n){const i=this.text,r=i+t,o=n/t.length;this.target.alpha=0;const c=[],l=this.target.style,p=Aa.measureText(r,l),h=p.lines;let u=this.target.y;h.forEach(f=>{let m=this.target.x;for(let g=0;g<f.length;g++){const v=f[g],b=new rn(v,l),V=Aa.measureText(v,l);b.x=m,b.y=u,b.alpha=c.length<i.length?1:0,b.zIndex=this.target.zIndex,m+=V.width,this.stage.addChild(b),c.push(b)}u+=p.lineHeight}),c.forEach((f,m)=>{m<i.length||this.tl.to(f,{alpha:1,duration:.3,onComplete:()=>{m===c.length-1&&c.forEach(g=>{this.stage.removeChild(g),this.target.text=r,this.target.alpha=1})}},this.duration+m*o)}),this.text=r}fadeIn(t,n){const{effectDuration:i}=this.options,r=this.text,o=r+t;this.tl.fromTo(this.target,{pixi:{alpha:0},text:{value:r}},{pixi:{alpha:1},text:{value:o},duration:Math.min(i!=null?i:.5,n),ease:"none"},this.duration),this.text=o}none(t){const i=this.text+t;this.tl.to(this.target,{pixi:{alpha:1},text:{value:i},duration:0,ease:"none"},this.duration),this.text=i}getDuration(){const{sequential:t,interval:n}=this.options;let i=this.duration;if(this.voiceDirective){const r=this.voiceDirective.getDuration();i=Math.max(i,r)}return i=i+(n!=null?n:0),t?i:0}readingTime(t,n=500){return t?Fd(t,{wordsPerMin:n}).seconds:0}}class zd extends ne{constructor(s,t){super(s,t),this.options=q({toVars:{pixi:{visible:!1},ease:"none",duration:0}},s)}}class Dd extends ne{constructor(s,t){super(s,t),this.options=q({toVars:{pixi:{alpha:0},ease:"power1.in",duration:.5}},s)}}class Yd extends ne{constructor(s,t){super(s,t),this.options={...s,immediate:!0}}async execute(){const{source:s,immediate:t}=this.options;this.target.changeSource(s),t?await this.target.load():he.to(this.target,{pixi:{alpha:0},duration:.3,onComplete:()=>{this.target.load().then(()=>{he.to(this.target,{pixi:{alpha:1},duration:.3})})}})}}class Md extends ne{constructor(s,t){super(s,t);const n=this.target;if(!n)return;const i=n.width?n.width*.05:0,r=n.x,o=r-i,c=r+i;this.options=q({toVars:{keyframes:{"0%":{x:r},"15%":{x:o},"30%":{x:c},"45%":{x:o},"60%":{x:c},"75%":{x:o},"90%":{x:c},"100%":{x:r}},duration:.5,ease:"none"}},s)}}class Hd extends ne{constructor(s,t){super(s,t);const n=this.target;if(!n)return;const i=n.height?n.height*.05:0,r=n.y,o=r-i,c=r+i;this.options=q({toVars:{keyframes:{"0%":{y:r},"15%":{y:o},"30%":{y:c},"45%":{y:o},"60%":{y:c},"75%":{y:o},"90%":{y:c},"100%":{y:r}},duration:.5,ease:"none"}},s)}}class Bd extends ne{constructor(s,t){super(s,t);const n=this.target;if(!n)return;const i=n.x,r=n.y;n.anchor.set(.5),n.x=i+n.width*n.anchor.x,n.y=r+n.height*n.anchor.y,this.options=q({toVars:{pixi:{scale:1.1},ease:"power1.in",duration:.5}},s)}}class Pd extends ne{constructor(s,t){super(s,t);const n=this.target;if(!n)return;const i=n.x,r=n.y;n.anchor.set(.5),n.x=i+n.width*n.anchor.x,n.y=r+n.height*n.anchor.y,this.options=q({toVars:{pixi:{scale:.9},ease:"power1.out",duration:.5}},s)}}class Ad extends ne{constructor(s,t){var i,r;super(s,t);const n=this.target;n&&(this.options=q({fromVars:{pixi:{x:n.x-n.width,alpha:0}},toVars:{pixi:{x:(i=n.x)!=null?i:0,alpha:(r=n.alpha)!=null?r:1},ease:"power1.in",duration:.5}},s))}}class Ud extends ne{constructor(s,t){super(s,t);const n=this.target;n&&(this.options=q({toVars:{pixi:{x:n.x-n.width,alpha:0},ease:"power1.in",duration:.5}},s))}}class Ed extends ne{constructor(s,t){var i,r;super(s,t);const n=this.target;n&&(this.options=q({fromVars:{pixi:{x:n.x+n.width,alpha:0}},toVars:{pixi:{x:(i=n.x)!=null?i:0,alpha:(r=n.alpha)!=null?r:1},ease:"power1.in",duration:.5}},s))}}class Od extends ne{constructor(s,t){super(s,t);const n=this.target;n&&(this.options=q({toVars:{pixi:{x:n.x+n.width,alpha:0},ease:"power1.in",duration:.5}},s))}}class Jd extends kt{constructor(s,t){super(s,t),this.options=q({sequential:!0},s)}execute(){}getDuration(){return this.options.duration}}class Qd extends ki{constructor(s,t){super(s,t),this.options=q({fromVars:{pixi:{alpha:0}},toVars:{pixi:{alpha:1},ease:"power1.in",duration:.3}},s)}}class _d extends ya{constructor(s,t){super(s,t),this.options=s}execute(){const{targetName:s,filterName:t}=this.options;s?this.target&&this.addFilter(this.target,t):this.addFilter(this.stage,t)}addFilter(s,t){const n=new ji[t];s.filters?s.filters.push(n):s.filters=[n]}}class $d extends ya{execute(){const{targetName:s}=this.options;s?this.target&&(this.target.filters=[]):this.stage.filters=[]}}he.registerPlugin(cn);he.registerPlugin(kd);cn.registerPIXI(qr);he.ticker.remove(he.updateRoot);var N=(a=>(a.ChangeSource="ChangeSource",a.Speak="Speak",a.Speaker="Speaker",a.Show="Show",a.Hide="Hide",a.FadeIn="FadeIn",a.FadeOut="FadeOut",a.ShakeX="ShakeX",a.ShakeY="ShakeY",a.ZoomIn="ZoomIn",a.ZoomOut="ZoomOut",a.EnterFromLeft="EnterFromLeft",a.LeaveFromLeft="LeaveFromLeft",a.EnterFromRight="EnterFromRight",a.LeaveFromRight="LeaveFromRight",a.Wait="Wait",a.Play="Play",a.Pause="Pause",a.Stop="Stop",a.FadeInTransition="FadeInTransition",a.AddFilter="AddFilter",a.RemoveFilter="RemoveFilter",a))(N||{});const vs=class vs{constructor(s){x(this,"ticker");x(this,"renderer");x(this,"rendererOptions");x(this,"started");x(this,"subtitles");x(this,"connecter");x(this,"cutResolver");var r;this.ticker=Fe.shared,this.ticker.ctx={},this.ticker.globalTime=0,this.ticker.asyncHandlers=[],this.ticker.autoStart=!1,this.ticker.stop(),this.rendererOptions=Object.assign({},vs.defaultRendererOptions,s),this.started=!1,this.subtitles=[];const{width:t,height:n,background:i}=this.rendererOptions;this.renderer=(r=this.rendererOptions.renderer)!=null?r:eo({view:new OffscreenCanvas(t,n),width:t,height:n,background:i})}connect(s){this.connecter=s,this.connecter.connect()}disconnect(){var s;(s=this.connecter)==null||s.disconnect(),this.connecter=void 0}hasStarted(){return this.started}async action(s){if(this.started)return;const t=performance.now();try{return await this.run(s)}catch(n){throw Xe.error("Error running screenplay:",n),n}finally{this.reset(),Xe.info("action cost:",performance.now()-t),this.cutResolver&&(this.cutResolver(!0),this.cutResolver=void 0)}}cut(){return new Promise(s=>{this.started=!1,this.cutResolver=s})}reset(){this.started=!1,this.subtitles=[],Ue.reset();let s=this.ticker._head.next;for(;s;)s=s.destroy(!0);this.ticker.time=0,this.ticker.globalTime=0,this.ticker.lastTime=-1,this.ticker.ctx={},this.ticker.asyncHandlers=[]}async parseSceneScript(s){const{scene:t}=s,{directives:n}=s;let i=0;const r=[];s.preload?await s.preload:await t.load(),t.children.forEach(h=>{h.visible=!1});const o=()=>{Xe.debug("switch scene exec:",this.ticker.time),he.updateRoot(0),Ue.resetExceptUtilEnd(),this.ticker.ctx.scene=t,r.forEach(u=>{this.ticker.add(u)});const h=()=>{const u=this.ticker.time;Ue.update(u,this.rendererOptions.fps);const f=async()=>{this.ticker.ctx.audioBuffers=await Ue.getAudioBuffers()};this.ticker.asyncHandlers.push(f()),he.updateRoot(u),this.ticker.ctx.scene&&(this.renderer.render(this.ticker.ctx.scene),this.ticker.ctx.imageSource=this.renderer.view)};return this.ticker.add(h),()=>{this.ticker.remove(h),this.ticker.time=0,this.ticker.lastTime=-1,this.ticker.ctx={},this.ticker.asyncHandlers=[]}};for(const h of n){const{directive:u,params:f}=h,m=xi[u];if(!m){Xe.error("Directive ".concat(u," not found"));continue}const g=i,v=new m({...f,executeTime:g},t);if(!v.check())throw{type:"custom",message:"directive check failed",errorSceneName:t.label,errorDirectiveName:u};v.load&&await v.load();const b=()=>{const{time:V,globalTime:W}=this.ticker;v.currentTime=V,gd(V,v.executeTime,1/this.rendererOptions.fps)&&(Xe.debug("execute directive:",v,V-v.executeTime),this.ticker.asyncHandlers.push(v.execute()),this.ticker.remove(b),u==="Speak"&&this.subtitles.push({start:W,end:W+v.getDuration(),text:v.options.text}))};r.push(b),i+=v.getDuration()}const{fps:c}=this.rendererOptions;return{frameCount:Math.ceil(i*c),install:o}}async run(s){var o,c;const{fps:t}=this.rendererOptions,{scenes:n}=s;let i=0;this.started=!0;for(const[l,p]of n.entries()){const h=await this.parseSceneScript(p),u=n[l+1];u&&(u.preload=u.scene.load());const f=h.install(),m=h.frameCount;for(let g=0;g<=m;g++){const v=g/t*1e3,b=i/t*1e3;if(this.started)this.ticker.time=v/1e3,this.ticker.update(v),this.ticker.globalTime=b/1e3,await Promise.all(this.ticker.asyncHandlers),(o=this.connecter)!=null&&o.connection&&await this.connecter.handle({timestamp:b,imageSource:this.ticker.ctx.imageSource,audioBuffers:this.ticker.ctx.audioBuffers}),this.rendererOptions.onProgress&&this.rendererOptions.onProgress((l/n.length+g/m/n.length)*100,b/1e3);else break;i++}f()}let r;return this.started&&((c=this.connecter)!=null&&c.connection)&&(r=await this.connecter.finish()),this.started=!1,{result:r,subtitles:this.subtitles}}};x(vs,"defaultRendererOptions",{fps:30,width:1920,height:1080,background:0});let Qs=vs;class Wi{constructor(s){x(this,"connection");x(this,"options");this.connection=!1,this.options=s}connect(){this.connection=!0}disconnect(){this.connection=!1}}const Ii="dmFyIGZpPU9iamVjdC5kZWZpbmVQcm9wZXJ0eTt2YXIgY2k9KFIsRCxOKT0+RCBpbiBSP2ZpKFIsRCx7ZW51bWVyYWJsZTohMCxjb25maWd1cmFibGU6ITAsd3JpdGFibGU6ITAsdmFsdWU6Tn0pOlJbRF09Tjt2YXIgaz0oUixELE4pPT4oY2koUix0eXBlb2YgRCE9InN5bWJvbCI/RCsiIjpELE4pLE4pOyhmdW5jdGlvbigpeyJ1c2Ugc3RyaWN0Ijt2YXIgUj1PYmplY3QuZGVmaW5lUHJvcGVydHksRD1PYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzLE49T2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eSx0dD1PYmplY3QucHJvdG90eXBlLnByb3BlcnR5SXNFbnVtZXJhYmxlLHo9TWF0aC5wb3csemU9KGUsdCxpKT0+dCBpbiBlP1IoZSx0LHtlbnVtZXJhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMCx3cml0YWJsZTohMCx2YWx1ZTppfSk6ZVt0XT1pLGl0PShlLHQpPT57Zm9yKHZhciBpIGluIHR8fCh0PXt9KSlOLmNhbGwodCxpKSYmemUoZSxpLHRbaV0pO2lmKEQpZm9yKHZhciBpIG9mIEQodCkpdHQuY2FsbCh0LGkpJiZ6ZShlLGksdFtpXSk7cmV0dXJuIGV9LHdlPShlLHQsaSk9PntpZighdC5oYXMoZSkpdGhyb3cgVHlwZUVycm9yKCJDYW5ub3QgIitpKX0sbj0oZSx0LGkpPT4od2UoZSx0LCJyZWFkIGZyb20gcHJpdmF0ZSBmaWVsZCIpLGk/aS5jYWxsKGUpOnQuZ2V0KGUpKSxoPShlLHQsaSk9PntpZih0LmhhcyhlKSl0aHJvdyBUeXBlRXJyb3IoIkNhbm5vdCBhZGQgdGhlIHNhbWUgcHJpdmF0ZSBtZW1iZXIgbW9yZSB0aGFuIG9uY2UiKTt0IGluc3RhbmNlb2YgV2Vha1NldD90LmFkZChlKTp0LnNldChlLGkpfSxiPShlLHQsaSxzKT0+KHdlKGUsdCwid3JpdGUgdG8gcHJpdmF0ZSBmaWVsZCIpLHM/cy5jYWxsKGUsaSk6dC5zZXQoZSxpKSxpKSxwPShlLHQsaSk9Pih3ZShlLHQsImFjY2VzcyBwcml2YXRlIG1ldGhvZCIpLGkpLHU9bmV3IFVpbnQ4QXJyYXkoOCksQj1uZXcgRGF0YVZpZXcodS5idWZmZXIpLEw9ZT0+WyhlJTI1NisyNTYpJTI1Nl0sZj1lPT4oQi5zZXRVaW50MTYoMCxlLCExKSxbdVswXSx1WzFdXSksbnQ9ZT0+KEIuc2V0SW50MTYoMCxlLCExKSxbdVswXSx1WzFdXSksQmU9ZT0+KEIuc2V0VWludDMyKDAsZSwhMSksW3VbMV0sdVsyXSx1WzNdXSksYT1lPT4oQi5zZXRVaW50MzIoMCxlLCExKSxbdVswXSx1WzFdLHVbMl0sdVszXV0pLHN0PWU9PihCLnNldFVpbnQzMigwLE1hdGguZmxvb3IoZS96KDIsMzIpKSwhMSksQi5zZXRVaW50MzIoNCxlLCExKSxbdVswXSx1WzFdLHVbMl0sdVszXSx1WzRdLHVbNV0sdVs2XSx1WzddXSksZ2U9ZT0+KEIuc2V0SW50MTYoMCx6KDIsOCkqZSwhMSksW3VbMF0sdVsxXV0pLFA9ZT0+KEIuc2V0SW50MzIoMCx6KDIsMTYpKmUsITEpLFt1WzBdLHVbMV0sdVsyXSx1WzNdXSksbWU9ZT0+KEIuc2V0SW50MzIoMCx6KDIsMzApKmUsITEpLFt1WzBdLHVbMV0sdVsyXSx1WzNdXSksVz0oZSx0PSExKT0+e2xldCBpPUFycmF5KGUubGVuZ3RoKS5maWxsKG51bGwpLm1hcCgocyxyKT0+ZS5jaGFyQ29kZUF0KHIpKTtyZXR1cm4gdCYmaS5wdXNoKDApLGl9LHg9ZT0+ZSYmZVtlLmxlbmd0aC0xXSxZPShlLHQsaT0hMCk9PntsZXQgcz1lKnQ7cmV0dXJuIGk/TWF0aC5yb3VuZChzKTpzfSxrZT1lPT57bGV0IHQ9ZSooTWF0aC5QSS8xODApLGk9TWF0aC5jb3ModCkscz1NYXRoLnNpbih0KTtyZXR1cm5baSxzLDAsLXMsaSwwLDAsMCwxXX0scnQ9a2UoMCksRmU9ZT0+W1AoZVswXSksUChlWzFdKSxtZShlWzJdKSxQKGVbM10pLFAoZVs0XSksbWUoZVs1XSksUChlWzZdKSxQKGVbN10pLG1lKGVbOF0pXSxtPShlLHQsaSk9Pih7dHlwZTplLGNvbnRlbnRzOnQmJm5ldyBVaW50OEFycmF5KHQuZmxhdCgxMCkpLGNoaWxkcmVuOml9KSx5PShlLHQsaSxzLHIpPT5tKGUsW0wodCksQmUoaSkscyE9bnVsbD9zOltdXSxyKSxhdD1lPT5lP20oImZ0eXAiLFtXKCJpc29tIiksYSgwKSxXKCJpc280IiksVygiaHZjMSIpXSk6bSgiZnR5cCIsW1coImlzb20iKSxhKDApLFcoImlzb20iKSxXKCJhdmMxIiksVygibXA0MSIpXSksb3Q9KCk9Pih7dHlwZToibWRhdCIsbGFyZ2VTaXplOiEwfSksbHQ9KGUsdCk9Pm0oIm1vb3YiLG51bGwsW2h0KHQsZSksLi4uZS5tYXAoaT0+dXQoaSx0KSldKSxodD0oZSx0KT0+e2xldCBpPVkoTWF0aC5tYXgoMCwuLi50LmZpbHRlcihyPT5yLnNhbXBsZXMubGVuZ3RoPjApLm1hcChyPT54KHIuc2FtcGxlcykudGltZXN0YW1wK3goci5zYW1wbGVzKS5kdXJhdGlvbikpLEVlKSxzPU1hdGgubWF4KC4uLnQubWFwKHI9PnIuaWQpKSsxO3JldHVybiB5KCJtdmhkIiwwLDAsW2EoZSksYShlKSxhKEVlKSxhKGkpLFAoMSksZ2UoMSksQXJyYXkoMTApLmZpbGwoMCksRmUocnQpLEFycmF5KDI0KS5maWxsKDApLGEocyldKX0sdXQ9KGUsdCk9Pm0oInRyYWsiLG51bGwsW2R0KGUsdCksZnQoZSx0KV0pLGR0PShlLHQpPT57bGV0IGk9eChlLnNhbXBsZXMpLHM9WShpP2kudGltZXN0YW1wK2kuZHVyYXRpb246MCxFZSk7cmV0dXJuIHkoInRraGQiLDAsMyxbYSh0KSxhKHQpLGEoZS5pZCksYSgwKSxhKHMpLEFycmF5KDgpLmZpbGwoMCksZigwKSxmKDApLGdlKGUuaW5mby50eXBlPT09ImF1ZGlvIj8xOjApLGYoMCksRmUoa2UoZS5pbmZvLnR5cGU9PT0idmlkZW8iP2UuaW5mby5yb3RhdGlvbjowKSksUChlLmluZm8udHlwZT09PSJ2aWRlbyI/ZS5pbmZvLndpZHRoOjApLFAoZS5pbmZvLnR5cGU9PT0idmlkZW8iP2UuaW5mby5oZWlnaHQ6MCldKX0sZnQ9KGUsdCk9Pm0oIm1kaWEiLG51bGwsW2N0KGUsdCksdnQoZS5pbmZvLnR5cGU9PT0idmlkZW8iPyJ2aWRlIjoic291biIpLHB0KGUpXSksY3Q9KGUsdCk9PntsZXQgaT14KGUuc2FtcGxlcykscz1ZKGk/aS50aW1lc3RhbXAraS5kdXJhdGlvbjowLGUudGltZXNjYWxlKTtyZXR1cm4geSgibWRoZCIsMCwwLFthKHQpLGEodCksYShlLnRpbWVzY2FsZSksYShzKSxmKDIxOTU2KSxmKDApXSl9LHZ0PWU9PnkoImhkbHIiLDAsMCxbVygibWhsciIpLFcoZSksYSgwKSxhKDApLGEoMCksVygibXA0LW11eGVyLWhkbHIiKV0pLHB0PWU9Pm0oIm1pbmYiLG51bGwsW2UuaW5mby50eXBlPT09InZpZGVvIj93dCgpOmd0KCksbXQoKSxfdChlKV0pLHd0PSgpPT55KCJ2bWhkIiwwLDEsW2YoMCksZigwKSxmKDApLGYoMCldKSxndD0oKT0+eSgic21oZCIsMCwwLFtmKDApLGYoMCldKSxtdD0oKT0+bSgiZGluZiIsbnVsbCxbeXQoKV0pLHl0PSgpPT55KCJkcmVmIiwwLDAsW2EoMSldLFtDdCgpXSksQ3Q9KCk9PnkoInVybCAiLDAsMSksX3Q9ZT0+bSgic3RibCIsbnVsbCxbVHQoZSksVXQoZSksRHQoZSksUHQoZSksV3QoZSksenQoZSldKSxUdD1lPT55KCJzdHNkIiwwLDAsW2EoMSldLFtlLmluZm8udHlwZT09PSJ2aWRlbyI/U3QoQnRbZS5pbmZvLmNvZGVjXSxlKTpMdChGdFtlLmluZm8uY29kZWNdLGUpXSksU3Q9KGUsdCk9Pm0oZSxbQXJyYXkoNikuZmlsbCgwKSxmKDEpLGYoMCksZigwKSxBcnJheSgxMikuZmlsbCgwKSxmKHQuaW5mby53aWR0aCksZih0LmluZm8uaGVpZ2h0KSxhKDQ3MTg1OTIpLGEoNDcxODU5MiksYSgwKSxmKDEpLEFycmF5KDMyKS5maWxsKDApLGYoMjQpLG50KDY1NTM1KV0sW2t0W3QuaW5mby5jb2RlY10odCldKSxFdD1lPT5lLmNvZGVjUHJpdmF0ZSYmbSgiYXZjQyIsWy4uLmUuY29kZWNQcml2YXRlXSksYnQ9ZT0+ZS5jb2RlY1ByaXZhdGUmJm0oImh2Y0MiLFsuLi5lLmNvZGVjUHJpdmF0ZV0pLEl0PWU9PmUuY29kZWNQcml2YXRlJiZtKCJ2cGNDIixbLi4uZS5jb2RlY1ByaXZhdGVdKSxBdD1lPT5lLmNvZGVjUHJpdmF0ZSYmbSgiYXYxQyIsWy4uLmUuY29kZWNQcml2YXRlXSksTHQ9KGUsdCk9Pm0oZSxbQXJyYXkoNikuZmlsbCgwKSxmKDEpLGYoMCksZigwKSxhKDApLGYodC5pbmZvLm51bWJlck9mQ2hhbm5lbHMpLGYoMTYpLGYoMCksZigwKSxQKHQuaW5mby5zYW1wbGVSYXRlKV0sW1J0W3QuaW5mby5jb2RlY10odCldKSxNdD1lPT55KCJlc2RzIiwwLDAsW2EoNTg3NTMxNTIpLEwoMzIrZS5jb2RlY1ByaXZhdGUuYnl0ZUxlbmd0aCksZigxKSxMKDApLGEoNzU1MzAzNjgpLEwoMTgrZS5jb2RlY1ByaXZhdGUuYnl0ZUxlbmd0aCksTCg2NCksTCgyMSksQmUoMCksYSgxMzAwNzEpLGEoMTMwMDcxKSxhKDkyMzA3NTg0KSxMKGUuY29kZWNQcml2YXRlLmJ5dGVMZW5ndGgpLC4uLmUuY29kZWNQcml2YXRlLGEoMTA5MDg0ODAwKSxMKDEpLEwoMildKSxPdD1lPT5tKCJkT3BzIixbTCgwKSxMKGUuaW5mby5udW1iZXJPZkNoYW5uZWxzKSxmKDM4NDApLGEoZS5pbmZvLnNhbXBsZVJhdGUpLGdlKDApLEwoMCldKSxVdD1lPT55KCJzdHRzIiwwLDAsW2EoZS50aW1lVG9TYW1wbGVUYWJsZS5sZW5ndGgpLGUudGltZVRvU2FtcGxlVGFibGUubWFwKHQ9PlthKHQuc2FtcGxlQ291bnQpLGEodC5zYW1wbGVEZWx0YSldKV0pLER0PWU9PntpZihlLnNhbXBsZXMuZXZlcnkoaT0+aS50eXBlPT09ImtleSIpKXJldHVybiBudWxsO2xldCB0PVsuLi5lLnNhbXBsZXMuZW50cmllcygpXS5maWx0ZXIoKFssaV0pPT5pLnR5cGU9PT0ia2V5Iik7cmV0dXJuIHkoInN0c3MiLDAsMCxbYSh0Lmxlbmd0aCksdC5tYXAoKFtpXSk9PmEoaSsxKSldKX0sUHQ9ZT0+eSgic3RzYyIsMCwwLFthKGUuY29tcGFjdGx5Q29kZWRDaHVua1RhYmxlLmxlbmd0aCksZS5jb21wYWN0bHlDb2RlZENodW5rVGFibGUubWFwKHQ9PlthKHQuZmlyc3RDaHVuayksYSh0LnNhbXBsZXNQZXJDaHVuayksYSgxKV0pXSksV3Q9ZT0+eSgic3RzeiIsMCwwLFthKDApLGEoZS5zYW1wbGVzLmxlbmd0aCksZS5zYW1wbGVzLm1hcCh0PT5hKHQuc2l6ZSkpXSksenQ9ZT0+ZS53cml0dGVuQ2h1bmtzLmxlbmd0aD4wJiZ4KGUud3JpdHRlbkNodW5rcykub2Zmc2V0Pj16KDIsMzIpP3koImNvNjQiLDAsMCxbYShlLndyaXR0ZW5DaHVua3MubGVuZ3RoKSxlLndyaXR0ZW5DaHVua3MubWFwKHQ9PnN0KHQub2Zmc2V0KSldKTp5KCJzdGNvIiwwLDAsW2EoZS53cml0dGVuQ2h1bmtzLmxlbmd0aCksZS53cml0dGVuQ2h1bmtzLm1hcCh0PT5hKHQub2Zmc2V0KSldKSxCdD17YXZjOiJhdmMxIixoZXZjOiJodmMxIix2cDk6InZwMDkiLGF2MToiYXYwMSJ9LGt0PXthdmM6RXQsaGV2YzpidCx2cDk6SXQsYXYxOkF0fSxGdD17YWFjOiJtcDRhIixvcHVzOiJvcHVzIn0sUnQ9e2FhYzpNdCxvcHVzOk90fSxSZT1jbGFzc3tjb25zdHJ1Y3Rvcigpe3RoaXMuYnVmZmVyPW51bGx9fSxOZT1jbGFzc3tjb25zdHJ1Y3RvcihlLHQsaSl7dGhpcy5vbkRhdGE9ZSx0aGlzLm9uRG9uZT10LHRoaXMub3B0aW9ucz1pfX0sTnQ9Y2xhc3N7Y29uc3RydWN0b3IoZSx0KXt0aGlzLnN0cmVhbT1lLHRoaXMub3B0aW9ucz10fX0sSCxLLHllPWNsYXNze2NvbnN0cnVjdG9yKCl7dGhpcy5wb3M9MCxoKHRoaXMsSCxuZXcgVWludDhBcnJheSg4KSksaCh0aGlzLEssbmV3IERhdGFWaWV3KG4odGhpcyxIKS5idWZmZXIpKSx0aGlzLm9mZnNldHM9bmV3IFdlYWtNYXB9c2VlayhlKXt0aGlzLnBvcz1lfXdyaXRlVTMyKGUpe24odGhpcyxLKS5zZXRVaW50MzIoMCxlLCExKSx0aGlzLndyaXRlKG4odGhpcyxIKS5zdWJhcnJheSgwLDQpKX13cml0ZVU2NChlKXtuKHRoaXMsSykuc2V0VWludDMyKDAsTWF0aC5mbG9vcihlL3ooMiwzMikpLCExKSxuKHRoaXMsSykuc2V0VWludDMyKDQsZSwhMSksdGhpcy53cml0ZShuKHRoaXMsSCkuc3ViYXJyYXkoMCw4KSl9d3JpdGVBc2NpaShlKXtmb3IobGV0IHQ9MDt0PGUubGVuZ3RoO3QrKyluKHRoaXMsSykuc2V0VWludDgodCU4LGUuY2hhckNvZGVBdCh0KSksdCU4PT09NyYmdGhpcy53cml0ZShuKHRoaXMsSCkpO2UubGVuZ3RoJTghPT0wJiZ0aGlzLndyaXRlKG4odGhpcyxIKS5zdWJhcnJheSgwLGUubGVuZ3RoJTgpKX13cml0ZUJveChlKXt2YXIgdCxpO2lmKHRoaXMub2Zmc2V0cy5zZXQoZSx0aGlzLnBvcyksZS5jb250ZW50cyYmIWUuY2hpbGRyZW4pdGhpcy53cml0ZUJveEhlYWRlcihlLCh0PWUuc2l6ZSkhPW51bGw/dDplLmNvbnRlbnRzLmJ5dGVMZW5ndGgrOCksdGhpcy53cml0ZShlLmNvbnRlbnRzKTtlbHNle2xldCBzPXRoaXMucG9zO2lmKHRoaXMud3JpdGVCb3hIZWFkZXIoZSwwKSxlLmNvbnRlbnRzJiZ0aGlzLndyaXRlKGUuY29udGVudHMpLGUuY2hpbGRyZW4pZm9yKGxldCBvIG9mIGUuY2hpbGRyZW4pbyYmdGhpcy53cml0ZUJveChvKTtsZXQgcj10aGlzLnBvcyxkPShpPWUuc2l6ZSkhPW51bGw/aTpyLXM7dGhpcy5zZWVrKHMpLHRoaXMud3JpdGVCb3hIZWFkZXIoZSxkKSx0aGlzLnNlZWsocil9fXdyaXRlQm94SGVhZGVyKGUsdCl7dGhpcy53cml0ZVUzMihlLmxhcmdlU2l6ZT8xOnQpLHRoaXMud3JpdGVBc2NpaShlLnR5cGUpLGUubGFyZ2VTaXplJiZ0aGlzLndyaXRlVTY0KHQpfXBhdGNoQm94KGUpe2xldCB0PXRoaXMucG9zO3RoaXMuc2Vlayh0aGlzLm9mZnNldHMuZ2V0KGUpKSx0aGlzLndyaXRlQm94KGUpLHRoaXMuc2Vlayh0KX19O0g9bmV3IFdlYWtNYXAsSz1uZXcgV2Vha01hcDt2YXIgc2UsVixKLHJlLENlLHh0PWNsYXNzIGV4dGVuZHMgeWV7Y29uc3RydWN0b3IoZSl7c3VwZXIoKSxoKHRoaXMscmUpLGgodGhpcyxzZSx2b2lkIDApLGgodGhpcyxWLG5ldyBBcnJheUJ1ZmZlcih6KDIsMTYpKSksaCh0aGlzLEosbmV3IFVpbnQ4QXJyYXkobih0aGlzLFYpKSksYih0aGlzLHNlLGUpfXdyaXRlKGUpe3AodGhpcyxyZSxDZSkuY2FsbCh0aGlzLHRoaXMucG9zK2UuYnl0ZUxlbmd0aCksbih0aGlzLEopLnNldChlLHRoaXMucG9zKSx0aGlzLnBvcys9ZS5ieXRlTGVuZ3RofWZpbmFsaXplKCl7cCh0aGlzLHJlLENlKS5jYWxsKHRoaXMsdGhpcy5wb3MpLG4odGhpcyxzZSkuYnVmZmVyPW4odGhpcyxWKS5zbGljZSgwLHRoaXMucG9zKX19O3NlPW5ldyBXZWFrTWFwLFY9bmV3IFdlYWtNYXAsSj1uZXcgV2Vha01hcCxyZT1uZXcgV2Vha1NldCxDZT1mdW5jdGlvbihlKXtsZXQgdD1uKHRoaXMsVikuYnl0ZUxlbmd0aDtmb3IoO3Q8ZTspdCo9MjtpZih0PT09bih0aGlzLFYpLmJ5dGVMZW5ndGgpcmV0dXJuO2xldCBpPW5ldyBBcnJheUJ1ZmZlcih0KSxzPW5ldyBVaW50OEFycmF5KGkpO3Muc2V0KG4odGhpcyxKKSwwKSxiKHRoaXMsVixpKSxiKHRoaXMsSixzKX07dmFyIFosJCx4ZT1jbGFzcyBleHRlbmRzIHlle2NvbnN0cnVjdG9yKGUpe3N1cGVyKCksaCh0aGlzLFosdm9pZCAwKSxoKHRoaXMsJCxbXSksYih0aGlzLFosZSl9d3JpdGUoZSl7bih0aGlzLCQpLnB1c2goe2RhdGE6ZS5zbGljZSgpLHN0YXJ0OnRoaXMucG9zfSksdGhpcy5wb3MrPWUuYnl0ZUxlbmd0aH1mbHVzaCgpe2lmKG4odGhpcywkKS5sZW5ndGg9PT0wKXJldHVybjtsZXQgZT1bXSx0PVsuLi5uKHRoaXMsJCldLnNvcnQoKGkscyk9Pmkuc3RhcnQtcy5zdGFydCk7ZS5wdXNoKHtzdGFydDp0WzBdLnN0YXJ0LHNpemU6dFswXS5kYXRhLmJ5dGVMZW5ndGh9KTtmb3IobGV0IGk9MTtpPHQubGVuZ3RoO2krKyl7bGV0IHM9ZVtlLmxlbmd0aC0xXSxyPXRbaV07ci5zdGFydDw9cy5zdGFydCtzLnNpemU/cy5zaXplPU1hdGgubWF4KHMuc2l6ZSxyLnN0YXJ0K3IuZGF0YS5ieXRlTGVuZ3RoLXMuc3RhcnQpOmUucHVzaCh7c3RhcnQ6ci5zdGFydCxzaXplOnIuZGF0YS5ieXRlTGVuZ3RofSl9Zm9yKGxldCBpIG9mIGUpe2kuZGF0YT1uZXcgVWludDhBcnJheShpLnNpemUpO2ZvcihsZXQgcyBvZiBuKHRoaXMsJCkpaS5zdGFydDw9cy5zdGFydCYmcy5zdGFydDxpLnN0YXJ0K2kuc2l6ZSYmaS5kYXRhLnNldChzLmRhdGEscy5zdGFydC1pLnN0YXJ0KTtuKHRoaXMsWikub25EYXRhKGkuZGF0YSxpLnN0YXJ0KX1uKHRoaXMsJCkubGVuZ3RoPTB9ZmluYWxpemUoKXt2YXIgZSx0Oyh0PShlPW4odGhpcyxaKSkub25Eb25lKT09bnVsbHx8dC5jYWxsKGUpfX07Wj1uZXcgV2Vha01hcCwkPW5ldyBXZWFrTWFwO3ZhciBIdD16KDIsMjQpLFZ0PTIsaixNLEksYWUsX2UsVGUsSGUsU2UsVmUsZWUsb2UsJGU9Y2xhc3MgZXh0ZW5kcyB5ZXtjb25zdHJ1Y3RvcihlKXt2YXIgdCxpO2lmKHN1cGVyKCksaCh0aGlzLGFlKSxoKHRoaXMsVGUpLGgodGhpcyxTZSksaCh0aGlzLGVlKSxoKHRoaXMsaix2b2lkIDApLGgodGhpcyxNLHZvaWQgMCksaCh0aGlzLEksW10pLGIodGhpcyxqLGUpLGIodGhpcyxNLChpPSh0PWUub3B0aW9ucyk9PW51bGw/dm9pZCAwOnQuY2h1bmtTaXplKSE9bnVsbD9pOkh0KSwhTnVtYmVyLmlzSW50ZWdlcihuKHRoaXMsTSkpfHxuKHRoaXMsTSk8eigyLDEwKSl0aHJvdyBuZXcgRXJyb3IoIkludmFsaWQgU3RyZWFtVGFyZ2V0IG9wdGlvbnM6IGNodW5rU2l6ZSBtdXN0IGJlIGFuIGludGVnZXIgbm90IHNtYWxsZXIgdGhhbiAxMDI0LiIpfXdyaXRlKGUpe3AodGhpcyxhZSxfZSkuY2FsbCh0aGlzLGUsdGhpcy5wb3MpLHAodGhpcyxlZSxvZSkuY2FsbCh0aGlzKSx0aGlzLnBvcys9ZS5ieXRlTGVuZ3RofWZpbmFsaXplKCl7dmFyIGUsdDtwKHRoaXMsZWUsb2UpLmNhbGwodGhpcywhMCksKHQ9KGU9bih0aGlzLGopKS5vbkRvbmUpPT1udWxsfHx0LmNhbGwoZSl9fTtqPW5ldyBXZWFrTWFwLE09bmV3IFdlYWtNYXAsST1uZXcgV2Vha01hcCxhZT1uZXcgV2Vha1NldCxfZT1mdW5jdGlvbihlLHQpe2xldCBpPW4odGhpcyxJKS5maW5kSW5kZXgoYz0+Yy5zdGFydDw9dCYmdDxjLnN0YXJ0K24odGhpcyxNKSk7aT09PS0xJiYoaT1wKHRoaXMsU2UsVmUpLmNhbGwodGhpcyx0KSk7bGV0IHM9bih0aGlzLEkpW2ldLHI9dC1zLnN0YXJ0LGQ9ZS5zdWJhcnJheSgwLE1hdGgubWluKG4odGhpcyxNKS1yLGUuYnl0ZUxlbmd0aCkpO3MuZGF0YS5zZXQoZCxyKTtsZXQgbz17c3RhcnQ6cixlbmQ6citkLmJ5dGVMZW5ndGh9O2lmKHAodGhpcyxUZSxIZSkuY2FsbCh0aGlzLHMsbykscy53cml0dGVuWzBdLnN0YXJ0PT09MCYmcy53cml0dGVuWzBdLmVuZD09PW4odGhpcyxNKSYmKHMuc2hvdWxkRmx1c2g9ITApLG4odGhpcyxJKS5sZW5ndGg+VnQpe2ZvcihsZXQgYz0wO2M8bih0aGlzLEkpLmxlbmd0aC0xO2MrKyluKHRoaXMsSSlbY10uc2hvdWxkRmx1c2g9ITA7cCh0aGlzLGVlLG9lKS5jYWxsKHRoaXMpfWQuYnl0ZUxlbmd0aDxlLmJ5dGVMZW5ndGgmJnAodGhpcyxhZSxfZSkuY2FsbCh0aGlzLGUuc3ViYXJyYXkoZC5ieXRlTGVuZ3RoKSx0K2QuYnl0ZUxlbmd0aCl9LFRlPW5ldyBXZWFrU2V0LEhlPWZ1bmN0aW9uKGUsdCl7bGV0IGk9MCxzPWUud3JpdHRlbi5sZW5ndGgtMSxyPS0xO2Zvcig7aTw9czspe2xldCBkPU1hdGguZmxvb3IoaSsocy1pKzEpLzIpO2Uud3JpdHRlbltkXS5zdGFydDw9dC5zdGFydD8oaT1kKzEscj1kKTpzPWQtMX1mb3IoZS53cml0dGVuLnNwbGljZShyKzEsMCx0KSwocj09PS0xfHxlLndyaXR0ZW5bcl0uZW5kPHQuc3RhcnQpJiZyKys7cjxlLndyaXR0ZW4ubGVuZ3RoLTEmJmUud3JpdHRlbltyXS5lbmQ+PWUud3JpdHRlbltyKzFdLnN0YXJ0OyllLndyaXR0ZW5bcl0uZW5kPU1hdGgubWF4KGUud3JpdHRlbltyXS5lbmQsZS53cml0dGVuW3IrMV0uZW5kKSxlLndyaXR0ZW4uc3BsaWNlKHIrMSwxKX0sU2U9bmV3IFdlYWtTZXQsVmU9ZnVuY3Rpb24oZSl7bGV0IGk9e3N0YXJ0Ok1hdGguZmxvb3IoZS9uKHRoaXMsTSkpKm4odGhpcyxNKSxkYXRhOm5ldyBVaW50OEFycmF5KG4odGhpcyxNKSksd3JpdHRlbjpbXSxzaG91bGRGbHVzaDohMX07cmV0dXJuIG4odGhpcyxJKS5wdXNoKGkpLG4odGhpcyxJKS5zb3J0KChzLHIpPT5zLnN0YXJ0LXIuc3RhcnQpLG4odGhpcyxJKS5pbmRleE9mKGkpfSxlZT1uZXcgV2Vha1NldCxvZT1mdW5jdGlvbihlPSExKXtmb3IobGV0IHQ9MDt0PG4odGhpcyxJKS5sZW5ndGg7dCsrKXtsZXQgaT1uKHRoaXMsSSlbdF07aWYoISghaS5zaG91bGRGbHVzaCYmIWUpKXtmb3IobGV0IHMgb2YgaS53cml0dGVuKW4odGhpcyxqKS5vbkRhdGEoaS5kYXRhLnN1YmFycmF5KHMuc3RhcnQscy5lbmQpLGkuc3RhcnQrcy5zdGFydCk7bih0aGlzLEkpLnNwbGljZSh0LS0sMSl9fX07dmFyICR0PWNsYXNzIGV4dGVuZHMgJGV7Y29uc3RydWN0b3IoZSl7dmFyIHQ7c3VwZXIobmV3IE5lKChpLHMpPT5lLnN0cmVhbS53cml0ZSh7dHlwZToid3JpdGUiLGRhdGE6aSxwb3NpdGlvbjpzfSksdm9pZCAwLHtjaHVua1NpemU6KHQ9ZS5vcHRpb25zKT09bnVsbD92b2lkIDA6dC5jaHVua1NpemV9KSl9fSxFZT0xZTMsR3Q9WyJhdmMiLCJoZXZjIiwidnA5IiwiYXYxIl0sWHQ9WyJhYWMiLCJvcHVzIl0scXQ9MjA4Mjg0NDgwMCxLdD0uNSxRdD1bInN0cmljdCIsIm9mZnNldCJdLGcsQyxHLFgscSxiZSxsZSxJZSxHZSxBZSxYZSxMZSxxZSxNZSxLZSxoZSxPZSxVZSxRZSx0ZSx1ZSxpZSxkZSxmZSxEZSxZdD1jbGFzc3tjb25zdHJ1Y3RvcihlKXtoKHRoaXMsSWUpLGgodGhpcyxBZSksaCh0aGlzLExlKSxoKHRoaXMsTWUpLGgodGhpcyxoZSksaCh0aGlzLFVlKSxoKHRoaXMsdGUpLGgodGhpcyxpZSksaCh0aGlzLGZlKSxoKHRoaXMsZyx2b2lkIDApLGgodGhpcyxDLHZvaWQgMCksaCh0aGlzLEcsdm9pZCAwKSxoKHRoaXMsWCxudWxsKSxoKHRoaXMscSxudWxsKSxoKHRoaXMsYmUsTWF0aC5mbG9vcihEYXRlLm5vdygpLzFlMykrcXQpLGgodGhpcyxsZSwhMSk7dmFyIHQ7aWYocCh0aGlzLEllLEdlKS5jYWxsKHRoaXMsZSksdGhpcy50YXJnZXQ9ZS50YXJnZXQsYih0aGlzLGcsaXQoe2ZpcnN0VGltZXN0YW1wQmVoYXZpb3I6InN0cmljdCJ9LGUpKSxlLnRhcmdldCBpbnN0YW5jZW9mIFJlKWIodGhpcyxDLG5ldyB4dChlLnRhcmdldCkpO2Vsc2UgaWYoZS50YXJnZXQgaW5zdGFuY2VvZiBOZSliKHRoaXMsQywodD1lLnRhcmdldC5vcHRpb25zKSE9bnVsbCYmdC5jaHVua2VkP25ldyAkZShlLnRhcmdldCk6bmV3IHhlKGUudGFyZ2V0KSk7ZWxzZSBpZihlLnRhcmdldCBpbnN0YW5jZW9mIE50KWIodGhpcyxDLG5ldyAkdChlLnRhcmdldCkpO2Vsc2UgdGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIHRhcmdldDogIi5jb25jYXQoZS50YXJnZXQpKTtwKHRoaXMsQWUsWGUpLmNhbGwodGhpcykscCh0aGlzLExlLHFlKS5jYWxsKHRoaXMpfWFkZFZpZGVvQ2h1bmsoZSx0LGkpe2xldCBzPW5ldyBVaW50OEFycmF5KGUuYnl0ZUxlbmd0aCk7ZS5jb3B5VG8ocyksdGhpcy5hZGRWaWRlb0NodW5rUmF3KHMsZS50eXBlLGkhPW51bGw/aTplLnRpbWVzdGFtcCxlLmR1cmF0aW9uLHQpfWFkZFZpZGVvQ2h1bmtSYXcoZSx0LGkscyxyKXtpZihwKHRoaXMsZmUsRGUpLmNhbGwodGhpcyksIW4odGhpcyxnKS52aWRlbyl0aHJvdyBuZXcgRXJyb3IoIk5vIHZpZGVvIHRyYWNrIGRlY2xhcmVkLiIpO3AodGhpcyxoZSxPZSkuY2FsbCh0aGlzLG4odGhpcyxYKSxlLHQsaSxzLHIpfWFkZEF1ZGlvQ2h1bmsoZSx0LGkpe2xldCBzPW5ldyBVaW50OEFycmF5KGUuYnl0ZUxlbmd0aCk7ZS5jb3B5VG8ocyksdGhpcy5hZGRBdWRpb0NodW5rUmF3KHMsZS50eXBlLGkhPW51bGw/aTplLnRpbWVzdGFtcCxlLmR1cmF0aW9uLHQpfWFkZEF1ZGlvQ2h1bmtSYXcoZSx0LGkscyxyKXtpZihwKHRoaXMsZmUsRGUpLmNhbGwodGhpcyksIW4odGhpcyxnKS5hdWRpbyl0aHJvdyBuZXcgRXJyb3IoIk5vIGF1ZGlvIHRyYWNrIGRlY2xhcmVkLiIpO3AodGhpcyxoZSxPZSkuY2FsbCh0aGlzLG4odGhpcyxxKSxlLHQsaSxzLHIpfWZpbmFsaXplKCl7bih0aGlzLFgpJiZwKHRoaXMsdGUsdWUpLmNhbGwodGhpcyxuKHRoaXMsWCkpLG4odGhpcyxxKSYmcCh0aGlzLHRlLHVlKS5jYWxsKHRoaXMsbih0aGlzLHEpKTtsZXQgZT1uKHRoaXMsQykub2Zmc2V0cy5nZXQobih0aGlzLEcpKSx0PW4odGhpcyxDKS5wb3MtZTtuKHRoaXMsRykuc2l6ZT10LG4odGhpcyxDKS5wYXRjaEJveChuKHRoaXMsRykpO2xldCBpPWx0KFtuKHRoaXMsWCksbih0aGlzLHEpXS5maWx0ZXIoQm9vbGVhbiksbih0aGlzLGJlKSk7bih0aGlzLEMpLndyaXRlQm94KGkpLHAodGhpcyxpZSxkZSkuY2FsbCh0aGlzKSxuKHRoaXMsQykuZmluYWxpemUoKSxiKHRoaXMsbGUsITApfX07Zz1uZXcgV2Vha01hcCxDPW5ldyBXZWFrTWFwLEc9bmV3IFdlYWtNYXAsWD1uZXcgV2Vha01hcCxxPW5ldyBXZWFrTWFwLGJlPW5ldyBXZWFrTWFwLGxlPW5ldyBXZWFrTWFwLEllPW5ldyBXZWFrU2V0LEdlPWZ1bmN0aW9uKGUpe2lmKGUudmlkZW8pe2lmKCFHdC5pbmNsdWRlcyhlLnZpZGVvLmNvZGVjKSl0aHJvdyBuZXcgRXJyb3IoIlVuc3VwcG9ydGVkIHZpZGVvIGNvZGVjOiAiLmNvbmNhdChlLnZpZGVvLmNvZGVjKSk7aWYoZS52aWRlby5yb3RhdGlvbiE9PXZvaWQgMCYmIVswLDkwLDE4MCwyNzBdLmluY2x1ZGVzKGUudmlkZW8ucm90YXRpb24pKXRocm93IG5ldyBFcnJvcigiSW52YWxpZCB2aWRlbyByb3RhdGlvbjogIi5jb25jYXQoZS52aWRlby5yb3RhdGlvbiwiLiBIYXMgdG8gYmUgMCwgOTAsIDE4MCBvciAyNzAuIikpfWlmKGUuYXVkaW8mJiFYdC5pbmNsdWRlcyhlLmF1ZGlvLmNvZGVjKSl0aHJvdyBuZXcgRXJyb3IoIlVuc3VwcG9ydGVkIGF1ZGlvIGNvZGVjOiAiLmNvbmNhdChlLmF1ZGlvLmNvZGVjKSk7aWYoZS5maXJzdFRpbWVzdGFtcEJlaGF2aW9yJiYhUXQuaW5jbHVkZXMoZS5maXJzdFRpbWVzdGFtcEJlaGF2aW9yKSl0aHJvdyBuZXcgRXJyb3IoIkludmFsaWQgZmlyc3QgdGltZXN0YW1wIGJlaGF2aW9yOiAiLmNvbmNhdChlLmZpcnN0VGltZXN0YW1wQmVoYXZpb3IpKX0sQWU9bmV3IFdlYWtTZXQsWGU9ZnVuY3Rpb24oKXt2YXIgZTtsZXQgdD0oKGU9bih0aGlzLGcpLnZpZGVvKT09bnVsbD92b2lkIDA6ZS5jb2RlYyk9PT0iaGV2YyI7bih0aGlzLEMpLndyaXRlQm94KGF0KHQpKSxiKHRoaXMsRyxvdCgpKSxuKHRoaXMsQykud3JpdGVCb3gobih0aGlzLEcpKSxwKHRoaXMsaWUsZGUpLmNhbGwodGhpcyl9LExlPW5ldyBXZWFrU2V0LHFlPWZ1bmN0aW9uKCl7dmFyIGU7aWYobih0aGlzLGcpLnZpZGVvJiZiKHRoaXMsWCx7aWQ6MSxpbmZvOnt0eXBlOiJ2aWRlbyIsY29kZWM6bih0aGlzLGcpLnZpZGVvLmNvZGVjLHdpZHRoOm4odGhpcyxnKS52aWRlby53aWR0aCxoZWlnaHQ6bih0aGlzLGcpLnZpZGVvLmhlaWdodCxyb3RhdGlvbjooZT1uKHRoaXMsZykudmlkZW8ucm90YXRpb24pIT1udWxsP2U6MH0sdGltZXNjYWxlOjcyMCxjb2RlY1ByaXZhdGU6bmV3IFVpbnQ4QXJyYXkoMCksc2FtcGxlczpbXSx3cml0dGVuQ2h1bmtzOltdLGN1cnJlbnRDaHVuazpudWxsLGZpcnN0VGltZXN0YW1wOnZvaWQgMCxsYXN0VGltZXN0YW1wOi0xLHRpbWVUb1NhbXBsZVRhYmxlOltdLGxhc3RUaW1lc2NhbGVVbml0czpudWxsLGNvbXBhY3RseUNvZGVkQ2h1bmtUYWJsZTpbXX0pLG4odGhpcyxnKS5hdWRpbyl7bGV0IHQ9cCh0aGlzLE1lLEtlKS5jYWxsKHRoaXMsMixuKHRoaXMsZykuYXVkaW8uc2FtcGxlUmF0ZSxuKHRoaXMsZykuYXVkaW8ubnVtYmVyT2ZDaGFubmVscyk7Yih0aGlzLHEse2lkOm4odGhpcyxnKS52aWRlbz8yOjEsaW5mbzp7dHlwZToiYXVkaW8iLGNvZGVjOm4odGhpcyxnKS5hdWRpby5jb2RlYyxudW1iZXJPZkNoYW5uZWxzOm4odGhpcyxnKS5hdWRpby5udW1iZXJPZkNoYW5uZWxzLHNhbXBsZVJhdGU6bih0aGlzLGcpLmF1ZGlvLnNhbXBsZVJhdGV9LHRpbWVzY2FsZTpuKHRoaXMsZykuYXVkaW8uc2FtcGxlUmF0ZSxjb2RlY1ByaXZhdGU6dCxzYW1wbGVzOltdLHdyaXR0ZW5DaHVua3M6W10sY3VycmVudENodW5rOm51bGwsZmlyc3RUaW1lc3RhbXA6dm9pZCAwLGxhc3RUaW1lc3RhbXA6LTEsdGltZVRvU2FtcGxlVGFibGU6W10sbGFzdFRpbWVzY2FsZVVuaXRzOm51bGwsY29tcGFjdGx5Q29kZWRDaHVua1RhYmxlOltdfSl9fSxNZT1uZXcgV2Vha1NldCxLZT1mdW5jdGlvbihlLHQsaSl7bGV0IHI9Wzk2ZTMsODgyMDAsNjRlMyw0OGUzLDQ0MTAwLDMyZTMsMjRlMywyMjA1MCwxNmUzLDEyZTMsMTEwMjUsOGUzLDczNTBdLmluZGV4T2YodCksZD1pLG89IiI7bys9ZS50b1N0cmluZygyKS5wYWRTdGFydCg1LCIwIiksbys9ci50b1N0cmluZygyKS5wYWRTdGFydCg0LCIwIikscj09PTE1JiYobys9dC50b1N0cmluZygyKS5wYWRTdGFydCgyNCwiMCIpKSxvKz1kLnRvU3RyaW5nKDIpLnBhZFN0YXJ0KDQsIjAiKTtsZXQgYz1NYXRoLmNlaWwoby5sZW5ndGgvOCkqODtvPW8ucGFkRW5kKGMsIjAiKTtsZXQgQT1uZXcgVWludDhBcnJheShvLmxlbmd0aC84KTtmb3IobGV0IEU9MDtFPG8ubGVuZ3RoO0UrPTgpQVtFLzhdPXBhcnNlSW50KG8uc2xpY2UoRSxFKzgpLDIpO3JldHVybiBBfSxoZT1uZXcgV2Vha1NldCxPZT1mdW5jdGlvbihlLHQsaSxzLHIsZCl7dmFyIG87bGV0IGM9cy8xZTYsQT1yLzFlNjtpZihlLmZpcnN0VGltZXN0YW1wPT09dm9pZCAwJiYoZS5maXJzdFRpbWVzdGFtcD1jKSxjPXAodGhpcyxVZSxRZSkuY2FsbCh0aGlzLGMsZSksZS5sYXN0VGltZXN0YW1wPWMsKCFlLmN1cnJlbnRDaHVua3x8Yy1lLmN1cnJlbnRDaHVuay5zdGFydFRpbWVzdGFtcD49S3QpJiYoZS5jdXJyZW50Q2h1bmsmJnAodGhpcyx0ZSx1ZSkuY2FsbCh0aGlzLGUpLGUuY3VycmVudENodW5rPXtzdGFydFRpbWVzdGFtcDpjLHNhbXBsZURhdGE6W10sc2FtcGxlQ291bnQ6MH0pLGUuY3VycmVudENodW5rLnNhbXBsZURhdGEucHVzaCh0KSxlLmN1cnJlbnRDaHVuay5zYW1wbGVDb3VudCsrLChvPWQ9PW51bGw/dm9pZCAwOmQuZGVjb2RlckNvbmZpZykhPW51bGwmJm8uZGVzY3JpcHRpb24mJihlLmNvZGVjUHJpdmF0ZT1uZXcgVWludDhBcnJheShkLmRlY29kZXJDb25maWcuZGVzY3JpcHRpb24pKSxlLnNhbXBsZXMucHVzaCh7dGltZXN0YW1wOmMsZHVyYXRpb246QSxzaXplOnQuYnl0ZUxlbmd0aCx0eXBlOml9KSxlLmxhc3RUaW1lc2NhbGVVbml0cyE9PW51bGwpe2xldCBFPVkoYyxlLnRpbWVzY2FsZSwhMSksXz1NYXRoLnJvdW5kKEUtZS5sYXN0VGltZXNjYWxlVW5pdHMpO2UubGFzdFRpbWVzY2FsZVVuaXRzKz1fO2xldCBPPXgoZS50aW1lVG9TYW1wbGVUYWJsZSk7Ty5zYW1wbGVDb3VudD09PTE/KE8uc2FtcGxlRGVsdGE9XyxPLnNhbXBsZUNvdW50KyspOk8uc2FtcGxlRGVsdGE9PT1fP08uc2FtcGxlQ291bnQrKzooTy5zYW1wbGVDb3VudC0tLGUudGltZVRvU2FtcGxlVGFibGUucHVzaCh7c2FtcGxlQ291bnQ6MixzYW1wbGVEZWx0YTpffSkpfWVsc2UgZS5sYXN0VGltZXNjYWxlVW5pdHM9MCxlLnRpbWVUb1NhbXBsZVRhYmxlLnB1c2goe3NhbXBsZUNvdW50OjEsc2FtcGxlRGVsdGE6WShBLGUudGltZXNjYWxlKX0pfSxVZT1uZXcgV2Vha1NldCxRZT1mdW5jdGlvbihlLHQpe2lmKG4odGhpcyxnKS5maXJzdFRpbWVzdGFtcEJlaGF2aW9yPT09InN0cmljdCImJnQubGFzdFRpbWVzdGFtcD09PS0xJiZlIT09MCl0aHJvdyBuZXcgRXJyb3IoIlRoZSBmaXJzdCBjaHVuayBmb3IgeW91ciBtZWRpYSB0cmFjayBtdXN0IGhhdmUgYSB0aW1lc3RhbXAgb2YgMCAocmVjZWl2ZWQgIi5jb25jYXQoZSwiKS4gTm9uLXplcm8gZmlyc3QgdGltZXN0YW1wcyBhcmUgb2Z0ZW4gY2F1c2VkIGJ5IGRpcmVjdGx5IHBpcGluZyBmcmFtZXMgb3IgYXVkaW8gZGF0YSBmcm9tIGEgTWVkaWFTdHJlYW1UcmFjayBpbnRvIHRoZSBlbmNvZGVyLiBUaGVpciB0aW1lc3RhbXBzIGFyZSB0eXBpY2FsbHkgcmVsYXRpdmUgdG8gdGhlIGFnZSBvZiB0aGUgZG9jdW1lbnQsIHdoaWNoIGlzIHByb2JhYmx5IHdoYXQgeW91IHdhbnQuXG5cbklmIHlvdSB3YW50IHRvIG9mZnNldCBhbGwgdGltZXN0YW1wcyBvZiBhIHRyYWNrIHN1Y2ggdGhhdCB0aGUgZmlyc3Qgb25lIGlzIHplcm8sIHNldCBmaXJzdFRpbWVzdGFtcEJlaGF2aW9yOiAnb2Zmc2V0JyBpbiB0aGUgb3B0aW9ucy5cbiIpKTtpZihuKHRoaXMsZykuZmlyc3RUaW1lc3RhbXBCZWhhdmlvcj09PSJvZmZzZXQiJiYoZS09dC5maXJzdFRpbWVzdGFtcCksZTx0Lmxhc3RUaW1lc3RhbXApdGhyb3cgbmV3IEVycm9yKCJUaW1lc3RhbXBzIG11c3QgYmUgbW9ub3RvbmljYWxseSBpbmNyZWFzaW5nICh3ZW50IGZyb20gIi5jb25jYXQodC5sYXN0VGltZXN0YW1wKjFlNiwiIHRvICIpLmNvbmNhdChlKjFlNiwiKS4iKSk7cmV0dXJuIGV9LHRlPW5ldyBXZWFrU2V0LHVlPWZ1bmN0aW9uKGUpe2lmKGUuY3VycmVudENodW5rKXtlLmN1cnJlbnRDaHVuay5vZmZzZXQ9bih0aGlzLEMpLnBvcztmb3IobGV0IHQgb2YgZS5jdXJyZW50Q2h1bmsuc2FtcGxlRGF0YSluKHRoaXMsQykud3JpdGUodCk7ZS5jdXJyZW50Q2h1bmsuc2FtcGxlRGF0YT1udWxsLChlLmNvbXBhY3RseUNvZGVkQ2h1bmtUYWJsZS5sZW5ndGg9PT0wfHx4KGUuY29tcGFjdGx5Q29kZWRDaHVua1RhYmxlKS5zYW1wbGVzUGVyQ2h1bmshPT1lLmN1cnJlbnRDaHVuay5zYW1wbGVDb3VudCkmJmUuY29tcGFjdGx5Q29kZWRDaHVua1RhYmxlLnB1c2goe2ZpcnN0Q2h1bms6ZS53cml0dGVuQ2h1bmtzLmxlbmd0aCsxLHNhbXBsZXNQZXJDaHVuazplLmN1cnJlbnRDaHVuay5zYW1wbGVDb3VudH0pLGUud3JpdHRlbkNodW5rcy5wdXNoKGUuY3VycmVudENodW5rKSxwKHRoaXMsaWUsZGUpLmNhbGwodGhpcyl9fSxpZT1uZXcgV2Vha1NldCxkZT1mdW5jdGlvbigpe24odGhpcyxDKWluc3RhbmNlb2YgeGUmJm4odGhpcyxDKS5mbHVzaCgpfSxmZT1uZXcgV2Vha1NldCxEZT1mdW5jdGlvbigpe2lmKG4odGhpcyxsZSkpdGhyb3cgbmV3IEVycm9yKCJDYW5ub3QgYWRkIG5ldyB2aWRlbyBvciBhdWRpbyBjaHVua3MgYWZ0ZXIgdGhlIGZpbGUgaGFzIGJlZW4gZmluYWxpemVkLiIpfTt2YXIgSnQ9dHlwZW9mIGdsb2JhbFRoaXM8InUiP2dsb2JhbFRoaXM6dHlwZW9mIHdpbmRvdzwidSI/d2luZG93OnR5cGVvZiBnbG9iYWw8InUiP2dsb2JhbDp0eXBlb2Ygc2VsZjwidSI/c2VsZjp7fTtmdW5jdGlvbiBadChlKXtyZXR1cm4gZSYmZS5fX2VzTW9kdWxlJiZPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwiZGVmYXVsdCIpP2UuZGVmYXVsdDplfXZhciBZZT17ZXhwb3J0czp7fX07KGZ1bmN0aW9uKGUpeyhmdW5jdGlvbih0LGkpe2UuZXhwb3J0cz9lLmV4cG9ydHM9aSgpOnQubG9nPWkoKX0pKEp0LGZ1bmN0aW9uKCl7dmFyIHQ9ZnVuY3Rpb24oKXt9LGk9InVuZGVmaW5lZCIscz10eXBlb2Ygd2luZG93IT09aSYmdHlwZW9mIHdpbmRvdy5uYXZpZ2F0b3IhPT1pJiYvVHJpZGVudFwvfE1TSUUgLy50ZXN0KHdpbmRvdy5uYXZpZ2F0b3IudXNlckFnZW50KSxyPVsidHJhY2UiLCJkZWJ1ZyIsImluZm8iLCJ3YXJuIiwiZXJyb3IiXSxkPXt9LG89bnVsbDtmdW5jdGlvbiBjKHYsVCl7dmFyIGw9dltUXTtpZih0eXBlb2YgbC5iaW5kPT0iZnVuY3Rpb24iKXJldHVybiBsLmJpbmQodik7dHJ5e3JldHVybiBGdW5jdGlvbi5wcm90b3R5cGUuYmluZC5jYWxsKGwsdil9Y2F0Y2godmUpe3JldHVybiBmdW5jdGlvbigpe3JldHVybiBGdW5jdGlvbi5wcm90b3R5cGUuYXBwbHkuYXBwbHkobCxbdixhcmd1bWVudHNdKX19fWZ1bmN0aW9uIEEoKXtjb25zb2xlLmxvZyYmKGNvbnNvbGUubG9nLmFwcGx5P2NvbnNvbGUubG9nLmFwcGx5KGNvbnNvbGUsYXJndW1lbnRzKTpGdW5jdGlvbi5wcm90b3R5cGUuYXBwbHkuYXBwbHkoY29uc29sZS5sb2csW2NvbnNvbGUsYXJndW1lbnRzXSkpLGNvbnNvbGUudHJhY2UmJmNvbnNvbGUudHJhY2UoKX1mdW5jdGlvbiBFKHYpe3JldHVybiB2PT09ImRlYnVnIiYmKHY9ImxvZyIpLHR5cGVvZiBjb25zb2xlPT09aT8hMTp2PT09InRyYWNlIiYmcz9BOmNvbnNvbGVbdl0hPT12b2lkIDA/Yyhjb25zb2xlLHYpOmNvbnNvbGUubG9nIT09dm9pZCAwP2MoY29uc29sZSwibG9nIik6dH1mdW5jdGlvbiBfKCl7Zm9yKHZhciB2PXRoaXMuZ2V0TGV2ZWwoKSxUPTA7VDxyLmxlbmd0aDtUKyspe3ZhciBsPXJbVF07dGhpc1tsXT1UPHY/dDp0aGlzLm1ldGhvZEZhY3RvcnkobCx2LHRoaXMubmFtZSl9aWYodGhpcy5sb2c9dGhpcy5kZWJ1Zyx0eXBlb2YgY29uc29sZT09PWkmJnY8dGhpcy5sZXZlbHMuU0lMRU5UKXJldHVybiJObyBjb25zb2xlIGF2YWlsYWJsZSBmb3IgbG9nZ2luZyJ9ZnVuY3Rpb24gTyh2KXtyZXR1cm4gZnVuY3Rpb24oKXt0eXBlb2YgY29uc29sZSE9PWkmJihfLmNhbGwodGhpcyksdGhpc1t2XS5hcHBseSh0aGlzLGFyZ3VtZW50cykpfX1mdW5jdGlvbiBvaSh2LFQsbCl7cmV0dXJuIEUodil8fE8uYXBwbHkodGhpcyxhcmd1bWVudHMpfWZ1bmN0aW9uIEplKHYsVCl7dmFyIGw9dGhpcyx2ZSxXZSxRLFU9ImxvZ2xldmVsIjt0eXBlb2Ygdj09InN0cmluZyI/VSs9IjoiK3Y6dHlwZW9mIHY9PSJzeW1ib2wiJiYoVT12b2lkIDApO2Z1bmN0aW9uIGhpKHcpe3ZhciBTPShyW3ddfHwic2lsZW50IikudG9VcHBlckNhc2UoKTtpZighKHR5cGVvZiB3aW5kb3c9PT1pfHwhVSkpe3RyeXt3aW5kb3cubG9jYWxTdG9yYWdlW1VdPVM7cmV0dXJufWNhdGNoKHBlKXt9dHJ5e3dpbmRvdy5kb2N1bWVudC5jb29raWU9ZW5jb2RlVVJJQ29tcG9uZW50KFUpKyI9IitTKyI7In1jYXRjaChwZSl7fX19ZnVuY3Rpb24gWmUoKXt2YXIgdztpZighKHR5cGVvZiB3aW5kb3c9PT1pfHwhVSkpe3RyeXt3PXdpbmRvdy5sb2NhbFN0b3JhZ2VbVV19Y2F0Y2goZGkpe31pZih0eXBlb2Ygdz09PWkpdHJ5e3ZhciBTPXdpbmRvdy5kb2N1bWVudC5jb29raWUscGU9ZW5jb2RlVVJJQ29tcG9uZW50KFUpLGV0PVMuaW5kZXhPZihwZSsiPSIpO2V0IT09LTEmJih3PS9eKFteO10rKS8uZXhlYyhTLnNsaWNlKGV0K3BlLmxlbmd0aCsxKSlbMV0pfWNhdGNoKGRpKXt9cmV0dXJuIGwubGV2ZWxzW3ddPT09dm9pZCAwJiYodz12b2lkIDApLHd9fWZ1bmN0aW9uIHVpKCl7aWYoISh0eXBlb2Ygd2luZG93PT09aXx8IVUpKXt0cnl7d2luZG93LmxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKFUpfWNhdGNoKHcpe310cnl7d2luZG93LmRvY3VtZW50LmNvb2tpZT1lbmNvZGVVUklDb21wb25lbnQoVSkrIj07IGV4cGlyZXM9VGh1LCAwMSBKYW4gMTk3MCAwMDowMDowMCBVVEMifWNhdGNoKHcpe319fWZ1bmN0aW9uIG5lKHcpe3ZhciBTPXc7aWYodHlwZW9mIFM9PSJzdHJpbmciJiZsLmxldmVsc1tTLnRvVXBwZXJDYXNlKCldIT09dm9pZCAwJiYoUz1sLmxldmVsc1tTLnRvVXBwZXJDYXNlKCldKSx0eXBlb2YgUz09Im51bWJlciImJlM+PTAmJlM8PWwubGV2ZWxzLlNJTEVOVClyZXR1cm4gUzt0aHJvdyBuZXcgVHlwZUVycm9yKCJsb2cuc2V0TGV2ZWwoKSBjYWxsZWQgd2l0aCBpbnZhbGlkIGxldmVsOiAiK3cpfWwubmFtZT12LGwubGV2ZWxzPXtUUkFDRTowLERFQlVHOjEsSU5GTzoyLFdBUk46MyxFUlJPUjo0LFNJTEVOVDo1fSxsLm1ldGhvZEZhY3Rvcnk9VHx8b2ksbC5nZXRMZXZlbD1mdW5jdGlvbigpe3JldHVybiBRIT1udWxsP1E6V2UhPW51bGw/V2U6dmV9LGwuc2V0TGV2ZWw9ZnVuY3Rpb24odyxTKXtyZXR1cm4gUT1uZSh3KSxTIT09ITEmJmhpKFEpLF8uY2FsbChsKX0sbC5zZXREZWZhdWx0TGV2ZWw9ZnVuY3Rpb24odyl7V2U9bmUodyksWmUoKXx8bC5zZXRMZXZlbCh3LCExKX0sbC5yZXNldExldmVsPWZ1bmN0aW9uKCl7UT1udWxsLHVpKCksXy5jYWxsKGwpfSxsLmVuYWJsZUFsbD1mdW5jdGlvbih3KXtsLnNldExldmVsKGwubGV2ZWxzLlRSQUNFLHcpfSxsLmRpc2FibGVBbGw9ZnVuY3Rpb24odyl7bC5zZXRMZXZlbChsLmxldmVscy5TSUxFTlQsdyl9LGwucmVidWlsZD1mdW5jdGlvbigpe2lmKG8hPT1sJiYodmU9bmUoby5nZXRMZXZlbCgpKSksXy5jYWxsKGwpLG89PT1sKWZvcih2YXIgdyBpbiBkKWRbd10ucmVidWlsZCgpfSx2ZT1uZShvP28uZ2V0TGV2ZWwoKToiV0FSTiIpO3ZhciBqZT1aZSgpO2plIT1udWxsJiYoUT1uZShqZSkpLF8uY2FsbChsKX1vPW5ldyBKZSxvLmdldExvZ2dlcj1mdW5jdGlvbihUKXtpZih0eXBlb2YgVCE9InN5bWJvbCImJnR5cGVvZiBUIT0ic3RyaW5nInx8VD09PSIiKXRocm93IG5ldyBUeXBlRXJyb3IoIllvdSBtdXN0IHN1cHBseSBhIG5hbWUgd2hlbiBjcmVhdGluZyBhIGxvZ2dlci4iKTt2YXIgbD1kW1RdO3JldHVybiBsfHwobD1kW1RdPW5ldyBKZShULG8ubWV0aG9kRmFjdG9yeSkpLGx9O3ZhciBsaT10eXBlb2Ygd2luZG93IT09aT93aW5kb3cubG9nOnZvaWQgMDtyZXR1cm4gby5ub0NvbmZsaWN0PWZ1bmN0aW9uKCl7cmV0dXJuIHR5cGVvZiB3aW5kb3chPT1pJiZ3aW5kb3cubG9nPT09byYmKHdpbmRvdy5sb2c9bGkpLG99LG8uZ2V0TG9nZ2Vycz1mdW5jdGlvbigpe3JldHVybiBkfSxvLmRlZmF1bHQ9byxvfSl9KShZZSk7dmFyIGp0PVllLmV4cG9ydHMsY2U9WnQoanQpO2NlLnNldExldmVsKCJFUlJPUiIpO2Z1bmN0aW9uIGVpKGUpe3JldHVybiBuZXcgUHJvbWlzZSh0PT57Y29uc3QgaT0oKT0+e2UoKT90KCk6cmVxdWVzdEFuaW1hdGlvbkZyYW1lKGkpfTtpKCl9KX1jbGFzcyB0aXtjb25zdHJ1Y3Rvcih0KXtrKHRoaXMsImNvbm5lY3Rpb24iKTtrKHRoaXMsIm9wdGlvbnMiKTt0aGlzLmNvbm5lY3Rpb249ITEsdGhpcy5vcHRpb25zPXR9Y29ubmVjdCgpe3RoaXMuY29ubmVjdGlvbj0hMH1kaXNjb25uZWN0KCl7dGhpcy5jb25uZWN0aW9uPSExfX12YXIgRj0oZT0+KGUuTE9BREVEPSJsb2FkZWQiLGUuSU5JVD0iaW5pdCIsZS5TRU5EPSJzZW5kIixlLkZJTklTSD0iZmluaXNoIixlKSkoRnx8e30pO2Z1bmN0aW9uIGlpKGUpe2NlLmVycm9yKCJub29wIGVycm9yIixlKX1jbGFzcyBuaSBleHRlbmRzIHRpe2NvbnN0cnVjdG9yKGkpe3N1cGVyKGkpO2sodGhpcywidmlkZW9Db25maWciKTtrKHRoaXMsImF1ZGlvQ29uZmlnIik7ayh0aGlzLCJtdXhlciIpO2sodGhpcywidmlkZW9FbmNvZGVyIik7ayh0aGlzLCJhdWRpb0VuY29kZXIiKTtrKHRoaXMsImVycm9yUmVqZWN0IixpaSk7dGhpcy52aWRlb0NvbmZpZz1pLnZpZGVvQ29uZmlnLHRoaXMuYXVkaW9Db25maWc9aS5hdWRpb0NvbmZpZyx0aGlzLmNyZWF0ZU11eGVyQW5kRW5jb2RlcigpfWFzeW5jIGhhbmRsZShpKXt2YXIgbyxjLEEsRTtjb25zdHt2aWRlb0ZyYW1lOnMsYXVkaW9JbmZvOnIsdGltZXN0YW1wOmR9PWk7aWYocyYmKChvPXRoaXMudmlkZW9FbmNvZGVyKSE9bnVsbCYmby5lbmNvZGVRdWV1ZVNpemUmJigoYz10aGlzLnZpZGVvRW5jb2Rlcik9PW51bGw/dm9pZCAwOmMuZW5jb2RlUXVldWVTaXplKT4yMCYmYXdhaXQgZWkoKCk9Pnt2YXIgXyxPO3JldHVybihfPXRoaXMudmlkZW9FbmNvZGVyKSE9bnVsbCYmXy5lbmNvZGVRdWV1ZVNpemU/KChPPXRoaXMudmlkZW9FbmNvZGVyKT09bnVsbD92b2lkIDA6Ty5lbmNvZGVRdWV1ZVNpemUpPDEwOiEwfSksKEE9dGhpcy52aWRlb0VuY29kZXIpPT1udWxsfHxBLmVuY29kZShzLHtrZXlGcmFtZTpkLygxZTMvdGhpcy5vcHRpb25zLmZwcyklMTUwPT09MH0pLHMuY2xvc2UoKSkscil7Y29uc3QgXz1uZXcgQXVkaW9EYXRhKHsuLi5yfSk7KEU9dGhpcy5hdWRpb0VuY29kZXIpPT1udWxsfHxFLmVuY29kZShfKSxfLmNsb3NlKCl9fWNyZWF0ZU11eGVyQW5kRW5jb2Rlcigpe3RoaXMubXV4ZXI9bmV3IFl0KHt0YXJnZXQ6bmV3IFJlLHZpZGVvOntjb2RlYzoiYXZjIix3aWR0aDp0aGlzLnZpZGVvQ29uZmlnLndpZHRoLGhlaWdodDp0aGlzLnZpZGVvQ29uZmlnLmhlaWdodH0sYXVkaW86e2NvZGVjOiJhYWMiLG51bWJlck9mQ2hhbm5lbHM6dGhpcy5hdWRpb0NvbmZpZy5udW1iZXJPZkNoYW5uZWxzLHNhbXBsZVJhdGU6dGhpcy5hdWRpb0NvbmZpZy5zYW1wbGVSYXRlfX0pLHRoaXMudmlkZW9FbmNvZGVyPW5ldyBWaWRlb0VuY29kZXIoe291dHB1dDooaSxzKT0+e3ZhciByO3JldHVybihyPXRoaXMubXV4ZXIpPT1udWxsP3ZvaWQgMDpyLmFkZFZpZGVvQ2h1bmsoaSxzKX0sZXJyb3I6aT0+e2NlLmVycm9yKCJ2aWRlbyBlbmNvZGVyIGVycm9yIixpKSx0aGlzLmVycm9yUmVqZWN0KGkpfX0pLHRoaXMudmlkZW9FbmNvZGVyLmNvbmZpZ3VyZSh0aGlzLnZpZGVvQ29uZmlnKSx0aGlzLm9wdGlvbnMuZGlzYWJsZUF1ZGlvfHwodGhpcy5hdWRpb0VuY29kZXI9bmV3IEF1ZGlvRW5jb2Rlcih7b3V0cHV0OihpLHMpPT57dmFyIHI7cmV0dXJuKHI9dGhpcy5tdXhlcik9PW51bGw/dm9pZCAwOnIuYWRkQXVkaW9DaHVuayhpLHMpfSxlcnJvcjppPT57Y2UuZXJyb3IoImF1ZGlvIGVuY29kZXIgZXJyb3IiLGkpLHRoaXMuZXJyb3JSZWplY3QoaSl9fSksdGhpcy5hdWRpb0VuY29kZXIuY29uZmlndXJlKHRoaXMuYXVkaW9Db25maWcpKX1hc3luYyBlbmRFbmNvZGluZygpe3ZhciBzLHIsZCxvLGMsQSxFO3JldHVybiBhd2FpdCgocz10aGlzLnZpZGVvRW5jb2Rlcik9PW51bGw/dm9pZCAwOnMuZmx1c2goKSksKHI9dGhpcy52aWRlb0VuY29kZXIpPT1udWxsfHxyLmNsb3NlKCksYXdhaXQoKGQ9dGhpcy5hdWRpb0VuY29kZXIpPT1udWxsP3ZvaWQgMDpkLmZsdXNoKCkpLChvPXRoaXMuYXVkaW9FbmNvZGVyKT09bnVsbHx8by5jbG9zZSgpLChjPXRoaXMubXV4ZXIpPT1udWxsfHxjLmZpbmFsaXplKCksKEU9KEE9dGhpcy5tdXhlcik9PW51bGw/dm9pZCAwOkEudGFyZ2V0KT09bnVsbD92b2lkIDA6RS5idWZmZXJ9YXN5bmMgZmluaXNoKCl7cmV0dXJuIGF3YWl0IHRoaXMuZW5kRW5jb2RpbmcoKX19bGV0IFBlO3NlbGYuYWRkRXZlbnRMaXN0ZW5lcigibWVzc2FnZSIsYXN5bmMgZT0+e2NvbnN0e3R5cGU6dCxkYXRhOml9PWUuZGF0YTt0cnl7c3dpdGNoKHQpe2Nhc2UgRi5JTklUOnJldHVybiBzaShpKTtjYXNlIEYuU0VORDpyZXR1cm4gYXdhaXQgcmkoaSk7Y2FzZSBGLkZJTklTSDpyZXR1cm4gYXdhaXQgYWkoKTtkZWZhdWx0OnJldHVybn19Y2F0Y2gocyl7c2VsZi5wb3N0TWVzc2FnZSh7dHlwZTp0LGVyck1zZzpzIGluc3RhbmNlb2YgRXJyb3I/cy5tZXNzYWdlOiJVbmtub3duIEVycm9yIn0pfX0pLHNlbGYucG9zdE1lc3NhZ2Uoe3R5cGU6Ri5MT0FERUR9KTtmdW5jdGlvbiBzaShlKXtQZT1uZXcgbmkoZSksc2VsZi5wb3N0TWVzc2FnZSh7dHlwZTpGLklOSVR9KX1hc3luYyBmdW5jdGlvbiByaShlKXthd2FpdCBQZS5oYW5kbGUoZSksc2VsZi5wb3N0TWVzc2FnZSh7dHlwZTpGLlNFTkR9KX1hc3luYyBmdW5jdGlvbiBhaSgpe2NvbnN0IGU9YXdhaXQgUGUuZmluaXNoKCk7c2VsZi5wb3N0TWVzc2FnZSh7dHlwZTpGLkZJTklTSCxyZXN1bHQ6ZX0sZT9bZV06W10pfX0pKCk7Cg==",Oa=typeof window<"u"&&window.Blob&&new Blob([atob(Ii)],{type:"text/javascript;charset=utf-8"});function qd(){let a;try{if(a=Oa&&(window.URL||window.webkitURL).createObjectURL(Oa),!a)throw"";return new Worker(a)}catch(s){return new Worker("data:application/javascript;base64,"+Ii)}finally{a&&(window.URL||window.webkitURL).revokeObjectURL(a)}}var Wt=(a=>(a.LOADED="loaded",a.INIT="init",a.SEND="send",a.FINISH="finish",a))(Wt||{});class eh extends Wi{constructor(t){var n,i;super(t);x(this,"compositorWorker");x(this,"initialized");x(this,"videoConfig");x(this,"audioConfig");this.videoConfig=(n=t.videoConfig)!=null?n:yi,this.audioConfig=(i=t.audioConfig)!=null?i:Si,this.compositorWorker=new qd,this.initialized=new Promise((r,o)=>{this.compositorWorker.addEventListener("message",c=>{const{type:l}=c.data;l===Wt.LOADED&&this.getFromWorker(Wt.INIT,{videoConfig:this.videoConfig,audioConfig:this.audioConfig,...t}).then(()=>{r()}).catch(p=>{o(p)})})})}getFromWorker(t,n,i){return new Promise((r,o)=>{const c=({data:l})=>{l.type===t&&(l.errMsg?o(l.errMsg):r(l.result),this.compositorWorker.removeEventListener("message",c))};this.compositorWorker.addEventListener("message",c),this.compositorWorker.postMessage({type:t,data:n},i||[])})}async genAudioInfo(t,n){const i=this.audioConfig.sampleRate,r=this.audioConfig.numberOfChannels,o=this.audioConfig.sampleRate*(1/this.options.fps),l=new OfflineAudioContext(r,o,i).createBuffer(r,o,i);let p;if(n){n.forEach((h,u)=>{for(let f=0;f<r;f++){const m=f<h.numberOfChannels?h.getChannelData(f):h.getChannelData(0),g=l.getChannelData(f);if(u===0)g.set(m);else for(let v=0;v<g.length;v++)g[v]+=m[v]}}),p=new Float32Array(o*r);for(let h=0;h<l.numberOfChannels;h++)p.set(l.getChannelData(h),h*l.length)}else p=new Float32Array(o*r).fill(0);return{timestamp:t,sampleRate:i,numberOfChannels:r,numberOfFrames:o,data:p,format:"f32-planar"}}async handle(t){await this.initialized;const{timestamp:n,imageSource:i,audioBuffers:r}=t,o=new VideoFrame(i,{timestamp:n*1e3}),c=[o];let l;return this.options.disableAudio||(l=await this.genAudioInfo(n,r),c.push(l.data.buffer)),this.getFromWorker(Wt.SEND,{timestamp:n,videoFrame:o,audioInfo:l},c)}async finish(){await this.initialized;const t=await this.getFromWorker(Wt.FINISH);if(t)return new Blob([t],{type:"video/mp4"})}}class th extends Wi{constructor(t){super(t);x(this,"context");x(this,"audioContext");x(this,"audioPlayTime");x(this,"currentTime");x(this,"frameId");x(this,"frameWaitPromise");x(this,"frameWaitResolve");this.options=t,this.audioPlayTime=0;const{canvas:n,width:i,height:r}=this.options;n.width=i,n.height=r,this.context=n.getContext("2d"),this.currentTime=0,this.frameId=0}async handle(t){const{imageSource:n,audioBuffers:i,timestamp:r}=t;this.currentTime=r/1e3,this.options.disableAudio?(this.context&&n&&this.playVideoFrame(n),await xd(1e3/this.options.fps)):(this.audioContext||(this.audioContext=new AudioContext),this.frameId||(this.frameWaitPromise=new Promise(o=>{this.frameWaitResolve=o}),this.frameId=requestAnimationFrame(()=>this.frameCallback())),this.playAudioBuffers(i),await this.frameWaitPromise,this.context&&n&&this.playVideoFrame(n))}frameCallback(){var t;this.audioContext&&(this.audioContext.currentTime>=this.currentTime&&((t=this.frameWaitResolve)==null||t.call(this),this.frameWaitPromise=new Promise(n=>{this.frameWaitResolve=n})),this.frameId=requestAnimationFrame(()=>this.frameCallback()))}playVideoFrame(t){const{width:n,height:i}=this.options;this.context.drawImage(t,0,0,n,i)}playAudioBuffers(t){if(t.length===0||!this.audioContext)return;let n=0;this.audioContext.currentTime>this.audioPlayTime&&(this.audioPlayTime=this.audioContext.currentTime);for(const i of t){const r=this.audioContext.createBufferSource();r.buffer=i,r.connect(this.audioContext.destination),r.onended=()=>{r.disconnect()},r.start(this.audioPlayTime),n=Math.max(n,i.duration)}this.audioPlayTime+=n}async finish(){var t;(t=this.audioContext)==null||t.close(),this.frameId&&cancelAnimationFrame(this.frameId),this.frameWaitPromise=void 0,this.frameWaitResolve=void 0}}var ce=(a=>(a[a.Background=0]="Background",a[a.Character=10]="Character",a[a.Dialog=20]="Dialog",a[a.Text=30]="Text",a))(ce||{}),St;let sh=(St=class{constructor(s){x(this,"options");x(this,"app");x(this,"scenes");x(this,"activeScene");x(this,"activeChild");x(this,"activeTransformer");this.options=Object.assign({},St.defaultEditorOptions,s);const{view:t,width:n,height:i,background:r}=this.options;this.app=new to({view:t,width:n,height:i,background:r}),this.scenes=[]}addTransformer(){var s;this.activeTransformer=new so({wireframeStyle:{thickness:4,color:41471}}).on("pointertap",()=>{this.activeTransformer&&(this.activeTransformer.__isTapped?(this.activeChild=void 0,this.activeTransformer.group=[],this.options.onChangeActiveChild(void 0),this.activeTransformer.__doubleTapTimer&&clearTimeout(this.activeTransformer.__doubleTapTimer),this.activeTransformer.__isTapped=!1):(this.activeTransformer.__isTapped=!0,this.activeTransformer.__doubleTapTimer=setTimeout(()=>{this.activeTransformer&&(this.activeTransformer.__isTapped=!1)},600)))}),(s=this.activeScene)==null||s.addChild(this.activeTransformer)}removeTransformer(){var s;this.activeTransformer&&((s=this.activeScene)==null||s.removeChild(this.activeTransformer),this.activeTransformer.destroy(),this.activeTransformer=void 0)}addChildTransformListener(s){s.interactive=!0,s.on("pointerdown",()=>{this.setActiveChild(s)})}setActiveChild(s){this.activeChild=s,s&&(this.activeTransformer||this.addTransformer(),this.activeTransformer&&(this.activeTransformer.group=[s],this.moveChildToTop(this.activeTransformer))),this.options.onChangeActiveChild(s)}setActiveChildByName(s){const t=this.activeScene;if(t){const n=t.children.find(i=>i.name===s);n&&this.setActiveChild(n)}}updateActiveChild(s){this.activeChild&&(s(this.activeChild),this.options.onChangeActiveChild(this.activeChild))}removeChildTransformListener(s){s.removeAllListeners("pointerdown")}addScene(s,t){typeof t>"u"?this.scenes.push(s):this.scenes.splice(t,0,s);const n=i=>{if(i.children&&i.children.length>0)for(const r of i.children)n(r);else this.addChildTransformListener(i)};for(const i of s.children)n(i);this.options.onChangeScenes(this.scenes)}loadScenes(s){s.forEach(t=>{this.addScene(t)}),this.options.onChangeScenes(this.scenes)}removeScene(s){this.scenes=this.scenes.filter(t=>t!==s),this.activeScene===s&&(this.stageRemoveChild(this.activeScene),this.activeScene.destroy(),this.activeScene=void 0),this.options.onChangeScenes(this.scenes)}removeSceneByIndex(s){this.removeScene(this.scenes[s])}removeSceneByName(s){const t=this.getSceneByName(s);t&&this.removeScene(t)}getSceneByName(s){return this.scenes.find(t=>t.name===s)}cloneScene(s){this.removeTransformer();const t=s!=null?s:this.activeScene;if(t)return t.clone()}cloneSceneByIndex(s){return this.cloneScene(this.scenes[s])}cloneSceneByName(s){const t=this.getSceneByName(s);if(t)return this.cloneScene(t)}swapScene(s,t){[this.scenes[s],this.scenes[t]]=[this.scenes[t],this.scenes[s]],this.options.onChangeScenes(this.scenes)}setActiveScene(s){this.activeScene&&(this.stageRemoveChild(this.activeScene),this.removeTransformer()),this.activeScene=s,s&&(this.activeScene.load({skipSoundLoading:!0}),this.addTransformer(),this.stageAddChild(s)),this.options.onChangeActiveScene(s)}setActiveSceneByName(s){const t=this.scenes.find(n=>n.name===s);t&&this.setActiveScene(t)}setActiveSceneByIndex(s){this.setActiveScene(this.scenes[s])}getActiveSceneIndex(){return this.activeScene?this.scenes.indexOf(this.activeScene):-1}updateActiveScene(s){this.activeScene&&(s(this.activeScene),this.options.onChangeActiveScene(this.activeScene))}addChild(s){const t=this.activeScene;t&&(this.addChildTransformListener(s),t.addChild(s),this.options.onChangeActiveScene(t))}removeChild(s){var n;const t=this.activeScene;t&&(((n=this.activeChild)==null?void 0:n.name)===s.name&&(this.setActiveChild(void 0),this.removeTransformer()),this.removeChildTransformListener(s),t.removeChild(s),s.destroy(),this.options.onChangeActiveScene(t))}removeChildByName(s){const t=this.activeScene;if(t){const n=t.children.find(i=>i.name===s);n&&this.removeChild(n)}}toggleChildVisibleByName(s){const t=this.activeScene;if(t){const n=t.children.find(i=>i.name===s);n&&(n.visible=!n.visible),this.options.onChangeActiveScene(t)}}toggleChildInteractiveByName(s){const t=this.activeScene;if(t){const n=t.children.find(i=>i.name===s);n&&(n.interactive=!n.interactive),this.options.onChangeActiveScene(t)}}cloneChild(s){const t=s!=null?s:this.activeChild;if(t)return t.clone()}addSound(s){const t=this.activeScene;t&&(t.addSound(s),this.options.onChangeActiveScene(t))}removeSound(s){const t=this.activeScene;t&&(t.removeSound(s),this.options.onChangeActiveScene(t))}removeSoundByName(s){const t=this.activeScene;if(t){const n=t.sounds.find(i=>i.name===s);n&&this.removeSound(n)}}cloneDialogue(s){return hs(s)}cloneDialogueSpeak(s){return hs(s)}addDialogue(s,t){const n=this.activeScene;n&&(n.addDialogue(s,t),this.options.onChangeActiveScene(n))}updateDialogue(s,t){const n=this.activeScene;n&&(n.updateDialogue(s,t),this.options.onChangeActiveScene(n))}removeDialogue(s){const t=this.activeScene;t&&(t.removeDialogue(s),this.options.onChangeActiveScene(t))}swapDialogue(s,t){const n=this.activeScene;n&&(n.swapDialogue(s,t),this.options.onChangeActiveScene(n))}swapChildren(s,t){var n;(n=this.activeScene)==null||n.swapChildren(s,t)}moveChildTo(s,t){const n=t!=null?t:this.activeChild;n&&(n.zIndex=s)}moveChildToTop(s){const t=s!=null?s:this.activeChild;this.activeScene&&t&&(t.zIndex=ce.Text,this.activeScene.setChildIndex(t,this.activeScene.children.length-1))}moveChildToBottom(s){var n;const t=s!=null?s:this.activeChild;this.activeScene&&t&&(t.zIndex=ce.Background,(n=this.activeScene)==null||n.setChildIndex(t,0))}moveUpChild(s){const t=s!=null?s:this.activeChild;if(this.activeScene&&t){const n=this.activeScene.children.indexOf(t);if(n<this.activeScene.children.length-1){const i=this.activeScene.children[n+1];i.zIndex>t.zIndex&&(t.zIndex=i.zIndex),this.swapChildren(t,i)}}}moveDownChild(s){const t=s!=null?s:this.activeChild;if(this.activeScene&&t){const n=this.activeScene.children.indexOf(t);if(n>0){const i=this.activeScene.children[n-1];i.zIndex<t.zIndex&&(t.zIndex=i.zIndex),this.swapChildren(t,i)}}}stageAddChild(s){this.app.stage.addChild(s)}stageRemoveChild(s){const t=this.app.stage.children.find(n=>n.name===s.name);t&&this.app.stage.removeChild(t)}setChildPosition(s,t){const n=t!=null?t:this.activeChild,{width:i,height:r}=this.options;if(n)switch(s){case"top":n.y=0;break;case"middle":n.y=r/2-n.height/2;break;case"bottom":n.y=r-n.height;break;case"left":n.x=0;break;case"near-left":n.x=i/3-n.width/2;break;case"center":n.x=i/2-n.width/2;break;case"near-right":n.x=i/3*2-n.width/2;break;case"right":n.x=i-n.width;break}}genSceneScript(s){var c,l,p,h,u;const{dialogues:t,config:n}=s,i=n.speak,r=[],o=s.children.find(f=>f.assetType==="Background");o&&n.autoShowBackground&&r.push({directive:N.Show,params:{targetName:o.name}});for(const f of t){const{speak:m,lines:g}=f;i!=null&&i.dialogTargetName&&r.push({directive:N.Show,params:{targetName:i.dialogTargetName}}),r.push({directive:N.Speak,params:{lines:g,targetName:i.targetName,wordsPerMin:m.wordsPerMin,interval:m.interval,effect:m.effect,effectDuration:m.effectDuration,speaker:i.speaker.targetName?{targetName:i.speaker.targetName,name:((c=m.speaker)==null?void 0:c.name)||"",speakerTargetName:(l=m.speaker)==null?void 0:l.speakerTargetName,autoShowSpeaker:(p=m.speaker)==null?void 0:p.autoShowSpeaker,autoMaskOtherSpeakers:(h=m.speaker)==null?void 0:h.autoMaskOtherSpeakers}:void 0,voice:(u=m.voice)!=null&&u.targetName?m.voice:void 0}})}return{scene:s,config:n,directives:r}}async exportScreenplay(s=0,t){const i=this.exportScenes(s,t).map(this.genSceneScript);return{config:{},scenes:i}}exportScenes(s=0,t){this.removeTransformer();const n=performance.now(),i=this.scenes.slice(s,t).map(r=>r.clone());return Xe.info("editor export cost:",performance.now()-n),i}saveAsJSON(){return this.removeTransformer(),JSON.stringify({version:"2.0",config:{},scenes:this.scenes})}async loadFromJSON(s){const t=JSON.parse(s),n=[];for(const i of t.scenes){const r=await Ie.fromJSON(i);n.push(r)}this.loadScenes(n)}clear(){this.scenes.forEach(s=>{this.removeScene(s)}),this.setActiveScene(void 0),this.setActiveChild(void 0),this.removeTransformer()}},x(St,"defaultEditorOptions",{width:1920,height:1080,background:0,onChangeActiveChild:()=>{},onChangeActiveScene:()=>{},onChangeScenes:()=>{}}),St);function rs(){const a=new Ie,s=new Nt;s.alpha=.7,s.beginFill(0),s.drawRect(0,0,1920,400),s.endFill(),s.x=0,s.y=680,s.zIndex=ce.Dialog,s.label="",s.fillColor="#000000";const t=new We("",{fill:16777215,fontSize:44,fontWeight:"bold",leading:15});t.x=160,t.y=700,t.zIndex=ce.Text,t.label="",t.disableTextEdit=!0;const n=new We("",{fill:16777215,wordWrap:!0,breakWords:!0,wordWrapWidth:1600,fontSize:38,leading:15});return n.x=160,n.y=770,n.zIndex=ce.Text,n.label="",n.disableTextEdit=!0,a.addChild(s),a.addChild(t),a.addChild(n),a.config.speak.targetName=n.name,a.config.speak.dialogTargetName=s.name,a.config.speak.speaker.targetName=t.name,a.config.speak.speaker.name=t.text,a}function Li(){const a=new Ie,s=new Nt;s.alpha=.7,s.beginFill(0),s.drawRect(0,0,1920,1080),s.endFill(),s.x=0,s.y=0,s.zIndex=ce.Dialog,s.label="";const t=new We("",{fill:16777215,breakWords:!0,wordWrap:!0,wordWrapWidth:1600,fontSize:45,leading:15});return t.x=160,t.y=160,t.zIndex=ce.Text,t.label="",t.disableTextEdit=!0,a.addChild(s),a.addChild(t),a.config.speak.targetName=t.name,a.config.speak.dialogTargetName=s.name,a}function Xi(){const a=new Ie,s=new We("",{fill:16777215,breakWords:!0,fontSize:100,fontWeight:"bold"});s.x=1920/2-s.width/2,s.y=1080/2-200,s.zIndex=ce.Text,s.label="";const t=new We("",{fill:16777215,breakWords:!0,fontSize:60});return t.x=1920/2-t.width/2,t.y=1080/2-40,t.zIndex=ce.Text,t.label="",a.addChild(s),a.addChild(t),a.dialogues=[{speak:{wordsPerMin:500,interval:.2,effect:"typewriter",speaker:{targetName:"",name:"",autoShowSpeaker:{inEffect:"Show"},autoMaskOtherSpeakers:{alpha:.5},speakerTargetName:"Narrator"}},lines:[{children:[{text:""},{children:[{text:""}],type:"directive",value:{directive:"FadeIn",params:{targetName:s.name},label:":"}},{text:""},{children:[{text:""}],type:"directive",value:{directive:"FadeIn",params:{targetName:t.name},label:":"}},{text:""},{children:[{text:""}],type:"directive",value:{directive:"Wait",params:{duration:3},label:":3"}},{text:""}],type:"p"}]}],a}const I=ys()(sa(a=>{let s;return{project:null,editor:null,activeChild:null,activeScene:null,scenes:[],setProject(t){a(n=>{n.project={id:t.id,name:t.name}})},initEditor(t){s=new sh({view:t,onChangeActiveChild(n){a(i=>{if(!n){i.activeChild=null;return}let r={...n,width:n.width,height:n.height,x:n.x,y:n.y};if(n.type==="Text"){const o=n;r={...r,text:o.text,style:o.style&&{...o.style,fontFamily:o.style.fontFamily,fontWeight:o.style.fontWeight,fontStyle:o.style.fontStyle,fontSize:o.style.fontSize,fill:o.style.fill}}}i.activeChild=r})},onChangeActiveScene(n){a(i=>{n?i.activeScene={...n}:i.activeScene=null})},onChangeScenes(n){a(i=>{i.scenes=[...n]})}}),a(n=>{n.editor=s})}}})),Te=ys()(sa(a=>({isOpen:!1,type:null,disableSelect:!1,confirm:null,cancel:null,setConfirm(s){a(t=>{t.confirm=s})},setCancel(s){a(t=>{t.cancel=s})},setOpen(s){a(t=>{t.isOpen=s})},setType(s){a(t=>{t.type=s})},setDisableSelect(s){a(t=>{t.disableSelect=s})}}))),gs=ys()(sa(a=>({isOpen:!1,loadingText:"",setOpen(s){a(t=>{t.isOpen=s})},setLoadingText(s){a(t=>{t.loadingText=s})}}))),ut=d.forwardRef(({className:a,...s},t)=>e.jsx("div",{ref:t,className:S("rounded-xl border bg-card text-card-foreground shadow",a),...s}));ut.displayName="Card";const ah=d.forwardRef(({className:a,...s},t)=>e.jsx("div",{ref:t,className:S("flex flex-col space-y-1.5 p-6",a),...s}));ah.displayName="CardHeader";const nh=d.forwardRef(({className:a,...s},t)=>e.jsx("h3",{ref:t,className:S("font-semibold leading-none tracking-tight",a),...s}));nh.displayName="CardTitle";const ih=d.forwardRef(({className:a,...s},t)=>e.jsx("p",{ref:t,className:S("text-sm text-muted-foreground",a),...s}));ih.displayName="CardDescription";const qe=d.forwardRef(({className:a,...s},t)=>e.jsx("div",{ref:t,className:S("p-6 pt-0",a),...s}));qe.displayName="CardContent";const ks=d.forwardRef(({className:a,...s},t)=>e.jsx("div",{ref:t,className:S("flex items-center p-6 pt-0",a),...s}));ks.displayName="CardFooter";const ge=d.forwardRef(({className:a,children:s,...t},n)=>{const i=d.useRef(null);return d.useImperativeHandle(n,()=>({scrollToBottom:()=>{i.current&&i.current.scrollTo({top:i.current.scrollHeight,behavior:"smooth"})}})),e.jsxs(dn,{className:S("relative overflow-hidden",a),...t,children:[e.jsx(ao,{ref:i,className:"h-full w-full rounded-[inherit]",children:s}),e.jsx(Ht,{}),e.jsx(no,{})]})});ge.displayName=dn.displayName;const Ht=d.forwardRef(({className:a,orientation:s="vertical",...t},n)=>e.jsx(hn,{ref:n,orientation:s,className:S("flex touch-none select-none transition-colors",s==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",s==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",a),...t,children:e.jsx(io,{className:"relative flex-1 rounded-full bg-border"})}));Ht.displayName=hn.displayName;const rh=a=>e.jsx("svg",{viewBox:"0 0 24 24",height:"48",width:"48",focusable:"false",role:"img",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...a,children:e.jsx("path",{d:"M3 6a3 3 0 0 1 3-3h12a3 3 0 0 1 3 3v12a3 3 0 0 1-3 3H6a3 3 0 0 1-3-3V6zm10 13h5a1 1 0 0 0 1-1v-5h-6v6zm-2-6H5v5a1 1 0 0 0 1 1h5v-6zm2-2h6V6a1 1 0 0 0-1-1h-5v6zm-2-6H6a1 1 0 0 0-1 1v5h6V5z"})}),oh=a=>e.jsx("svg",{viewBox:"0 0 24 24",height:"48",width:"48",focusable:"false",role:"img",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...a,children:e.jsx("path",{d:"M13 5a1 1 0 1 0 0-2h-2a1 1 0 1 0 0 2h2zm-8 6a1 1 0 1 0-2 0v2a1 1 0 1 0 2 0v-2zm-2 7a1 1 0 1 1 2 0 1 1 0 0 0 1 1h12a1 1 0 0 0 1-1 1 1 0 1 1 2 0 3 3 0 0 1-3 3H6a3 3 0 0 1-3-3zm17-8a1 1 0 0 0-1 1v2a1 1 0 1 0 2 0v-2a1 1 0 0 0-1-1zM7 4a1 1 0 0 0-1-1 3 3 0 0 0-3 3 1 1 0 0 0 2 0 1 1 0 0 1 1-1 1 1 0 0 0 1-1zm11-1a1 1 0 1 0 0 2 1 1 0 0 1 1 1 1 1 0 1 0 2 0 3 3 0 0 0-3-3z"})}),lh=a=>e.jsx("svg",{viewBox:"0 0 24 24",height:"48",width:"48",focusable:"false",role:"img",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...a,children:e.jsx("path",{d:"M6 21a1 1 0 1 0 0-2 1 1 0 0 1-1-1V6a1 1 0 0 1 1-1 1 1 0 0 0 0-2 3 3 0 0 0-3 3v12a3 3 0 0 0 3 3zm7-16a1 1 0 1 0 0-2h-2a1 1 0 1 0 0 2h2zm6 6a1 1 0 1 1 2 0v2a1 1 0 1 1-2 0v-2zm-5 9a1 1 0 0 1-1 1h-2a1 1 0 1 1 0-2h2a1 1 0 0 1 1 1zm4-17a1 1 0 1 0 0 2 1 1 0 0 1 1 1 1 1 0 1 0 2 0 3 3 0 0 0-3-3zm-1 17a1 1 0 0 0 1 1 3 3 0 0 0 3-3 1 1 0 1 0-2 0 1 1 0 0 1-1 1 1 1 0 0 0-1 1z"})}),ch=a=>e.jsx("svg",{viewBox:"0 0 24 24",height:"48",width:"48",focusable:"false",role:"img",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...a,children:e.jsx("path",{d:"M14 4a1 1 0 0 1-1 1h-2a1 1 0 1 1 0-2h2a1 1 0 0 1 1 1zm-9 7a1 1 0 1 0-2 0v2a1 1 0 1 0 2 0v-2zm14 0a1 1 0 1 1 2 0v2a1 1 0 1 1-2 0v-2zm-6 10a1 1 0 1 0 0-2h-2a1 1 0 1 0 0 2h2zM7 4a1 1 0 0 0-1-1 3 3 0 0 0-3 3 1 1 0 0 0 2 0 1 1 0 0 1 1-1 1 1 0 0 0 1-1zm11-1a1 1 0 1 0 0 2 1 1 0 0 1 1 1 1 1 0 1 0 2 0 3 3 0 0 0-3-3zM7 20a1 1 0 0 1-1 1 3 3 0 0 1-3-3 1 1 0 1 1 2 0 1 1 0 0 0 1 1 1 1 0 0 1 1 1zm11 1a1 1 0 1 1 0-2 1 1 0 0 0 1-1 1 1 0 1 1 2 0 3 3 0 0 1-3 3z"})}),dh=a=>e.jsx("svg",{viewBox:"0 0 24 24",height:"48",width:"48",focusable:"false",role:"img",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...a,children:e.jsx("path",{d:"M13 5a1 1 0 1 0 0-2h-2a1 1 0 1 0 0 2h2zm-8 6a1 1 0 1 0-2 0v2a1 1 0 1 0 2 0v-2zm9 9a1 1 0 0 1-1 1h-2a1 1 0 1 1 0-2h2a1 1 0 0 1 1 1zM6 3a1 1 0 0 1 0 2 1 1 0 0 0-1 1 1 1 0 0 1-2 0 3 3 0 0 1 3-3zm1 17a1 1 0 0 1-1 1 3 3 0 0 1-3-3 1 1 0 1 1 2 0 1 1 0 0 0 1 1 1 1 0 0 1 1 1zm11 1a1 1 0 1 1 0-2 1 1 0 0 0 1-1V6a1 1 0 0 0-1-1 1 1 0 1 1 0-2 3 3 0 0 1 3 3v12a3 3 0 0 1-3 3z"})}),hh=a=>e.jsx("svg",{viewBox:"0 0 24 24",height:"48",width:"48",focusable:"false",role:"img",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...a,children:e.jsx("path",{d:"M3 6a1 1 0 0 0 2 0 1 1 0 0 1 1-1h12a1 1 0 0 1 1 1 1 1 0 1 0 2 0 3 3 0 0 0-3-3H6a3 3 0 0 0-3 3zm2 5a1 1 0 1 0-2 0v2a1 1 0 1 0 2 0v-2zm14 0a1 1 0 1 1 2 0v2a1 1 0 1 1-2 0v-2zm-5 9a1 1 0 0 1-1 1h-2a1 1 0 1 1 0-2h2a1 1 0 0 1 1 1zm-8 1a1 1 0 1 0 0-2 1 1 0 0 1-1-1 1 1 0 1 0-2 0 3 3 0 0 0 3 3zm11-1a1 1 0 0 0 1 1 3 3 0 0 0 3-3 1 1 0 1 0-2 0 1 1 0 0 1-1 1 1 1 0 0 0-1 1z"})}),G={add:Es,alignCenter:ro,alignJustify:oo,alignLeft:lo,alignRight:co,arrowDown:ho,bg:uo,blockquote:mo,bold:po,borderAll:rh,borderBottom:oh,borderLeft:lh,borderNone:ch,borderRight:dh,borderTop:hh,check:fo,chevronRight:xo,chevronsUpDown:go,clear:Ua,close:Ua,code:bo,codeblock:vo,color:yo,column:So,combine:jo,ungroup:wo,comment:No,commentAdd:Co,delete:Os,dragHandle:ko,editing:Zo,emoji:Go,externalLink:To,h1:Vo,h2:Ro,h3:Wo,h4:Io,h5:Lo,h6:Xo,image:Fo,indent:Ko,italic:zo,kbd:Do,lineHeight:Yo,link:Mo,minus:Ho,more:Bo,ol:Po,outdent:Ao,paragraph:Uo,refresh:Eo,row:Oo,search:Jo,settings:Qo,strikethrough:_o,subscript:$o,superscript:qo,table:el,text:tl,trash:sl,trash2:Os,ul:al,underline:nl,unlink:il,viewing:rl,viewingOff:ol,lock:ll,lockOpen:cl,type:dl,fontSize:hl,bookOpenText:ul,copy:ml,moveUp:pl,moveDown:fl,squarePlus:xl,folder:gl,bookmark:bl,mic:vl,download:yl,edit:Sl,library:jl,scene:wl,images:Nl,preview:Cl,tip:kl,wandSparkles:Zl,sparkles:Gl,flip:Tl,gitHub:a=>e.jsx("svg",{viewBox:"0 0 438.549 438.549",...a,children:e.jsx("path",{fill:"currentColor",d:"M409.132 114.573c-19.608-33.596-46.205-60.194-79.798-79.8-33.598-19.607-70.277-29.408-110.063-29.408-39.781 0-76.472 9.804-110.063 29.408-33.596 19.605-60.192 46.204-79.8 79.8C9.803 148.168 0 184.854 0 224.63c0 47.78 13.94 90.745 41.827 128.906 27.884 38.164 63.906 64.572 108.063 79.227 5.14.954 8.945.283 11.419-1.996 2.475-2.282 3.711-5.14 3.711-8.562 0-.571-.049-5.708-.144-15.417a2549.81 2549.81 0 01-.144-25.406l-6.567 1.136c-4.187.767-9.469 1.092-15.846 1-6.374-.089-12.991-.757-19.842-1.999-6.854-1.231-13.229-4.086-19.13-8.559-5.898-4.473-10.085-10.328-12.56-17.556l-2.855-6.57c-1.903-4.374-4.899-9.233-8.992-14.559-4.093-5.331-8.232-8.945-12.419-10.848l-1.999-1.431c-1.332-.951-2.568-2.098-3.711-3.429-1.142-1.331-1.997-2.663-2.568-3.997-.572-1.335-.098-2.43 1.427-3.289 1.525-.859 4.281-1.276 8.28-1.276l5.708.853c3.807.763 8.516 3.042 14.133 6.851 5.614 3.806 10.229 8.754 13.846 14.842 4.38 7.806 9.657 13.754 15.846 17.847 6.184 4.093 12.419 6.136 18.699 6.136 6.28 0 11.704-.476 16.274-1.423 4.565-.952 8.848-2.383 12.847-4.285 1.713-12.758 6.377-22.559 13.988-29.41-10.848-1.14-20.601-2.857-29.264-5.14-8.658-2.286-17.605-5.996-26.835-11.14-9.235-5.137-16.896-11.516-22.985-19.126-6.09-7.614-11.088-17.61-14.987-29.979-3.901-12.374-5.852-26.648-5.852-42.826 0-23.035 7.52-42.637 22.557-58.817-7.044-17.318-6.379-36.732 1.997-58.24 5.52-1.715 13.706-.428 24.554 3.853 10.85 4.283 18.794 7.952 23.84 10.994 5.046 3.041 9.089 5.618 12.135 7.708 17.705-4.947 35.976-7.421 54.818-7.421s37.117 2.474 54.823 7.421l10.849-6.849c7.419-4.57 16.18-8.758 26.262-12.565 10.088-3.805 17.802-4.853 23.134-3.138 8.562 21.509 9.325 40.922 2.279 58.24 15.036 16.18 22.559 35.787 22.559 58.817 0 16.178-1.958 30.497-5.853 42.966-3.9 12.471-8.941 22.457-15.125 29.979-6.191 7.521-13.901 13.85-23.131 18.986-9.232 5.14-18.182 8.85-26.84 11.136-8.662 2.286-18.415 4.004-29.263 5.146 9.894 8.562 14.842 22.077 14.842 40.539v60.237c0 3.422 1.19 6.279 3.572 8.562 2.379 2.279 6.136 2.95 11.276 1.995 44.163-14.653 80.185-41.062 108.068-79.226 27.88-38.161 41.825-81.126 41.825-128.906-.01-39.771-9.818-76.454-29.414-110.049z"})}),logo:a=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",...a,children:e.jsx("path",{fill:"currentColor",d:"M11.572 0c-.176 0-.31.001-.358.007a19.76 19.76 0 0 1-.364.033C7.443.346 4.25 2.185 2.228 5.012a11.875 11.875 0 0 0-2.119 5.243c-.096.659-.108.854-.108 1.747s.012 1.089.108 1.748c.652 4.506 3.86 8.292 8.209 9.695.779.25 1.6.422 2.534.525.363.04 1.935.04 2.299 0 1.611-.178 2.977-.577 4.323-1.264.207-.106.247-.134.219-.158-.02-.013-.9-1.193-1.955-2.62l-1.919-2.592-2.404-3.558a338.739 338.739 0 0 0-2.422-3.556c-.009-.002-.018 1.579-.023 3.51-.007 3.38-.01 3.515-.052 3.595a.426.426 0 0 1-.206.214c-.075.037-.14.044-.495.044H7.81l-.108-.068a.438.438 0 0 1-.157-.171l-.05-.106.006-4.703.007-4.705.072-.092a.645.645 0 0 1 .174-.143c.096-.047.134-.051.54-.051.478 0 .558.018.682.154.035.038 1.337 1.999 2.895 4.361a10760.433 10760.433 0 0 0 4.735 7.17l1.9 2.879.096-.063a12.317 12.317 0 0 0 2.466-2.163 11.944 11.944 0 0 0 2.824-6.134c.096-.66.108-.854.108-1.748 0-.893-.012-1.088-.108-1.747-.652-4.506-3.859-8.292-8.208-9.695a12.597 12.597 0 0 0-2.499-.523A33.119 33.119 0 0 0 11.573 0zm4.069 7.217c.347 0 .408.005.486.047a.473.473 0 0 1 .237.277c.018.06.023 1.365.018 4.304l-.006 4.218-.744-1.14-.746-1.14v-3.066c0-1.982.01-3.097.023-3.15a.478.478 0 0 1 .233-.296c.096-.05.13-.054.5-.054z"})}),moon:un,sun:Vl},Sa=fn,ja=xn,uh=ia,mh=Rl,Fi=d.forwardRef(({className:a,inset:s,children:t,...n},i)=>e.jsxs(aa,{ref:i,className:S("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",s&&"pl-8",a),...n,children:[t,e.jsx(mn,{className:"ml-auto h-4 w-4"})]}));Fi.displayName=aa.displayName;const Ki=d.forwardRef(({className:a,...s},t)=>e.jsx(na,{ref:t,className:S("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...s}));Ki.displayName=na.displayName;const Zs=d.forwardRef(({className:a,sideOffset:s=4,...t},n)=>e.jsx(ia,{children:e.jsx(ra,{ref:n,sideOffset:s,className:S("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...t})}));Zs.displayName=ra.displayName;const de=d.forwardRef(({className:a,inset:s,...t},n)=>e.jsx(oa,{ref:n,className:S("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",s&&"pl-8",a),...t}));de.displayName=oa.displayName;const ph=d.forwardRef(({className:a,children:s,checked:t,...n},i)=>e.jsxs(la,{ref:i,className:S("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),checked:t,...n,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Ss,{children:e.jsx(ca,{className:"h-4 w-4"})})}),s]}));ph.displayName=la.displayName;const fh=d.forwardRef(({className:a,children:s,...t},n)=>e.jsxs(da,{ref:n,className:S("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...t,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Ss,{children:e.jsx(pn,{className:"h-4 w-4 fill-current"})})}),s]}));fh.displayName=da.displayName;const xh=d.forwardRef(({className:a,inset:s,...t},n)=>e.jsx(ha,{ref:n,className:S("px-2 py-1.5 text-sm font-semibold",s&&"pl-8",a),...t}));xh.displayName=ha.displayName;const wa=d.forwardRef(({className:a,...s},t)=>e.jsx(ua,{ref:t,className:S("-mx-1 my-1 h-px bg-muted",a),...s}));wa.displayName=ua.displayName;const gh=function(){const a=["monospace","sans-serif","serif"],s="mmmmmmmmmmlli",t="72px",n=document.getElementsByTagName("body")[0],i=document.createElement("span");i.style.fontSize=t,i.innerHTML=s;const r={},o={};for(const l in a)i.style.fontFamily=a[l],n.appendChild(i),r[a[l]]=i.offsetWidth,o[a[l]]=i.offsetHeight,n.removeChild(i);function c(l){let p=!1;for(const h in a){i.style.fontFamily=l+","+a[h],n.appendChild(i);const u=i.offsetWidth!=r[a[h]]||i.offsetHeight!=o[a[h]];n.removeChild(i),p=p||u}return p}this.detect=c},is={windows:[{ch:"",en:"SimSun"},{ch:"",en:"SimHei"},{ch:"",en:"Microsoft Yahei"},{ch:"",en:"Microsoft JhengHei"},{ch:"",en:"KaiTi"},{ch:"",en:"NSimSun"},{ch:"",en:"FangSong"}],"OS X":[{ch:"",en:"PingFang SC"},{ch:"",en:"Hiragino Sans GB"},{ch:"-",en:"Lantinghei SC"},{ch:"-",en:"Hanzipen SC"},{ch:"-",en:"Hannotate SC"},{ch:"-",en:"Songti SC"},{ch:"-",en:"Wawati SC"},{ch:"-",en:"Weibei SC"},{ch:"-",en:"Xingkai SC"},{ch:"-",en:"Yapi SC"},{ch:"-",en:"Yuanti SC"}],office:[{ch:"",en:"YouYuan"},{ch:"",en:"LiSu"},{ch:"",en:"STXihei"},{ch:"",en:"STHeiti"},{ch:"",en:"STKaiti"},{ch:"",en:"STSong"},{ch:"",en:"STFangsong"},{ch:"",en:"STZhongsong"},{ch:"",en:"STCaiyun"},{ch:"",en:"STHupo"},{ch:"",en:"STXinwei"},{ch:"",en:"STLiti"},{ch:"",en:"STXingkai"},{ch:"",en:"FZShuTi"},{ch:"",en:"FZYaoti"}],open:[{ch:"",en:"Source Han Sans CN"},{ch:"",en:"Source Han Serif SC"},{ch:"",en:"WenQuanYi Micro Hei"},{ch:"",en:"LXGW WenKai"},{ch:"",en:"Ark Pixel 12px Monospaced zh_cn"},{ch:"DW Pica Roman V",en:"DW Pica Roman V"}]},bh=new gh,vh=[{ch:"Arial",en:"Arial"}].concat([...is["OS X"],...is.windows,...is.open,...is.office].filter(a=>bh.detect(a.en)));var It=(a=>(a.NORMAL="normal",a.BOLD="bold",a))(It||{}),Lt=(a=>(a.NORMAL="normal",a.ITALIC="italic",a))(Lt||{});async function _s(a,s){const t=new FontFace(a,typeof s=="string"?"url(".concat(s,")"):s);document.fonts.add(t),await t.load()}const Na="__TMP__",lt=1e5;var C=(a=>(a.Character="Character",a.Background="Background",a.Thing="Thing",a.Dialog="Dialog",a.Audio="Audio",a.Font="Font",a))(C||{});const Ca=[{name:"",value:"Character"},{name:"",value:"Background"},{name:"",value:"Thing"},{name:"",value:"Dialog"},{name:"",value:"Audio"},{name:"",value:"Font"}],yh=Ca.reduce((a,{name:s,value:t})=>(a[t]=s,a),{});class Sh extends Wl{constructor(){super("vnve2");x(this,"asset");x(this,"assetSource");x(this,"template");x(this,"project");this.version(4).stores({asset:"++id, name, type, voice, states, [name+type]",assetSource:"++id, mime, blob, ext",template:"++id, name, type, content",project:"++id, name, time, content"})}}const Zt=new Sh,Q=Zt.asset,Ve=Zt.assetSource,Bt=Zt.template,Ae=Zt.project;function xe(a){return a.url||"https://s/".concat(a.id,".").concat(a.ext)}function zi(a){const s=a.states.find(t=>t.id===a.stateId);return s?xe(s):""}function Di(a){switch(a){case"Background":case"Character":case"Thing":case"Dialog":return".webp, .png, .jpg, .jpeg, .gif, .mp4";case"Audio":return".mp3, .wav, .m4a, .aac";case"Font":return".ttf, .woff, .woff2";default:return""}}async function jh(){const a=await window.showDirectoryPicker();for(const s of Ca){const t=await a.getDirectoryHandle(s.name).catch(()=>{});if(t){for await(const[n,i]of t.entries())if(i.kind==="directory"){const r=await Q.add({name:n,type:s.value,states:[]});for await(const[,o]of i.entries())if(o.kind==="file"){const c=await o.getFile(),{name:l,ext:p}=jt(c);if(Di(s.value).includes(p)){const u=await Ve.add({mime:c.type,blob:c,ext:p});await Q.where("id").equals(r).modify(f=>{f.states.push({id:u,name:l,ext:p})})}}}}}}async function wh(){await Ve.clear(),await Q.clear()}async function Nh(){const a=await Q.where("type").equals("Font").toArray();for(const s of a)for(const t of s.states)await _s(t.name,xe(t))}async function ka(a,s){const t=await Q.get(a);if(s){const n=t.states.find(i=>i.name===s);return n?{...t,stateId:n.id}:void 0}return t}async function $s(a,s,t){const n={name:a};t&&(n.type=t);const i=await Q.where(n).first();if(i&&s){const r=i.states.find(o=>o.name===s);return r?{...i,stateId:r.id}:void 0}return i}async function Ch(){const a=await Zt.export(),s=URL.createObjectURL(a);gi("book",s,"vnve"),URL.revokeObjectURL(s)}async function kh(){const s=(await ld({accept:".vnve"}))[0];s&&await Zt.import(s)}function Zh(){return Math.random().toString(36).substring(2,8)}async function Gh(a,s,t){const n="".concat(Na).concat(a);let i=await $s(n,void 0,s);if(!i){const l=await Q.add({name:n,type:s,states:[]});i=await ka(l)}const{name:r,ext:o}=jt(t),c=await Ve.add({mime:t.type,blob:t,ext:o});return i.stateId=c,i.states.push({id:c,name:"".concat(r,"_").concat(Zh()),ext:o}),await Q.update(i.id,{states:i.states}),i}async function Th(a){const s="".concat(Na).concat(a),t=await Q.where("name").equals(s).toArray();for(const n of t){await Q.delete(n.id);for(const i of n.states)await Ve.delete(i.id)}}async function Vh(){await Q.get(lt)||await Q.put({id:lt,name:"",type:"Character",states:[]})}const Rh="/vnve/assets/day-b6ef6b0c.webp",Wh="/vnve/assets/night-da7c9955.webp",Ih="/vnve/assets/day-c525641b.webp",Lh="/vnve/assets/night-61088675.webp",Xh="/vnve/assets/default-9e36bbf3.webp",Fh="/vnve/assets/happy-61fa7adf.webp",Kh="/vnve/assets/default-6a415d65.webp",zh="/vnve/assets/happy-77097254.webp",Dh="/vnve/assets/red-628f973d.webp",Yh="/vnve/assets/bgm1-865a2e82.mp3",Mh="/vnve/assets/bgm2-9df28d45.mp3",Hh="/vnve/assets/thunder-fcdc6cdf.mp3",Bh="/vnve/assets/rain-2ed4ca49.mp3",Ph="/vnve/assets/open-door-0aa9286c.mp3",Ah="/vnve/assets/knock-door-25770f6b.mp3",Uh="/vnve/assets/zh-hans-17f9a740.woff2",Eh="/vnve/assets/zh-hant-df9154bf.woff2",Oh=[{type:C.Background,assets:[{name:"",states:[{name:"",url:Rh},{name:"",url:Wh}]},{name:"",states:[{name:"",url:Ih},{name:"",url:Lh}]}]},{type:C.Character,assets:[{name:"",states:[{name:"",url:Xh},{name:"",url:Fh}]},{name:"",states:[{name:"",url:Kh},{name:"",url:zh}]}]},{type:C.Thing,assets:[{name:"",states:[{name:"",url:Dh}]}]},{type:C.Audio,assets:[{name:"BGM",states:[{name:"bgm1",url:Yh},{name:"bgm2",url:Mh}]},{name:"",states:[{name:"",url:Ph},{name:"",url:Ah},{name:"",url:Bh},{name:"",url:Hh}]}]},{type:C.Font,assets:[{name:"",states:[{name:"",url:Uh},{name:"",url:Eh}]}]}];async function Jh(){for(const a of Oh){const{type:s,assets:t}=a;for(const n of t){const{name:i,states:r}=n,o=await Q.add({name:i,type:s,states:[]});for(const c of r)try{const{name:l,url:p}=c,h=p.split(".").pop(),u=await fetch(p),f=await u.blob(),m=u.headers.get("Content-Type")||"",g=await Ve.add({mime:m,ext:h,blob:f,url:p});await Q.where("id").equals(o).modify(v=>{v.states.push({id:g,name:l,ext:h,url:p})})}catch(l){console.error("",l)}}}}const Ja="IS_PRESET_IMPORTED";async function Qh(){try{if(localStorage.getItem(Ja))return;localStorage.setItem(Ja,"true"),await Ve.count()===0&&await Jh()}catch(a){console.error("",a)}}const _h=[{name:"",content:rs},{name:"",content:Li},{name:"",content:Xi},{name:"",content:()=>new Ie}];function Za(){const a=I(i=>i.editor),s=Et(()=>Bt.reverse().toArray());return{defaultTemplates:_h,customTemplates:s||[],handleAddDefaultTemplate:(i,r)=>()=>{const o=i();a.addScene(o,r),a.setActiveSceneByName(o.name)},handleAddCustomTemplate:async(i,r)=>{const o=await Ie.fromJSON(JSON.parse(i),!1);a.addScene(o,r),a.setActiveSceneByName(o.name)}}}function $h({onOpenSceneDetailDialog:a}){const s=I(f=>f.editor),t=I(f=>f.activeScene),n=I(f=>f.scenes),{defaultTemplates:i,customTemplates:r,handleAddDefaultTemplate:o,handleAddCustomTemplate:c}=Za(),l=d.useRef(null);d.useEffect(()=>{l.current&&l.current.scrollIntoView({behavior:"smooth"})},[n.length]);const p=f=>{f.name===(t==null?void 0:t.name)&&s.setActiveScene(void 0),s.removeSceneByName(f.name)},h=(f,m)=>{const g=s.cloneSceneByName(f.name);s.addScene(g,m),s.setActiveSceneByName(g.name)},u=(f,m)=>{s.swapScene(f,m)};return e.jsx(ut,{className:"flex-1 shrink-0 max-h-[50%] sm:max-h-full rounded-md",children:e.jsx(qe,{className:"h-full p-1",children:e.jsx(ge,{className:"h-full p-2",children:e.jsxs(ws,{children:[e.jsx(Ns,{children:e.jsxs(it,{children:[e.jsx(rt,{children:""}),e.jsx(rt,{className:"w-[3rem] text-right",children:""})]})}),e.jsx(Cs,{children:n.map((f,m)=>e.jsxs(it,{ref:(t==null?void 0:t.name)===f.name?l:null,className:"".concat((t==null?void 0:t.name)===f.name?"bg-muted":""," cursor-pointer"),children:[e.jsxs(ot,{onClick:()=>{s.setActiveSceneByName(f.name)},children:[e.jsxs("span",{className:"font-medium mr-1",children:[m+1,"."]}),f.label]}),e.jsxs(ot,{className:"flex gap-1 justify-end",children:[m>0&&e.jsx(G.moveUp,{className:"size-4 cursor-pointer",onClick:()=>u(m,m-1)}),m<n.length-1&&e.jsx(G.moveDown,{className:"size-4 cursor-pointer",onClick:()=>u(m,m+1),children:""}),e.jsxs(Sa,{modal:!1,children:[e.jsx(ja,{children:e.jsx(G.more,{className:"size-4 cursor-pointer"})}),e.jsxs(Zs,{children:[e.jsx(de,{className:"flex md:hidden",onClick:a,children:""}),e.jsxs(mh,{children:[e.jsx(Fi,{children:""}),e.jsx(uh,{children:e.jsxs(Ki,{children:[i.map(g=>e.jsx(de,{onClick:o(g.content,m+1),children:g.name},g.name)),r.length>0&&e.jsx(wa,{}),r.map(g=>e.jsx(de,{onClick:()=>c(g.content,m+1),children:g.name},g.id))]})})]}),e.jsx(de,{onClick:()=>h(f,m+1),children:""}),e.jsx(de,{className:"text-destructive",onClick:()=>p(f),children:""})]})]})]})]},f.name))})]})})})})}function Gt(){const a=Te(o=>o.setConfirm),s=Te(o=>o.setCancel),t=Te(o=>o.setOpen),n=Te(o=>o.setType),i=Te(o=>o.setDisableSelect);return{selectAsset:(o,c)=>new Promise(l=>{a(p=>{l(p),t(!1)}),s(()=>{l(void 0),t(!1)}),t(!0),n(o),i(c)})}}async function Yi(a){const{text:s,voiceType:t,volume:n,speed:i,pitch:r,token:o,appid:c,resourceId:l="volc.tts_async.default"}=a,p=5*60*1e3,h=Date.now(),u=await eu({text:s,voiceType:t,volume:n,speed:i,pitch:r,token:o,appid:c,resourceId:l});if(!u.task_id)throw new Error(": ".concat(u.message));if(u.task_status===2)throw new Error(": ".concat(JSON.stringify(u)));const f=u.task_id;let m;for(;;){if(Date.now()-h>p)throw new Error("");const g=await tu({taskId:f,token:o,appid:c,resourceId:l});if(g.task_status===1){m=g;break}else{if(g.task_status===2)throw new Error(": ".concat(JSON.stringify(g)));await new Promise(v=>setTimeout(v,1e3))}}return m}function qh(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){const s=Math.random()*16|0;return(a==="x"?s:s&3|8).toString(16)})}async function eu(a){const{text:s,voiceType:t,volume:n,speed:i,pitch:r,token:o,appid:c,resourceId:l}=a,h={"volc.tts_async.default":"/api/tts/ark/api/v1/tts_async/submit","volc.tts_async.emotion":"/api/tts/ark/api/v1/tts_async_with_emotion/submit"}[l],u=qh(),f="mp3",m={"Content-Type":"application/json","Resource-Id":l,Authorization:"Bearer; ".concat(o)};return await(await fetch(h,{method:"POST",headers:m,body:JSON.stringify({appid:c,reqid:u,text:s,format:f,voice_type:t,volume:n,speed:i,pitch:r})})).json()}async function tu(a){const{taskId:s,token:t,appid:n,resourceId:i}=a,o={"volc.tts_async.default":"/api/tts/ark/api/v1/tts_async/query","volc.tts_async.emotion":"/api/tts/ark/api/v1/tts_async_with_emotion/query"}[i],c="appid=".concat(n,"&task_id=").concat(s),l={"Resource-Id":i,Authorization:"Bearer; ".concat(t)};return await(await fetch("".concat(o,"?").concat(c),{method:"GET",headers:l})).json()}const Pt="NONE_VOICE",su=[{name:"",value:Pt},{name:" 2.0",value:"BV700_V2_streaming"},{name:"",value:"BV705_streaming"},{name:" 2.0",value:"BV701_V2_streaming"},{name:" 2.0",value:"BV001_V2_streaming"},{name:"",value:"BV700_streaming"},{name:"-2.0",value:"BV406_V2_streaming"},{name:"-",value:"BV406_streaming"},{name:"-2.0",value:"BV407_V2_streaming"},{name:"-",value:"BV407_streaming"},{name:"",value:"BV001_streaming"},{name:"",value:"BV002_streaming"},{name:"",value:"BV701_streaming"},{name:"",value:"BV123_streaming"},{name:"",value:"BV120_streaming"},{name:"",value:"BV119_streaming"},{name:"",value:"BV115_streaming"},{name:"",value:"BV107_streaming"},{name:"",value:"BV100_streaming"},{name:"",value:"BV104_streaming"},{name:"",value:"BV004_streaming"},{name:"",value:"BV113_streaming"},{name:"",value:"BV102_streaming"},{name:"",value:"BV405_streaming"},{name:"",value:"BV007_streaming"},{name:"",value:"BV009_streaming"},{name:"",value:"BV419_streaming"},{name:"",value:"BV415_streaming"},{name:"",value:"BV008_streaming"},{name:"",value:"BV408_streaming"},{name:"",value:"BV426_streaming"},{name:"",value:"BV428_streaming"},{name:"",value:"BV403_streaming"},{name:"",value:"BV158_streaming"},{name:"",value:"BV157_streaming"},{name:"",value:"BR001_streaming"},{name:"",value:"BV410_streaming"},{name:"",value:"BV411_streaming"},{name:"-",value:"BV437_streaming"},{name:"",value:"BV412_streaming"},{name:"",value:"BV159_streaming"},{name:"",value:"BV418_streaming"},{name:"",value:"BV142_streaming"},{name:"",value:"BV143_streaming"},{name:"",value:"BV056_streaming"},{name:"",value:"BV005_streaming"},{name:"",value:"BV064_streaming"},{name:"",value:"BV051_streaming"},{name:"",value:"BV063_streaming"},{name:"",value:"BV417_streaming"},{name:"",value:"BV050_streaming"},{name:"",value:"BV061_streaming"},{name:"",value:"BV401_streaming"},{name:"",value:"BV402_streaming"},{name:"",value:"BV006_streaming"},{name:"",value:"BV011_streaming"},{name:"",value:"BV012_streaming"},{name:"-",value:"BV034_streaming"},{name:"",value:"BV033_streaming"}];async function At(a,s){var r;const t=a.states,n=(r=t.find(o=>o.id===a.stateId))!=null?r:t[0];let i;return n.ext==="gif"?i=new xs({source:xe(n)}):n.ext==="mp4"?i=new Yt({source:xe(n)}):i=new Dt({source:xe(n)}),i.label=a.name,i.assetID=a.id,i.assetType=a.type,await i.load(),a.type===C.Character?(i.zIndex=ce.Character,i.x=s.options.width/2-i.width/2,i.y=s.options.height-i.height):a.type===C.Background?(i.zIndex=ce.Background,i.width=s.options.width,i.height=s.options.height):a.type===C.Dialog&&(i.zIndex=ce.Dialog,i.x=s.options.width/2-i.width/2,i.y=s.options.height-i.height),i}function au(a){const s=new We("",{fill:16777215,breakWords:!0,wordWrap:!0,wordWrapWidth:1600,fontSize:60,leading:15});return s.x=a.options.width/2-s.width/2,s.y=a.options.height/2-s.height/2,s.zIndex=ce.Text,s.label=""+s.name,s}function Ga(a){var i;const s=a.states,t=(i=s.find(r=>r.id===a.stateId))!=null?i:s[0],n=new Mt({source:xe(t)});return n.label=t.name,n.assetID=a.id,n.assetType=a.type,n}let Mi=!1;function nu(a){Mi=a}function Qa(){return Mi}function _a(a){let s=a,t="";const n=a.match(/^(.+)\[(.+)\]$/);return n&&(s=n[1],t=n[2]),{name:s,state:t}}function iu(a){const s=(t,n)=>n?"".concat(t,"[").concat(n,"]"):t;return a.map(t=>{const n=[];return t.name&&n.push("\n".concat(t.name)),n.push("\n".concat(s(t.background.name,t.background.state))),t.dialogues.forEach(i=>{const{name:r,state:o}=i.character;n.push("".concat(s(r,o),"\n").concat(i.line))}),n.join("\n\n")}).join("\n\n\n")}function ru(a){const s=a.split(/\n\s*\n/).filter(n=>n.trim()!=="").map(n=>{const[i,...r]=n.split("\n");return{name:i,value:r.join("\n")}}),t=[];return s.forEach(n=>{var i;if(n.name==="")t.push({name:n.value,background:{name:"",state:""},dialogues:[]});else if(/(\[.+\])?/.test(n.name)){const r=(i=n.name.match(/(\[.+\])?/)[1])==null?void 0:i.replace(/\[|\]/g,"");t[t.length-1]||t.push({name:"",type:r,background:{name:"",state:""},dialogues:[]}),t[t.length-1].type=r,t[t.length-1].background=_a(n.value)}else t[t.length-1]||t.push({name:"",background:{name:"",state:""},dialogues:[]}),t[t.length-1].dialogues.push({character:_a(n.name),line:n.value})}),t}async function ou(a){const s=new Set,t=new Set;a.forEach(r=>{r.dialogues.forEach(o=>{o.character.name!==""&&s.add(o.character.name)}),t.add(r.background.name)});const n={},i={};for(const r of s)n[r]=await $s(r,void 0,C.Character);for(const r of t)i[r]=await $s(r,void 0,C.Background);return{characterAssetMap:n,backgroundAssetMap:i}}function Hs(a,s){return a.states.find(t=>t.name===s)||a.states.find(t=>t.id===a.stateId)||a.states[0]}async function lu(a,s,t,n,i){var r;for(const o of a){let c;const l=(r=o.type)!=null?r:i;if(l){let m={:Xi,:Li,:rs}[l];if(!m)try{const g=await Bt.where("name").equals(l).first(),v=await Ie.fromJSON(JSON.parse(g.content),!1);m=()=>v}catch(g){console.error("",g),m=rs}c=m()}else c=rs();if(c.label=o.name,s.addScene(c),s.setActiveScene(c),o.background){const{name:f,state:m}=o.background,g=n[f];if(g){const v=Hs(g,m);g.name=f,g.stateId=v.id;const b=await At(g,s);s.addChild(b)}}let p=1;const h=new Set;o.dialogues.forEach(f=>{const{name:m}=f.character;m!==""&&h.add(m)});const u=h.size;for(const f of o.dialogues){const m={targetName:"",speakerTargetName:"",name:""};let g;if(f.character.name==="")m.speakerTargetName="Narrator";else{const{name:b,state:V}=f.character,W=t[b];if(W){const R=c.getChildByLabel(b);if(R){if(m.speakerTargetName=R.name,m.name=R.label,V&&W.states.find(H=>H.name===V)){const H=Hs(W,V);g={type:"directive",value:{directive:"ChangeSource",params:{targetName:R.name,source:xe(H)},label:":".concat(R.label,":").concat(V)},children:[{text:""}]}}}else{const H=Hs(W,V);W.stateId=H.id,W.name=b;const X=await At(W,s);X.x=s.options.width/(u+1)*p-X.width/2,p++,s.addChild(X),m.speakerTargetName=X.name,m.name=X.label}}else m.name=b}let v=[];g&&(v=[{text:""},g,{text:""}]),s.addDialogue({speak:{speaker:m},lines:[{type:"p",children:[...v,{text:f.line}]}]})}}}async function Hi({lines:a,editor:s,project:t,speak:n,ttsSettings:i}){var h;if(!i||!i.appid||!i.token)throw new Error("");const r=n.speaker.speakerTargetName;let o;r==="Narrator"?o=lt:o=s.activeScene.getChildByName(r).assetID;const l=(await ka(o)).voice;if(!l)throw new Error(", ");if(l===Pt)throw{voice:l,message:" "};(h=n.voice)!=null&&h.targetName&&s.removeSoundByName(n.voice.targetName);const p=vi(a);try{const u=await Yi({token:i.token,appid:i.appid,text:p,voiceType:l}),f=await cd(u.audio_url,p.slice(0,6)),m=await Gh(t.id,C.Audio,f),g=Ga(m);s.addSound(g);const v=zi(m);return{sound:g,url:v}}catch(u){throw console.error(u),new Error("".concat(p.slice(0,6),"... : ").concat(u.message))}}const gt=Ll,Bi=d.forwardRef(({className:a,...s},t)=>e.jsx(gn,{ref:t,className:S("flex h-9 items-center space-x-1 rounded-md border bg-background p-1 shadow-sm",a),...s}));Bi.displayName=gn.displayName;const st=d.forwardRef(({className:a,...s},t)=>e.jsx(bn,{ref:t,className:S("flex cursor-default select-none items-center rounded-sm px-2 sm:px-3 py-1 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground",a),...s}));st.displayName=bn.displayName;const cu=d.forwardRef(({className:a,inset:s,children:t,...n},i)=>e.jsxs(vn,{ref:i,className:S("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground",s&&"pl-8",a),...n,children:[t,e.jsx(mn,{className:"ml-auto h-4 w-4"})]}));cu.displayName=vn.displayName;const du=d.forwardRef(({className:a,...s},t)=>e.jsx(yn,{ref:t,className:S("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...s}));du.displayName=yn.displayName;const bt=d.forwardRef(({className:a,align:s="start",alignOffset:t=-4,sideOffset:n=8,...i},r)=>e.jsx(Il,{children:e.jsx(Sn,{ref:r,align:s,alignOffset:t,sideOffset:n,className:S("z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...i})}));bt.displayName=Sn.displayName;const U=d.forwardRef(({className:a,inset:s,...t},n)=>e.jsx(jn,{ref:n,className:S("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s&&"pl-8",a),...t}));U.displayName=jn.displayName;const hu=d.forwardRef(({className:a,children:s,checked:t,...n},i)=>e.jsxs(wn,{ref:i,className:S("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),checked:t,...n,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Nn,{children:e.jsx(ca,{className:"h-4 w-4"})})}),s]}));hu.displayName=wn.displayName;const uu=d.forwardRef(({className:a,children:s,...t},n)=>e.jsxs(Cn,{ref:n,className:S("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...t,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Nn,{children:e.jsx(pn,{className:"h-4 w-4 fill-current"})})}),s]}));uu.displayName=Cn.displayName;const mu=d.forwardRef(({className:a,inset:s,...t},n)=>e.jsx(kn,{ref:n,className:S("px-2 py-1.5 text-sm font-semibold",s&&"pl-8",a),...t}));mu.displayName=kn.displayName;const vt=d.forwardRef(({className:a,...s},t)=>e.jsx(Zn,{ref:t,className:S("-mx-1 my-1 h-px bg-muted",a),...s}));vt.displayName=Zn.displayName;const Ne=Fl,pu=Kl,Pi=d.forwardRef(({className:a,...s},t)=>e.jsx(Gn,{ref:t,className:S("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...s}));Pi.displayName=Gn.displayName;const je=d.forwardRef(({className:a,children:s,disableClose:t,...n},i)=>e.jsxs(pu,{children:[e.jsx(Pi,{}),e.jsxs(Tn,{ref:i,className:S("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...n,children:[s,!t&&e.jsxs(Xl,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[e.jsx(Vn,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));je.displayName=Tn.displayName;const re=({className:a,...s})=>e.jsx("div",{className:S("flex flex-col space-y-1.5 text-center sm:text-left",a),...s});re.displayName="DialogHeader";const Gs=({className:a,...s})=>e.jsx("div",{className:S("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",a),...s});Gs.displayName="DialogFooter";const oe=d.forwardRef(({className:a,...s},t)=>e.jsx(Rn,{ref:t,className:S("text-lg font-semibold leading-none tracking-tight",a),...s}));oe.displayName=Rn.displayName;const le=d.forwardRef(({className:a,...s},t)=>e.jsx(Wn,{ref:t,className:S("text-sm text-muted-foreground",a),...s}));le.displayName=Wn.displayName;const fu=ye("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),fe=d.forwardRef(({className:a,...s},t)=>e.jsx(In,{ref:t,className:S(fu(),a),...s}));fe.displayName=In.displayName;const ct=Yl,Ai=d.createContext({}),Y=({...a})=>e.jsx(Ai.Provider,{value:{name:a.name},children:e.jsx(zl,{...a})}),Ts=()=>{const a=d.useContext(Ai),s=d.useContext(Ui),{getFieldState:t,formState:n}=Dl(),i=t(a.name,n);if(!a)throw new Error("useFormField should be used within <FormField>");const{id:r}=s;return{id:r,name:a.name,formItemId:"".concat(r,"-form-item"),formDescriptionId:"".concat(r,"-form-item-description"),formMessageId:"".concat(r,"-form-item-message"),...i}},Ui=d.createContext({}),F=d.forwardRef(({className:a,...s},t)=>{const n=d.useId();return e.jsx(Ui.Provider,{value:{id:n},children:e.jsx("div",{ref:t,className:S("space-y-2",a),...s})})});F.displayName="FormItem";const z=d.forwardRef(({className:a,...s},t)=>{const{error:n,formItemId:i}=Ts();return e.jsx(fe,{ref:t,className:S(n&&"text-destructive",a),htmlFor:i,...s})});z.displayName="FormLabel";const K=d.forwardRef(({...a},s)=>{const{error:t,formItemId:n,formDescriptionId:i,formMessageId:r}=Ts();return e.jsx(ma,{ref:s,id:n,"aria-describedby":t?"".concat(i," ").concat(r):"".concat(i),"aria-invalid":!!t,...a})});K.displayName="FormControl";const os=d.forwardRef(({className:a,...s},t)=>{const{formDescriptionId:n}=Ts();return e.jsx("p",{ref:t,id:n,className:S("text-[0.8rem] text-muted-foreground",a),...s})});os.displayName="FormDescription";const M=d.forwardRef(({className:a,children:s,...t},n)=>{const{error:i,formMessageId:r}=Ts(),o=i?String(i==null?void 0:i.message):s;return o?e.jsx("p",{ref:n,id:r,className:S("text-[0.8rem] font-medium text-destructive",a),...t,children:o}):null});M.displayName="FormMessage";const P=d.forwardRef(({className:a,type:s,...t},n)=>e.jsx("input",{type:s,className:S("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",a),ref:n,...t}));P.displayName="Input";const Ta=ye("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),j=d.forwardRef(({className:a,variant:s,size:t,asChild:n=!1,...i},r)=>{const o=n?ma:"button";return e.jsx(o,{className:S(Ta({variant:s,size:t,className:a})),ref:r,...i})});j.displayName="Button";const xu=B({templateName:E().min(1,"")});function gu({isOpen:a,sceneName:s,onClose:t}){const n=I(c=>c.editor),i=at({resolver:nt(xu),defaultValues:{templateName:""}}),r=c=>{c||t()},o=async c=>{await Bt.add({name:c.templateName,type:"",content:JSON.stringify(n.cloneSceneByName(s))}),t(),i.reset()};return e.jsx(Ne,{open:a,onOpenChange:r,children:e.jsxs(je,{children:[e.jsxs(re,{children:[e.jsx(oe,{children:""}),e.jsx(le,{})]}),e.jsx(ct,{...i,children:e.jsxs("form",{onSubmit:i.handleSubmit(o),className:"space-y-8",children:[e.jsx(Y,{control:i.control,name:"templateName",render:({field:c})=>e.jsxs(F,{children:[e.jsx(z,{children:""}),e.jsx(K,{children:e.jsx(P,{placeholder:"",...c})}),e.jsx(M,{})]})}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx(j,{type:"button",variant:"outline",onClick:t,children:""}),e.jsx(j,{type:"submit",children:""})]})]})})]})})}function bu({isOpen:a,onClose:s}){const t=Et(()=>Bt.reverse().toArray()),n=async r=>{await Bt.delete(r)},i=r=>{r||s()};return e.jsx(Ne,{open:a,onOpenChange:i,children:e.jsxs(je,{className:"max-h-[80vh] overflow-auto",children:[e.jsxs(re,{children:[e.jsx(oe,{children:""}),e.jsx(le,{})]}),e.jsxs(ws,{children:[e.jsx(Ns,{children:e.jsxs(it,{children:[e.jsx(rt,{children:""}),e.jsx(rt,{className:"w-[100px]",children:""})]})}),e.jsx(Cs,{children:t==null?void 0:t.map(r=>e.jsxs(it,{children:[e.jsx(ot,{children:r.name}),e.jsx(ot,{children:e.jsxs(j,{variant:"ghost",size:"icon",onClick:()=>n(r.id),children:[e.jsx(G.delete,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:""})]})})]},r.id))})]})]})})}const Va=d.forwardRef(({className:a,value:s,...t},n)=>e.jsx(Ln,{ref:n,className:S("relative h-2 w-full overflow-hidden rounded-full bg-primary/20",a),...t,children:e.jsx(Ml,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:"translateX(-".concat(100-(s||0),"%)")}})}));Va.displayName=Ln.displayName;function vu({progress:a,url:s,subtitles:t,isOpen:n,onClose:i}){const r=I(l=>l.project),o=l=>{l||i()},c=()=>{gi(r.name,s)};return e.jsx(Ne,{open:n,onOpenChange:o,children:e.jsxs(je,{className:"min-w-[80vw]",onPointerDownOutside:l=>l.preventDefault(),children:[e.jsxs(re,{children:[e.jsx(oe,{children:""}),e.jsx(le,{})]}),!s&&e.jsx(Va,{value:a.value}),s&&e.jsx("video",{src:s,className:"w-full aspect-[16/9]",controls:!0}),e.jsx(Gs,{children:s&&e.jsxs(j,{onClick:c,children:[e.jsx(G.download,{className:"size-4 mr-1"}),""]})})]})})}const yu=d.forwardRef(({progress:a,isOpen:s,onReplay:t,onClose:n,onExport:i},r)=>{const o=d.useRef(null);d.useImperativeHandle(r,()=>({getPreviewCanvas:()=>o.current}));const c=l=>{l||n()};return e.jsx(Ne,{open:s,onOpenChange:c,children:e.jsxs(je,{className:"min-w-[80vw]",onPointerDownOutside:l=>l.preventDefault(),children:[e.jsxs(re,{children:[e.jsx(oe,{children:""}),e.jsx(le,{}),e.jsx("canvas",{ref:o,className:"w-full aspect-[16/9]"}),e.jsx(Va,{value:a.value,className:"mt-2"})]}),e.jsxs(Gs,{children:[e.jsx(j,{variant:"ghost",onClick:t,children:e.jsx(G.refresh,{className:"size-5"})}),e.jsxs(j,{onClick:i,children:[e.jsx(G.download,{className:"size-4 mr-1"}),""]})]})]})})}),Su=1,ju=1e6;let Bs=0;function wu(){return Bs=(Bs+1)%Number.MAX_SAFE_INTEGER,Bs.toString()}const Ps=new Map,$a=a=>{if(Ps.has(a))return;const s=setTimeout(()=>{Ps.delete(a),Ft({type:"REMOVE_TOAST",toastId:a})},ju);Ps.set(a,s)},Nu=(a,s)=>{switch(s.type){case"ADD_TOAST":return{...a,toasts:[s.toast,...a.toasts].slice(0,Su)};case"UPDATE_TOAST":return{...a,toasts:a.toasts.map(t=>t.id===s.toast.id?{...t,...s.toast}:t)};case"DISMISS_TOAST":{const{toastId:t}=s;return t?$a(t):a.toasts.forEach(n=>{$a(n.id)}),{...a,toasts:a.toasts.map(n=>n.id===t||t===void 0?{...n,open:!1}:n)}}case"REMOVE_TOAST":return s.toastId===void 0?{...a,toasts:[]}:{...a,toasts:a.toasts.filter(t=>t.id!==s.toastId)}}},ls=[];let cs={toasts:[]};function Ft(a){cs=Nu(cs,a),ls.forEach(s=>{s(cs)})}function Cu({...a}){const s=wu(),t=i=>Ft({type:"UPDATE_TOAST",toast:{...i,id:s}}),n=()=>Ft({type:"DISMISS_TOAST",toastId:s});return Ft({type:"ADD_TOAST",toast:{...a,id:s,open:!0,onOpenChange:i=>{i||n()}}}),{id:s,dismiss:n,update:t}}function et(){const[a,s]=d.useState(cs);return d.useEffect(()=>(ls.push(s),()=>{const t=ls.indexOf(s);t>-1&&ls.splice(t,1)}),[a]),{...a,toast:Cu,dismiss:t=>Ft({type:"DISMISS_TOAST",toastId:t})}}const ku=B({projectName:E().min(1,"")});function Zu({isOpen:a,onClose:s}){const t=I(l=>l.editor),n=I(l=>l.setProject),{toast:i}=et(),r=at({resolver:nt(ku),defaultValues:{projectName:""}}),o=l=>{l||s()},c=async l=>{const p={name:l.projectName,content:"",time:Date.now()},h=await Ae.add(p);t.clear(),n({id:h,...p}),s(),r.reset(),i({title:"!",description:"",duration:1e3})};return e.jsx(Ne,{open:a,onOpenChange:o,children:e.jsxs(je,{children:[e.jsxs(re,{children:[e.jsx(oe,{children:""}),e.jsx(le,{})]}),e.jsx(ct,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(c),className:"space-y-8",children:[e.jsx(Y,{control:r.control,name:"projectName",render:({field:l})=>e.jsxs(F,{children:[e.jsx(z,{children:""}),e.jsx(K,{children:e.jsx(P,{placeholder:"",...l})}),e.jsx(M,{})]})}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx(j,{type:"button",variant:"outline",onClick:s,children:""}),e.jsx(j,{type:"submit",children:""})]})]})})]})})}function Gu({isOpen:a,onClose:s}){const t=I(h=>h.editor),n=I(h=>h.setProject),i=Et(()=>Ae.reverse().toArray()),r=d.useRef(!1),o=h=>{h||s()},c=async h=>{if(r.current)return;r.current=!0;const u=await Ae.get(h);t.clear(),u.content&&(await t.loadFromJSON(u.content),t.setActiveSceneByIndex(0)),n(u),s(),setTimeout(()=>{r.current=!1},100)},l=async h=>{await Ae.delete(h),await Th(h)},p=async h=>{const u=await Ae.get(h);await Ae.add({name:"".concat(u.name," - "),content:u.content,time:Date.now()})};return e.jsx(Ne,{open:a,onOpenChange:o,children:e.jsxs(je,{className:"max-h-[80vh] overflow-auto",children:[e.jsxs(re,{children:[e.jsx(oe,{children:""}),e.jsx(le,{})]}),e.jsxs(ws,{children:[e.jsx(Ns,{children:e.jsxs(it,{children:[e.jsx(rt,{children:""}),e.jsx(rt,{className:"w-[80px]",children:""})]})}),e.jsx(Cs,{children:i==null?void 0:i.map(h=>e.jsxs(it,{children:[e.jsx(ot,{onClick:()=>c(h.id),children:e.jsx("span",{className:"cursor-pointer",children:h.name})}),e.jsxs(ot,{className:"flex gap-2",children:[e.jsx(G.copy,{className:"h-4 w-4 cursor-pointer",onClick:()=>p(h.id)}),e.jsx(G.delete,{className:"h-4 w-4 cursor-pointer",onClick:()=>l(h.id)})]})]},h.id))})]})]})})}const Tu=Bl,Vu=Hl,Ei=d.forwardRef(({className:a,...s},t)=>e.jsx(Xn,{className:S("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...s,ref:t}));Ei.displayName=Xn.displayName;const Oi=d.forwardRef(({className:a,...s},t)=>e.jsxs(Vu,{children:[e.jsx(Ei,{}),e.jsx(Fn,{ref:t,className:S("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...s})]}));Oi.displayName=Fn.displayName;const Ji=({className:a,...s})=>e.jsx("div",{className:S("flex flex-col space-y-2 text-center sm:text-left",a),...s});Ji.displayName="AlertDialogHeader";const Qi=({className:a,...s})=>e.jsx("div",{className:S("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",a),...s});Qi.displayName="AlertDialogFooter";const _i=d.forwardRef(({className:a,...s},t)=>e.jsx(Kn,{ref:t,className:S("text-lg font-semibold",a),...s}));_i.displayName=Kn.displayName;const $i=d.forwardRef(({className:a,...s},t)=>e.jsx(zn,{ref:t,className:S("text-sm text-muted-foreground",a),...s}));$i.displayName=zn.displayName;const qi=d.forwardRef(({className:a,...s},t)=>e.jsx(Dn,{ref:t,className:S(Ta(),a),...s}));qi.displayName=Dn.displayName;const er=d.forwardRef(({className:a,...s},t)=>e.jsx(Yn,{ref:t,className:S(Ta({variant:"outline"}),"mt-2 sm:mt-0",a),...s}));er.displayName=Yn.displayName;function Ru({isOpen:a,onConfirm:s,onClose:t}){const n=r=>{r||t()},i=()=>{s(),t()};return e.jsx(Tu,{open:a,onOpenChange:n,children:e.jsxs(Oi,{children:[e.jsxs(Ji,{children:[e.jsx(_i,{children:""}),e.jsx($i,{})]}),e.jsxs(Qi,{children:[e.jsx(er,{children:""}),e.jsx(qi,{onClick:i,children:""})]})]})})}function tr(){const a=gs(r=>r.setOpen),s=gs(r=>r.setLoadingText);return{showLoading:r=>{a(!0),s(r)},updateLoadingText:r=>{s(r)},hideLoading:()=>{a(!1),s("")}}}const be=$l,Ra=ql,ve=ec,ue=d.forwardRef(({className:a,children:s,...t},n)=>e.jsxs(Mn,{ref:n,className:S("flex h-9 w-full items-center justify-between whitespace-nowrap rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",a),"data-disable-click-outside":!0,...t,children:[s,e.jsx(Pl,{asChild:!0,children:e.jsx(Al,{"data-disable-click-outside":!0,className:"h-4 w-4 opacity-50"})})]}));ue.displayName=Mn.displayName;const sr=d.forwardRef(({className:a,...s},t)=>e.jsx(Hn,{ref:t,className:S("flex cursor-default items-center justify-center py-1",a),"data-disable-click-outside":!0,...s,children:e.jsx(Ul,{})}));sr.displayName=Hn.displayName;const ar=d.forwardRef(({className:a,...s},t)=>e.jsx(Bn,{ref:t,className:S("flex cursor-default items-center justify-center py-1",a),"data-disable-click-outside":!0,...s,children:e.jsx(El,{})}));ar.displayName=Bn.displayName;const me=d.forwardRef(({className:a,children:s,position:t="popper",...n},i)=>e.jsx(Ol,{children:e.jsxs(Pn,{ref:i,className:S("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",a),position:t,"data-disable-click-outside":!0,...n,children:[e.jsx(sr,{}),e.jsx(Jl,{className:S("p-1",t==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),"data-disable-click-outside":!0,children:s}),e.jsx(ar,{})]})}));me.displayName=Pn.displayName;const Vs=d.forwardRef(({className:a,...s},t)=>e.jsx(An,{ref:t,className:S("px-2 py-1.5 text-sm font-semibold",a),...s,"data-disable-click-outside":!0}));Vs.displayName=An.displayName;const $=d.forwardRef(({className:a,children:s,...t},n)=>e.jsxs(Un,{ref:n,className:S("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),"data-disable-click-outside":!0,...t,children:[e.jsx("span",{className:"absolute right-2 flex h-3.5 w-3.5 items-center justify-center","data-disable-click-outside":!0,children:e.jsx(Ql,{children:e.jsx(ca,{className:"h-4 w-4"})})}),e.jsx(_l,{"data-disable-click-outside":!0,children:s})]}));$.displayName=Un.displayName;const Wu=d.forwardRef(({className:a,...s},t)=>e.jsx(En,{ref:t,className:S("-mx-1 my-1 h-px bg-muted",a),"data-disable-click-outside":!0,...s}));Wu.displayName=En.displayName;const Rs=tc,ts=d.forwardRef(({className:a,...s},t)=>e.jsx(On,{ref:t,className:S("inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground",a),...s}));ts.displayName=On.displayName;const De=d.forwardRef(({className:a,...s},t)=>e.jsx(Jn,{ref:t,className:S("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow",a),...s}));De.displayName=Jn.displayName;const _e=d.forwardRef(({className:a,...s},t)=>e.jsx(Qn,{ref:t,className:S("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",a),...s}));_e.displayName=Qn.displayName;const Ee=ys()(sc(a=>({ai:null,updateAI:s=>a({ai:s}),tts:null,updateTTS:s=>a({tts:s})}),{name:"settings"})),Iu=B({platform:E().min(1,""),key:E().min(1,"API KEY"),model:E().min(1,"")}),Lu=B({token:E().min(1,"Token"),appid:E().min(1,"AppID")});function Xu({isOpen:a,onClose:s}){const[t,n]=d.useState("llm"),i=Ee(m=>m.ai),r=Ee(m=>m.tts),o=Ee(m=>m.updateAI),c=Ee(m=>m.updateTTS),l=m=>{m||s()},p=at({resolver:nt(Iu),defaultValues:{platform:"deepseek",key:"",model:"deepseek-chat"}}),h=at({resolver:nt(Lu),defaultValues:{appid:"",token:""}});function u(m){o(m),s()}function f(m){c(m),s()}return d.useEffect(()=>{i&&p.reset(i)},[i,p]),d.useEffect(()=>{r&&h.reset(r)},[r,h]),e.jsx(Ne,{open:a,onOpenChange:l,children:e.jsxs(je,{className:"min-w-[400px]",onPointerDownOutside:m=>m.preventDefault(),children:[e.jsxs(re,{children:[e.jsx(oe,{children:""}),e.jsx(le,{})]}),e.jsxs(Rs,{value:t,onValueChange:n,className:"w-full",children:[e.jsxs(ts,{className:"grid grid-cols-2 mb-4",children:[e.jsx(De,{value:"llm",children:""}),e.jsx(De,{value:"tts",children:""})]}),e.jsx(_e,{value:"llm",children:e.jsx(ct,{...p,children:e.jsxs("form",{onSubmit:p.handleSubmit(u),className:"space-y-4",children:[e.jsx(Y,{control:p.control,name:"platform",render:({field:m})=>e.jsxs(F,{children:[e.jsx(z,{children:"AI"}),e.jsx(K,{children:e.jsxs(be,{onValueChange:m.onChange,value:m.value,children:[e.jsx(ue,{children:e.jsx(ve,{placeholder:"AI"})}),e.jsxs(me,{children:[e.jsx($,{value:"deepseek",children:"DeepSeek"}),e.jsx($,{value:"ark",children:""}),e.jsx($,{value:"openai",children:"OpenAI"})]})]})}),e.jsx(M,{})]})}),e.jsx(Y,{control:p.control,name:"key",render:({field:m})=>e.jsxs(F,{children:[e.jsx(z,{children:"API KEY"}),e.jsx(K,{children:e.jsx(P,{type:"password",placeholder:"API KEY",...m})}),e.jsx(M,{})]})}),e.jsx(Y,{control:p.control,name:"model",render:({field:m})=>e.jsxs(F,{children:[e.jsx(z,{children:"Model"}),e.jsx(K,{children:e.jsx(P,{placeholder:"",...m})}),e.jsx(M,{})]})}),e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx(j,{type:"submit",children:""}),e.jsx(j,{variant:"ghost",onClick:s,children:""})]})]})})}),e.jsx(_e,{value:"tts",children:e.jsx(ct,{...h,children:e.jsxs("form",{onSubmit:h.handleSubmit(f),className:"space-y-4",children:[e.jsx(Y,{control:h.control,name:"appid",render:({field:m})=>e.jsxs(F,{children:[e.jsx(z,{children:"AppID"}),e.jsx(K,{children:e.jsx(P,{placeholder:"AppID",...m})}),e.jsx(M,{})]})}),e.jsx(Y,{control:h.control,name:"token",render:({field:m})=>e.jsxs(F,{children:[e.jsx(z,{children:"Token"}),e.jsx(K,{children:e.jsx(P,{type:"password",placeholder:"Token",...m})}),e.jsx(M,{})]})}),e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx(j,{type:"submit",children:""}),e.jsx(j,{variant:"ghost",onClick:s,children:""})]})]})})})]})]})})}function Tt(a){const[s,t]=d.useState(window.matchMedia(a).matches);return d.useEffect(()=>{const n=window.matchMedia(a);n.matches!==s&&t(n.matches);const i=()=>t(n.matches);return n.addEventListener("change",i),()=>n.removeEventListener("change",i)},[s,a]),s}function Fu(){const[a,s]=d.useState(!1),[t,n]=d.useState();return{isOpenText2Scene:a,text2SceneType:t,handleOpenImportText2Scene:()=>{s(!0),n("formatter")},handleOpenAiText2Scene:()=>{s(!0),n("ai")},handleCloseText2Scene:()=>{s(!1)}}}async function nr(a,s){var u,f,m;const t=new URLSearchParams(window.location.search),n=Ee.getState().ai;let i=t.get("key"),r=t.get("model"),o=(u=t.get("platform"))!=null?u:"deepseek";if(i||(i=n.key,r=n.model,o=n.platform),!i||!r||!o)throw new Error(" AI ");const p=(m=(f=(await new ac({apiKey:i,baseURL:"".concat(location.origin,"/api/llm/").concat(o),dangerouslyAllowBrowser:!0}).chat.completions.create({messages:[{role:"system",content:a},{role:"user",content:s}],model:r})).choices[0])==null?void 0:f.message)==null?void 0:m.content;console.log("LLM Response:",p);const h=bi(p);if(h)return h.scenes;throw new Error(" JSON ")}async function Ku(a){const s=' JSON \n\n1.	 Typescript \n\n```typescript\ninterface StoryCharacter {\n  /**\n   * \n   */\n  name: string;\n  /**\n   * \n   */\n  state: string;\n}\n\ninterface StoryDialogue {\n  /**\n   *  3  3 \n   */\n  character: StoryCharacter;\n  /**\n   * \n   */\n  line: string;\n}\n\ninterface StoryBackground {\n  /**\n   * \n   */\n  name: string;\n  /**\n   * \n   */\n  state: string;\n}\n\nexport interface StoryScene {\n  /**\n   * \n   */\n  name: string;\n  /**\n   * \n   */\n  background: StoryBackground;\n  /**\n   * \n   */\n  dialogues: StoryDialogue[];\n}\n```\n\n2.	\n JSON  StoryScene \n```json\n{\n  "scenes": [{\n    "name": "",\n    "background": {\n      "name": "",\n      "state": ""\n    },\n    "dialogues": [{\n      "character": {\n        "name": "",\n        "state": ""\n      },\n      "line": ""\n    }{\n      "character": {\n        "name": "",\n        "state": ""\n      },\n      "line": ""\n    }, {\n      "character": {\n        "name": "",\n        "state": ""\n      },\n      "line": ""\n    }]\n  }, {\n    "name": "",\n    "background": {\n      "name": "",\n      "state": ""\n    },\n    "dialogues": [{\n      "character": {\n        "name": "",\n        "state": ""\n      },\n      "line": ""\n    }]\n  }]\n}\n```\n',t="".concat(a);return await nr(s,t)}async function zu(a){const s=' JSON \n\n1.	 Typescript \n\n```typescript\ninterface StoryCharacter {\n  /**\n   * \n   */\n  name: string;\n  /**\n   * \n   */\n  state: string;\n}\n\ninterface StoryDialogue {\n  /**\n   *  3  3 \n   */\n  character: StoryCharacter;\n  /**\n   * \n   */\n  line: string;\n}\n\ninterface StoryBackground {\n  /**\n   * \n   */\n  name: string;\n  /**\n   * \n   */\n  state: string;\n}\n\nexport interface StoryScene {\n  /**\n   * \n   */\n  name: string;\n  /**\n   * \n   */\n  background: StoryBackground;\n  /**\n   * \n   */\n  dialogues: StoryDialogue[];\n}\n```\n\n2.	\n JSON  StoryScene \n```json\n{\n  "scenes": [{\n    "name": "",\n    "background": {\n      "name": "",\n      "state": ""\n    },\n    "dialogues": [{\n      "character": {\n        "name": "",\n        "state": ""\n      },\n      "line": ""\n    },{\n      "character": {\n        "name": "",\n        "state": ""\n      },\n      "line": ""\n    }, {\n      "character": {\n        "name": "",\n        "state": ""\n      },\n      "line": ""\n    }]\n  }, {\n    "name": "",\n    "background": {\n      "name": "",\n      "state": ""\n    },\n    "dialogues": [{\n      "character": {\n        "name": "",\n        "state": ""\n      },\n      "line": ""\n    }]\n  }]\n}\n```\n',t="".concat(a);return await nr(s,t)}const ir=d.forwardRef(({className:a,...s},t)=>e.jsx("textarea",{className:S("flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",a),ref:t,...s}));ir.displayName="Textarea";function Du({accept:a,disabled:s,onFileSelect:t}){const[n,i]=d.useState(null),r=d.useRef(null),o=l=>{var h;const p=(h=l.target.files)==null?void 0:h[0];p&&(i(p.name),t(p))},c=()=>{var l;(l=r.current)==null||l.click()};return e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(j,{variant:"outline",size:"icon",onClick:c,"aria-label":"",disabled:s,children:e.jsx(nc,{className:"h-4 w-4"})}),e.jsx("input",{type:"file",ref:r,onChange:o,className:"hidden",accept:a}),n&&e.jsxs("span",{className:"text-sm text-gray-600",children:[": ",n]})]})}function Yu({value:a,onChange:s}){const t=a.split("\n"),n=i=>{const r=[...t];r.splice(i,0,"",""," ".concat(i+1),""),s(r.join("\n"))};return e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"text-xs text-muted-foreground bg-muted/50 p-2 rounded",children:[" ",e.jsx(Es,{className:"inline w-3 h-3"})," "]}),e.jsx(ge,{className:"h-[400px] w-full border rounded-md relative bg-background",children:e.jsx("div",{className:"p-4",children:t.map((i,r)=>{const o=i.trim()==="",c=r>0&&t[r-1].trim()==="",l=o;return e.jsxs("div",{className:S("group flex items-start py-1 px-2 hover:bg-muted/50 rounded transition-colors border-l-2 border-transparent",(o||c)&&"bg-primary/10 font-bold",l&&"border-l-primary mt-4 border-t border-t-primary/20"),children:[e.jsx("div",{className:"w-8 text-xs text-muted-foreground pt-1 select-none text-right mr-3",children:r+1}),e.jsx("div",{className:"relative w-6 h-6 mr-2 flex-shrink-0 flex items-center justify-center",children:e.jsx(j,{size:"icon",variant:"ghost",className:"h-6 w-6 opacity-20 group-hover:opacity-100 transition-all hover:bg-primary hover:text-primary-foreground",title:"",onClick:()=>n(r),children:e.jsx(Es,{className:"h-3 w-3"})})}),e.jsx("div",{className:"flex-1 whitespace-pre-wrap break-all text-sm leading-6",children:i||e.jsx("span",{className:"text-muted-foreground/30 italic h-6 block"})})]},r)})})})]})}function As({children:a,value:s,placeholder:t,completeButtonLabel:n,loading:i,onChange:r,onChangeTemplate:o,onComplete:c}){const l=d.useMemo(()=>!!i,[i]),{customTemplates:p}=Za(),[h,u]=d.useState("edit"),f=async b=>{const V=await b.text();r(V)},m=b=>{r(b.target.value)},g=()=>{c(s)},v=d.useMemo(()=>[{name:"",value:""},...p.map(b=>({name:b.name,value:b.name}))],[p]);return e.jsxs("div",{className:"space-y-4 w-full",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(fe,{children:""}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(j,{variant:h==="edit"?"secondary":"ghost",size:"sm",onClick:()=>u("edit"),children:[e.jsx(ic,{className:"w-4 h-4 mr-1"})," "]}),e.jsxs(j,{variant:h==="split"?"secondary":"ghost",size:"sm",onClick:()=>u("split"),children:[e.jsx(rc,{className:"w-4 h-4 mr-1"})," "]})]})]}),h==="edit"?e.jsx(ir,{value:s,onChange:m,placeholder:t,className:"min-h-[400px]",disabled:l}):e.jsx(Yu,{value:s,onChange:r}),e.jsxs("div",{className:"flex items-center justify-between",children:[a||e.jsx(Du,{disabled:l,onFileSelect:f,accept:".txt"}),e.jsxs("div",{className:"flex items-center space-x-6",children:[o&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm",children:":"}),e.jsxs(be,{onValueChange:o,defaultValue:v[0].name,children:[e.jsx(ue,{className:"flex-1 min-w-[150px]",children:e.jsx(ve,{placeholder:""})}),e.jsx(me,{children:v.map(b=>e.jsx($,{value:b.name,children:b.name},b.name))})]})]}),e.jsxs(j,{onClick:g,disabled:l,children:[i&&e.jsx(pa,{className:"animate-spin mr-1"}),i||n||""]})]})]})]})}function Mu({url:a,className:s}){const[t,n]=d.useState(!1),i=d.useRef(null),r=o=>{o.stopPropagation(),i.current&&(t?i.current.pause():i.current.play(),n(!t))};return e.jsxs("div",{className:S("w-full aspect-[1/1] flex justify-center items-center cursor-pointer relative",s),children:[e.jsx("audio",{ref:i,src:a,className:"hidden"}),e.jsx(j,{onClick:r,variant:"outline",size:"icon",className:"w-12 h-12",children:t?e.jsx(_n,{className:"h-6 w-6"}):e.jsx($n,{className:"h-6 w-6"})})]})}function Hu({url:a,className:s}){return e.jsx("div",{className:S("w-full h-full cursor-pointer flex justify-center items-center relative",s),style:{backgroundImage:'url(\'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20"><rect width="10" height="10" fill="%23ccc"/><rect x="10" y="10" width="10" height="10" fill="%23ccc"/></svg>\')'},children:a&&e.jsx("img",{src:a,className:"absolute left-0 top-0 h-full w-full object-contain"})})}function Bu(){return"font-".concat(Date.now())}function Pu({fontName:a,fontUrl:s,className:t}){const n=d.useMemo(()=>{if(a)return a;if(s)return Bu()},[a,s]);return d.useEffect(()=>{if(a)return;const i=document.createElement("style");return i.innerHTML="\n      @font-face {\n        font-family: '".concat(n,"';\n        src: url('").concat(s,"');\n      }\n    "),document.head.appendChild(i),()=>{a||document.head.removeChild(i)}},[n,a,s]),e.jsxs("div",{className:S("w-full aspect-[1/1] flex flex-col justify-center items-center relative",t),style:{fontFamily:n},children:[e.jsx("span",{children:""}),e.jsx("span",{children:"Sample Text"}),e.jsx("span",{children:"0123456789"})]})}function Au({url:a,className:s}){return e.jsx("video",{src:a,className:S("w-full h-full",s),controls:!0,muted:!0})}const Uu={[C.Background]:"240px",[C.Character]:"135px",[C.Thing]:"200px",[C.Dialog]:"240px",[C.Audio]:"150px",[C.Font]:"150px"},Us={[C.Background]:"aspect-[16/9]",[C.Character]:"aspect-[9/16]",[C.Thing]:"aspect-[1/1]",[C.Dialog]:"aspect-[16/3]"};function rr({type:a,url:s,ext:t,state:n}){const i=d.useMemo(()=>s||(n&&n.id?xe(n):""),[s,n]),r=d.useMemo(()=>t||(n?n.ext:""),[t,n]);return Object.keys(Us).includes(a)?r==="mp4"?e.jsx(Au,{url:i,className:Us[a]}):e.jsx(Hu,{url:i,className:Us[a]}):a===C.Audio?e.jsx(Mu,{url:i}):a===C.Font?e.jsx(Pu,{fontName:n==null?void 0:n.name,fontUrl:i}):null}function bs({type:a,state:s,children:t,onSelect:n}){return e.jsx(ut,{className:"rounded-md cursor-pointer",style:{width:Uu[a]},onClick:n,children:t||e.jsxs(e.Fragment,{children:[e.jsx(qe,{className:"p-2 flex justify-center",children:e.jsx(rr,{type:a,state:s})}),e.jsx(ks,{className:"font-medium p-2 pt-0 flex justify-center text-sm break-all",children:s.name})]})})}function Eu({asset:a,onSelect:s,onEdit:t,onDelete:n}){return e.jsxs(ut,{className:"rounded-md",children:[e.jsx(qe,{className:"p-0 flex justify-center cursor-pointer",onClick:s,children:e.jsx(G.folder,{className:"w-[120px] h-[120px] text-neutral-600 p-2"})}),e.jsxs(ks,{className:"w-[120px] font-medium p-2 pt-0 flex justify-between text-sm",children:[e.jsx("div",{className:"max-w-[100px] overflow-hidden text-ellipsis cursor-pointer",onClick:s,children:a.name}),e.jsxs(Sa,{children:[e.jsx(ja,{children:e.jsx(G.more,{className:"w-4 h-4 pointer"})}),e.jsxs(Zs,{children:[e.jsx(de,{onClick:t,children:""}),a.id!==lt&&e.jsx(de,{className:"text-destructive",onClick:n,children:""})]})]})]})]})}function Ou({isOpen:a,type:s,onClose:t}){const n=I(Z=>Z.editor),i=I(Z=>Z.project),r=I(Z=>Z.setProject),[o,c]=d.useState([]),[l,p]=d.useState(""),{toast:h}=et(),[u,f]=d.useState(null),[m,g]=d.useState(null),[v,b]=d.useState(""),[V,W]=d.useState(""),[R,H]=d.useState(""),[X,O]=d.useState(1),{selectAsset:ie}=Gt(),[T,y]=d.useState("");d.useEffect(()=>{if(s==="ai"&&O(1),s==="formatter"){O(2);const Z=localStorage.getItem("vnve_import_text");Z&&(W(Z),localStorage.removeItem("vnve_import_text"),h({title:" Story Painter "}))}},[s]);const w=()=>{t(),c([]),p(""),f(null),g(null),b(""),W("")},A=async Z=>{p("");try{const L=bi(Z);await ke(L!=null&&L.scenes?L.scenes:ru(Z))}catch(L){h({title:"",description:L.message,variant:"destructive"}),console.error(L)}finally{p("")}},ee=async(Z,L)=>{p(Z==="convert"?"":"");try{let se;Z==="convert"?se=await Ku(L):se=await zu(L);const pt=iu(se);W(pt),O(X+1)}catch(se){h({title:"".concat(Z==="convert"?"":"",""),description:se.message,variant:"destructive"})}finally{p("")}},ke=async Z=>{c(Z);const L=await ou(Z);f(L.characterAssetMap),g(L.backgroundAssetMap),O(X+1)},Me=()=>{if(Object.keys(u).some(L=>!u[L])){h({title:"",variant:"destructive"});return}O(X+1)},te=async()=>{if(Object.keys(m).some(L=>!m[L])){h({title:"",variant:"destructive"});return}if(!i&&!R){h({title:"",variant:"destructive"});return}p("");try{if(!i){const L={name:R,content:"",time:Date.now()},se=await Ae.add(L);r({id:se,...L}),n.clear()}await lu(o,n,u,m,T),w()}catch(L){h({title:"",description:L.message,variant:"destructive"})}finally{p("")}},D=async Z=>{const L=await ie(C.Character);L&&f({...u,[Z]:L})},_=async Z=>{if(l)return;const L=await ie(C.Background);L&&g({...m,[Z]:L})},Ls=[()=>e.jsxs(e.Fragment,{children:[e.jsxs(re,{children:[e.jsxs(oe,{className:"flex items-center gap-2",children:[e.jsx(G.sparkles,{className:"size-5"}),""]}),e.jsx(le,{})]}),e.jsxs(Rs,{defaultValue:"convert",children:[e.jsxs(ts,{className:"grid w-full grid-cols-2",children:[e.jsx(De,{value:"convert",disabled:!!l,children:""}),e.jsx(De,{value:"generate",disabled:!!l,children:""})]}),e.jsx(_e,{value:"convert",children:e.jsx(As,{value:v,onChange:b,placeholder:"",loading:l,onComplete:Z=>ee("convert",Z)})}),e.jsx(_e,{value:"generate",children:e.jsx(As,{value:v,onChange:b,placeholder:"",loading:l,onComplete:Z=>ee("generate",Z)})})]})]}),()=>e.jsx(e.Fragment,{children:e.jsxs(re,{children:[e.jsx(oe,{className:"flex items-center gap-2",children:""}),e.jsx(le,{}),!i&&e.jsxs("div",{className:"grid w-full items-center gap-1.5 mb-2",children:[e.jsx(fe,{htmlFor:"projectName",children:""}),e.jsx(P,{id:"projectName",value:R,onChange:Z=>H(Z.target.value),placeholder:""})]}),e.jsx(As,{value:V,placeholder:"",loading:l,onChange:W,onComplete:A,onChangeTemplate:y,children:s==="ai"&&e.jsx(j,{variant:"outline",onClick:()=>O(X-1),children:""})})]})}),()=>e.jsxs(e.Fragment,{children:[e.jsxs(re,{children:[e.jsx(oe,{className:"flex items-center gap-2",children:""}),e.jsx(le,{children:""})]}),e.jsxs(ge,{children:[e.jsx("div",{className:"flex gap-1 pb-4",children:Object.keys(u).map(Z=>{const L=u[Z];let se={name:Z,id:0,ext:""};return L&&(se={...L.states.find(Vt=>Vt.id===L.stateId)||L.states[0],name:Z}),e.jsx(bs,{type:C.Character,state:se,onSelect:()=>D(Z)},Z)})}),e.jsx(Ht,{orientation:"horizontal"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(j,{variant:"outline",onClick:()=>O(X-1),children:""}),e.jsx(j,{onClick:Me,children:""})]})]}),()=>e.jsxs(e.Fragment,{children:[e.jsxs(re,{children:[e.jsx(oe,{className:"flex items-center gap-2",children:""}),e.jsx(le,{children:""})]}),e.jsxs(ge,{children:[e.jsx("div",{className:"flex gap-1 pb-4",children:Object.keys(m).map(Z=>{const L=m[Z];let se={name:Z,id:0,ext:""};return L&&(se={...L.states.find(Vt=>Vt.id===L.stateId)||L.states[0],name:Z}),e.jsx(bs,{type:C.Background,state:se,onSelect:()=>_(Z)},Z)})}),e.jsx(Ht,{orientation:"horizontal"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(j,{variant:"outline",disabled:!!l,onClick:()=>O(X-1),children:""}),e.jsxs(j,{disabled:!!l,onClick:te,children:[l&&e.jsx(pa,{className:"animate-spin mr-1"}),l||""]})]})]})];return e.jsx(Ne,{open:a,onOpenChange:w,children:e.jsx(je,{className:"min-w-[70vw]",onPointerDownOutside:Z=>Z.preventDefault(),children:X>0&&Ls[X-1]()})})}var yt=(a=>(a.Animation="Animation",a.Sound="Sound",a.Util="Util",a.Filter="Filter",a.Transition="Transition",a))(yt||{});const Ce={[N.Speak]:"",[N.Speaker]:"",[N.ChangeSource]:"",[N.Show]:"",[N.Hide]:"",[N.FadeIn]:"",[N.FadeOut]:"",[N.ShakeX]:"",[N.ShakeY]:"",[N.ZoomIn]:"",[N.ZoomOut]:"",[N.EnterFromLeft]:"",[N.LeaveFromLeft]:"",[N.EnterFromRight]:"",[N.LeaveFromRight]:"",[N.Play]:"",[N.Pause]:"",[N.Stop]:"",[N.Wait]:"",[N.FadeInTransition]:"",[N.AddFilter]:"",[N.RemoveFilter]:""},Ut=[N.ChangeSource,N.Show,N.Hide,N.FadeIn,N.FadeOut,N.ShakeX,N.ShakeY,N.ZoomIn,N.ZoomOut,N.EnterFromLeft,N.LeaveFromLeft,N.EnterFromRight,N.LeaveFromRight],Ju=Ut.map(a=>({name:Ce[a],value:a})),Wa=[N.Play,N.Pause,N.Stop],Qu=Wa.map(a=>({name:Ce[a],value:a})),Ia=[N.Wait],La=[N.AddFilter,N.RemoveFilter],or=[N.FadeInTransition],_u=Ia.map(a=>({name:Ce[a],value:a})),$u=La.map(a=>({name:Ce[a],value:a})),qu=or.map(a=>({name:Ce[a],value:a})),em=[{name:"",type:"Animation",options:Ju},{name:"",type:"Sound",options:Qu},{name:"",type:"Util",options:_u},{name:"",type:"Filter",options:$u},{name:"",type:"Transition",options:qu}];function tm(a){if(Ut.includes(a))return"Animation";if(Wa.includes(a))return"Sound";if(Ia.includes(a))return"Util";if(La.includes(a))return"Filter";if(or.includes(a))return"Transition"}const qa=[{name:"",value:"BlackMaskFilter"},{name:"",value:"BlurFilter"},{name:"",value:"NoiseFilter"},{name:"",value:"OldFilmFilter"},{name:"",value:"VignetteFilter"}];function sm(){const a=I(k=>k.initEditor),s=I(k=>k.project),t=I(k=>k.editor),n=I(k=>k.activeScene),i=I(k=>k.scenes),{selectAsset:r}=Gt(),o=d.useRef(null),c=d.useRef(null),{defaultTemplates:l,customTemplates:p,handleAddDefaultTemplate:h,handleAddCustomTemplate:u}=Za(),[f,m]=d.useState(!1),[g,v]=d.useState(!1),[b,V]=d.useState(!1),[W,R]=d.useState(!1),[H,X]=d.useState(!1),[O,ie]=d.useState(!1),[T,y]=d.useState(!1),w=d.useRef(null),[A,ee]=d.useState([]),[ke,Me]=d.useState(null),te=d.useRef(null),[D,_]=d.useState([]),[we,mt]=d.useState({value:0,currentTime:0}),Le=d.useRef(0),[Is,Ls]=d.useState(""),{toast:Z}=et(),{showLoading:L,hideLoading:se}=tr(),{isOpenText2Scene:pt,text2SceneType:Vt,handleOpenImportText2Scene:Ya,handleOpenAiText2Scene:Sr,handleCloseText2Scene:jr}=Fu(),ft=Tt("(min-width: 768px)"),wr=async()=>{try{await Ch()}catch(k){Z({title:"",description:k.message,variant:"destructive"})}},Nr=async()=>{L("");try{await kh()}catch(k){Z({title:"",description:k.message,variant:"destructive"})}finally{se()}},Cr=(k,J)=>{if(k>=100){mt({value:k,currentTime:J}),Le.current&&clearTimeout(Le.current),Le.current=0;return}Le.current||(Le.current=setTimeout(()=>{mt({value:k,currentTime:J}),Le.current=0},1e3/30))},Ma=()=>{mt({value:0,currentTime:0})},Xs=()=>{const k=o.current,J=c.current;if(k&&J){const Ze=k.clientWidth,tt=k.clientHeight,He=16/9;let ns=Ze,Rt=Ze/He;Rt>tt&&(Rt=tt,ns=tt*He),J.style.width="".concat(ns,"px"),J.style.height="".concat(Rt,"px")}},Fs=d.useCallback(async k=>{try{const J=new Date;await Ae.update(s.id,{content:t.saveAsJSON(),time:J.getTime()}),Ls(J.toLocaleString()),k||Z({title:"",duration:1500})}catch(J){Z({title:"",description:J.message,variant:"destructive"})}},[Z,t,s]),Ks=k=>async()=>{const J=await r(k);if(J){const Ze=await At(J,t);t.addChild(Ze)}},kr=()=>{const k=au(t);t.addChild(k)},Ha=k=>k.type==="custom"?"".concat(k.errorSceneName,"").concat(k.errorLines?"".concat(k.errorLines,""):"","").concat(Ce[k.errorDirectiveName],""):k.message,ss=async(k=0,J)=>{Ma(),ee([k,J]),X(!0);const Ze=await t.exportScreenplay(k,J),tt=new th({canvas:w.current.getPreviewCanvas(),width:1920,height:1080,fps:30,disableAudio:Qa()});te.current.connect(tt),te.current.action(Ze).then(()=>{console.log("")}).catch(He=>{X(!1),Z({title:"",description:Ha(He),variant:"destructive"})})},Zr=async()=>{te.current.hasStarted()&&await te.current.cut(),ss(...A)},as=async(k=0,J)=>{Ma(),R(!0),Me(null);const Ze=await t.exportScreenplay(k,J),tt=new eh({width:1920,height:1080,fps:30,disableAudio:Qa()});te.current.connect(tt),te.current.action(Ze).then(({result:He,subtitles:ns})=>{const Rt=URL.createObjectURL(He);_(ns),Me(Rt)}).catch(He=>{R(!1),Z({title:"",description:Ha(He),variant:"destructive"})})},Gr=()=>{R(!1),te.current.hasStarted()&&te.current.cut(),ke&&URL.revokeObjectURL(ke),Me(null)},Ba=async()=>{X(!1),te.current.hasStarted()&&await te.current.cut()},Tr=async()=>{await Ba(),as(...A)},Vr=async()=>{L("");try{await jh()}catch(k){Z({title:"",description:k.message,variant:"destructive"}),console.error(k)}finally{se()}},Rr=async()=>{await wh(),Z({title:"",duration:1500})};return d.useEffect(()=>{if(s){const k=setInterval(async()=>{Fs(!0)},6e4);return()=>{clearInterval(k)}}},[s,Fs]),d.useEffect(()=>(window.addEventListener("resize",Xs),Xs(),a(c.current),te.current=new Qs({onProgress(J,Ze){Cr(J,Ze)}}),c.current.onselectstart=function(){return!1},localStorage.getItem("vnve_import_text")&&Ya(),()=>{window.removeEventListener("resize",Xs)}),[a]),e.jsxs("div",{className:"flex flex-col gap-2 flex-1",children:[e.jsxs(Bi,{className:"relative z-50",children:[e.jsxs(gt,{children:[e.jsxs(st,{className:"data-[disabled]:text-gray-400",children:[ft&&e.jsx(G.library,{className:"size-4 mr-0.5"}),""]}),e.jsxs(bt,{children:[e.jsx(U,{onClick:()=>m(!0),children:""}),e.jsx(U,{onClick:()=>v(!0),children:"..."}),e.jsx(U,{disabled:!s,onClick:()=>Fs(),children:""}),Is&&e.jsxs(U,{className:"text-muted-foreground",children:["",Is]}),e.jsx(vt,{}),e.jsx(U,{onClick:wr,children:"..."}),e.jsx(U,{onClick:Nr,children:"..."})]})]}),e.jsxs(gt,{children:[e.jsxs(st,{className:"data-[disabled]:text-gray-400",disabled:!s,children:[ft&&e.jsx(G.scene,{className:"size-4 mr-0.5"}),""]}),e.jsxs(bt,{children:[l.map(k=>e.jsxs(U,{onClick:h(k.content),children:["",k.name]},k.name)),p.length>0&&e.jsx(vt,{}),p.map(k=>e.jsxs(U,{onClick:()=>u(k.content),children:["",k.name]},k.id)),e.jsx(vt,{}),e.jsx(U,{onClick:Ya,children:"..."}),e.jsx(U,{onClick:Sr,children:"..."}),e.jsx(vt,{}),e.jsx(U,{onClick:()=>V(!0),children:"..."})]})]}),e.jsxs(gt,{children:[e.jsxs(st,{className:"data-[disabled]:text-gray-400",disabled:!s,children:[ft&&e.jsx(G.images,{className:"size-4 mr-0.5"}),""]}),e.jsxs(bt,{children:[e.jsx(U,{disabled:!n,onClick:Ks(C.Character),children:""}),e.jsx(U,{disabled:!n,onClick:Ks(C.Background),children:""}),e.jsx(U,{disabled:!n,onClick:Ks(C.Thing),children:""}),e.jsx(U,{disabled:!n,onClick:kr,children:""}),e.jsx(vt,{}),e.jsx(U,{onClick:Vr,children:"..."}),e.jsx(U,{onClick:()=>r(void 0,!0),children:"..."}),e.jsx(U,{className:"text-destructive",onClick:()=>ie(!0),children:""})]})]}),e.jsxs(gt,{children:[e.jsxs(st,{disabled:i.length===0,className:"data-[disabled]:text-gray-400",children:[ft&&e.jsx(G.preview,{className:"size-4 mr-0.5"}),""]}),e.jsxs(bt,{children:[e.jsx(U,{disabled:!n,onClick:()=>{const k=t.getActiveSceneIndex();ss(k,k+1)},children:""}),e.jsx(U,{disabled:!n,onClick:()=>ss(t.getActiveSceneIndex()),children:""}),e.jsx(U,{onClick:()=>ss(),children:""})]})]}),e.jsxs(gt,{children:[e.jsxs(st,{disabled:i.length===0,className:"data-[disabled]:text-gray-400",children:[ft&&e.jsx(G.download,{className:"size-4 mr-0.5"}),""]}),e.jsxs(bt,{children:[e.jsx(U,{disabled:!n,onClick:()=>{const k=t.getActiveSceneIndex();as(k,k+1)},children:""}),e.jsx(U,{disabled:!n,onClick:()=>as(t.getActiveSceneIndex()),children:""}),e.jsx(U,{onClick:()=>as(),children:""})]})]}),e.jsx(gt,{children:e.jsxs(st,{className:"data-[disabled]:text-gray-400",onClick:()=>y(!0),children:[ft&&e.jsx(G.settings,{className:"size-4 mr-0.5"}),""]})})]}),e.jsx(ut,{className:"flex-1 rounded-md relative",children:e.jsx(qe,{className:"relative h-full p-2",children:e.jsx("div",{className:"w-full h-full flex justify-center items-center",ref:o,children:e.jsx("canvas",{className:"shadow border border-b",ref:c})})})}),g&&e.jsx(Gu,{isOpen:g,onClose:()=>v(!1)}),b&&e.jsx(bu,{isOpen:b,onClose:()=>V(!1)}),W&&e.jsx(vu,{progress:we,url:ke,subtitles:D,isOpen:W,onClose:Gr}),H&&e.jsx(yu,{progress:we,ref:w,isOpen:H,onReplay:Zr,onClose:Ba,onExport:Tr}),f&&e.jsx(Zu,{isOpen:f,onClose:()=>m(!1)}),O&&e.jsx(Ru,{isOpen:O,onConfirm:Rr,onClose:()=>ie(!1)}),T&&e.jsx(Xu,{isOpen:T,onClose:()=>y(!1)}),pt&&e.jsx(Ou,{isOpen:pt,type:Vt,onClose:jr})]})}function am(){const a=I(l=>l.editor),s=I(l=>l.activeChild),t=I(l=>l.activeScene),n=d.useMemo(()=>{if(!t)return[];const l=[],p=[],h=[],u=[],f=t.sounds;for(const m of t.children)m.assetType===C.Character?l.push(m):m.assetType===C.Background?h.push(m):m.assetType===C.Thing?p.push(m):m.name&&u.push(m);return[{label:"",children:l},{label:"",children:p},{label:"",children:h},{label:"",children:u},{label:"",children:f}]},[t]),i=l=>{l.assetType!==C.Audio&&a.setActiveChildByName(l.name)},r=l=>{if(l.assetType===C.Audio){a.removeSoundByName(l.name);return}a.removeChildByName(l.name),(s==null?void 0:s.name)===l.name&&a.setActiveChild(void 0)},o=l=>{a.toggleChildVisibleByName(l.name)},c=l=>{a.toggleChildInteractiveByName(l.name)};return e.jsx(ge,{className:"h-full pr-2",children:e.jsx("div",{className:"space-y-4",children:n.map(l=>l.children.length>0&&e.jsxs("fieldset",{className:"rounded-md border p-2",children:[e.jsx("legend",{className:"-ml-1 px-1 text-sm font-medium",children:l.label}),e.jsx("div",{className:"flex flex-col gap-1",children:l.children.map(p=>e.jsx("div",{className:"text-sm p-1 px-2 border rounded ".concat((s==null?void 0:s.name)===p.name?"bg-muted":""),children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{onClick:()=>i(p),className:"cursor-pointer flex-1",children:p.label}),e.jsxs("div",{className:"flex space-x-2 items-center",children:[p.assetType!==C.Audio&&e.jsxs(e.Fragment,{children:[p.visible?e.jsx(G.viewing,{onClick:()=>o(p),className:"size-4 cursor-pointer"}):e.jsx(G.viewingOff,{onClick:()=>o(p),className:"size-4 cursor-pointer"}),p.interactive?e.jsx(G.lockOpen,{onClick:()=>c(p),className:"size-4 cursor-pointer"}):e.jsx(G.lock,{onClick:()=>c(p),className:"size-4 cursor-pointer"})]}),e.jsx(G.trash2,{onClick:()=>r(p),className:"size-4 cursor-pointer hover:text-destructive"})]})]})},p.name))})]},l.label))})})}const Ct=d.forwardRef(({className:a,showPercentage:s=!1,value:t,...n},i)=>{const r=Array.isArray(t)?t[0]:t,o=r!==void 0?"".concat(Math.round(r*100),"%"):"";return e.jsxs("div",{className:"relative flex w-full items-center gap-2",children:[e.jsxs(qn,{ref:i,value:t,className:S("relative flex w-full touch-none select-none items-center",a),...n,children:[e.jsx(oc,{className:"relative h-1.5 w-full grow overflow-hidden rounded-full bg-primary/20",children:e.jsx(lc,{className:"absolute h-full bg-primary"})}),e.jsx(cc,{className:"block h-4 w-4 rounded-full border border-primary/50 bg-background shadow transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50"})]}),s&&e.jsx("span",{className:"min-w-[36px] text-sm text-muted-foreground",children:o})]})});Ct.displayName=qn.displayName;function nm(){const a=I(i=>i.editor),s=I(i=>i.activeChild),t=(i,r)=>o=>{a.updateActiveChild(c=>{r==="number"?c[i]=Number(o.target.value):c[i]=o.target.value})},n=i=>r=>{a.updateActiveChild(o=>{o[i]=r})};return e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1 flex gap-1 items-center",children:[e.jsx(fe,{className:"w-5",children:""}),e.jsx(P,{value:s.width.toFixed(0),onChange:t("width","number"),type:"number",min:0,step:10,className:"h-6"})]}),e.jsxs("div",{className:"flex-1 flex gap-1 items-center",children:[e.jsx(fe,{className:"w-5",children:""}),e.jsx(P,{value:s.height.toFixed(0),onChange:t("height","number"),type:"number",min:0,step:10,className:"h-6"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1 flex gap-1 items-center",children:[e.jsx(fe,{className:"w-5",children:"X"}),e.jsx(P,{value:s.x.toFixed(0),onChange:t("x","number"),type:"number",min:0,step:10,className:"h-6"})]}),e.jsxs("div",{className:"flex-1 flex gap-1 items-center",children:[e.jsx(fe,{className:"w-5",children:"Y"}),e.jsx(P,{value:s.y.toFixed(0),onChange:t("y","number"),type:"number",min:0,step:10,className:"h-6"})]})]}),e.jsxs("div",{className:"flex-1 flex gap-1 items-center",children:[e.jsx(fe,{className:"flex-shrink-0 mr-2",children:""}),e.jsx(Ct,{min:0,max:1,step:.1,value:[s.alpha],onValueChange:i=>n("alpha")(i[0]),showPercentage:!0})]})]})}const Xa=dc,Fa=hc,Ws=d.forwardRef(({className:a,align:s="center",sideOffset:t=4,...n},i)=>e.jsx(ei,{children:e.jsx(fa,{ref:i,align:s,sideOffset:t,className:S("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...n})}));Ws.displayName=fa.displayName;function im(a){const s=d.useRef(null);return d.useEffect(()=>{a&&(typeof a=="function"?a(s.current):a.current=s.current)}),s}const Ka=d.forwardRef(({disabled:a,value:s,onChange:t,onBlur:n,name:i,className:r,...o},c)=>{const l=im(c),[p,h]=d.useState(!1),u=d.useMemo(()=>s||"#FFFFFF",[s]);return e.jsxs(Xa,{onOpenChange:h,open:p,children:[e.jsx(Fa,{asChild:!0,disabled:a,onBlur:n,children:e.jsx(j,{...o,className:S("block",r),name:i,onClick:()=>{h(!0)},size:"icon",style:{backgroundColor:u},variant:"outline",children:e.jsx("div",{})})}),e.jsxs(Ws,{className:"w-full",children:[e.jsx(uc,{color:u,onChange:t}),e.jsx(P,{className:"mt-2",maxLength:7,onChange:f=>{var m;t((m=f==null?void 0:f.currentTarget)==null?void 0:m.value)},ref:l,value:u})]})]})});Ka.displayName="ColorPicker";const lr=ye("inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground",{variants:{variant:{default:"bg-transparent",outline:"border border-input bg-transparent shadow-sm hover:bg-accent hover:text-accent-foreground"},size:{default:"h-9 px-3",sm:"h-8 px-2",lg:"h-10 px-3"}},defaultVariants:{variant:"default",size:"default"}}),rm=d.forwardRef(({className:a,variant:s,size:t,...n},i)=>e.jsx(ti,{ref:i,className:S(lr({variant:s,size:t,className:a})),...n}));rm.displayName=ti.displayName;const cr=d.createContext({size:"default",variant:"default"}),dr=d.forwardRef(({className:a,variant:s,size:t,children:n,...i},r)=>e.jsx(si,{ref:r,className:S("flex items-center justify-center gap-1",a),...i,children:e.jsx(cr.Provider,{value:{variant:s,size:t},children:n})}));dr.displayName=si.displayName;const qs=d.forwardRef(({className:a,children:s,variant:t,size:n,...i},r)=>{const o=d.useContext(cr);return e.jsx(ai,{ref:r,className:S(lr({variant:o.variant||t,size:o.size||n}),a),...i,children:s})});qs.displayName=ai.displayName;function om(){const a=I(l=>l.editor),s=I(l=>l.activeChild),t=Et(()=>Q.where("type").equals(C.Font).reverse().toArray()),n=d.useMemo(()=>{const l=[];if(!t)return l;for(const p of t)for(const h of p.states)l.push({ch:h.name,en:h.name});return l},[t]),i=(l,p)=>h=>{a.updateActiveChild(u=>{p==="number"?u[l]=Number(h.target.value):u[l]=h.target.value})},r=(l,p)=>h=>{a.updateActiveChild(u=>{p==="number"?u.style[l]=Number(h.target.value):u.style[l]=h.target.value})},o=l=>p=>{a.updateActiveChild(h=>{h.style[l]=p})},c=l=>{a.updateActiveChild(p=>{p.style.fontWeight=l.includes(It.BOLD)?It.BOLD:It.NORMAL,p.style.fontStyle=l.includes(Lt.ITALIC)?Lt.ITALIC:Lt.NORMAL})};return e.jsxs("div",{className:"flex flex-col gap-3",children:[!s.disableTextEdit&&e.jsx("div",{className:"flex gap-2",children:e.jsxs("div",{className:"flex-1 flex gap-1 items-center",children:[e.jsx(G.bookOpenText,{className:"w-5 h-5"}),e.jsx(P,{value:s.text,onChange:i("text")})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1 flex gap-1 items-center",children:[e.jsx(G.color,{className:"w-5 h-5"}),e.jsx(Ka,{value:s.style.fill,onChange:o("fill"),className:"w-6 h-6"})]}),e.jsx("div",{className:"flex-1 flex gap-1 items-center",children:e.jsxs(dr,{type:"multiple",value:[s.style.fontWeight,s.style.fontStyle],onValueChange:c,children:[e.jsx(qs,{value:It.BOLD,className:"p-2",children:e.jsx(G.bold,{className:"size-4"})}),e.jsx(qs,{value:Lt.ITALIC,className:"p-2",children:e.jsx(G.italic,{className:"size-4"})})]})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1 shrink-0 flex gap-1 items-center",children:[e.jsx(G.type,{className:"w-5 h-5"}),e.jsxs(be,{onValueChange:o("fontFamily"),value:s.style.fontFamily,children:[e.jsx(ue,{className:"h-6 max-w-[150px]",children:e.jsx(ve,{placeholder:"---"})}),e.jsx(me,{children:[...n,...vh].map(l=>e.jsx($,{value:l.en,children:l.ch},l.en))})]})]}),e.jsxs("div",{className:"flex-1 shrink-0 flex gap-1 items-center",children:[e.jsx(G.fontSize,{className:"w-5 h-5"}),e.jsx(P,{value:String(s.style.fontSize),onChange:r("fontSize","number"),type:"number",min:1,step:10,className:"h-6"})]})]})]})}function lm(){const a=I(r=>r.editor),s=I(r=>r.activeChild),{selectAsset:t}=Gt(),n=r=>{a.updateActiveChild(o=>{const c=o.width,l=o.height;o.fillColor=r,o.clear().beginFill(r).drawRect(0,0,c,l).endFill()})},i=async()=>{const r=await t(C.Dialog),o=await At(r,a);a.addChild(o),a.updateActiveScene(c=>{c.config.speak.dialogTargetName=o.name}),a.setActiveChildByName(o.name),a.removeChildByName(s.name)};return e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1 flex gap-1 items-center",children:[e.jsx(fe,{className:"flex-shrink-0 mr-2",children:""}),e.jsx(Ka,{value:s.fillColor,onChange:n,className:"w-6 h-6"})]}),e.jsx(j,{size:"sm",onClick:i,children:""})]})}function cm(){const a=I(s=>s.activeChild);return e.jsx(ge,{className:"h-full pr-2",children:a&&e.jsxs(e.Fragment,{children:[e.jsxs("fieldset",{className:"rounded-md border p-2",children:[e.jsx("legend",{className:"-ml-1 px-1 text-sm font-medium",children:""}),e.jsx(nm,{})]}),a.type==="Text"&&e.jsxs("fieldset",{className:"rounded-md border p-2 mt-2",children:[e.jsx("legend",{className:"-ml-1 px-1 text-sm font-medium",children:""}),e.jsx(om,{})]}),a.type==="Graphics"&&e.jsxs("fieldset",{className:"rounded-md border p-2 mt-2",children:[e.jsx("legend",{className:"-ml-1 px-1 text-sm font-medium",children:""}),e.jsx(lm,{})]})]})})}const Oe=ni,Je=ii,Qe=ri,Ke=d.forwardRef(({className:a,sideOffset:s=4,...t},n)=>e.jsx(xa,{ref:n,sideOffset:s,className:S("z-50 overflow-hidden rounded-md bg-primary px-3 py-1.5 text-xs text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...t}));Ke.displayName=xa.displayName;function dm(){const a=I(l=>l.editor),s=I(l=>l.activeChild),t=()=>{if(a.activeChild){const l=a.activeChild;l.scale.x*=-1,l.scale.x<0?l.x+=l.width:l.x-=l.width}},n=async()=>{const l=a.cloneChild();l.type==="Sprite"&&await l.load(),l.x+=l.width*.1,l.y+=l.height*.1,a.addChild(l),a.setActiveChildByName(l.name)},i=()=>{a.activeChild&&a.removeChildByName(a.activeChild.name),a.setActiveChild(void 0)},r=l=>()=>{switch(l){case"top":a.moveChildToTop();break;case"bottom":a.moveChildToBottom();break;case"up":a.moveUpChild();break;case"down":a.moveDownChild();break}},o=l=>()=>{a.setChildPosition(l)},c=()=>{const l=a.activeScene.getChildrenByAssetType(C.Character),p=l.length;let h=1;for(const u of l)u.x=a.options.width/(p+1)*h-u.width/2,u.y=a.options.height-u.height,h++};return e.jsx(ge,{className:"h-full pr-2",children:s&&e.jsxs("div",{children:[e.jsxs("fieldset",{className:"rounded-md border p-1",children:[e.jsx("legend",{className:"-ml-1 px-1 text-sm font-medium",children:""}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx(j,{size:"sm",variant:"ghost",onClick:r("top"),children:""}),e.jsx(j,{size:"sm",variant:"ghost",onClick:r("up"),children:""}),e.jsx(j,{size:"sm",variant:"ghost",onClick:r("down"),children:""}),e.jsx(j,{size:"sm",variant:"ghost",onClick:r("bottom"),children:""})]}),e.jsxs("div",{children:[s.type!=="Graphics"&&e.jsx(Oe,{children:e.jsxs(Je,{children:[e.jsx(Qe,{asChild:!0,children:e.jsx(j,{size:"sm",variant:"ghost",onClick:t,children:e.jsx(G.flip,{className:"size-4"})})}),e.jsx(Ke,{children:e.jsx("p",{children:""})})]})}),e.jsx(Oe,{children:e.jsxs(Je,{children:[e.jsx(Qe,{asChild:!0,children:e.jsx(j,{size:"sm",variant:"ghost",onClick:n,children:e.jsx(G.copy,{className:"size-4"})})}),e.jsx(Ke,{children:e.jsx("p",{children:""})})]})}),e.jsx(Oe,{children:e.jsxs(Je,{children:[e.jsx(Qe,{asChild:!0,children:e.jsx(j,{size:"sm",variant:"ghost",onClick:i,children:e.jsx(G.delete,{className:"size-4"})})}),e.jsx(Ke,{children:e.jsx("p",{children:""})})]})})]})]})]}),e.jsxs("fieldset",{className:"rounded-md border p-1 mt-2",children:[e.jsx("legend",{className:"-ml-1 px-1 text-sm font-medium",children:""}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{children:[e.jsx(j,{size:"sm",variant:"ghost",onClick:o("left"),children:""}),e.jsx(j,{size:"sm",variant:"ghost",onClick:o("near-left"),children:"1/3"}),e.jsx(j,{size:"sm",variant:"ghost",onClick:o("center"),children:""}),e.jsx(j,{size:"sm",variant:"ghost",onClick:o("near-right"),children:"2/3"}),e.jsx(j,{size:"sm",variant:"ghost",onClick:o("right"),children:""})]}),s.assetType===C.Character&&e.jsx(Oe,{children:e.jsxs(Je,{children:[e.jsx(Qe,{asChild:!0,children:e.jsx(j,{size:"sm",variant:"ghost",onClick:c,children:""})}),e.jsx(Ke,{children:e.jsx("p",{children:""})})]})})]})]}),e.jsxs("fieldset",{className:"rounded-md border p-1 mt-2",children:[e.jsx("legend",{className:"-ml-1 px-1 text-sm font-medium",children:""}),e.jsx(j,{size:"sm",variant:"ghost",onClick:o("top"),children:""}),e.jsx(j,{size:"sm",variant:"ghost",onClick:o("middle"),children:""}),e.jsx(j,{size:"sm",variant:"ghost",onClick:o("bottom"),children:""})]})]})})}function hm(){return e.jsx(ut,{className:"flex-1 shrink-0 max-h-[50%] sm:max-h-full rounded-md",children:e.jsx(qe,{className:"h-full p-2",children:e.jsxs(Rs,{defaultValue:"position",className:"h-full flex flex-col",children:[e.jsxs(ts,{className:"self-center",children:[e.jsx(De,{value:"position",children:""}),e.jsx(De,{value:"style",children:""}),e.jsx(De,{value:"list",children:""})]}),e.jsx(_e,{className:"h-[calc(100%-2.5rem)]",value:"position",children:e.jsx(dm,{})}),e.jsx(_e,{className:"h-[calc(100%-2.5rem)]",value:"style",children:e.jsx(cm,{})}),e.jsx(_e,{className:"h-[calc(100%-2.5rem)]",value:"list",children:e.jsx(am,{})})]})})})}const um=ye("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{defaultVariants:{size:"default",variant:"default"},variants:{isMenu:{true:"h-auto w-full cursor-pointer justify-start"},size:{default:"h-10 px-4 py-2",icon:"size-10",lg:"h-11 rounded-md px-8",none:"",sm:"h-9 rounded-md px-3",sms:"size-9 rounded-md px-0",xs:"h-8 rounded-md px-3"},variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",ghost:"hover:bg-accent hover:text-accent-foreground",inlineLink:"text-base text-primary underline underline-offset-4",link:"text-primary underline-offset-4 hover:underline",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80"}}}),en=$e(({asChild:a=!1,className:s,isMenu:t,size:n,variant:i,...r},o)=>{const c=a?ma:"button";return e.jsx(c,{className:ae(um({className:s,isMenu:t,size:n,variant:i})),ref:o,...r})});function mm(){const a=I(r=>r.project),[s,t]=d.useState(!0);d.useEffect(()=>{const r=document.documentElement.classList.contains("dark");t(r),!document.documentElement.classList.contains("dark")&&!document.documentElement.classList.contains("light")&&(document.documentElement.classList.add("dark"),t(!0))},[]);const n=()=>{const r=!s;t(r),r?(document.documentElement.classList.add("dark"),document.documentElement.classList.remove("light")):(document.documentElement.classList.remove("dark"),document.documentElement.classList.add("light"))},i=()=>{window.location.href="/?no_intro=true"};return e.jsxs("header",{className:"sticky top-0 z-10 flex h-[53px] items-center justify-between gap-1 border-b bg-background px-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(en,{variant:"ghost",size:"sm",onClick:i,className:"gap-2",children:[e.jsx(mc,{className:"h-4 w-4"}),"Back to Home"]}),e.jsxs("h1",{className:"text-xl font-bold",children:["VNVE",a&&e.jsxs("span",{className:"text-xs text-muted-foreground ml-2",children:["// ",a.name]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(en,{variant:"ghost",size:"icon",onClick:n,children:s?e.jsx(un,{className:"h-5 w-5"}):e.jsx(pc,{className:"h-5 w-5"})}),e.jsx(G.gitHub,{className:"size-5 cursor-pointer",onClick:()=>{window.location.href="https://github.com/vnve/vnve"}})]})]})}const pm=ye(ae("relative overflow-x-auto whitespace-pre-wrap break-words","min-h-[80px] w-full rounded-md bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none","[&_[data-slate-placeholder]]:text-muted-foreground [&_[data-slate-placeholder]]:!opacity-100","[&_[data-slate-placeholder]]:top-[auto_!important]","[&_strong]:font-bold"),{defaultVariants:{focusRing:!0,size:"sm",variant:"outline"},variants:{disabled:{true:"cursor-not-allowed opacity-50"},focusRing:{false:"",true:"focus-visible:ring-1 focus-visible:ring-ring"},focused:{true:"ring-1 ring-ring"},size:{md:"text-base",sm:"text-sm"},variant:{ghost:"",outline:"border border-input"}}}),hr=ze.forwardRef(({className:a,disabled:s,focusRing:t,focused:n,readOnly:i,size:r,variant:o,...c},l)=>e.jsx("div",{className:"relative w-full",ref:l,children:e.jsx(fc,{"aria-disabled":s,className:ae(pm({disabled:s,focusRing:t,focused:n,size:r,variant:o}),a),"data-plate-selectable":!0,disableDefaultStyles:!0,readOnly:s!=null?s:i,...c})}));hr.displayName="Editor";const fm=ye("shrink-0 bg-border",{defaultVariants:{orientation:"horizontal"},variants:{orientation:{horizontal:"h-px w-full",vertical:"h-full w-px"}}}),xm=js(ga(xc,{decorative:!0,orientation:"horizontal"}),fm),gm=ni,bm=ii,vm=ri,ym=gc,Sm=Ye(ga(xa,{sideOffset:4}),"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md");function jm(a){return ze.forwardRef(function({tooltip:t,tooltipContentProps:n,tooltipProps:i,...r},o){const[c,l]=ze.useState(!1);ze.useEffect(()=>{l(!0)},[]);const p=e.jsx(a,{ref:o,...r});return t&&c?e.jsx(gm,{children:e.jsxs(bm,{...i,children:[e.jsx(vm,{asChild:!0,children:p}),e.jsx(ym,{children:e.jsx(Sm,{...n,children:t})})]})}):p})}const wm=Ye(vc,"relative flex select-none items-center gap-1 bg-background"),Nm=Ye(yc,"flex items-center");Ye(Sc,"font-medium underline underline-offset-4");Ye(jc,"my-1 w-px shrink-0 bg-border");const ea=ye(ae("inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50","[&_svg:not([data-icon])]:size-5"),{defaultVariants:{size:"sm",variant:"default"},variants:{size:{default:"h-10 px-3",lg:"h-11 px-5",sm:"h-9 px-2"},variant:{default:"bg-transparent hover:bg-muted hover:text-muted-foreground aria-checked:bg-accent aria-checked:text-accent-foreground",outline:"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground"}}}),Kt=jm(d.forwardRef(({children:a,className:s,isDropdown:t,pressed:n,size:i,variant:r,...o},c)=>typeof n=="boolean"?e.jsx(Nm,{disabled:o.disabled,type:"single",value:"single",children:e.jsx(Cm,{className:ae(ea({size:i,variant:r}),t&&"my-1 justify-between pr-1",s),ref:c,value:n?"single":"",...o,children:t?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-1",children:a}),e.jsx("div",{children:e.jsx(G.arrowDown,{className:"ml-0.5 size-4","data-icon":!0})})]}):a})}):e.jsx(bc,{className:ae(ea({size:i,variant:r}),t&&"pr-1",s),ref:c,...o,children:a})));Kt.displayName="ToolbarButton";const Cm=js(wc,ea,["variant","size"]),tn=$e(({children:a,className:s,noSeparator:t},n)=>{const i=d.Children.map(a,r=>r);return!i||i.length===0?null:e.jsxs("div",{className:ae("flex",s),ref:n,children:[!t&&e.jsx("div",{className:"h-full py-2",children:e.jsx(xm,{orientation:"vertical"})}),e.jsx("div",{className:"mx-1 flex items-center gap-1",children:a})]})}),km=Ye(wm,"supports-backdrop-blur:bg-background/60 z-40 w-full justify-between overflow-x-auto rounded-t-lg border-b border-b-border bg-background/95 backdrop-blur"),Zm=fn,Gm=xn;$e(({children:a,className:s,inset:t,...n},i)=>e.jsxs(aa,{className:ae("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent","data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t&&"pl-8",s),ref:i,...n,children:[a,e.jsx(G.chevronRight,{className:"ml-auto size-4"})]}));Ye(na,"z-50 min-w-32 overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2");const Tm=ga(ra,{className:ae("z-50 min-w-32 overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2"),sideOffset:4}),Vm=$e(({...a},s)=>e.jsx(ia,{children:e.jsx(Tm,{ref:s,...a})})),Rm=ye(ae("relative flex h-9 cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors","focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50"),{variants:{inset:{true:"pl-8"}}}),Wm=js(oa,Rm,["inset"]);$e(({children:a,className:s,...t},n)=>e.jsxs(la,{className:ae("relative flex select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50","cursor-pointer",s),ref:n,...t,children:[e.jsx("span",{className:"absolute left-2 flex size-3.5 items-center justify-center",children:e.jsx(Ss,{children:e.jsx(G.check,{className:"size-4"})})}),a]}));$e(({children:a,className:s,hideIcon:t,...n},i)=>e.jsxs(da,{className:ae("relative flex select-none items-center rounded-sm pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50","h-9 cursor-pointer px-2 data-[state=checked]:bg-accent data-[state=checked]:text-accent-foreground",s),ref:i,...n,children:[!t&&e.jsx("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:e.jsx(Ss,{children:e.jsx(G.check,{className:"size-4"})})}),a]}));const Im=ye(ae("select-none px-2 py-1.5 text-sm font-semibold"),{variants:{inset:{true:"pl-8"}}}),Lm=js(ha,Im,["inset"]),Xm=Ye(ua,"-mx-1 my-1 h-px bg-muted");Ye(Nc("span"),"ml-auto text-xs tracking-widest opacity-60");const Fm=()=>{const[a,s]=d.useState(!1);return{onOpenChange:d.useCallback((n=!a)=>{s(n)},[a]),open:a}},dt=Cc(kc({key:"directive",node:{isElement:!0,isInline:!0,isMarkableVoid:!0,isVoid:!0},options:{openEditorId:null,mode:"",editingDirective:null,directiveType:null}}).extendOptions(({getOptions:a})=>({isOpen:s=>a().openEditorId===s})).extendEditorApi(({setOptions:a})=>({floatingDirective:{hide:()=>{a({mode:"",openEditorId:null,editingDirective:null,directiveType:null})},show:(s,t,n,i)=>{a({mode:s,openEditorId:t,editingDirective:n,directiveType:i})}}})).extendEditorTransforms(({editor:a,type:s})=>({insert:{directive:({value:t})=>{Zc(a,{children:[{text:""}],type:s,value:t})}},edit:{directive:({value:t,at:n})=>{Gc(a,{children:[{text:""}],type:s,value:t},{at:n})}}}))),za=(a,{directiveElement:s,directiveType:t}={})=>{const{api:n}=Tc(a,dt);if(s){const i=s.value.directive,r=tm(i);n.floatingDirective.show("edit",a.id,s,r)}else n.floatingDirective.show("insert",a.id,null,t)};function Km({triggerFloatingLinkHotkeys:a,floatingOptions:s}){const t=Tt("(min-width: 640px)"),{editor:n,api:i,tf:r,useOption:o,setOption:c,getOptions:l}=ba(dt),p=o("mode"),h=o("isOpen",n.id),u=o("editingDirective"),f=Vc({onOpenChange:R=>c("openEditorId",R?n.id:null),getBoundingClientRect:Rc,open:h&&["insert","edit"].includes(p),...s}),m=Wc(R=>{const H=R.target;H!==document.documentElement&&(H.closest("[data-disable-click-outside]")||H.closest("#asset-library")||["insert","edit"].includes(l().mode)&&(i.floatingDirective.hide(),Xt(n,n.selection)))},{disabled:!h});ze.useEffect(()=>{h&&f.update()},[h,f.update]);const g=R=>{r.insert.directive({value:R}),Lc(n,{unit:"offset"}),i.floatingDirective.hide(),setTimeout(()=>{Xt(n,n.selection)},0)},v=R=>{const H=n.selection,[,X]=Xc(n,{at:H,match:{type:n.getType(dt)}});r.edit.directive({value:R,at:X}),i.floatingDirective.hide()},b=R=>{u?v(R):g(R)},V=()=>{i.floatingDirective.hide(),setTimeout(()=>{Xt(n,n.selection)},0)};return{props:{style:t?{...f.style,zIndex:50}:{...f.style,position:"fixed",left:"50%",top:"50%",transform:"translate(-50%, -50%)",zIndex:50}},ref:Ic(f.refs.setFloating,m),onSubmit:b,onCancel:V}}const zm=[{items:[{description:"",icon:G.squarePlus,label:"",value:yt.Util},{description:"",icon:G.squarePlus,label:"",value:yt.Transition},{description:"",icon:G.squarePlus,label:"",value:yt.Filter}],label:""}];function Dm(a){const s=Tt("(min-width: 640px)"),t=oi(),n=Fm();function i(r){za(t,{directiveType:r}),s&&Xt(t)}return e.jsxs(Zm,{modal:!1,...n,...a,children:[e.jsx(Gm,{asChild:!0,children:e.jsx(Kt,{isDropdown:!0,pressed:n.open,tooltip:"",children:e.jsx(G.add,{className:"size-4"})})}),e.jsx(Vm,{align:"start",className:"flex max-h-[500px] min-w-0 flex-col gap-0.5 overflow-y-auto",children:zm.map(({items:r,label:o},c)=>e.jsxs(ze.Fragment,{children:[c!==0&&e.jsx(Xm,{}),e.jsx(Lm,{children:o}),r.map(({icon:l,label:p,value:h})=>e.jsxs(Wm,{className:"min-w-[180px]",onSelect:()=>i(h),children:[e.jsx(l,{className:"mr-2 size-4"}),p]},h))]},o))})]})}const ht=d.forwardRef(({className:a,...s},t)=>e.jsx(li,{className:S("peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",a),...s,ref:t,children:e.jsx(Fc,{className:S("pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0")})}));ht.displayName=li.displayName;const Ym=B({wordsPerMin:pe().optional(),interval:pe().optional(),effect:E().optional(),effectDuration:pe().optional(),speaker:B({name:E().optional(),autoShowSpeaker:B({inEffect:E()}).optional(),autoMaskOtherSpeakers:B({alpha:pe()}).optional()})});function ur({speak:a,onChangeSpeak:s,disableCustomName:t=!1}){const n=at({resolver:nt(Ym),defaultValues:a}),i=Re({control:n.control});return d.useEffect(()=>{n.formState.isDirty&&s({...a,...i,speaker:{...a.speaker,...i.speaker}})},[n.formState.isDirty,i]),e.jsx(ct,{...n,children:e.jsxs("form",{className:"space-y-2",children:[!t&&e.jsx(Y,{control:n.control,name:"speaker.name",render:({field:r})=>e.jsxs(F,{className:"space-y-1",children:[e.jsx(z,{children:""}),e.jsx(os,{children:""}),e.jsx(K,{children:e.jsx(P,{className:"h-8",placeholder:"",...r})}),e.jsx(M,{})]})}),e.jsx(Y,{control:n.control,name:"wordsPerMin",render:({field:r})=>e.jsxs(F,{className:"space-y-1",children:[e.jsx(z,{children:"/"}),e.jsx(os,{children:""}),e.jsx(K,{children:e.jsx(P,{className:"h-8",type:"number",min:0,step:100,placeholder:"",value:String(r.value),onChange:o=>{const c=Number(o.target.value);r.onChange(c)}})}),e.jsx(M,{})]})}),e.jsx(Y,{control:n.control,name:"interval",render:({field:r})=>e.jsxs(F,{className:"space-y-1",children:[e.jsx(z,{children:""}),e.jsx(os,{children:""}),e.jsx(K,{children:e.jsx(P,{className:"h-8",type:"number",min:0,step:.1,placeholder:"",value:String(r.value),onChange:o=>{const c=Number(o.target.value);r.onChange(c)}})}),e.jsx(M,{})]})}),e.jsx(Y,{control:n.control,name:"effect",render:({field:r})=>e.jsxs(F,{className:"space-y-1",children:[e.jsx(z,{children:""}),e.jsx(K,{children:e.jsxs(be,{onValueChange:r.onChange,value:r.value,children:[e.jsx(ue,{className:"h-8",children:e.jsx(ve,{placeholder:""})}),e.jsxs(me,{children:[e.jsx($,{value:"typewriter",children:""}),e.jsx($,{value:"fadeIn",children:""}),e.jsx($,{value:"none",children:""})]})]})}),e.jsx(M,{})]})}),i.effect==="fadeIn"&&e.jsx(Y,{control:n.control,name:"effectDuration",render:({field:r})=>e.jsxs(F,{className:"space-y-1",children:[e.jsx(z,{children:""}),e.jsx(K,{children:e.jsx(P,{className:"h-8",type:"number",min:0,step:.1,placeholder:"",value:String(r.value),onChange:o=>{const c=Number(o.target.value);r.onChange(c)}})}),e.jsx(M,{})]})}),e.jsx(Y,{control:n.control,name:"speaker.autoShowSpeaker",render:({field:r})=>e.jsxs(F,{className:"flex flex-row items-center space-y-0",children:[e.jsx(z,{className:"w-[8rem]",children:""}),e.jsx(K,{children:e.jsx(ht,{checked:!!r.value,onCheckedChange:r.onChange})}),e.jsx(M,{})]})}),e.jsx(Y,{control:n.control,name:"speaker.autoMaskOtherSpeakers",render:({field:r})=>e.jsxs(F,{className:"flex flex-row items-center space-y-0",children:[e.jsx(z,{className:"w-[8rem]",children:""}),e.jsx(K,{children:e.jsx(ht,{checked:!!r.value,onCheckedChange:r.onChange})}),e.jsx(M,{})]})})]})})}const sn={name:"Narrator",label:""};function Mm({speak:a,lines:s,onChangeSpeak:t,children:n}){const i=Tt("(min-width: 640px)"),r=I(v=>v.activeScene),o=d.useMemo(()=>{const v=[sn];return r?[...v,...r.children.filter(b=>b.assetType===C.Character)]:v},[r]),c=oi(),{selectAsset:l}=Gt(),[p,h]=d.useState(!1),u=I(v=>v.editor),f=v=>{const b=o.find(V=>V.name===v);t({...a,speaker:{...a.speaker,speakerTargetName:b==null?void 0:b.name,name:(b==null?void 0:b.name)===sn.name?"":(b==null?void 0:b.label)||""}})},m=v=>{za(c,{directiveType:v}),i&&Xt(c)},g=async()=>{h(!1);const v=await l(C.Character);if(v){const b=await At(v,u);u.addChild(b),t({...a,speaker:{...a.speaker,speakerTargetName:b.name,name:b.label}})}};return e.jsxs("div",{className:"w-full flex flex-wrap",children:[e.jsxs(tn,{noSeparator:!0,children:[e.jsxs(be,{open:p,onOpenChange:h,value:a.speaker.speakerTargetName||"",onValueChange:f,children:[e.jsx(ue,{className:"w-[100px] md:w-[130px] h-8",children:e.jsx(ve,{placeholder:""})}),e.jsxs(me,{children:[o.map(v=>e.jsx($,{value:v.name,children:v.label},v.name)),e.jsx("div",{onClick:g,className:"cursor-pointer select-none py-1.5 pl-2 pr-8 text-sm hover:bg-slate-100 rounded-sm","data-disable-click-outside":!0,children:"..."})]})]}),e.jsxs(Xa,{children:[e.jsx(Fa,{asChild:!0,children:e.jsx(Kt,{className:"px-1",tooltip:"",children:e.jsx(G.settings,{className:"!size-4 cursor-pointer mx-1"})})}),e.jsx(Ws,{children:e.jsx(ur,{speak:a,onChangeSpeak:t})})]}),e.jsxs(Kt,{className:"px-1 text-xs",onClick:()=>m(yt.Animation),tooltip:"",children:[e.jsx(G.squarePlus,{className:"!size-4 md:mr-0.5 hidden md:flex"}),""]}),e.jsxs(Kt,{className:"px-1 text-xs",onClick:()=>m(yt.Sound),tooltip:"",children:[e.jsx(G.squarePlus,{className:"!size-4 md:mr-0.5 hidden md:flex"}),""]}),e.jsx(Dm,{})]}),e.jsx(tn,{className:"ml-auto",children:n})]})}function Hm(){const[a,s]=d.useState(!1);return d.useEffect(()=>{s(!0)},[]),a}const Bm=$e(({children:a,className:s,prefix:t,...n},i)=>{const r=Kc(),o=zc(),c=Dc(),l=Hm(),{editor:p}=ba(dt),h=()=>{za(p,{directiveElement:r})};return e.jsx(Yc,{className:ae("inline-block cursor-pointer rounded-md bg-muted px-1.5 py-0.5 align-baseline text-sm font-medium select-none mx-0.5",o&&c&&"ring-2 ring-ring",r.children[0].bold===!0&&"font-bold",r.children[0].italic===!0&&"italic",r.children[0].underline===!0&&"underline",s),contentEditable:!1,onClick:h,ref:i,...n,children:l&&Mc?e.jsxs(ze.Fragment,{children:[a,t,r.value.label||""]}):e.jsxs(ze.Fragment,{children:[t,r.value.label||"",a]})})}),mr=ye("w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 print:hidden");$e(({align:a="center",className:s,sideOffset:t=4,style:n,...i},r)=>e.jsx(ei,{children:e.jsx(fa,{align:a,className:ae(mr(),s),ref:r,sideOffset:t,style:{zIndex:1e3,...n},...i})}));const Pm=d.forwardRef(({form:a},s)=>{const t=I(h=>h.activeScene),[n,i]=d.useState([]),[r,o]=d.useState([]),c=Re({control:a.control,name:"directive"}),l=Re({control:a.control,name:"params.targetName"}),p=Re({control:a.control,name:"params.source"});return d.useEffect(()=>{if(t){const h=[],u=[],f=[];let m=[];for(const g of t.children){const v={value:g.name,label:g.label};g.assetType===C.Character?h.push(v):g.assetType===C.Background?f.push(v):g.assetType===C.Thing?u.push(v):g.name&&m.push(v)}c===N.ChangeSource&&(m=m.filter(g=>g.assetID)),i([{label:"",options:h},{label:"",options:f},{label:"",options:u},{label:"",options:m}])}},[t,c]),d.useEffect(()=>{if(t&&c===N.ChangeSource&&l){const h=t.children.find(u=>u.name===l);h!=null&&h.assetID?Q.get(h.assetID).then(u=>{const f=u.states.map(m=>({value:xe(m),label:m.name}));o(f)}):o([])}},[t,c,l,a]),d.useImperativeHandle(s,()=>({getDirectiveLabel:()=>{var h,u;if(t&&c&&l){const f=Ce[c],m=((h=t.children.find(v=>v.name===l))==null?void 0:h.label)||"",g=[f,m];if(c===N.ChangeSource&&p){const v=((u=r.find(b=>b.value===p))==null?void 0:u.label)||"";g.push(v)}return g.join(":")}return""}}),[t,c,l,p,r]),e.jsxs(e.Fragment,{children:[e.jsx(Y,{control:a.control,name:"params.targetName",render:({field:h})=>e.jsxs(F,{className:"space-y-1",children:[e.jsx(z,{children:""}),e.jsx(K,{children:e.jsxs(be,{onValueChange:u=>{h.onChange(u),a.setValue("params.source","")},value:h.value,children:[e.jsx(ue,{className:"h-8",children:e.jsx(ve,{placeholder:""})}),e.jsxs(me,{children:[n.map(u=>u.options.length>0&&e.jsxs(Ra,{children:[e.jsx(Vs,{children:u.label}),u.options.map(f=>e.jsx($,{value:f.value,children:f.label},f.value))]},u.label)),n.every(u=>u.options.length===0)&&e.jsx("div",{className:"select-none py-1.5 pl-2 pr-8 text-sm opacity-50",children:""})]})]})}),e.jsx(M,{})]})}),c===N.ChangeSource&&r.length>0&&e.jsx(Y,{control:a.control,name:"params.source",render:({field:h})=>e.jsxs(F,{className:"space-y-1",children:[e.jsx(z,{children:""}),e.jsx(K,{children:e.jsxs(be,{onValueChange:h.onChange,value:h.value,children:[e.jsx(ue,{className:"h-8",children:e.jsx(ve,{placeholder:""})}),e.jsx(me,{children:r.map(u=>e.jsx($,{value:u.value,children:u.label},u.value))})]})}),e.jsx(M,{})]})}),c!==N.ChangeSource&&e.jsx(Y,{control:a.control,name:"params.duration",render:({field:h})=>e.jsxs(F,{className:"space-y-1",children:[e.jsx(z,{children:"()"}),e.jsx(K,{children:e.jsx(P,{type:"number",min:0,step:.1,placeholder:"",value:h.value||"",onChange:u=>{const f=Number(u.target.value);h.onChange(f)},className:"h-8"})}),e.jsx(M,{})]})})]})}),Am=d.forwardRef(({form:a},s)=>{const t=Re({control:a.control,name:"directive"}),n=Re({control:a.control,name:"params.duration"});return d.useImperativeHandle(s,()=>({getDirectiveLabel:()=>"".concat(Ce[t],":").concat(n!=null?n:0,"")}),[n,t]),e.jsx(Y,{control:a.control,name:"params.duration",render:({field:i})=>e.jsxs(F,{className:"space-y-1",children:[e.jsx(z,{children:"()"}),e.jsx(K,{children:e.jsx(P,{type:"number",min:0,step:.1,placeholder:"",value:String(i.value),onChange:r=>{const o=Number(r.target.value);i.onChange(o)},className:"h-8"})}),e.jsx(M,{})]})})}),Um=d.forwardRef(({form:a},s)=>{const t=I(f=>f.activeScene),n=I(f=>f.editor),[i,r]=d.useState([]),o=Re({control:a.control,name:"directive"}),c=Re({control:a.control,name:"params.targetName"}),{selectAsset:l}=Gt(),[p,h]=d.useState(!1),u=async f=>{h(!1);const m=await l(C.Audio);if(m){c&&n.removeSoundByName(c);const g=Ga(m);n.addSound(g),setTimeout(()=>{f(g.name)},150)}};return d.useEffect(()=>{if(t){const f=t.dialogues.map(g=>{var v,b;return(b=(v=g.speak)==null?void 0:v.voice)==null?void 0:b.targetName}),m=t.sounds.map(g=>({label:g.label,value:g.name})).filter(g=>!f.includes(g.value));r([{label:"",options:m}])}},[t]),d.useImperativeHandle(s,()=>({getDirectiveLabel:()=>{var f;if(t&&o&&c){const m=Ce[o],g=((f=t.sounds.find(b=>b.name===c))==null?void 0:f.label)||"";return[m,g].join(":")}return""}}),[t,o,c]),e.jsxs(e.Fragment,{children:[e.jsx(Y,{control:a.control,name:"params.targetName",render:({field:f})=>e.jsxs(F,{className:"space-y-1",children:[e.jsx(z,{children:""}),e.jsx(K,{children:e.jsxs(be,{open:p,onOpenChange:h,onValueChange:f.onChange,value:f.value,children:[e.jsx(ue,{className:"h-8",children:e.jsx(ve,{placeholder:""})}),e.jsxs(me,{children:[i.map(m=>m.options.length>0&&e.jsxs(Ra,{children:[e.jsx(Vs,{children:m.label}),m.options.map(g=>e.jsx($,{value:g.value,children:g.label},g.value))]},m.label)),e.jsx("div",{onClick:()=>u(f.onChange),className:"cursor-pointer select-none py-1.5 pl-2 pr-8 text-sm hover:bg-slate-100 rounded-sm","data-disable-click-outside":!0,children:"..."})]})]})}),e.jsx(M,{})]})}),o===N.Play&&e.jsxs(e.Fragment,{children:[e.jsx(Y,{control:a.control,name:"params.start",render:({field:f})=>e.jsxs(F,{className:"space-y-1",children:[e.jsx(z,{children:"()"}),e.jsx(K,{children:e.jsx(P,{type:"number",min:0,step:1,placeholder:"0",value:f.value||"",onChange:m=>{const g=Number(m.target.value);f.onChange(g)},className:"h-8"})}),e.jsx(M,{})]})}),e.jsx(Y,{control:a.control,name:"params.volume",render:({field:f})=>{var m;return e.jsxs(F,{className:"space-y-1",children:[e.jsx(z,{children:""}),e.jsx(K,{children:e.jsx(Ct,{min:0,max:1,step:.1,value:[(m=f.value)!=null?m:1],onValueChange:g=>f.onChange(g[0]),showPercentage:!0})}),e.jsx(M,{})]})}}),e.jsx(Y,{control:a.control,name:"params.loop",render:({field:f})=>e.jsxs(F,{className:"space-y-0 flex flex-row items-center",children:[e.jsx(z,{className:"flex flex-col w-[4rem]",children:""}),e.jsx(K,{children:e.jsx(ht,{checked:f.value,onCheckedChange:f.onChange})}),e.jsx(M,{})]})}),e.jsx(Y,{control:a.control,name:"params.untilEnd",render:({field:f})=>e.jsxs(F,{className:"space-y-0 flex flex-row items-center",children:[e.jsx(z,{className:"flex flex-col w-[4rem]",children:""}),e.jsx(K,{children:e.jsx(ht,{checked:f.value,onCheckedChange:f.onChange})}),e.jsx(M,{})]})})]})]})}),Em=d.forwardRef(({form:a},s)=>{const t=I(o=>o.activeScene),[n,i]=d.useState([]),r=Re({control:a.control,name:"directive"});return d.useEffect(()=>{if(t){const o=[],c=[],l=[],p=[];for(const h of t.children){const u={value:h.name,label:h.label};h.assetType===C.Character?o.push(u):h.assetType===C.Background?l.push(u):h.assetType===C.Thing?c.push(u):h.name&&p.push(u)}i([{label:"",options:o},{label:"",options:l},{label:"",options:c},{label:"",options:p}])}},[t]),d.useImperativeHandle(s,()=>({getDirectiveLabel:()=>{const o=[Ce[r]],c=a.getValues("params.targetName"),l=n.flatMap(u=>u.options).find(u=>u.value===c),p=l?l.label:"";o.push(p);const h=a.getValues("params.filterName");if(h){const u=qa.find(m=>m.value===h),f=u?u.name:"";o.push(f)}return o.join(":")}}),[a,r,n]),e.jsxs(e.Fragment,{children:[e.jsx(Y,{control:a.control,name:"params.targetName",render:({field:o})=>e.jsxs(F,{className:"space-y-1",children:[e.jsx(z,{children:""}),e.jsx(K,{children:e.jsxs(be,{onValueChange:o.onChange,value:o.value,children:[e.jsx(ue,{className:"h-8",children:e.jsx(ve,{placeholder:""})}),e.jsx(me,{children:n.map(c=>c.options.length>0&&e.jsxs(Ra,{children:[e.jsx(Vs,{children:c.label}),c.options.map(l=>e.jsx($,{value:l.value,children:l.label},l.value))]},c.label))})]})}),e.jsx(M,{})]})}),r===N.AddFilter&&e.jsx(Y,{control:a.control,name:"params.filterName",render:({field:o})=>e.jsxs(F,{className:"space-y-1",children:[e.jsx(z,{children:""}),e.jsx(K,{children:e.jsxs(be,{onValueChange:o.onChange,value:o.value,children:[e.jsx(ue,{className:"h-8",children:e.jsx(ve,{placeholder:""})}),e.jsx(me,{children:qa.map(c=>e.jsx($,{value:c.value,children:c.name},c.value))})]})}),e.jsx(M,{})]})})]})}),Om=d.forwardRef(({form:a},s)=>(d.useImperativeHandle(s,()=>({getDirectiveLabel:()=>{const t=a.getValues("directive");return Ce[t]}})),e.jsx(e.Fragment,{children:e.jsx(Y,{control:a.control,name:"params.duration",render:({field:t})=>e.jsxs(F,{className:"space-y-1",children:[e.jsx(z,{children:""}),e.jsx(K,{children:e.jsx(P,{type:"number",min:0,step:.1,placeholder:"",value:t.value||"",onChange:n=>{const i=Number(n.target.value);t.onChange(i)},className:"h-8"})}),e.jsx(M,{})]})})}))),Jm=Hc("directive",[B({directive:Be(Ut[0]),params:B({targetName:E({message:""}),source:E().min(1,{message:""}),duration:pe().optional(),sequential:Ge().optional()})}),...Ut.slice(1).map(a=>B({directive:Be(a),params:B({targetName:E({message:""}),duration:pe().optional(),sequential:Ge().optional()})})),B({directive:Be(N.Wait),params:B({duration:pe().optional(),sequential:Ge().optional()})}),B({directive:Be(N.Play),params:B({targetName:E({message:""}),start:pe().optional(),volume:pe().optional(),loop:Ge().optional(),untilEnd:Ge().optional(),sequential:Ge().optional()})}),...[N.Pause,N.Stop].map(a=>B({directive:Be(a),params:B({targetName:E({message:""}),sequential:Ge().optional()})})),B({directive:Be(N.AddFilter),params:B({targetName:E({message:""}),filterName:E({message:""}),sequential:Ge().optional()})}),B({directive:Be(N.RemoveFilter),params:B({targetName:E({message:""}),sequential:Ge().optional()})}),B({directive:Be(N.FadeInTransition),params:B({duration:pe().optional(),sequential:Ge().optional()})})]);function Qm({editingDirective:a,directiveType:s,onSubmitDirective:t,onCancel:n}){const i=at({resolver:nt(Jm),defaultValues:{directive:void 0,params:{}}}),r=Re({control:i.control,name:"directive"}),o=d.useRef(null),c=d.useRef(null),l=d.useRef(null),p=d.useRef(null),h=d.useRef(null),u=d.useMemo(()=>em.find(m=>m.type===s),[s]);d.useEffect(()=>{a?i.reset(a.value,{keepDefaultValues:!0}):i.reset()},[a,i.reset,i]);function f(m){let g="";o.current?g=o.current.getDirectiveLabel():c.current?g=c.current.getDirectiveLabel():l.current?g=l.current.getDirectiveLabel():p.current?g=p.current.getDirectiveLabel():h.current&&(g=h.current.getDirectiveLabel()),t({...m,label:g})}return e.jsx(ct,{...i,children:e.jsxs("form",{onSubmit:i.handleSubmit(f),className:"space-y-2 flex flex-col h-full",children:[e.jsx(Y,{control:i.control,name:"directive",render:({field:m})=>e.jsxs(F,{className:"space-y-1",children:[e.jsx(z,{children:u==null?void 0:u.name}),e.jsx(K,{children:e.jsxs(be,{onValueChange:m.onChange,value:m.value,children:[e.jsx(ue,{className:"h-8",children:e.jsx(ve,{placeholder:""})}),e.jsx(me,{children:u==null?void 0:u.options.map(g=>e.jsx($,{value:g.value,children:g.name},g.value))})]})})]})}),Ut.includes(r)&&e.jsx(Pm,{form:i,ref:o}),Ia.includes(r)&&e.jsx(Am,{form:i,ref:c}),Wa.includes(r)&&e.jsx(Um,{form:i,ref:l}),La.includes(r)&&e.jsx(Em,{form:i,ref:p}),r===N.FadeInTransition&&e.jsx(Om,{form:i,ref:h}),r&&r!==N.Wait&&e.jsx(Y,{control:i.control,name:"params.sequential",render:({field:m})=>e.jsxs(F,{className:"space-y-0 flex flex-row items-center !mb-4",children:[e.jsx(z,{className:"flex flex-col w-[4rem]",children:""}),e.jsx(K,{children:e.jsx(ht,{checked:m.value,onCheckedChange:m.onChange})}),e.jsx(M,{})]})}),e.jsxs("div",{className:"pt-2 !mt-auto sticky left-0 bottom-0 bg-white w-full flex justify-center border-t border-t-border gap-2",children:[e.jsx(j,{size:"sm",type:"submit",children:""}),e.jsx(j,{size:"sm",type:"button",onClick:n,variant:"outline",children:""})]})]})})}const _m={middleware:[Bc(12),Pc({fallbackPlacements:["bottom-end","top-start","top-end"],padding:12})],placement:"bottom-start"};function $m(){const a=Uc({preventDefaultOnEnterKeydown:!0}),{useOption:s}=ba(dt),t=s("editingDirective"),n=s("directiveType"),{ref:i,props:r,onSubmit:o,onCancel:c}=Km({floatingOptions:_m,triggerFloatingLinkHotkeys:"mod+k"});return e.jsx(Ac,{children:e.jsx("div",{className:ae(mr(),"w-auto p-1"),...r,ref:i,children:e.jsx("div",{className:"flex w-[200px] h-[400px] overflow-auto flex-col p-2",...a,children:n&&e.jsx(Qm,{editingDirective:t,directiveType:n,onSubmitDirective:o,onCancel:c})})})})}const Da=({className:a})=>e.jsx(pa,{className:S("h-6 w-6 text-primary/60 animate-spin",a)});function qm({speak:a,lines:s,onChangeSpeak:t}){var te;const[n,i]=d.useState(!1),[r,o]=d.useState(0),[c,l]=d.useState(0),[p,h]=d.useState(1),u=d.useRef(null),[f,m]=d.useState(""),{selectAsset:g}=Gt(),v=I(D=>D.editor),b=I(D=>D.project),V=Ee(D=>D.tts),[W,R]=d.useState(!1),{toast:H}=et(),X=d.useCallback(D=>{t({...a,voice:{...a.voice||{},...D}})},[t,a]),O=async()=>{R(!0);try{const{sound:D,url:_}=await Hi({lines:s,editor:v,project:b,speak:a,ttsSettings:V});X({targetName:D.name}),m(_),H({title:"!",duration:1500})}catch(D){console.error("TTS generation failed:",D),H({title:"",description:D.message,variant:"destructive"})}finally{R(!1)}},ie=d.useCallback(async()=>{u.current&&(n?u.current.pause():u.current.play(),i(!n))},[n]),T=d.useCallback(()=>{u.current&&l(u.current.currentTime)},[]),y=d.useCallback(()=>{u.current&&o(u.current.duration)},[]),w=d.useCallback(D=>{u.current&&(u.current.currentTime=D[0],l(D[0]))},[]),A=d.useCallback(D=>{if(u.current){const _=D[0];u.current.volume=_,h(_),X({volume:_})}},[X]),ee=d.useCallback(async()=>{var _;const D=await g(C.Audio);if(D){(_=a.voice)!=null&&_.targetName&&v.removeSoundByName(a.voice.targetName);const we=Ga(D);v.addSound(we),X({targetName:we.name})}},[a,v,X,g]),ke=d.useCallback(()=>{m(""),l(0),o(0),i(!1),v.removeSoundByName(a.voice.targetName),X({targetName:""})},[v,X,a]),Me=D=>{const _=Math.floor(D/60),we=Math.floor(D%60);return"".concat(_,":").concat(we.toString().padStart(2,"0"))};return d.useEffect(()=>{(async()=>{var _;if((_=a.voice)!=null&&_.targetName){const we=v.activeScene.getSoundByName(a.voice.targetName),mt=await ka(we.assetID,we.label),Le=zi(mt);m(Le)}})()},[v,a]),d.useEffect(()=>{var D;(D=a.voice)!=null&&D.volume&&h(a.voice.volume)},[a]),d.useEffect(()=>{u.current&&(u.current.volume=p)},[p,f]),e.jsxs("div",{className:"flex items-center w-full gap-2 p-1 border border-t-0 rounded-md rounded-t-none bg-background h-[32px]",children:[e.jsx("audio",{ref:u,src:f,onTimeUpdate:T,onLoadedMetadata:y,onEnded:()=>{i(!1),l(0)}}),(te=a.voice)!=null&&te.targetName?e.jsxs(e.Fragment,{children:[e.jsx(j,{variant:"ghost",size:"icon",className:"w-6 h-6",onClick:ie,children:n?e.jsx(_n,{className:"w-3 h-3"}):e.jsx($n,{className:"w-3 h-3"})}),e.jsxs("div",{className:"flex items-center flex-1 gap-2",children:[e.jsx("span",{className:"text-xs text-muted-foreground min-w-[35px]",children:Me(c)}),e.jsx(Ct,{value:[c],max:r,step:.1,className:"w-full",onValueChange:w}),e.jsx("span",{className:"text-xs text-muted-foreground min-w-[35px]",children:Me(r)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(Xa,{children:[e.jsx(Fa,{asChild:!0,children:e.jsx(j,{variant:"ghost",size:"icon",className:"w-6 h-6",children:e.jsx(Ec,{className:"w-3 h-3"})})}),e.jsx(Ws,{className:"w-[260px] p-2",side:"top",children:e.jsx(Ct,{value:[p],max:1,step:.1,className:"w-full",onValueChange:A,showPercentage:!0})})]}),e.jsx(j,{variant:"ghost",size:"icon",className:"w-6 h-6 hover:text-destructive",onClick:ke,children:e.jsx(Os,{className:"w-3 h-3"})})]})]}):e.jsxs("div",{className:"flex items-center justify-around w-full h-full px-1",children:[e.jsxs(j,{variant:"ghost",size:"icon",className:"flex-1 h-6 mx-1 text-xs",disabled:W,onClick:ee,children:[e.jsx(Oc,{className:"w-3 h-3 mr-1"}),""]}),e.jsx(j,{variant:"ghost",size:"icon",disabled:W,className:"flex-1 h-6 mx-1 text-xs",onClick:O,children:W?e.jsxs(e.Fragment,{children:[e.jsx(Da,{className:"w-3 h-3 mr-1"}),"..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ci,{className:"w-3 h-3 mr-1"}),""]})})]})]})}function ep({value:a,onChange:s,onFocus:t,children:n}){const i=Jc({plugins:[Qc,dt.extend({render:{afterEditable:()=>e.jsx($m,{})}}),_c],override:{components:{[dt.key]:Bm}},value:a.lines}),r=d.useRef(!1),o=({value:p})=>{if(r.current){r.current=!1;return}s({...a,lines:p})},c=p=>{s({...a,speak:p})},l=()=>{t(a)};return d.useEffect(()=>{i.children!==a.lines&&(r.current=!0,i.tf.setValue(a.lines))},[a.lines,i]),e.jsxs("div",{className:"flex flex-col",children:[e.jsx($c,{editor:i,onValueChange:o,children:e.jsxs("div",{className:"relative rounded-md rounded-b-none border bg-background border-border",onFocus:l,children:[e.jsx(km,{children:e.jsx(Mm,{speak:a.speak,lines:a.lines,onChangeSpeak:c,children:n})}),e.jsx(hr,{focusRing:!1,variant:"ghost",size:"sm"})]})}),e.jsx(qm,{speak:a.speak,lines:a.lines,onChangeSpeak:c})]})}const tp=({isOpen:a,speak:s,autoShowBackground:t,onClose:n,onConfirm:i})=>{var u,f;const[r,o]=ze.useState({speak:s,autoShowBackground:t}),c=m=>{o({...r,speak:m})},l=m=>{o({...r,autoShowBackground:m})},p=m=>{o({...r,speak:{...r.speak,voice:{...r.speak.voice||{},volume:m[0]}}})},h=()=>{i(r),n()};return e.jsx(Ne,{open:a,onOpenChange:n,children:e.jsxs(je,{className:"sm:max-w-[600px]",children:[e.jsxs(re,{children:[e.jsx(oe,{className:"text-base font-bold",children:""}),e.jsx(le,{children:""})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(ur,{speak:r.speak,onChangeSpeak:c,disableCustomName:!0}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-sm font-medium w-[8rem]",children:""}),e.jsx(ht,{checked:r.autoShowBackground,onCheckedChange:l})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-sm font-medium w-[8rem]",children:""}),e.jsx("div",{className:"flex-1",children:e.jsx(Ct,{value:[(f=(u=r.speak.voice)==null?void 0:u.volume)!=null?f:1],onValueChange:p,min:0,max:1,step:.1,className:"flex-1",showPercentage:!0})})]})]}),e.jsxs(Gs,{className:"justify-center sm:justify-center",children:[e.jsx(j,{onClick:h,children:""}),e.jsx(j,{variant:"outline",onClick:n,children:""})]})]})})};function an({onClose:a}){const s=I(T=>T.editor),t=I(T=>T.project),n=I(T=>T.activeScene),[i,r]=d.useState(!1),[o,c]=d.useState(!1),l=d.useRef(null),p=Ee(T=>T.tts),{toast:h}=et(),{showLoading:u,updateLoadingText:f,hideLoading:m}=tr(),g=T=>{s.updateActiveScene(y=>{y.config.autoShowBackground=T.autoShowBackground,y.config.speak=T.speak,y.dialogues.forEach(w=>{w.speak={...w.speak,...T.speak,speaker:{...w.speak.speaker||{},wordsPerMin:T.speak.speaker.wordsPerMin,interval:T.speak.speaker.interval,effect:T.speak.speaker.effect,effectDuration:T.speak.speaker.effectDuration,autoShowSpeaker:T.speak.speaker.autoShowSpeaker,autoMaskOtherSpeakers:T.speak.speaker.autoMaskOtherSpeakers},voice:{...w.speak.voice||{},volume:T.speak.voice.volume}}})})},v=T=>{const{config:y}=n;s.addDialogue({speak:s.cloneDialogueSpeak(y.speak),lines:[]},T),O()},b=(T,y)=>{s.addDialogue({speak:{...s.cloneDialogueSpeak(y.speak),voice:void 0},lines:[]},T)},V=T=>{s.updateActiveScene(y=>{y.label=T})},W=(T,y)=>{if(s.activeScene){const{speaker:w,targetName:A}=s.activeScene.config.speak||{};if(w){const ee=s.activeScene.getChildByName(w.targetName);ee&&(ee.text=y.speak.speaker.name)}if(y.lines.length>0){const ee=s.activeScene.getChildByName(A),ke=vi(y.lines);ke&&ee&&(ee.text=ke)}}},R=(T,y)=>{s.updateDialogue(T,y),W(T,y)},H=(T,y)=>{const w=s.cloneDialogue(T);w.speak.voice=void 0,s.addDialogue(w,y)},X=(T,y)=>{s.swapDialogue(T,y)},O=()=>{setTimeout(()=>{l.current&&l.current.scrollToBottom()},100)},ie=async()=>{if(!p||!p.appid||!p.token){h({title:"",variant:"destructive"});return}const T=n.dialogues;u("");try{for(const[y,w]of T.entries()){f(" ".concat(y+1," "));try{const{sound:A}=await Hi({speak:w.speak,lines:w.lines,editor:s,project:t,ttsSettings:p});s.updateDialogue(y,{...w,speak:{...w.speak,voice:{...w.speak.voice||{},targetName:A.name}}})}catch(A){if(A.voice!==Pt)throw A}}h({title:"!"})}catch(y){h({title:"",description:y.message,variant:"destructive"})}finally{m()}};return e.jsx(ut,{className:"w-full flex-1 h-full border-0 md:border shadow-none md:shadow rounded-md",children:e.jsx(qe,{className:"h-full p-1 md:p-2",children:n?e.jsxs(e.Fragment,{children:[e.jsx(ge,{className:"w-full h-full pr-2",ref:l,children:e.jsxs("div",{className:"flex flex-col m-1 mr-0 pr-1",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs(fe,{htmlFor:"sceneName",className:"flex justify-between items-center",children:[e.jsx("span",{children:""}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(Oe,{children:e.jsxs(Je,{children:[e.jsx(Qe,{asChild:!0,children:e.jsx(j,{size:"sm",variant:"ghost",onClick:()=>c(!0),children:e.jsx(G.settings,{className:"size-4"})})}),e.jsx(Ke,{children:e.jsx("p",{children:""})})]})}),e.jsx(Oe,{children:e.jsxs(Je,{children:[e.jsx(Qe,{asChild:!0,children:e.jsx(j,{size:"sm",variant:"ghost",onClick:()=>r(!0),children:e.jsx(G.bookmark,{className:"size-4"})})}),e.jsx(Ke,{children:e.jsx("p",{children:""})})]})}),a&&e.jsx(j,{className:"-mr-3",size:"sm",variant:"ghost",onClick:a,children:e.jsx(G.close,{className:"size-4"})})]})]}),e.jsx(P,{type:"text",id:"sceneName",placeholder:"",value:n.label,onChange:T=>V(T.target.value)})]}),e.jsxs("div",{className:"flex flex-col gap-2 mt-4",children:[e.jsxs(fe,{className:"flex justify-between items-center",children:[e.jsx("span",{children:""}),e.jsx(Oe,{children:e.jsxs(Je,{children:[e.jsx(Qe,{asChild:!0,children:e.jsx(j,{size:"sm",variant:"ghost",onClick:ie,children:e.jsx(ci,{className:"size-4"})})}),e.jsx(Ke,{children:e.jsx("p",{children:""})})]})})]}),n.dialogues.map((T,y)=>e.jsx("div",{children:e.jsx(ep,{value:T,onChange:w=>R(y,w),onFocus:w=>W(y,w),children:e.jsxs(Sa,{children:[e.jsx(ja,{children:e.jsx(G.more,{className:"size-4 cursor-pointer mx-1"})}),e.jsxs(Zs,{children:[e.jsx(de,{onClick:()=>b(y+1,T),children:""}),e.jsx(de,{onClick:()=>H(T,y+1),children:""}),e.jsx(de,{className:"text-destructive",onClick:()=>{s.removeDialogue(T)},children:""}),e.jsx(wa,{}),y>0&&e.jsx(de,{onClick:()=>X(y,y-1),children:""}),y<n.dialogues.length-1&&e.jsx(de,{onClick:()=>X(y,y+1),children:""})]})]})})},y))]}),e.jsx(j,{className:"mt-2",onClick:()=>v(),children:""})]})}),i&&e.jsx(gu,{isOpen:i,onClose:()=>r(!1),sceneName:n.name}),o&&e.jsx(tp,{isOpen:o,speak:n.config.speak,autoShowBackground:n.config.autoShowBackground,onConfirm:g,onClose:()=>c(!1)})]}):e.jsx("div",{className:"h-full text-lg flex items-center justify-center text-muted-foreground/50",children:t?"":""})})})}function sp({type:a,url:s,ext:t,className:n,onChange:i}){const[r,o]=d.useState(null),[c,l]=d.useState(null),p=d.useMemo(()=>r||s||"",[s,r]),h=d.useMemo(()=>c||t||"",[t,c]),u=d.useMemo(()=>Di(a),[a]),f=d.useRef(null),m=v=>{var V;r&&URL.revokeObjectURL(r);const b=(V=v.target.files)==null?void 0:V[0];o(URL.createObjectURL(b)),l(jt(b).ext),i(b)},g=()=>{var v;(v=f.current)==null||v.click()};return d.useEffect(()=>()=>{r&&URL.revokeObjectURL(r)},[r]),e.jsxs("div",{className:S("flex cursor-pointer group relative",n),onClick:g,children:[e.jsx("input",{type:"file",ref:f,onChange:m,className:"hidden",accept:u}),e.jsxs("div",{className:"size-full flex justify-center items-center text-sm invisible group-hover:visible bg-muted/80 absolute left-0 right-0 z-20",children:[e.jsx(qc,{className:"size-4"}),e.jsx("div",{children:""})]}),e.jsx(rr,{url:p,type:a,ext:h})]})}const ap=ye("relative w-full rounded-lg border px-4 py-3 text-sm [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground [&>svg~*]:pl-7",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),pr=d.forwardRef(({className:a,variant:s,...t},n)=>e.jsx("div",{ref:n,role:"alert",className:S(ap({variant:s}),a),...t}));pr.displayName="Alert";const np=d.forwardRef(({className:a,...s},t)=>e.jsx("h5",{ref:t,className:S("mb-1 font-medium leading-none tracking-tight",a),...s}));np.displayName="AlertTitle";const fr=d.forwardRef(({className:a,...s},t)=>e.jsx("div",{ref:t,className:S("text-sm [&_p]:leading-relaxed",a),...s}));fr.displayName="AlertDescription";const ip=B({id:pe().optional(),name:E().min(1,{message:""}),type:E().min(1,{message:""}),voice:E().optional(),states:ed(B({id:pe().optional(),name:E().min(1,{message:""}),ext:E().optional(),file:td(File).optional()}).refine(a=>a.id||a.file,{message:""}))});function rp({asset:a,onSubmit:s,onCancel:t}){const[n,i]=d.useState(!1),r=d.useRef(),o=d.useMemo(()=>yh[a.type],[a.type]),c=at({resolver:nt(ip),defaultValues:{name:"",type:"",voice:"",states:[]}}),{fields:l,append:p,remove:h}=sd({control:c.control,name:"states",keyName:"_id"}),u=Ee(b=>b.tts),{toast:f}=et(),m=b=>{s(b)},g=(b,V)=>{c.setValue("states.".concat(V,".file"),b),c.getValues("states.".concat(V,".name"))||c.setValue("states.".concat(V,".name"),jt(b).name)},v=async b=>{var V;if(!u||!u.appid||!u.token){f({title:"",variant:"destructive"});return}if(b!==Pt)try{if(i(!0),((V=r.current)==null?void 0:V.voice)===b){r.current.audio.play();return}const W=await Yi({text:"",voiceType:b,token:u.token,appid:u.appid}),R=new Audio(W.audio_url);R.onended=()=>{i(!1)},R.play(),r.current={voice:b,audio:R}}catch(W){console.error(W),i(!1)}};return d.useEffect(()=>()=>{var b;(b=r.current)!=null&&b.audio&&(r.current.audio.pause(),r.current=void 0)},[]),d.useEffect(()=>{c.reset({id:a.id,name:a.name,type:a.type,voice:a.voice,states:a.states})},[a,c]),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-base font-bold mb-2",children:[a.id?"":"",o,e.jsx(pr,{className:"p-2 mt-1",children:e.jsxs(fr,{className:"text-muted-foreground font-normal flex gap-1 items-center",children:[e.jsx(G.tip,{className:"size-4"}),[C.Background,C.Character,C.Thing,C.Dialog].includes(a.type)&&e.jsx("span",{children:"1920*1080"}),a.type===C.Audio&&e.jsx("span",{children:">=44100Hz"}),a.type===C.Font&&e.jsx("span",{children:"woff/woff2/ttf"})]})})]}),e.jsx(ct,{...c,children:e.jsxs("form",{onSubmit:c.handleSubmit(m),className:"space-y-4",children:[e.jsx(Y,{control:c.control,name:"name",render:({field:b})=>e.jsxs(F,{children:[e.jsxs(z,{children:[o,""]}),e.jsx(K,{children:e.jsx(P,{placeholder:"".concat(o,""),disabled:a.id===lt,...b})}),e.jsx(M,{})]})}),a.type===C.Character&&e.jsx(Y,{control:c.control,name:"voice",render:({field:b})=>e.jsxs(F,{children:[e.jsx(z,{children:""}),e.jsx(K,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(be,{onValueChange:b.onChange,value:b.value,children:[e.jsx(ue,{className:"flex-1",children:e.jsx(ve,{placeholder:""})}),e.jsx(me,{children:su.map(V=>e.jsx($,{value:V.value,children:V.name},V.value))})]}),e.jsx(Oe,{children:e.jsxs(Je,{children:[e.jsx(Qe,{asChild:!0,children:e.jsx(j,{type:"button",variant:"outline",disabled:!b.value||b.value===Pt||n,onClick:()=>v(b.value),children:n?e.jsx(Da,{className:"size-4"}):e.jsx(ad,{className:"size-4"})})}),e.jsx(Ke,{children:e.jsx("p",{children:""})})]})})]})}),e.jsx(M,{})]})}),a.id!==lt&&e.jsxs(F,{children:[e.jsxs(z,{className:"flex items-center",children:[o,"",e.jsxs(j,{size:"sm",variant:"outline",onClick:()=>p({name:""}),className:"ml-2",children:[e.jsx(G.squarePlus,{className:"size-4 mr-1"}),""]})]}),e.jsx(K,{children:e.jsx("div",{children:l.length>0&&e.jsxs(ge,{className:"w-full whitespace-nowrap rounded-md border",children:[e.jsx("div",{className:"flex w-full gap-2 p-2",children:l.map((b,V)=>e.jsx(bs,{type:a.type,state:b,children:e.jsxs(e.Fragment,{children:[e.jsx(qe,{className:"p-2 flex justify-center",children:e.jsx(sp,{className:"w-full h-full",type:a.type,ext:b.ext,url:b.id&&xe(b),onChange:W=>g(W,V)})}),e.jsx(ks,{className:"font-medium p-2 pt-0 flex flex-col gap-1",children:e.jsxs("div",{className:"flex w-full justify-between",children:[e.jsx(Y,{control:c.control,name:"states.".concat(V,".name"),render:({field:W})=>e.jsx(F,{children:e.jsx(K,{children:e.jsx(P,{className:"h-6 text-sm",placeholder:"",...W})})})}),e.jsx(G.delete,{className:"size-4 ml-1 mt-1 flex-shrink-0 cursor-pointer hover:text-destructive",onClick:()=>h(V)})]})})]})},V))}),e.jsx(Ht,{orientation:"horizontal"})]})})}),e.jsx(M,{})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(j,{type:"submit",children:""}),e.jsx(j,{type:"button",className:"mr-2",variant:"outline",onClick:t,children:""})]})]})})]})}function op({asset:a,onEdit:s,onSelectState:t,onCancel:n}){var i;return e.jsxs("div",{className:"h-[calc(100%-2.5rem)] flex flex-col",children:[e.jsxs("h3",{className:"text-base font-bold mb-4 flex justify-between items-center",children:["",e.jsx(j,{className:"ml-1 mr-auto",variant:"ghost",size:"sm",onClick:()=>s(a),children:e.jsx(G.edit,{className:"size-4"})}),e.jsx(j,{variant:"outline",size:"sm",onClick:n,children:""})]}),e.jsx(ge,{className:"flex-1",children:e.jsx("div",{className:"flex gap-2 flex-wrap",children:(i=a.states)==null?void 0:i.map(r=>e.jsx(bs,{type:a.type,state:r,onSelect:()=>t(r)},r.id))})})]})}function lp(){const a=Tt("(min-width: 640px)"),s=Te(y=>y.isOpen),t=Te(y=>y.confirm),n=Te(y=>y.cancel),i=Te(y=>y.disableSelect),r=Te(y=>y.type),[o,c]=d.useState(r),[l,p]=d.useState(null),[h,u]=d.useState(null),f=Et(async()=>{if(o){const y=await Q.where("type").equals(o).and(w=>!w.name.startsWith(Na)).reverse().toArray();if(o===C.Character){const w=y.findIndex(A=>A.id===lt);if(w!==-1){const A=y[w];y.splice(w,1),y.unshift(A)}}return y}return[]},[o]),m=y=>{c(y)},g=()=>{p({name:"",type:o,states:[]})},v=y=>{p(y)},b=y=>{y.states.forEach(w=>{Ve.delete(w.id)}),Q.delete(y.id)},V=()=>{n(),p(null),u(null)},W=async y=>{for(const w of y.states){const A=jt(w.file).ext,ee=await Ve.add({mime:w.file.type,blob:w.file,ext:A});w.id=ee,w.ext=A,delete w.file,y.type===C.Font&&_s(w.name,xe(w))}await Q.add(y)},R=async y=>{for(const w of y.states){if(w.file){w.id&&await Ve.delete(w.id);const A=jt(w.file).ext,ee=await Ve.add({mime:w.file.type,blob:w.file,ext:A});w.id=ee,w.ext=A,y.type===C.Font&&_s(w.name,xe(w))}delete w.file}await Q.update(y.id,y)},H=async y=>{if(y.id){if(await R(y),h){const w=await Q.get(y.id);u(w)}}else await W(y);p(null)},X=()=>{p(null)},O=y=>{i||(t({...h,stateId:y.id}),u(null))},ie=()=>{u(null)};d.useEffect(()=>{c(r||C.Character)},[r]);const T=()=>l?e.jsx(rp,{asset:l,onSubmit:H,onCancel:X}):h?e.jsx(op,{asset:h,onEdit:y=>v(y),onSelectState:O,onCancel:ie}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(Rs,{value:o,onValueChange:m,children:e.jsx(ts,{children:Ca.map(y=>e.jsx(De,{value:y.value,disabled:r&&r!==y.value,children:y.name},y.value))})}),e.jsxs(j,{size:"sm",onClick:g,children:[e.jsx(G.squarePlus,{className:"w-3.5 h-3.5 mr-0.5"}),a&&""]})]}),e.jsx(ge,{className:"flex-grow",children:e.jsx("div",{className:"flex gap-2 flex-wrap",children:f==null?void 0:f.map(y=>e.jsx(Eu,{asset:y,onSelect:()=>u(y),onEdit:()=>v(y),onDelete:()=>b(y)},y.id))})})]});return e.jsx(Ne,{open:s,onOpenChange:V,children:e.jsxs(je,{id:"asset-library",className:S("min-w-[90vw] h-[90vh] flex flex-col",!a&&"px-2"),children:[e.jsxs(re,{children:[e.jsx(oe,{children:""}),e.jsx(le,{})]}),T()]})})}const cp=nd,xr=d.forwardRef(({className:a,...s},t)=>e.jsx(di,{ref:t,className:S("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",a),...s}));xr.displayName=di.displayName;const dp=ye("group pointer-events-auto relative flex w-full items-center justify-between space-x-2 overflow-hidden rounded-md border p-4 pr-6 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),gr=d.forwardRef(({className:a,variant:s,...t},n)=>e.jsx(hi,{ref:n,className:S(dp({variant:s}),a),...t}));gr.displayName=hi.displayName;const hp=d.forwardRef(({className:a,...s},t)=>e.jsx(ui,{ref:t,className:S("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium transition-colors hover:bg-secondary focus:outline-none focus:ring-1 focus:ring-ring disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",a),...s}));hp.displayName=ui.displayName;const br=d.forwardRef(({className:a,...s},t)=>e.jsx(mi,{ref:t,className:S("absolute right-1 top-1 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-1 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",a),"toast-close":"",...s,children:e.jsx(Vn,{className:"h-4 w-4"})}));br.displayName=mi.displayName;const vr=d.forwardRef(({className:a,...s},t)=>e.jsx(pi,{ref:t,className:S("text-sm font-semibold [&+div]:text-xs",a),...s}));vr.displayName=pi.displayName;const yr=d.forwardRef(({className:a,...s},t)=>e.jsx(fi,{ref:t,className:S("text-sm opacity-90",a),...s}));yr.displayName=fi.displayName;function up(){const{toasts:a}=et();return e.jsxs(cp,{children:[a.map(function({id:s,title:t,description:n,action:i,...r}){return e.jsxs(gr,{...r,children:[e.jsxs("div",{className:"grid gap-1",children:[t&&e.jsx(vr,{children:t}),n&&e.jsx(yr,{children:n})]}),i,e.jsx(br,{})]},s)}),e.jsx(xr,{})]})}function mp(){const a=gs(t=>t.isOpen),s=gs(t=>t.loadingText);return e.jsx(Ne,{open:a,children:e.jsxs(je,{disableClose:!0,onPointerDownOutside:t=>t.preventDefault(),children:[e.jsxs(re,{className:"hidden",children:[e.jsx(oe,{}),e.jsx(le,{})]}),e.jsxs("div",{className:"w-full flex gap-2 justify-center items-center",children:[e.jsx("div",{className:"font-bold text-xl",children:s}),e.jsx(Da,{})]})]})})}function pp(){const[a,s]=d.useState(!1),t=Tt("(min-width: 768px)"),[n,i]=d.useState(null),{toast:r}=et(),o=()=>{s(!0)};return d.useEffect(()=>{fd().then(c=>{i(c.video),c.audio||(nu(!0),r({title:"",description:"ChromeEdge",duration:1500}))})},[r]),n?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"h-screen flex flex-col",children:[e.jsx(mm,{}),e.jsxs("main",{className:"grid flex-1 gap-2 overflow-auto p-2 grid-cols-1 md:grid-cols-[minmax(450px,1fr)_2fr] bg-muted/50",children:[e.jsx("div",{className:"relative hidden md:flex h-[calc(100vh-53px-1rem)]",children:t&&e.jsx(an,{})}),e.jsxs("div",{className:"relative flex h-full flex-col gap-2",children:[e.jsx(sm,{}),e.jsxs("div",{className:"flex gap-2 h-[50vh] md:h-[30vh] flex-col sm:flex-row",children:[e.jsx(hm,{}),e.jsx($h,{onOpenSceneDetailDialog:o})]})]})]})]}),!t&&a&&e.jsx("div",{className:"fixed top-0 left-0 size-full z-50",children:e.jsx(an,{onClose:()=>s(!1)})}),e.jsx(lp,{}),e.jsx(up,{}),e.jsx(mp,{})]}):e.jsx("div",{className:"flex h-screen items-center justify-center",children:n===!1?e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-semibold",children:""}),e.jsx("p",{className:"text-sm",children:"ChromeEdge"})]}):e.jsx("div",{className:"text-center",children:"..."})})}const fp=id([{path:"/",element:e.jsx(pp,{})}]);function xp(){return e.jsx(rd,{router:fp})}window.onbeforeunload=function(){return""};Vh();Qh().finally(()=>{Nh()});const gp=document.getElementById("root");od.createRoot(gp).render(e.jsx(xp,{}));export{vp as __vite_legacy_guard};
